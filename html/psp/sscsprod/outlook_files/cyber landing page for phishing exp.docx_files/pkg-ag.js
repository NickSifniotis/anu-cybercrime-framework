(function(){define("modules/clean/account_photo_modal/account_header",["jquery","require"],function(e,t){var s;return s=function(){function s(){}return s.init=function(s,r,n){return e(s).add(r).on("click",function(e){return e.preventDefault(),t(["modules/clean/account_photo_modal/controller"],function(e){return e.show()})}),e(document).on("db:account_photo:photo_set",function(t){return e(r).addClass(n)}),e(document).on("db:account_photo:photo_deleted",function(t){return e(r).removeClass(n)})},s}()})}).call(this),function(){define("modules/clean/avatar/inherited_count_avatar",["external/classnames","external/react","modules/clean/react/css"],function(e,t,s){var r,n;return n=t.DOM,r=t.createClass({displayName:"InheritedMemberCountAvatar",propTypes:{inheritedMemberCount:t.PropTypes.number.isRequired,onClick:t.PropTypes.func},render:function(){var t;return t=e({"u-unbutton":null!=this.props.onClick,"inherited-count-avatar":!0}),null!=this.props.onClick?n.button({className:t,onClick:this.props.onClick},this.props.inheritedMemberCount):n.div({className:t},this.props.inheritedMemberCount)}}),r=s(r,["/static/css/avatar_list-vflW4vhKE.css","/static/css/scooter/scooter-scoped-vfl6M_UYZ.css"])})}.call(this),function(){define("modules/clean/avatar/list",["external/classnames","external/react","modules/clean/avatar/inherited_count_avatar","modules/clean/avatar/overflow_count_pill","modules/clean/avatar/size"],function(e,t,s,r,n){var o,i,a,l;return i=n.VALID_AVATAR_DIMENSIONS,a=t.createElement,l=t.DOM,o=t.createClass({displayName:"HorizontalAvatarList",propTypes:{avatars:t.PropTypes.array.isRequired,avatarDimension:t.PropTypes.oneOf(i).isRequired,maxVisible:t.PropTypes.number.isRequired,undisplayableCount:t.PropTypes.number.isRequired,onOverflowCountClick:t.PropTypes.func,animation:t.PropTypes.bool,inheritedCountAvatar:t.PropTypes.node,className:t.PropTypes.string},getDefaultProps:function(){return{className:"",inheritedCountAvatar:null}},render:function(){var e,t,s;return e=this.props.avatars,t=this.props.maxVisible,s=0,this.props.undisplayableCount&&(s+=this.props.undisplayableCount),(this.props.undisplayableCount||e.length>t)&&(t--,s+=e.length-t,e=e.slice(0,t)),s&&e.push(a(r,{count:s,dimension:this.props.avatarDimension,key:"overflow_pill:"+s,onClick:this.props.onOverflowCountClick})),l.div({className:this.getClassName()},[this.props.inheritedCountAvatar,e])},getClassName:function(){return e(["horizontal-avatar-list","c-facepile",this.props.className,this.props.animation?["animation","is-animated"]:null])}})})}.call(this),function(){define("modules/clean/avatar/not_shared_avatar",["external/react","modules/clean/avatar/size","modules/clean/avatar/style","modules/clean/react/css","modules/clean/react/image","modules/clean/static_urls","modules/core/i18n"],function(e,t,s,r,n,o,i){var a,l,u,c,p,d,h;return l=t.VALID_AVATAR_DIMENSIONS,d=s.getClassName,h=o.static_url,u=i._,c=e.createElement,p=e.DOM,a=e.createClass({displayName:"NotSharedAvatar",propTypes:{alt:e.PropTypes.string,dimension:e.PropTypes.oneOf(l).isRequired,onClick:e.PropTypes.func},render:function(){var e,t;return t=c(n,{src:h("/static/images/avatar/lock-icon-vfli60-hO.png"),srcHiRes:h("/static/images/avatar/lock-icon@2x-vflK233wm.png"),alt:this.props.alt||u("Not shared")}),null!=this.props.onClick?(e=d(this.props.dimension,["c-avatar--meta u-unbutton"]),p.button({className:e,onClick:this.props.onClick},t)):(e=d(this.props.dimension,["c-avatar--meta"]),p.div({className:e},t))}})})}.call(this),function(){define("modules/clean/avatar/overflow_count_pill",["external/react","modules/clean/avatar/size","modules/clean/avatar/style","modules/clean/css","modules/core/i18n"],function(e,t,s,r,n){var o,i,a,l,u;return i=t.VALID_AVATAR_DIMENSIONS,l=s.getClassName,u=n.ungettext,a=e.DOM,o=e.createClass({displayName:"OverflowCountPill",propTypes:{dimension:e.PropTypes.oneOf(i).isRequired,count:e.PropTypes.number.isRequired,onClick:e.PropTypes.func},componentDidMount:function(){return r.require_css("/static/css/scooter/scooter-scoped-vfl6M_UYZ.css")},render:function(){var e,t;return t=" +"+this.props.count+" ",e=u("%(count)s more member","%(count)s more members",this.props.count).format({count:this.props.count}),null!=this.props.onClick?a.button({className:l(this.props.dimension,["overflow-pill c-avatar--meta u-unbutton"]),onClick:this.props.onClick},a.span({"aria-hidden":!0},t),a.span({className:"ax-visually-hidden"},e)):a.div({className:l(this.props.dimension,["overflow-pill c-avatar--meta"])},a.span({"aria-hidden":!0},t),a.span({className:"ax-visually-hidden"},e))}})})}.call(this),function(){define("modules/clean/avatar/shared_link_avatar",["external/react","modules/clean/avatar/size","modules/clean/avatar/style","modules/clean/css","modules/clean/static_urls","modules/core/i18n"],function(e,t,s,r,n,o){var i,a,l,u,c,p;return a=t.VALID_AVATAR_DIMENSIONS,c=s.getClassName,p=n.static_url,l=o._,u=e.DOM,i=e.createClass({displayName:"SharedLinkAvatar",propTypes:{alt:e.PropTypes.string,dimension:e.PropTypes.oneOf(a).isRequired,onClick:e.PropTypes.func},componentDidMount:function(){return r.require_css("/static/css/scooter/scooter-scoped-vfl6M_UYZ.css")},render:function(){var e,t;return t=u.img({src:p("/static/images/avatar/shared-link-icon-vflHCU_m6.svg"),alt:this.props.alt||l("Shared link"),width:12}),null!=this.props.onClick?(e=c(this.props.dimension,["c-avatar--meta u-unbutton"]),u.button({className:e,onClick:this.props.onClick},t)):(e=c(this.props.dimension,["c-avatar--meta"]),u.div({className:e,onClick:this.props.onClick},t))}})})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t=function(e,t){function r(){this.constructor=e}for(var n in t)s.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},s={}.hasOwnProperty;define("modules/clean/components/bubble_menu",["jquery","modules/clean/keycode","modules/clean/components/bubble_dropdown"],function(s,r,n){var o;return o=function(n){function o(t,s,r,n){this.$root=t,this.arrow_direction=s,this.show_on_hover=r,this.top_adjustment=null!=n?n:0,this.onKeyDown=e(this.onKeyDown,this),this.onMouseEnter=e(this.onMouseEnter,this),this.$target=this.$root.find(".bubble-dropdown-target"),this.$target.on("keydown",this.onKeyDown),this.$menu=this.$root.find('*[role="menu"]'),this.$menuitems=this.$root.find('*[role="menuitem"]'),this.$menuitems.attr("role","menuitem"),this.$menuitems.on("keydown",this.onKeyDown),this.$menuitems.on("mouseenter",this.onMouseEnter),o.__super__.constructor.apply(this,arguments)}return t(o,n),o.prototype.focusPrevious=function(e){var t;return t=this.$menuitems.index(e),t=-1===t||0===t?this.$menuitems.length-1:t-1,this.$menuitems.get(t).focus()},o.prototype.focusNext=function(e){var t;return t=this.$menuitems.index(e),t=-1===t||t===this.$menuitems.length-1?0:t+1,this.$menuitems.get(t).focus()},o.prototype.onMouseEnter=function(e){return s(this.$menu).removeClass("bubble-menu--keyboard")},o.prototype.onKeyDown=function(e){return s(this.$menu).addClass("bubble-menu--keyboard"),e.keyCode===r.DOWN?(this.focusNext(e.target),e.stopPropagation(),e.preventDefault()):e.keyCode===r.UP?(this.focusPrevious(e.target),e.stopPropagation(),e.preventDefault()):void 0},o}(n)})}.call(this),function(){define("modules/clean/dropbox_nav",["jquery","modules/clean/analytics","modules/clean/photos/photos_engagement_logger"],function(e,t,s){var r;return r=function(){function r(){e(".carousel-nav-item").click(function(e){return function(){return e.log_click("carousel_nav_link_click")}}(this)),e(".composer-nav-item").click(function(e){return function(){return e.log_click("composer_nav_link_click")}}(this)),e(".mailbox-nav-item").click(function(e){return function(){return e.log_click("mailbox_nav_link_click")}}(this)),e(".carousel-nav-item").click(function(){return s.log_and_send(s.CAROUSEL_NAV_LINK_CLICK)}),e(".photos-nav-item").click(function(){return s.log_and_send(s.PHOTOS_NAV_LINK_CLICK)})}return r.prototype.log_click=function(e){return t.WebMiscActivityLogger.log(e)},r}()})}.call(this),function(){define("modules/clean/file_operations/notifications",["external/underscore","modules/clean/browse_interface","modules/clean/em_string","modules/clean/filepath","modules/clean/react/browse/api","modules/clean/undo","modules/core/html","modules/core/i18n","modules/core/notify"],function(e,t,s,r,n,o,i,a,l){var u,c,p,d,h,_,m,f,g,b,S;return u=a._,S=a.ungettext,b=function(e,t,s,r,i){var a;return a=function(){return n.rollbackChangeSets({changesets:s,userId:t.id,progressText:u("Undoing…"),rollbackHints:r,onSuccess:function(){return l.success(u("Undo complete.")),"function"==typeof i?i():void 0}})},o.notifyWithUndo(e,s,a)},c=function(n,o){var i,a,l;return a=t.browse_uri_for_fq_path(o,n),l=40,i=s.em_snippet(r.filename(n),l),{href:a,text:e.escape(i)}},p=function(e,t,s,r,n,o){var a,l,u;return null==r&&(r=null),r?(a=c(r,t),u=S('Copied %(num_items)d item to <a href="%(dest_href)s">%(dest_name)s</a>.','Copied %(num_items)d items to <a href="%(dest_href)s">%(dest_name)s</a>.',e),l=u.format({num_items:e,dest_href:a.href,dest_name:a.text}),l=new i(l)):(l=S("Copied %(num_items)d item.","Copied %(num_items)d items.",e),l=l.format({num_items:e})),b(l,t,s,n,o)},_=function(e,t,s,r,n,o){var a,l,u;return l=null,r?(a=c(r,t),u=S('Moved %(num_items)d item to <a href="%(dest_href)s">%(dest_name)s</a>.','Moved %(num_items)d items to <a href="%(dest_href)s">%(dest_name)s</a>.',e),l=u.format({num_items:e,dest_href:a.href,dest_name:a.text}),l=new i(l)):(u=S("Moved %(num_items)d item.","Moved %(num_items)d items.",e),l=u.format({num_items:e})),b(l,t,s,n,o)},d=function(e,t,s,r,n){var o,a;return a=S("Deleted %(num_items)d item","Deleted %(num_items)d items",e),o=a.format({num_items:e}),o=new i(o),b(o,t,s,r,n)},f=function(e,t,s,r){var n;return n=u("Rename complete."),n=new i(n),b(n,e,t,s,r)},h=function(e,t,s){var r,n;return n=u("Created folder %(folder_name)s"),r=n.format({folder_name:e}),r=new i(r),b(r,t,s)},m=function(e){var t,s;return s=S("Permanently deleted %(num)s item","Permanently deleted %(num)s items",e),t=s.format({num:e}),l.success(t)},g=function(t){var s,n,o,a;return s=t.length,1===s?(n=r.filename(t[0].fq_path),n=e.escape(n),a=u("Restored <strong>%(filename)s</strong>."),o=a.format({filename:n}),o=new i(o)):(a=S("Restored %(num)s file.","Restored %(num)s files.",s),o=a.format({num:s})),l.success(o)},{notifyCopySuccess:p,notifyMoveSuccess:_,notifyDeleteSuccess:d,notifyRestoreSuccess:g,notifyPurgeSuccess:m,notifyFolderCreationSuccess:h,notifyRenameSuccess:f}})}.call(this),function(){"use strict";var e=[].slice;define("modules/clean/flux/store_mixin",[],function(){var t;return t=function(){var t;return t=1<=arguments.length?e.call(arguments,0):[],{getInitialState:function(){return this._get_state_from_stores(this.props)},componentDidMount:function(){var e,s,r;for(e=0,s=t.length;s>e;e++)r=t[e],r.add_change_listener(this._handle_store_changed);return this.setState(this._get_state_from_stores(this.props))},componentWillUnmount:function(){var e,s,r,n;for(r=[],e=0,s=t.length;s>e;e++)n=t[e],r.push(n.remove_change_listener(this._handle_store_changed));return r},_handle_store_changed:function(){var e;return this.isMounted()&&(e=this._get_state_from_stores(this.props),null!=e)?this.setState(e):void 0}}}})}.call(this),function(){define("modules/clean/payments/pro_trial_onboarding_tour",["jquery","modules/clean/ajax","modules/clean/react/pro/pro_onboarding_tour_modal"],function(e,t,s){var r,n,o;return n=s.ProOnboardingTourModal,o=function(){function e(e,t,s,r,o){this.$container=e,this.modal_autoshow=t,this.modal_id=s,this.modal_paths=r,this.modal_content=o,this.tourProps={modalId:this.modal_id,onboardingPaths:this.modal_paths,contentSource:this.modal_content},this.modal_autoshow&&n.renderWithProps(this.tourProps),this._listen()}return e.prototype._listen=function(){return this.$container.find(".start-tour").on("click",function(e){return function(t){return t.preventDefault(),n.renderWithProps(e.tourProps)}}(this))},e}(),r=function(){function s(e){this.active_onboarding_class=e,this._listen()}return s.prototype._listen=function(){return e(this.active_onboarding_class).on("click",function(t){var r;return r=e(t.currentTarget).data("onboarding-step"),s.setUserOnboardingAttribute(t.currentTarget,r)})},s.setUserOnboardingAttribute=function(s,r){var n;return n=this.active_onboarding_class||"global-actions__button--onboarding",t.WebRequest({url:"/ajax_set_pro_onboarding_step",data:{queue_onboarding_step:parseInt(r)},success:function(t){var r,o,i;if(t)try{if(i=JSON.parse(t),i.subgrowth_pro_onboarding_step_increase)return e(s).removeClass(n)}catch(t){return r=t,e.noop()}}})},s}(),{ProTrialOnboardingTourHeaderLink:o,ProOnboardingTooltips:r}})}.call(this),function(){define("modules/clean/photos/photos_engagement_logger",["jquery","modules/clean/ajax"],function(e,t){var s;return s=function(){function s(){}return s.Platform={WEB:"web",WEB_CAROUSEL:"web_carousel"},s.CAROUSEL_NAV_LINK_CLICK="carousel_nav_link_click",s.PHOTOS_NAV_LINK_CLICK="photos_nav_link_click",s.WEBAPP_VIEW_TIMELINE="webapp_view_gallery",s.WEBAPP_VIEW_SHARED_ALBUM="webapp_view_conversations",s.WEBAPP_VIEW_SHARED_ALBUMS_GRID="webapp_view_shared_albums_grid",s.WEBAPP_VIEW_ALBUMS_GRID="webapp_view_albums_grid",s.WEBAPP_VIEW_ALBUM="webapp_view_albums",s.WEBAPP_VIEW_FLASHBACK="webapp_view_flashback",s.WEBAPP_ACTION_ADD_TO_ALBUM="webapp_action_add_to_album",s.WEBAPP_ACTION_REMOVE_FROM_ALBUM="webapp_action_remove_from_album",s.WEBAPP_ACTION_DOWNLOAD="webapp_action_download",s.WEBAPP_ACTION_SHOW_IN_FOLDER="webapp_action_show_in_folder",s.WEBAPP_ACTION_DELETE="webapp_action_delete",s.WEBAPP_SHOW_EXCLUDE_MODAL="webapp_show_exclude_modal",s.ATTEMPT_EXCLUDE_CAROUSEL_SUBFOLDER="attempt_exclude_carousel_subfolder",s.ATTEMPT_EXCLUDE_CU_FOLDER="attempt_exclude_cu_folder",s.ATTEMPT_EXCLUDE_CAROUSEL_FOLDER="attempt_exclude_carousel_folder",s.ATTEMPT_EXCLUDE_DROPBOX_ROOT="attempt_exclude_dropbox_root",s.WEBAPP_GALLERY_SELECT_EVENT="webapp_gallery_select_event",s.WEBAPP_GALLERY_DESELECT_EVENT="webapp_gallery_deselect_event",s.WEBAPP_GALLERY_SELECT_ITEM="webapp_gallery_select_item",s.WEBAPP_GALLERY_DESELECT_ITEM="webapp_gallery_deselect_item",s.WEBAPP_GALLERY_TIME_FIRST_ITEM="webapp_gallery_time_first_item",s.WEBAPP_GALLERY_TIME_EVENTS_OUTLINE="webapp_gallery_time_events_outline",s.WEBAPP_GALLERY_TIME_FIRST_VISIBLE_EVENTS="webapp_gallery_time_first_visible_events",s.WEBAPP_GALLERY_TIME_FIRST_VISIBLE_THUMBS_BATCH="webapp_gallery_time_first_visible_thumbs_batch",s.WEBAPP_GALLERY_EMPTY="webapp_gallery_empty",s.WEBAPP_GALLERY_CONTEXT_MENU_SHOWN="webapp_gallery_context_menu_shown",s.WEBAPP_LIGHTBOX_OPEN="webapp_lightbox_open",s.WEBAPP_LIGHTBOX_DOWNLOAD="webapp_lightbox_download",s.WEBAPP_LIGHTBOX_SELECT_ITEM="webapp_lightbox_select_item",s.WEBAPP_LIGHTBOX_DESELECT_ITEM="webapp_lightbox_deselect_item",s.WEBAPP_LIGHTBOX_FORWARD="webapp_lightbox_forward",s.WEBAPP_LIGHTBOX_BACK="webapp_lightbox_back",s.WEBAPP_LIGHTBOX_SHARE="webapp_lightbox_share",s.WEBAPP_LIGHTBOX_CLOSE_ICON="webapp_lightbox_close_icon",s.WEBAPP_LIGHTBOX_CLOSE_KEY="webapp_lightbox_close_key",s.WEBAPP_TIMELINE_NAVIGATION_SHOWN="webapp_timeline_navigation_shown",s.WEBAPP_TIMELINE_NAVIGATION_TRACK_CLICKED="webapp_timeline_navigation_track_clicked",s.WEBAPP_TIMELINE_NAVIGATION_SCRUBBER_DRAGGED="webapp_timeline_navigation_scrubber_dragged",s.WEBAPP_SHARE_CART_CANCEL="webapp_share_cart_cancel",s.WEBAPP_SHARE_CART_SHARE="webapp_share_cart_share",s.WEBAPP_SHARE_CART_SHARE_FACEBOOK="webapp_share_cart_share_facebook",s.WEBAPP_SHARE_CART_SHARE_TWITTER="webapp_share_cart_share_twitter",s.WEBAPP_SHARE_CART_ITEM_CLICKED="webapp_share_cart_item_clicked",s.WEBAPP_SHARE_DROPDOWN_SEND_LINK="webapp_share_dropdown_send_link",s.WEBAPP_SHARE_DROPDOWN_SHARED_ALBUM="webapp_share_dropdown_shared_album",s.WEBAPP_OPEN_SHARE_MODAL="webapp_open_share_modal",s.WEBAPP_GALLERY_DELETE_MODAL_CONFIRMED="webapp_gallery_delete_modal_confirmed",s.WEBAPP_GALLERY_DELETE_MODAL_CANCELED="webapp_gallery_delete_modal_canceled",s.WEBAPP_GALLERY_REMOVE_FROM_ALBUM_MODAL_CONFIRMED="webapp_gallery_remove_from_album_modal_confirmed",s.WEBAPP_GALLERY_REMOVE_FROM_ALBUM_MODAL_CANCELED="webapp_gallery_remove_from_album_modal_canceled",s.WEBAPP_SHARE_COMPOSER_RECIPIENT="webapp_share_composer_recipient",s.WEBAPP_SHARE_COMPOSER_MESSAGE="webapp_share_composer_message",s.WEBAPP_SHARE_COMPOSER_SHARE="webapp_share_composer_share",s.WEBAPP_SHARE_COMPOSER_TWITTER="webapp_share_composer_twitter",s.WEBAPP_SHARE_COMPOSER_FACEBOOK="webapp_share_composer_facebook",s.WEBAPP_SHARE_COMPOSER_LINK="webapp_share_composer_link",s.WEBAPP_SHARE_WITH_SELF_ATTEMPT="webapp_share_with_self_attempt",s.WEBAPP_CONVERSATIONS_ROOM_CLICKED="webapp_conversations_room_clicked",s.WEBAPP_CONVERSATIONS_VIEW_SETTINGS="webapp_conversations_view_settings",s.WEBAPP_CONVERSATIONS_CLOSE_SETTINGS="webapp_conversations_close_settings",s.WEBAPP_CONVERSATIONS_TIME_FIRST_POST="webapp_conversations_time_first_post",s.WEBAPP_CONVERSATIONS_EMPTY="webapp_conversations_empty",s.WEBAPP_CONVERSATIONS_CHAT_VIEW_CLICKED="webapp_conversations_chat_view_clicked",s.WEBAPP_CONVERSATIONS_GALLERY_VIEW_CLICKED="webapp_conversations_gallery_view_clicked",s.WEBAPP_CONVERSATIONS_CHAT_VIEW_LOAD_MORE="webapp_conversations_chat_view_load_more",s.WEBAPP_CONVERSATIONS_GALLERY_VIEW_LOAD_MORE="webapp_conversations_gallery_view_load_more",s.WEBAPP_SHARING_COMMENT_SUBMIT="webapp_sharing_comment_submit",s.WEBAPP_SHARING_GALLERY_ADD_PHOTOS="webapp_sharing_gallery_add_photos",s.WEBAPP_SHARING_COPY_LINK="webapp_sharing_copy_link",s.WEBAPP_SHARING_LIKE_ITEM="webapp_sharing_like_item",s.WEBAPP_SHARING_UNLIKE_ITEM="webapp_sharing_unlike_item",s.WEBAPP_FLASHBACK_SELECT_EVENT="webapp_flashback_select_event",s.WEBAPP_FLASHBACK_SELECT_ITEM="webapp_flashback_select_item",s.WEBAPP_FLASHBACK_CLICK_ITEM="webapp_flashback_click_item",s.WEBAPP_FLASHBACK_CLICK_SHARE="webapp_flashback_click_share",s.WEBAPP_FLASHBACK_SURVEY_RESPONSE="webapp_flashback_survey_response",s.WEBAPP_FLASHBACK_SURVEY_FREE_RESPONSE="webapp_flashback_survey_free_response",s.WEBAPP_FLASHBACK_SHARE_ALL="webapp_flashback_share_all",s.WEBAPP_FLASHBACK_SHARE_SINGLE_ITEM_FACEBOOK="webapp_flashback_share_single_item_facebook",s.WEBAPP_FLASHBACK_SHARE_SINGLE_ITEM_TWITTER="webapp_flashback_share_single_item_twitter",s.WEBAPP_FLASHBACK_SHARE_SINGLE_ITEM_LINK="webapp_flashback_share_single_item_link",s.PUBLIC_LASS_INPUT_CLICK="public_lass_input_click",s.PUBLIC_LASS_INPUT_MESSAGE="public_lass_input_message",s.PUBLIC_LASS_INPUT_SUBMIT="public_lass_input_submit",s.PUBLIC_LASS_ADD_PHOTOS="public_lass_add_photos",s.PUBLIC_LASS_LIKE_CLICK="public_lass_like_click",s.PUBLIC_LASS_START_LOGIN="public_lass_start_login",s.PUBLIC_LASS_FINISH_LOGIN="public_lass_finish_login",s.PHOTO_SPACE_START_LOGIN="photo_space_start_login",s.PHOTO_SPACE_FINISH_LOGIN="photo_space_finish_login",s.PHOTO_SPACE_SUBSCRIBE="photo_space_subscribe",s.MOBILE_DROPBOX_FLASHBACK_SHARE_CART_SHARE="share_cart_share",s.MOBILE_DROPBOX_FLASHBACK_SHARE_CART_CANCEL="share_cart_cancel",s.MOBILE_DROPBOX_FLASHBACK_LINK_GENERATED="link_generated",s.MOBILE_DROPBOX_FLASHBACK_SHARE_DONE="share_done",s.first_log_sent=!1,s.logs_queued=[],s.HACK_prefix_to_replace=null,s.HACK_prefix_replace_with=null,s.HACK_new_platform=null,s.HACK_extra={},s.hack_all_log_prefixes_and_platform=function(e){var t,r,n,o;return o=e.prefix_to_replace,n=e.prefix_replace_with,r=e.new_platform,t=e.extra,s.HACK_prefix_to_replace=o,s.HACK_prefix_replace_with=n,s.HACK_new_platform=r,s.HACK_extra=t},s.apply_hacky_log_overrides=function(t,r,n){var o,i;return s.HACK_prefix_to_replace?(i=0===t.indexOf(s.HACK_prefix_to_replace)?t.replace(s.HACK_prefix_to_replace,s.HACK_prefix_replace_with):0!==t.indexOf(s.HACK_prefix_replace_with)?s.HACK_prefix_replace_with+t:t,o=e.extend({},n,this.HACK_extra),[i,s.HACK_new_platform,o]):[t,r,n]},s.log_and_send=function(e,r,n){var o;return null==r&&(r={}),null==n&&(n=s.Platform.WEB),o=s.apply_hacky_log_overrides(e,n,r),e=o[0],n=o[1],r=o[2],t.AuthenticatedRequest({url:"/photos/photos_engagement_log",data:{event:e,extra:JSON.stringify(r),platform:n}})},s.log=function(e,t,r){var n,o;return this._init(),s.first_log_sent?(null==t&&(t={}),null==r&&(r=s.Platform.WEB),o=s.apply_hacky_log_overrides(e,r,t),e=o[0],r=o[1],t=o[2],n={event:e,extra:t,platform:r},s.logs_queued.push(n)):(s.log_and_send(e,t,r),void(s.first_log_sent=!0))},s.log_carousel=function(e,t){return s.log(e,t,s.Platform.WEB_CAROUSEL)},s._send_log_batch=function(){return s.logs_queued.length?(t.AuthenticatedRequest({url:"/photos/photos_engagement_batch_log",data:{events:JSON.stringify(s.logs_queued)}}),s.logs_queued=[]):void 0},s._init=function(){return this._initialized?void 0:(this._initialized=!0,setInterval(s._send_log_batch,1e4),e(window).unload(s._send_log_batch))},s}()})}.call(this),function(){define("modules/clean/raf",function(){var e,t,s,r,n,o,i;for(t=window.requestAnimationFrame,e=window.cancelAnimationFrame,o=["ms","moz","webkit","o"],s=0,n=o.length;n>s&&(i=o[s],!t);s++)t=window[i+"RequestAnimationFrame"],e=window[i+"CancelAnimationFrame"]||window[i+"CancelRequestAnimationFrame"];return t||(r=0,t=function(e,t){var s,n,o,i;return s=(new Date).getTime(),i=Math.max(0,16-(s-r)),n=function(){return e(s+i)},o=setTimeout(n,i),r=s+i,o}),e||(e=function(e){return clearTimeout(e)}),{requestAnimationFrame:t.bind(window),cancelAnimationFrame:e.bind(window)}})}.call(this),function(){define("modules/clean/react/app_actions_view",["external/react","modules/clean/react/sprite_div"],function(e,t){var s,r,n,o;return o=e.DOM,r=e.PropTypes.shape({displayName:e.PropTypes.string.isRequired,handleClick:e.PropTypes.func}),n=e.PropTypes.shape({displayName:e.PropTypes.string.isRequired,handleClick:e.PropTypes.func,iconName:e.PropTypes.string.isRequired}),s=e.createClass({displayName:"AppActionsView",propTypes:{headerText:e.PropTypes.string,primaryMenuItem:r.isRequired,secondaryMenuItems:e.PropTypes.arrayOf(n)},getDefaultProps:function(){return{headerText:"",secondaryMenuItems:[]}},_renderMenuItemIcon:function(s){return e.createElement(t,{ref:"icon",alt:"",group:"web",name:s.iconName})},render:function(){var e,t;return e=o.div({},o.span({className:"header-text"},this.props.headerText),o.button({className:"button-primary primary-menu-button",onClick:this.props.primaryMenuItem.handleClick},this.props.primaryMenuItem.displayName)),t=this.props.secondaryMenuItems.map(function(e){return function(t){var s,r;return r=e._renderMenuItemIcon(t),s=o.button({className:"secondary-menu-button",onClick:t.handleClick},r,o.span({className:"secondary-menu-button-text"},t.displayName)),o.li({},s)}}(this)),o.div({className:"appactions-menu"},e,o.ul({},t))}})})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,s=this.length;s>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/browse/api",["external/underscore","modules/clean/ajax","modules/clean/react/browse/constants","modules/clean/filepath","modules/clean/history","modules/clean/pagination_manager","modules/clean/react/browse/models","modules/clean/react/browse/store","modules/clean/viewer","modules/core/browser","modules/core/i18n","modules/core/notify","modules/core/uri","modules/constants/browse","modules/constants/viewer"],function(t,s,r,n,o,i,a,l,u,c,p,d,h,_,m){var f,g,b,S,y,v,T,w,E,P,F,I,D,C,N,A,R,O;return S=r.LoadingStates,b=a.File,f=a.BrowseContext,g=l.BrowseStore,y=p._,O=function(e){var t,s;try{return JSON.parse(e)}catch(e){if(s=e,!(s instanceof SyntaxError))throw s}return null},I=function(e){var r,n,o,i,a,l,u,c,p;return i=e.path,p=e.userId,o=e.onSuccess,r=null!=(a=e.includeDeletedFiles)?a:!1,c=null!=(l=e.sortFoldersFirst)?l:!0,n=null!=(u=e.onError)?u:t.noop,s.WebRequest({data:{show_deleted:r||"",sort_folders_first:c},url:h({path:"/browse"+i}),subject_user:p,success:function(e){var t;return t=O(e),t?o({path:i,data:t}):void 0},error:function(e,t,s){return"function"==typeof n?n(e,t,s):void 0}})},v=function(r){var n,o,i,a,l,u;return o=r.files,a=r.newPath,u=r.userId,l=r.onSuccess,i=function(){var e,t,s;for(s=[],e=0,t=o.length;t>e;e++)n=o[e],s.push(n.fq_path);return s}(),e.call(i,a)>=0?(d.error(y("You can’t copy a folder into itself.")),null):s.WebProgressRequest({url:h({path:"/cmd/copy"}),data:{files:i,to_path:a},subject_user:u,progress_text:y("Copying files..."),success:function(e){try{return t.isString(e)&&(e=JSON.parse(e)),o=function(){var t,s,r,o;for(r=e.new_browse_files,o=[],t=0,s=r.length;s>t;t++)n=r[t],o.push(b.fromServerObject(n));return o}(),l({files:o,destinationPath:a,changesets:e.changesets,rollbackHints:e.rollback_hints})}catch(e){}}})},w=function(e){var r,n,o,i,a;return n=e.files,a=e.userId,i=e.onSuccess,o=function(){var e,t,s;for(s=[],e=0,t=n.length;t>e;e++)r=n[e],s.push(r.fq_path);return s}(),s.WebProgressRequest({url:h({path:"/cmd/delete"}),data:{files:o},subject_user:a,progress_text:y("Deleting files..."),success:function(e){var s,r;try{return t.isString(e)&&(e=JSON.parse(e)),r=function(){var e,t,r;for(r=[],e=0,t=n.length;t>e;e++)s=n[e],r.push({before:s,after:null});return r}(),i({fileDeltas:r,changesets:e.changesets,rollbackHints:e.rollback_hints})}catch(e){}}})},D=function(r){var o,i,a,l,u,c,p;return c=r.path,i=r.files,l=r.newPath,p=r.userId,u=r.onSuccess,c===l?(d.error(y("Those files already exist in that folder.")),null):(a=function(){var e,t,s;for(s=[],e=0,t=i.length;t>e;e++)o=i[e],s.push(o.fq_path);return s}(),e.call(a,l)>=0?(d.error(y("You can’t move a folder into itself.")),null):s.WebProgressRequest({url:h({path:"/cmd/move"}),data:{files:a,to_path:l},subject_user:p,progress_text:y("Moving files..."),success:function(e){var s;try{return t.isString(e)&&(e=JSON.parse(e)),i=g.filesMap(),s=function(){var s,r,l,u;for(l=e.new_browse_files,u=[],s=0,r=l.length;r>s;s++)o=l[s],u.push({before:i.get(t.find(a,function(e){return n.filename(e)===n.filename(o.fq_path)}),null),after:b.fromServerObject(o)});return u}(),u({path:c,destinationPath:l,fileDeltas:s,changesets:e.changesets,rollbackHints:e.rollback_hints})}catch(e){}}}))},N=function(e){var t,r,n,o,i;return t=e.file,r=e.newName,i=e.userId,o=e.onSuccess,n=e.onError,s.WebRequest({url:h({path:"/cmd/rename"+t.fq_path}).toString(),subject_user:i,data:{to_path:r},success:function(e,t,s){var r,i,a,l;l=null;try{l=JSON.parse(e)}catch(e){if(r=e,!(r instanceof SyntaxError))throw r}return l?(a=b.fromServerObject(l.new_browse_files[0]),o({changesets:l.changesets,renamedFile:a,rollbackHints:l.rollback_hints})):n?n():void 0},error:n?n:void 0})},F=function(e){var t,s,r,n;return t=e.fqPath,n=e.userId,s={prev:h.parse(o.get_url()).setFragment("").toString()},s[m.UID_PARAM_NAME]=n,t=t.replace(/^[\/]/,""),r=h({path:"/restore/"+t}).updateQuery(s),r.toString()},P=function(e){var t,s,r,n;return t=e.fqPath,n=e.userId,r={undelete:1},r[m.UID_PARAM_NAME]=n,t=t.replace(/^[\/]/,""),s=_.REVISION_HISTORY_WEB?"/history":"/revisions",h({path:s+"/"+t}).updateQuery(r).toString()},A=function(e){var r,n,o;return r=e.files,o=e.userId,n=e.onSuccess,s.WebProgressRequest({url:"/cmd/restore",data:{files:t.pluck(r,"fq_path")},subject_user:o,dataType:"json",progress_text:y("Restoring…"),success:function(e){return n()}})},C=function(e){var r,n,o,i,a;return r=e.files,a=e.userId,n=e.onSuccess,o=null!=(i=e.progressText)?i:y("Deleting…"),s.WebProgressRequest({url:"/cmd/purge",data:{files:t.pluck(r,"fq_path")},subject_user:a,dataType:"text",progress_text:o,success:function(e){var t;return t=O(e),t&&"success"===t.status?n():void 0}})},R=function(e){var t,r,n,o,i,a;return a=e.userId,t=e.changesets,n=e.progressText,i=null!=(o=e.rollbackHints)?o:{},r=e.onSuccess,s.WebProgressRequest({url:h({path:"/cmd/rollback"}),data:{ns_to_cs:JSON.stringify(t),rollback_hints:JSON.stringify(i)},subject_user:a,progress_text:n,success:function(){return r()}})},T=function(e){var t,r,n,o,i;return o=e.pathName,t=e.folderName,i=e.userId,n=e.onSuccess,r=e.onError,s.WebProgressRequest({url:h({path:"/cmd/new"+o}),data:{to_path:t,folder:"yes"},subject_user:i,success:function(e){var t,s;return t=O(e),t?(s=b.fromServerObject(t.new_browse_files[0]),n({changesets:t.changesets,createdFolder:s})):void 0},error:function(){return r()}})},E=function(e){var t,r,n,o,i,a,l,u,c;return a=e.path,c=e.userId,r=e.namespaceToJournalIdMap,t=e.includeDeletedFiles,o=e.onSuccess,l="/"===a?"":a,i={fq_dir:l,ns_map:function(){var e;e=[];for(n in r)u=r[n],e.push(n+"_"+u);return e}().join(","),show_deleted:Boolean(t)},s.WebRequest({url:h({path:"/update/list_dir"}),subject_user:c,data:i,dataType:"text",success:function(e){var t;return t=O(e),t?o(t):void 0}})},{loadPath:I,copyFiles:v,moveFiles:D,deleteFiles:w,renameFile:N,getFileHistoryUrl:P,getRestoreFileUrl:F,restoreFiles:A,purgeFiles:C,rollbackChangeSets:R,getChangesForDirectory:E,createNewFolder:T}})}.call(this),function(){define("modules/clean/react/browse/cdm_mve_work_usage_banner",["external/react","modules/clean/react/browse/models","modules/clean/react/css","modules/clean/teams/cdm_mve_quota_usage","modules/core/i18n"],function(e,t,s,r,n){var o,i,a,l,u,c;return i=t.QuotaStats,a=n._,c=e.DOM,u=e.createElement,l=e.createClass({displayName:"CdmMveWorkUsageBanner",propTypes:{userQuota:e.PropTypes.instanceOf(i).isRequired},mixins:[e.addons.PureRenderMixin],render:function(){return c.div({className:"c-banner c-banner--unpinned u-pad-s"},c.strong({},a("Only you have access")),u(r,{quotaStats:this.props.userQuota}))}}),o=s(l,["/static/css/shared_folder_members_preview/cdm_mve_banner-vflRBgSZE.css"])})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,s=this.length;s>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/browse/file_jump",["modules/clean/keycode","modules/clean/react/browse/store","modules/core/dom","modules/clean/react/browse/constants","modules/clean/flux/dispatcher"],function(t,s,r,n,o){var i,a,l,u,c;return l=s.BrowseStore,a=n.BrowseActionTypes,i=["/","\\",":","?","*","<",">","|"],c=1e3,u={_timeout:null,_reset:function(){return o.dispatch({type:a.RESET_FILE_JUMP})},handleKeyPress:function(s){var n,u,p;return u=null!=(p=s.which)?p:s.keyCode,n=String.fromCharCode(u),u<t.SPACE||e.call(i,n)>=0||r.focus_in_input()||s.metaKey||s.altKey||s.altGraphKey||s.ctrlKey||u===t.SPACE&&!l.isFileJumping()?void 0:(u===t.SPACE&&l.isFileJumping()&&s.preventDefault(),o.dispatch({type:a.ADD_FILE_JUMP_KEY_CODE,data:{keyChar:n}}),null!=this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout(this._reset,c))}}})}.call(this),function(){define("modules/clean/react/browse/file_list_empty_folder",["external/classnames","external/react","modules/clean/analytics","modules/clean/react/browse/constants","modules/clean/react/button","modules/clean/react/file_uploader/uploader","modules/clean/react/image","modules/clean/static_urls","modules/core/i18n"],function(e,t,s,r,n,o,i,a,l){var u,c,p,d,h,_,m,f,g;return d=s.TeamsWebActionsLogger,p=r.NameSpaceAccess,_=n.button,c=o.FileUploader,g=a.static_url,h=l._,f=t.DOM,m=t.createElement,u=t.createClass({propTypes:{currentSharedFolderPermissionRole:t.PropTypes.number,isArchiveState:t.PropTypes.bool,isBrowseInContentManager:t.PropTypes.bool,isInCdmMve:t.PropTypes.bool,isInsideSharedFolder:t.PropTypes.bool,isSearchState:t.PropTypes.bool,isViewingTeamFolder:t.PropTypes.bool,userId:t.PropTypes.number.isRequired,userFamiliarName:t.PropTypes.string},mixins:[t.addons.PureRenderMixin],displayName:"EmptyFolder",getDefaultProps:function(){return{isSearchState:!1}},_logTeamAction:function(e){return d.log(e,null,null,this.props.userId,!1,d.LOG_CATEGORY.TEAM_INFO)},render:function(){var t,s,r,n,o,a,l,u;return l=this.props.isInsideSharedFolder&&this.props.currentSharedFolderPermissionRole===p.ACCESS_READER,s={"u-l-dn":l,"drag-prompt":!0},this.props.isSearchState?f.div({className:"u-font-center u-pad-top-xl"},m(i,{src:g("/static/images/empty_states/search-vfl6DaX2I.png"),srcHiRes:g("/static/images/empty_states/search@2x-vflBsUhDE.png"),alt:""}),f.h2({className:"u-pad-top-l"},h("No results found")),f.div({},h("Please update your search and try again"))):this.props.isBrowseInContentManager&&this.props.isArchiveState?f.div({
className:"u-font-center u-font-meta u-pad-top-xl"},h("No archived team folders")):this.props.isBrowseInContentManager&&this.props.isViewingTeamFolder?f.div({className:"u-font-center u-pad-top-xl"},m(i,{src:g("/static/images/empty_states/collaboration-team-folder-vflapVQHo.png"),srcHiRes:g("/static/images/empty_states/collaboration-team-folder@2x-vflsqkNUB.png"),alt:h("user avatars arranged around a shared folder")}),f.div({className:"u-font-center u-font-meta"},h("Create a team folder to get started.")),f.a({href:"/help/224",target:"_blank"},h("What are team folders?"))):(this.props.isViewingTeamFolder?(this._logTeamAction("upload_files_displayed"),this.props.isInCdmMve?r=f.div({},f.h2({},h("Welcome to your team, %(name)s!").format({name:this.props.userFamiliarName})),f.span({},h("You don’t have any team files yet. Upload files here to instantly share them with your teammates. You can even drag and drop files from your desktop here."))):(o=g("/static/images/empty_states/team-folder-vflZkv0TQ.png"),a=g("/static/images/empty_states/team-folder@2x-vfloC8f3o.png"),n=h("people collaborating with Dropbox"),r=h("This Team folder is empty. Upload files to this folder to share with your Team.")),t=f.div({className:"o-grid"},f.div({className:e({"o-grid__col--centered":!0,"u-pad-top-m":!this.props.isInCdmMve,"o-grid__col--1-of-3":!this.props.isInCdmMve,"o-grid__col--1-of-2":this.props.isInCdmMve})},r,m(_,{onClick:function(e){return function(){return c.showModal(),e._logTeamAction("upload_files_clicked")}}(this)},h("Upload files"))))):(o=g("/static/images/empty_states/files-vflsVPyeo.png"),a=g("/static/images/empty_states/files@2x-vflvkuH8g.png"),n=h("Dropbox folder with files"),u=f.h2({},h("This folder is empty.")),t=this.props.isBrowseInContentManager?f.div({},""):f.div({},h("Drag and drop files onto this window to upload."))),f.div({className:"u-font-center u-pad-top-xl"},o?m(i,{src:o,srcHiRes:a,alt:n}):void 0,u,f.div({className:e(s)},t)))}})})}.call(this),function(){define("modules/clean/react/browse/file_list_utils",["modules/clean/react/browse/constants"],function(e){var t,s,r;return t=e.DropTargetHighlightMode,r=e.FileTypes,s={shouldFileBeHighlightedDropTarget:function(e){var s,n,o,i;if(n=e.file,o=e.isSelected,s=e.dropTargetHighlightMode,s===t.NONE)return!1;if(!n.is_dir)return!1;if(n.is_read_only_mount)return!1;if(n.isDeleted)return!1;switch(s){case t.ALL_FOLDERS:return!0;case t.NONSELECTED_FOLDERS:return!o;case t.NONSELECTED_NONSHARED_FOLDERS:return!o&&n.type!==r.SHARED_FOLDER;case t.NONSELECTED_NONSHARED_NONTEAM_FOLDERS:return!o&&(i=n.type)!==r.SHARED_FOLDER&&i!==r.TEAM_SHARED_FOLDER}return!1}},{FileListHelpers:s}})}.call(this),function(){define("modules/clean/react/browse/internal_drag_status",["external/immutable","external/react","jquery","modules/clean/react/sprite"],function(e,t,s,r){var n,o,i;return i=t.DOM,o=t.createElement,n=t.createClass({displayName:"InternalDragStatus",mixins:[t.addons.PureRenderMixin],propTypes:{files:t.PropTypes.array.isRequired},render:function(){return i.div({id:"drag-status",className:"active"},i.div({id:"drag-selection-status"},this.props.files.slice(0,4).map(function(e,t){return e.thumbnail_url_tmpl?i.img({key:t,src:e.thumbnail_url_tmpl,className:"icon icon"+t,alt:""}):o(r,{key:t,group:"web",name:e.icon,className:"icon icon"+t,alt:""})}),i.span({className:"badge"},this.props.files.length)))}}),{InternalDragStatus:n}})}.call(this),function(){define("modules/clean/react/browse/keyboard_shortcuts",["external/react","jquery","modules/core/browser","modules/core/i18n","modules/clean/keycode","modules/clean/react/modal","modules/clean/react/flag"],function(e,t,s,r,n,o,i){var a,l,u,c,p,d;return c=r._,l=o.Modal,d=e.DOM,p=e.createElement,u=[{key:"↑",desc:c("Select previous file (hold shift to select range)",{comment:"Shift refers to the shift key"})},{key:"↓",desc:c("Select next file (hold shift to select range)",{comment:"Shift refers to the shift key"})},{windowsKey:"ctrl + a",macKey:"⌘ + a",desc:c("Select all files")},{key:"esc",desc:c("Deselect all files")},{key:"←",desc:c("Go up a folder")},{key:"/",desc:c("Search")},{key:"→",desc:c("Open folder")},{key:"enter",desc:c("Open file or folder")},{key:"alt + a",desc:c("Show action menu for selected file(s)")},{windowsKey:"ctrl + c",macKey:"⌘ + c",desc:c("Copy selected file(s)")},{windowsKey:"ctrl + v",macKey:"⌘ + v",desc:c("Paste selected file(s) into the current folder")},{key:"F2",desc:c("Rename selected file")},{windowsKey:"Delete",macKey:"delete",desc:c("Delete selected file(s)")},{windowsKey:"ctrl + z",macKey:"⌘ + z",desc:c("Undo recent move/copy/rename/delete")},{key:"?",desc:c("Show keyboard shortcuts")}],a=e.createClass({displayName:"KeyboardShortcuts",_setupKeyDown:function(){var e;return e=this.refs.shortcutsModal.refs.modal.getDOMNode(),t(e).on("keydown",function(e){return function(t){return t.shiftKey&&t.which===n.FORWARD_SLASH?(t.stopPropagation(),e.refs.shortcutsModal.close()):void 0}}(this))},_renderShortcutsItem:function(e){var t;return t=d.span({className:"keyboard-shortcuts__key"},e.key?e.key:s.mac?e.macKey:e.windowsKey),d.li({className:"keyboard-shortcuts__item u-mar-bottom-xs"},p(i,{leftAttachment:t,alignment:"top"},d.span({className:"keyboard-shortcuts__desc"},e.desc)))},render:function(){var e;return p(l,{ref:"shortcutsModal",acceptButtonText:"",className:"keyboard-shortcuts",onShow:this._setupKeyDown,title:c("Dropbox keyboard shortcuts"),width:750},d.ul({className:"keyboard-shortcuts__pane u-unlist u-trim-padding"},function(){var t,s,r;for(r=[],t=0,s=u.length;s>t;t++)e=u[t],r.push(this._renderShortcutsItem(e));return r}.call(this)))}})})}.call(this),function(){define("modules/clean/react/browse/name_input",["external/underscore","external/classnames","external/react","modules/core/i18n","modules/clean/keycode","modules/core/notify","modules/clean/raf"],function(e,t,s,r,n,o,i){var a,l,u,c;return u=r._,c=s.DOM,l=s.PropTypes,a=s.createClass({mixins:[s.addons.PureRenderMixin],displayName:"NameInput",propTypes:{defaultValue:l.string.isRequired,label:l.string.isRequired,onSubmit:l.func,onCancel:l.func,className:l.string},getDefaultProps:function(){return{onSubmit:e.noop,onCancel:e.noop,className:""}},componentDidMount:function(){var e;return e=this.refs.input.getDOMNode(),e.focus(),i.requestAnimationFrame(function(){var t,s;return t=e.value,s=t.lastIndexOf("."),-1===s&&(s=t.length),e.setSelectionRange(0,s)})},_checkValue:function(){var e;return e=this.refs.input.getDOMNode().value.trim(),e===this.props.defaultValue?(this.props.label===u("Folder name")&&o.error(u("Please provide a name for the new folder.")),this.props.onCancel()):this.props.onSubmit(e)},_onSubmit:function(e){return e.preventDefault(),this._checkValue()},_onKeyDown:function(e){return e.keyCode===n.ESC?(e.preventDefault(),this.props.onCancel()):void 0},_onBlur:function(e){return this._checkValue()},render:function(){var e;return e=c.input({ref:"input",defaultValue:this.props.defaultValue,className:t("c-input",this.props.className),onBlur:this._onBlur,onKeyDown:this._onKeyDown,onDragStart:function(e){return e.stopPropagation()},"aria-label":this.props.label}),c.form({className:"u-pad-right-xs",onSubmit:this._onSubmit},e)}})})}.call(this),function(){define("modules/clean/react/browse/render_partials",["external/react","modules/clean/react/sprite","modules/clean/react/browse/models"],function(e,t,s){var r,n,o,i;return r=s.File,i=e.DOM,o=e.createElement,n=e.createClass({displayName:"FileIconView",propTypes:{file:e.PropTypes.instanceOf(r).isRequired,onClick:e.PropTypes.func,onMouseDown:e.PropTypes.func,className:e.PropTypes.string},getDefaultProps:function(){return{onClick:function(){},onMouseDown:function(){},onDragStart:function(){},className:""}},getInitialState:function(){return{hasThumbFailed:!1}},render:function(){return this.props.file.thumbnail_url_tmpl&&!this.state.hasThumbFailed?i.img({src:this.props.file.thumbnail_url_tmpl,className:"browse-file-row__accessory "+this.props.className,alt:"",onError:function(e){return function(){return e.setState({hasThumbFailed:!0})}}(this),onClick:this.props.onClick,onDragStart:this.props.onDragStart,onMouseDown:this.props.onMouseDown}):o(t,{group:"web",name:this.props.file.icon,className:"browse-file-row__accessory "+this.props.className,alt:"",onClick:this.props.onClick,onDragStart:this.props.onDragStart,onMouseDown:this.props.onMouseDown})}}),{FileIcon:n}})}.call(this),function(){define("modules/clean/react/browse/settings_gear_menu",["external/react","external/underscore","modules/clean/react/browse/models","modules/clean/react/bubble_menu","modules/clean/react/sprite"],function(e,t,s,r,n){var o,i,a,l,u,c,p;return o=s.BrowseContext,l=s.File,i=r.BubbleMenu,a=r.BubbleMenuItem,p=e.DOM,c=e.createElement,u=e.createClass({displayName:"settingsGearMenuBubble",propTypes:{alt:e.PropTypes.string.isRequired,browseContext:e.PropTypes.instanceOf(o).isRequired,file:e.PropTypes.instanceOf(l).isRequired,isShowing:e.PropTypes.bool.isRequired,menuItems:e.PropTypes.arrayOf(e.PropTypes.shape({label:e.PropTypes.string,action:e.PropTypes.func})).isRequired},componentDidUpdate:function(){return this.props.isShowing?this.refs.gearBubbleMenu.show():this.refs.gearBubbleMenu.hide()},render:function(){var e,s;return e=p.button({className:"sprite-button bubble-button"},c(n,{group:"web",name:"gear",alt:this.props.alt})),c(i,{arrow_position:"top",targetButton:e,ref:"gearBubbleMenu",items:function(){var e,r,n,o;for(n=this.props.menuItems,o=[],e=0,r=n.length;r>e;e++)s=n[e],o.push(c(a,{onClick:t.partial(s.action,this.props.browseContext,this.props.file)},s.label));return o}.call(this)})}}),{SettingsGearMenuBubble:u}})}.call(this),function(){define("modules/clean/react/browse/sort_helpers",["external/underscore"],function(e){var t,s;return t=function(e,t,s){var r,n,o,i,a,l,u,c;for(r="=ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=u=0,c=Math.max(e.length,t.length);c>=0?c>u:u>c;i=c>=0?++u:--u){if(n=e.charAt(i),o=t.charAt(i),!n)return-s;if(!o)return s;if(a=r.indexOf(n),l=r.indexOf(o),l>a)return-s;if(a>l)return s}return 0},s=function(s,r,n){var o,i,a,l,u,c;if(e.isArray(s)&&e.isArray(r)){for(l=u=0,c=Math.max(s.length,r.length);c>=0?c>u:u>c;l=c>=0?++u:--u){if(i=s[l],a=r[l],null==i)return-n;if(null==a)return n;if(e.isNumber(i)&&e.isString(a))return-n;if(e.isNumber(a)&&e.isString(i))return n;if(e.isString(i)&&e.isString(a)){if(o=t(i,a,n),0!==o)return o}else{if(a>i)return-n;if(i>a)return n}}return 0}return s===r?0:r>s?-n:n},{compare:s}})}.call(this),function(){var e=function(e,s){function r(){this.constructor=e}for(var n in s)t.call(s,n)&&(e[n]=s[n]);return r.prototype=s.prototype,e.prototype=new r,e.__super__=s.prototype,e},t={}.hasOwnProperty,s=[].indexOf||function(e){for(var t=0,s=this.length;s>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/browse/store",["external/underscore","external/immutable","modules/core/browser","modules/core/exception","modules/clean/filepath","modules/clean/flux/base_store","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/browse/sort_helpers","modules/clean/react/file_uploader/store","modules/clean/react/columnheader","modules/clean/react/selectable_list"],function(t,r,n,o,i,a,l,u,c,p,d,h){var _,m,f,g,b,S,y,v,T,w,E,P,F,I,D,C,N;return D=o.assert,_=l.BrowseActionTypes,f=l.BrowseSortField,v=l.FileTypes,T=l.LoadingStates,w=l.NewFolderCreationState,E=l.RenameStates,b=u.File,m=u.BrowseContext,S=u.FileRename,C=c.compare,I=p.UploaderStore,F=p.UploaderActionTypes,y=p.FileStatus,P=d.SortDirections,N=h.createSelection,g=function(o){function a(){return a.__super__.constructor.apply(this,arguments)}return e(a,o),a.prototype._init=function(){return this._unsortedFiles=r.Map(),this._sortedFiles=r.List(),this._teamFolders=r.List(),this._path="",this._user=null,this._urlPrefix="",this._selection=N(),this._loadingState=T.LOADING_FIRST_PAGE,this._context=new m,this._mountPoints=null,this._shouldShowDeletedFiles=!1,this._activeDropTarget=null,this._inCopyMode=!1,this._clipboardFiles=r.Set(),this._currentSort={sortField:f.FILENAME,direction:P.ASCENDING},this._fileRename=null,this._newFolderCreationState=w.CREATE_FOLDER_INACTIVE,this._filePathsToSelectOnNextUpdate=r.Set(),this._activeFileJumpFilter="",this._fileJumpIndex=[],this._activeTab=void 0},a.prototype.files=function(){return this._sortedFiles},a.prototype.filesMap=function(){return this._unsortedFiles},a.prototype.filesWithoutTeamFolders=function(){return this._sortedFiles.filter(function(e){return e.type!==v.TEAM_SHARED_FOLDER})},a.prototype.teamFolders=function(){return this._teamFolders},a.prototype.path=function(){return this._path},a.prototype.user=function(){return this._user},a.prototype.urlPrefix=function(){return this._urlPrefix},a.prototype.selection=function(){return this._selection},a.prototype.selectedFiles=function(){return this._sortedFiles.filter(function(e){return function(t){return e._selection.selected.has(t.fq_path)}}(this)).toOrderedSet()},a.prototype.activeTab=function(){return this._activeTab},a.prototype.loadingState=function(){return this._loadingState},a.prototype.context=function(){return this._context},a.prototype.mountPoints=function(){return this._mountPoints},a.prototype.shouldShowDeletedFiles=function(){return this._shouldShowDeletedFiles},a.prototype.activeDropTarget=function(){return this._activeDropTarget},a.prototype.currentSort=function(){return this._currentSort},a.prototype.getIndexOfFile=function(e){return this._sortedFiles.findIndex(function(t){return t.sjid===e.sjid})},a.prototype.getFileByFilename=function(e){return this._sortedFiles.find(function(t){return i.filename(t.fq_path)===e})||null},a.prototype.inCopyMode=function(){return this._inCopyMode},a.prototype.clipboardFiles=function(){return this._clipboardFiles},a.prototype.fileRename=function(){return this._fileRename},a.prototype.newFolderCreationState=function(){return this._newFolderCreationState},a.prototype.isFileJumping=function(){return this._activeFileJumpFilter.length>0},a.prototype._initializeEverything=function(e){var t,s,n,o,i,a,l,u,c,p;return p=e.user,a=e.path,s=e.files,c=e.urlPrefix,t=e.context,i=e.mountPoints,n=e.fqPathsToSelect,o=e.loadingState,l=e.shouldShowDeletedFiles,u=e.teamFolders,this._user=p,this._path=a,this._urlPrefix=c,this._appendFiles({path:a,files:s},!1),this._context=t,this._mountPoints=r.Map(i),this._loadingState=o,this._setTeamFolders({teamFolders:u}),o===T.LOADED?this._selectFqPaths({fqPathsToSelect:n},!1):this._filePathsToSelectOnNextUpdate=r.Set(n),this._shouldShowDeletedFiles=Boolean(l)},a.prototype._setUser=function(e){var t;return t=e.user,null==this.user()?this._user=t:void 0},a.prototype._setPathData=function(e){var t,s,r;return r=e.path,s=e.files,t=e.context,r===this.path()?(this._unsortedFiles=this._unsortedFiles.clear(),this._sortedFiles=this._sortedFiles.clear(),this._selection=N(),this._appendFiles({path:r,files:s},!1),this._context=t,this.emit_change()):void 0},a.prototype._appendFiles=function(e,t){var s,n,o,i,a,l;if(l=e.path,n=e.files,null==t&&(t=!0),l===this.path()){for(o=[],i=0,a=n.length;a>i;i++)s=n[i],s instanceof b||(s=b.fromServerObject(s)),o.push([s.fq_path,s]);if(this._unsortedFiles=this._unsortedFiles.merge(o),this._sortedFiles=this._sortedFiles.concat(r.List(function(){var e,t,r;for(r=[],e=0,t=n.length;t>e;e++)s=n[e],r.push(this._unsortedFiles.get(s.fq_path));return r}.call(this))),D(this._unsortedFiles.size===this._sortedFiles.size,"appendFiles ended up with mismatched data structures"),this._sortFiles(this._currentSort,!1),this._filePathsToSelectOnNextUpdate.count()&&this._selectFqPaths({fqPathsToSelect:this._filePathsToSelectOnNextUpdate.toArray()},!1),this._buildFileJumpIndex(),t)return this.emit_change()}},a.prototype._isMostRecentVersionOfFile=function(e){var t,s;return s=e.file,t=s&&this._unsortedFiles.get(s.fq_path),t?t.sjid<s.sjid:!0},a.prototype._updateQuotaStats=function(e){var t,s,r,n,o;return s=e.before,t=e.after,this._context.cdmMveQuotaStats?(r=(null!=t?t.bytes:void 0)||0,o=(null!=s?s.bytes:void 0)||0,n=this._context.cdmMveQuotaStats.update("quotaRawBytesUsed",function(e){return e+r-o}),this._context=this._context.set("cdmMveQuotaStats",n)):void 0},a.prototype._insertOrUpdateFile=function(e){var t,s,r,n,o,i,a,l;return n=e.file,o=null!=(a=e.forceUpdate)?a:!1,this._unsortedFiles=this._unsortedFiles.set(n.fq_path,n),i=n.fq_path.toLowerCase(),t=function(e){return e.fq_path.toLowerCase()===i},l=this._sortedFiles.findEntry(t)||[null,null],r=l[0],s=l[1],s?o||n.sjid>s.sjid?this._sortedFiles=this._sortedFiles.set(r,n):void 0:this._sortedFiles=this._sortedFiles.push(n)},a.prototype._removeFile=function(e){var t,s;return t=e.file,D(this._unsortedFiles.has(t.fq_path),"trying to remove a file that doesn't exist in the file map"),s=this._sortedFiles.indexOf(t),D(-1!==s,"tried to remove file that doesn't exist in the sorted file list"),this._unsortedFiles=this._unsortedFiles.delete(t.fq_path),this._sortedFiles=this._sortedFiles.delete(s)},a.prototype._replaceFile=function(e){var t,s,r,n;return t=e.existingFile,r=e.newFile,D(this._unsortedFiles.has(t.fq_path),"tried to replace file, but previous file doesn't exist in map"),s=this._sortedFiles.indexOf(t),D(-1!==s,"tried to update file, but previous file doesn't exist in sorted list"),t.fq_path===r.fq_path?(this._sortedFiles=this._sortedFiles.set(s,r),this._unsortedFiles=this._unsortedFiles.set(t.fq_path,r)):(this._sortedFiles=this._sortedFiles.delete(s),this._unsortedFiles=this._unsortedFiles.delete(t.fq_path),this._unsortedFiles=this._unsortedFiles.set(r.fq_path,r),this._sortedFiles=this._sortedFiles.push(r),(null!=(n=this._fileRename)?n.state:void 0)===E.SAVING_INPUT?(this._updateRenameState(t,null),this._selectFqPaths({fqPathsToSelect:[r.fq_path]})):void 0)},a.prototype._applyFileDelta=function(e){var t,s,r;return s=e.before,t=e.after,r=e.pathForDelta,t&&!i.paths_are_equal(i.parent_dir(t.fq_path),r)&&(t=null),t!==s&&this._isMostRecentVersionOfFile({file:t})?(t&&s?this._replaceFile({existingFile:s,newFile:t}):t&&!s?this._insertOrUpdateFile({file:t}):s&&!t&&this._removeFile({file:s}),this._updateQuotaStats({before:s,after:t})):void 0},a.prototype._applyFileDeltas=function(e){var t,s,n,o,a,l,u,c;if(l=e.path,n=e.fileDeltas,i.paths_are_equal(l,this._path)){for(o=0,a=n.length;a>o;o++)c=n[o],s=c.before,t=c.after,this._applyFileDelta({before:s,after:t,pathForDelta:l});return this._filePathsToSelectOnNextUpdate.size&&(u=this._selectFqPaths({fqPathsToSelect:this._filePathsToSelectOnNextUpdate.toArray()},!1),u.size===this._filePathsToSelectOnNextUpdate.size&&(this._filePathsToSelectOnNextUpdate=r.Set())),D(this._unsortedFiles.size===this._sortedFiles.size,"applyFileDeltas ended up with mismatched file collections (map vs. sorted list)"),this._sortFiles(this._currentSort,!1),this._buildFileJumpIndex(),this.emit_change()}},a.prototype._applyTeamFolderDowngrade=function(e){var t,s,r;return r=this.mountPoints().get(e),s=this.filesMap().get(r),null!=s&&(t=s.merge({icon:"folder_user_32",type:v.SHARED_FOLDER}),this._replaceFile({existingFile:s,newFile:t})),this.emit_change()},a.prototype._setPath=function(e){var t;return t=e.path,this._path=t,this.emit_change()},a.prototype._setUrlPrefix=function(e){var t;return t=e.prefix,this._urlPrefix=t,this.emit_change()},a.prototype._setLoadingState=function(e){var t,s;return s=e.path,t=e.loadingState,this.path()===s?(this._loadingState=t,t===T.LOADED&&(this._filePathsToSelectOnNextUpdate=r.Set()),this.emit_change()):void 0},a.prototype._setMountPoints=function(e){var t;return t=e.mountPoints,this._mountPoints=r.Map(t)},a.prototype._setTeamFolders=function(e){var t,s;return s=e.teamFolders,this._teamFolders=r.List(function(){var e,r,n,o;for(n=s||[],o=[],e=0,r=n.length;r>e;e++)t=n[e],o.push(b.fromServerObject(t));return o}())},a.prototype._setSelection=function(e){var t;return t=e.selection,this._selection=t,this.emit_change()},a.prototype._selectFqPaths=function(e,t){var n,o,i,a,l,u;return i=e.fqPathsToSelect,null==t&&(t=!0),a=i.map(function(e){return e.toLowerCase()}),o=this._sortedFiles.filter(function(e){var t;return t=e.fq_path.toLowerCase(),s.call(a,t)>=0}),l=o.map(function(e){return e.fq_path}),u=this._selection.set("selected",r.OrderedSet(l)),n=l.size?l.get(0):null,u=u.set("anchor",n),this._selection=u,t&&this.emit_change(),l},a.prototype._toggleFqPathSelected=function(e){var t,s,r,n,o,i,a,l,u,c,p;if(a=e.path,p=this._selection,p.selected.has(a)){for(p=p.update("selected",function(e){return e.delete(a)}),i=null,t=this._selection.selected.indexOf(a),s=n=l=t+1,u=this._selection.selected.count();u>=l?u>n:n>u;s=u>=l?++n:--n)if(r=this._selection.selected.get(s),p.selected.has(r)){i=r;break}if(!i)for(s=o=c=t-1;0>=c?0>=o:o>=0;s=0>=c?++o:--o)if(r=this._selection.selected.get(s),p.selected.has(r)){i=r;break}i||(i=this._selection.selected.get(0)),p=p.set("anchor",i)}else p=p.update("selected",function(e){return e.add(a)}).set("anchor",a);return this._selection=p,this.emit_change()},a.prototype._setActiveTab=function(e){var t;return t=e.tabName,this._activeTab=t,this.emit_change()},a.prototype._setShouldShowDeletedFiles=function(e){var t;return t=e.shouldShowDeletedFiles,this._shouldShowDeletedFiles=Boolean(t),this.emit_change()},a.prototype._setDropTarget=function(e){var t;return t=e.target,this._activeDropTarget=t,this.emit_change()},a.prototype._setCopyMode=function(e){var t;return t=e.copyMode,this._inCopyMode=t,this.emit_change()},a.prototype._sortFiles=function(e,t){var s,r,o,i,a,l,u,c;return c=e.sortField,a=e.direction,null==t&&(t=!0),u=a===P.ASCENDING?1:-1,o=function(e,t){var s,r;return s=e.value,r=t.value,C(s,r,u)},r=function(e,t){var s,r,n,o;return r=e.isFolder,s=e.value,o=t.isFolder,n=t.value,r&&o?C(s,n,u):r?-u:o?u:C(s,n,u)},s=function(e,t){var s,r,n,o;return r=e.isFolder,s=e.value,o=t.isFolder,n=t.value,r&&o?C(s,n,u):r?1:o?-1:""===s?1:""===n?-1:C(s,n,u)},l=c===f.FILENAME||c===f.SHARED_WITH,l?(i=n.mac?o:r,this._sortedFiles=this._sortedFiles.sortBy(function(e){return{isFolder:e.is_dir,value:e.sort_key}},i)):c===f.MODIFIED?this._sortedFiles=this._sortedFiles.sortBy(function(e){return{isFolder:e.is_dir,value:e.ts}},s):c===f.CATEGORY?this._sortedFiles=this._sortedFiles.sortBy(function(e){return{isFolder:e.is_dir,value:b.getCategoryDescription(e)}},s):c===f.EXTENSION?this._sortedFiles=this._sortedFiles.sortBy(function(e){return{isFolder:e.is_dir,value:b.getExtension(e)}},s):c===f.SIZE&&(this._sortedFiles=this._sortedFiles.sortBy(function(e){return{isFolder:e.is_dir,value:-e.bytes}},s)),this._currentSort={sortField:c,direction:a},t?this.emit_change():void 0},a.prototype._setClipboardToSelectedFiles=function(){return this._clipboardFiles=this.selectedFiles(),this.emit_change()},a.prototype._updateRenameState=function(e,r){var n;return r?(n=t.values(E),D(s.call(n,r)>=0,"_updateRenameState received: "+r+", but expected one of: "+n),this._fileRename=new S({file:e,state:r})):this._fileRename=null,this.emit_change()},a.prototype._setNewFolderCreationState=function(e){return this._newFolderCreationState=e,this.emit_change()},a.prototype._setFilePathsToSelectOnNextUpdate=function(e){var t,s;return t=null!=(s=e.fqPathsToSelect)?s:[],this._filePathsToSelectOnNextUpdate=r.Set(t)},a.prototype._addCommentStatusBatch=function(e){var s,r;return s=e.commentStatusByFqPath,r=this._unsortedFiles,t.each(s,function(e){return function(t,s){var n,o;return n=r.get(s),null!=n?(o=n.merge(t),e._insertOrUpdateFile({file:o,forceUpdate:!0})):void 0}}(this)),this.emit_change()},a.prototype._buildFileJumpIndex=function(){return this._fileJumpIndex=this._unsortedFiles.keySeq().toArray().map(function(e){var t;return t=i.filename(e).toLowerCase(),{filename:t,fqPath:e}}),this._fileJumpIndex.sort(function(e,t){var s,r;return s=e.filename,r=t.filename,r>s?-1:s>r?1:0})},a.prototype._addFileJumpKeyCode=function(e){var t,s,r,n,o,i,a,l;for(o=e.keyChar,this._activeFileJumpFilter+=o.toLowerCase(),r=null,a=this._fileJumpIndex,n=0,i=a.length;i>n;n++)if(l=a[n],s=l.fqPath,t=l.filename,t>=this._activeFileJumpFilter){r=s;break}return null!=r?this._selectFqPaths({fqPathsToSelect:[r]}):void 0},a.prototype._resetFileJump=function(){return this._activeFileJumpFilter=""},a.prototype._completeUpload=function(){var e,t;return t=I.fileList().find(function(e){var t;return(t=e.status)===y.PENDING||t===y.UPLOADING}),t?void 0:(e=I.fileList().valueSeq().filter(function(e){return e.status===y.COMPLETE}).map(function(e){return i.normalize(e.dest)+i.normalize(e.name)}),e.every(function(e){return function(t){return e._unsortedFiles.has(t)}}(this))?this._selectFqPaths({fqPathsToSelect:e.toArray()}):this._setFilePathsToSelectOnNextUpdate({fqPathsToSelect:e.toArray()}))},a.prototype._new_payload=function(e){switch(e.action.type){case _.INITIALIZE_EVERYTHING:return this._initializeEverything(e.action.data);case _.LOAD_PATH:return this._setPathData(e.action.data);case _.ADD_FILES:return this._appendFiles(e.action.data);case _.SET_PATH:return this._setPath(e.action.data);case _.SET_USER:return this._setUser(e.action.data);case _.SET_URL_PREFIX:return this._setUrlPrefix(e.action.data);case _.CHANGE_FILES:return this._applyFileDeltas(e.action.data);case _.OPEN_PREVIEW:return this._setPreviewFile(e.action.data);case _.CLOSE_PREVIEW:return this._setPreviewFile(e.action.data);case _.SET_ACTIVE_TAB:return this._setActiveTab(e.action.data);case _.SET_SELECTION:return this._setSelection(e.action.data);case _.SELECT_FILES_BY_FQ_PATH:return this._selectFqPaths(e.action.data);case _.TOGGLE_FQ_PATH_SELECTED:return this._toggleFqPathSelected(e.action.data);case _.SET_LOADING_STATE:return this._setLoadingState(e.action.data);case _.SET_SEARCH_ACTIVE:return this._setSearchActive(e.action.data);case _.SET_MOUNT_POINTS:return this._setMountPoints(e.action.data);case _.SET_TEAM_FOLDERS:return this._setTeamFolders(e.action.data);case _.SET_SHOULD_SHOW_DELETED_FILES:return this._setShouldShowDeletedFiles(e.action.data);case _.SET_DROP_TARGET:return this._setDropTarget(e.action.data);case _.SET_COPY_MODE:return this._setCopyMode(e.action.data);case _.COPY_SELECTED_FILES_TO_CLIPBOARD:return this._setClipboardToSelectedFiles();case _.SORT_FILES:return this._sortFiles(e.action.data);case _.REQUEST_NEW_FILE_NAME:return this._updateRenameState(e.action.data.file,E.PENDING_INPUT);case _.SET_FILE_RENAME_PENDING:return this._updateRenameState(e.action.data.file,E.SAVING_INPUT);case _.SET_FILE_RENAME_COMPLETE:case _.CANCEL_FILE_RENAME:return this._updateRenameState(e.action.data.file,null);case _.REQUEST_FOLDER_NAME:return this._setNewFolderCreationState(w.PENDING_INPUT);case _.CREATE_FOLDER_PENDING:return this._setNewFolderCreationState(w.SAVING_INPUT);case _.CREATE_FOLDER_COMPLETE:case _.CANCEL_CREATE_FOLDER:return this._setNewFolderCreationState(w.CREATE_FOLDER_INACTIVE);case _.SET_FILE_PATHS_TO_SELECT_ON_NEXT_UPDATE:return this._setFilePathsToSelectOnNextUpdate(e.action.data);case _.TEAM_FOLDER_DOWNGRADE:return this._applyTeamFolderDowngrade(e.action.data.nsId);case _.ADD_COMMENT_STATUS_BATCH:return this._addCommentStatusBatch(e.action.data);case _.ADD_FILE_JUMP_KEY_CODE:return this._addFileJumpKeyCode(e.action.data);case _.RESET_FILE_JUMP:return this._resetFileJump();case F.COMPLETE_UPLOAD:return this._completeUpload(e.action.data)}},a}(a),{BrowseStore:new g}})}.call(this),function(){define("modules/clean/react/browse/util",["modules/clean/em_string","modules/clean/filepath","modules/constants/browse","modules/constants/viewer","modules/core/i18n","modules/core/uri"],function(e,t,s,r,n,o){var i,a,l,u;return i=n._,u=n.ungettext,a=function(s){var r,n,o,a,l,c,p,d,h,_,m;return r=13.5,1===s.count()?(a=s.first(),l=t.filename(a.fq_path),o=e.em_snippet(l,r)):s.count()>1&&(n=function(e){return e.isDeleted},h=s.some(n)&&!s.every(n),d=function(){var e,t,r,n;for(r=s.toArray(),n=[],e=0,t=r.length;t>e;e++)p=r[e],p.is_dir&&n.push(p);return n}(),c=function(){var e,t,r,n;for(r=s.toArray(),n=[],e=0,t=r.length;t>e;e++)a=r[e],a.is_dir||n.push(a);return n}(),h?o=i("No available actions"):(_=[],c.length&&(m=u("%(num_files)d file","%(num_files)d files",c.length).format({num_files:c.length}),_.push(m)),d.length&&(m=u("%(num_folders)d folder","%(num_folders)d folders",d.length).format({num_folders:d.length}),_.push(m)),o=2===_.length?i("%(x)s and %(y)s",{comment:'The whole string is a phrase like "2 files and 3 folders". `x` is a string containing a phrase like "2 files" and `y` is a string containing a phrase like "3 folders".'}).format({x:_[0],y:_[1]}):_[0])),o},l=function(e,t,n){return null==n&&(n={}),n[r.UID_PARAM_NAME]=String(t),s.REVISION_HISTORY_WEB?o({path:"/history"+e}).updateQuery(n):o({path:"/revisions"+e}).updateQuery(n)},{describeFiles:a,getRevisionsUri:l}})}.call(this),function(){define("modules/clean/react/columnheader",["jquery","external/classnames","external/react","external/underscore","modules/clean/react/sprite","modules/core/i18n","modules/clean/css","modules/clean/react/css"],function(e,t,s,r,n,o,i,a){var l,u,c,p,d,h,_,m,f,g,b,S;return h=o._,S=s.DOM,b=s.createElement,p={ASCENDING:"ASCENDING",DESCENDING:"DESCENDING"},c={STATIC:"STATIC",SINGLE:"SINGLE",MULTI:"MULTI"},d=s.PropTypes.shape({label:s.PropTypes.string.isRequired,sortField:s.PropTypes.string,headerClassName:s.PropTypes.string}),u=s.PropTypes.shape({type:s.PropTypes.oneOf([c.STATIC,c.SINGLE,c.MULTI]).isRequired,label:s.PropTypes.string,headerClassName:s.PropTypes.string,sortField:s.PropTypes.string,content:s.PropTypes.node,columns:s.PropTypes.arrayOf(d)}).isRequired,g=function(e,t){var s,r,n,o;for(n=0,o=t.length;o>n;n++){if(s=t[n],s.sortField===e)return s;if(s.type===c.MULTI&&(r=g(e,s.columns)))return r}return null},l=s.createClass({displayName:"ColumnHeader",propTypes:{columns:s.PropTypes.arrayOf(u).isRequired,className:s.PropTypes.string,css:s.PropTypes.string,tabbable:s.PropTypes.bool,disabled:s.PropTypes.bool,activeSortField:s.PropTypes.string,activeSortDirection:s.PropTypes.oneOf([p.ASCENDING,p.DESCENDING]),initialMultiColumnSortField:s.PropTypes.string,onSortChange:s.PropTypes.func,onMultiColumnChange:s.PropTypes.func},getDefaultProps:function(){return{tabbable:!0,disabled:!1,activeSortField:void 0,activeSortDirection:p.ASCENDING,onSortChange:r.noop,onMultiColumnChange:r.noop}},getInitialState:function(){return{cssLoaded:!1}},componentWillMount:function(){return this.props.css?i.require_css(this.props.css,function(e){return function(){return e.setState({cssLoaded:!0})}}(this)):this.setState({cssLoaded:!0})},_didChangeSort:function(e,t){var s,r;return r=e!==this.props.activeSortField,s=t!==this.props.activeSortDirection,r||s},handleSingleColumnClick:function(e){var t,s,r;return r=e.sortField,t=this.props.activeSortField===e.sortField,s=t?this.props.activeSortDirection===p.ASCENDING?p.DESCENDING:p.ASCENDING:this.props.activeSortDirection,this._didChangeSort(r,s)?this.props.onSortChange(r,s):void 0},handleSubColumnChange:function(e){var t,s;return s=e.sortField,t=p.ASCENDING,this._didChangeSort(s,t)&&this.props.onSortChange(s,t),this.props.onMultiColumnChange(e)},renderStaticColumnHeader:function(e){return b(f,{key:e.label,label:e.label,className:e.headerClassName||"",content:e.content})},renderSingleColumnHeader:function(e){return b(_,{key:e.label,label:e.label,isActive:this.props.activeSortField===e.sortField,onClick:function(t){return function(){return t.handleSingleColumnClick(e)}}(this),sortDirection:this.props.activeSortDirection,canTriggerSortDirection:!0,className:e.headerClassName||"",tabbable:this.props.tabbable,disabled:this.props.disabled})},renderMultiColumnHeader:function(e){return b(m,{key:e.columns[0].label,columns:e.columns,activeSortField:this.props.activeSortField,initialSortField:this.props.initialMultiColumnSortField,onSubColumnChange:this.handleSubColumnChange,tabbable:this.props.tabbable,disabled:this.props.disabled})},render:function(){var e,t,s,r,n,o;if(this.state.cssLoaded){for(t=[],o=this.props.columns,s=0,n=o.length;n>s;s++)r=o[s],r.type===c.STATIC?t.push(this.renderStaticColumnHeader(r)):r.type===c.SINGLE?t.push(this.renderSingleColumnHeader(r)):r.type===c.MULTI&&t.push(this.renderMultiColumnHeader(r));
return e="c-column-header "+this.props.className,S.ul({role:"row",className:e},t)}return S.ul(null)}}),f=s.createClass({displayName:"_StaticColumnHeader",propTypes:{label:s.PropTypes.string.isRequired,className:s.PropTypes.string.isRequired,content:s.PropTypes.node},render:function(){return S.li({role:"columnheader",className:"c-column-header__header u-pad-vertical-xs "+this.props.className},null!=this.props.content?this.props.content:void 0,S.span({className:"col-header-contents"},this.props.label))}}),_=s.createClass({displayName:"_ColumnHeaderView",propTypes:{label:s.PropTypes.string.isRequired,className:s.PropTypes.string,isActive:s.PropTypes.bool,canTriggerSortDirection:s.PropTypes.bool,nextColumnLabel:s.PropTypes.string,tabbable:s.PropTypes.bool,disabled:s.PropTypes.bool,sortDirection:s.PropTypes.oneOf([p.ASCENDING,p.DESCENDING]),onClick:s.PropTypes.func},getDefaultProps:function(){return{className:null,isActive:!1,canTriggerSortDirection:!1,nextColumnLabel:void 0,tabbable:!0,disabled:!1,sortDirection:p.DESCENDING,onClick:r.noop}},renderColumnHeaderLabel:function(){var e,t,s;return this.props.isActive&&this.props.canTriggerSortDirection?(this.props.sortDirection===p.ASCENDING?(s="arrow-up-gray",e="ascending"):(s="arrow-down-gray",e="descending"),t=b(n,{group:"web",name:s,alt:"",key:"icon-element",className:"c-column-header__sort-icon u-mar-left-xxs u-l-ib--m"}),[S.span({key:"label"},this.props.label),t]):[S.span({key:"label"},this.props.label)]},getActionDescription:function(){var e;return this.props.nextColumnLabel?(e=h("Swap column to %(nextlabel)s",{comment:"nextlabel is the name of the column that the current column will be replaced with when this button is clicked."}),e.format({nextlabel:this.props.nextColumnLabel})):this.props.sortDirection===p.DESCENDING?h("Sort in ascending order"):this.props.sortDirection===p.ASCENDING?h(this.props.isActive?"Sort in descending order":"Sort in ascending order"):null},getAriaDirectionName:function(){if(this.props.isActive){if(this.props.sortDirection===p.ASCENDING)return"ascending";if(this.props.sortDirection===p.DESCENDING)return"descending"}return""},render:function(){var e;return e=t("c-column-header__button u-trim-margin u-trim-padding",{"u-font-strong":this.props.isActive}),S.li({role:"columnheader","aria-sort":this.getAriaDirectionName(),className:"c-column-header__header u-pad-vertical-xs "+this.props.className},S.button({className:e,onClick:this.props.onClick,ref:"columnButton",title:this.getActionDescription(),tabIndex:this.props.tabbable?0:-1,disabled:this.props.disabled},this.renderColumnHeaderLabel()))}}),m=s.createClass({displayName:"_MultiColumnHeader",propTypes:{columns:s.PropTypes.arrayOf(d).isRequired,tabbable:s.PropTypes.bool,disabled:s.PropTypes.bool,activeSortField:s.PropTypes.string,initialSortField:s.PropTypes.string,onSubColumnChange:s.PropTypes.func},getDefaultProps:function(){return{tabbable:!0,disabled:!1,activeSortField:void 0,onSubColumnChange:r.noop}},getInitialState:function(){var e,t;return this.props.initialSortField&&(t=g(this.props.initialSortField,this.props.columns),t&&(e=this.props.columns.indexOf(t))),{currentColumnIndex:e||0}},componentWillMount:function(){return this.updateCurrentColumnIndex(this.props.activeSortField)},componentWillReceiveProps:function(e){return e.activeSortField!==this.props.activeSortField?this.updateCurrentColumnIndex(e.activeSortField):void 0},updateCurrentColumnIndex:function(e){var t,s;return s=g(e,this.props.columns),s?(t=this.props.columns.indexOf(s),t!==this.state.currentColumnIndex&&this.props.onSubColumnChange(s),this.setState({currentColumnIndex:t})):void 0},switchToColumn:function(e){return this.props.onSubColumnChange(e)},render:function(){var e,t,s,r;return e=this.props.columns[this.state.currentColumnIndex],s=this.props.activeSortField&&this.props.activeSortField===e.sortField,t=(this.state.currentColumnIndex+1)%this.props.columns.length,r=this.props.columns[t],b(_,{ref:"singleColumn",key:e.label,className:e.headerClassName||"",canTriggerSortDirection:!1,label:e.label,nextColumnLabel:r.label,tabbable:this.props.tabbable,disabled:this.props.disabled,isActive:s,onClick:function(e){return function(){return e.switchToColumn(r)}}(this)})}}),{ColumnHeader:a(l,["/static/css/components/column-headers-vflS11lNY.css","/static/css/scooter/scooter-scoped-vfl6M_UYZ.css"]),SortDirections:p,ColumnTypes:c}})}.call(this),function(){define("modules/clean/react/context_menu_v2",["jquery","external/immutable","external/keymaster","external/react","external/underscore","modules/clean/keycode","modules/clean/react/css","modules/clean/react/sprite_div","modules/core/browser","modules/core/dom","modules/clean/react/browse/constants"],function(e,t,s,r,n,o,i,a,l,u,c){var p,d,h,_,m,f,g,b,S,y;return f=c.MouseEventButton,b=r.createElement,S=r.addons.classSet,y=r.DOM,g="",h=t.Record({icon:null,text:"",shouldShow:!0,isDisabled:!1,onClick:n.noop,href:null,subMenuItems:null}),m=r.createClass({displayName:"GlobalContextMenu",propTypes:{alwaysOpenOnCapture:r.PropTypes.bool,ignoreSelectors:r.PropTypes.string,items:r.PropTypes.arrayOf(h),onMenuOpen:r.PropTypes.func,onMenuClose:r.PropTypes.func},getDefaultProps:function(){return{alwaysOpenOnCapture:!1,ignoreSelectors:"a, input, button, textarea, select",onMenuOpen:n.noop,onMenuClose:n.noop}},getInitialState:function(){return{isMenuOpen:!1}},componentDidMount:function(){return e(document).on("contextmenu.GlobalContextMenu",function(t){return function(s){return 0===e(s.target).closest(t.props.ignoreSelectors).size()?t.toggleMenu(s):t.closeMenu()}}(this)),e(document).on("click.GlobalContextMenu",function(t){return function(s){return s.button!==f.RIGHT&&0===e(s.target).closest(".context-menu").size()?t.closeMenu():void 0}}(this))},componentWillUnmount:function(){return e(document).off(".GlobalContextMenu")},openMenuAtPosition:function(e,t,s){return this.setState({isMenuOpen:!0,left:e,top:t}),this.props.onMenuOpen(s)},closeMenu:function(){return this.state.isMenuOpen?(this.setState({isMenuOpen:!1}),this.props.onMenuClose()):void 0},toggleMenu:function(e){return e.shiftKey?void 0:(e.preventDefault(),this.state.isMenuOpen&&!this.props.alwaysOpenOnCapture?this.closeMenu():this.openMenuAtPosition(e.clientX,e.clientY,e))},render:function(){return y.span({},this.state.isMenuOpen?b(_,{initialLeft:this.state.left,initialTop:this.state.top,onMenuClose:this.closeMenu,items:this.props.items,ref:"contextMenu"}):void 0)}}),d=r.createClass({displayName:"ContextMenuHandler",propTypes:{alwaysOpenOnCapture:r.PropTypes.bool,className:r.PropTypes.string,items:r.PropTypes.arrayOf(h),onMenuOpen:r.PropTypes.func,onMenuClose:r.PropTypes.func},getDefaultProps:function(){return{onMenuOpen:n.noop,onMenuClose:n.noop,alwaysOpenOnCapture:!1}},getInitialState:function(){return{isMenuOpen:!1}},componentDidMount:function(){return e(document).on("click.ContextMenuHandler",function(t){return function(s){return s.button!==f.RIGHT&&0===e(s.target).closest(".context-menu").size()?t.closeMenu():void 0}}(this))},componentWillUnmount:function(){return e(document).off(".ContextMenuHandler")},openMenuAtPosition:function(e,t,s){return this.setState({isMenuOpen:!0,left:e,top:t}),this.props.onMenuOpen(s)},closeMenu:function(){return this.setState({isMenuOpen:!1}),this.props.onMenuClose()},toggleMenu:function(e){return e.shiftKey?void 0:(e.preventDefault(),this.state.isMenuOpen&&!this.props.alwaysOpenOnCapture?this.closeMenu():this.openMenuAtPosition(e.clientX,e.clientY,e))},render:function(){return y.span({className:this.props.className},this.state.isMenuOpen?b(_,{initialLeft:this.state.left,initialTop:this.state.top,onMenuClose:this.closeMenu,items:this.props.items,ref:"contextMenu"}):void 0,y.span({"aria-haspopup":!0,onContextMenuCapture:this.toggleMenu,ref:"contextMenuTarget"},this.props.children))}}),p=r.createClass({displayName:"ContextMenu",propTypes:{initialLeft:r.PropTypes.number,initialTop:r.PropTypes.number,items:r.PropTypes.arrayOf(h),onMenuClose:r.PropTypes.func,onCurrentMenuClose:r.PropTypes.func,level:r.PropTypes.number,shouldAutoSelect:r.PropTypes.bool},getDefaultProps:function(){return{initialLeft:null,initialTop:null,items:null,onMenuClose:n.noop,onCurrentMenuClose:n.noop,level:0,shouldAutoSelect:!1}},getInitialState:function(){return{selectedIndex:null,left:null,right:null,isSubMenuOpen:!1}},componentWillMount:function(){return this.setState({left:this.props.initialLeft,top:this.props.initialTop})},componentDidMount:function(){return g=key.getScope(),key.setScope("ContextMenu"),this.updateCoordinates(),this.refs.contextMenu.getDOMNode().focus(),this.props.shouldAutoSelect?this._selectNextItem():void 0},componentDidUpdate:function(e){return e.items!==this.props.items||e.initialLeft!==this.props.initialLeft||e.initialTop!==this.props.initialTop?(this.setState({selectedIndex:null}),this.updateCoordinates(),this.refs.contextMenu.getDOMNode().focus()):void 0},componentWillUnmount:function(){return key.setScope(g)},_getReachableIndices:function(){var e,t,s,r,n,o;for(n=[],o=this.props.items,e=s=0,r=o.length;r>s;e=++s)t=o[e],t.shouldShow&&!t.isDisabled&&n.push(e);return n},_selectNextItem:function(){var e,t;return e=this._getReachableIndices(),t=null!=this.state.selectedIndex?(e.indexOf(this.state.selectedIndex)+1)%e.length:0,null!=t?this.selectItem(e[t]):void 0},_selectPreviousItem:function(){var e,t;return e=this._getReachableIndices(),t=null!=this.state.selectedIndex?(e.indexOf(this.state.selectedIndex)+e.length-1)%e.length:e.length-1,null!=t?this.selectItem(e[t]):void 0},_handleKeyDown:function(e){var t,s,r,n,i,a,l,u;if(!this.state.isSubMenuOpen)switch(e.keyCode){case o.TAB:return e.preventDefault(),e.stopPropagation();case o.ESC:return this.props.onMenuClose();case o.SPACE:case o.ENTER:if(null!=this.state.selectedIndex)return l=this.props.items[this.state.selectedIndex],this.clickItem(l,e),this.openSubMenu(l,!0),e.preventDefault(),e.stopPropagation();break;case o.DOWN:return this._selectNextItem(),e.preventDefault(),e.stopPropagation();case o.UP:return this._selectPreviousItem(),e.preventDefault(),e.stopPropagation();case o.RIGHT:if(null!=this.state.selectedIndex)return this.openSubMenu(this.props.items[this.state.selectedIndex],!0);break;case o.LEFT:if(this.props.level>0)return this.props.onCurrentMenuClose(),e.preventDefault(),e.stopPropagation();break;default:for(u=String.fromCharCode(e.keyCode),i=this.props.items,a=[],t=r=0,n=i.length;n>r;t=++r)if(s=i[t],s.shouldShow&&!s.isDisabled){if(s.text[0].toUpperCase()===u){this.selectItem(t),e.preventDefault(),e.stopPropagation();break}a.push(void 0)}return a}},openSubMenu:function(e,t){var s;return(null!=(s=e.subMenuItems)?s.length:void 0)>0?this.setState({isSubMenuOpen:!0,shouldAutoSelectSubMenu:t}):void 0},closeSubMenu:function(){return this.refs.contextMenu.getDOMNode().focus(),this.setState({isSubMenuOpen:!1})},selectItemWithMouse:function(e){return this.refs.contextMenu.getDOMNode().focus(),this.selectItem(e,!0,!1)},selectItem:function(e,t,s){return this.setState({selectedIndex:e}),t?this.openSubMenu(this.props.items[e],s):void 0},clickItem:function(e,t){return null!=e.subMenuItems||e.isDisabled?void 0:(null!=e.href?l.redirect(e.href):e.onClick(t),this.props.onMenuClose())},updateCoordinates:function(){var t,s,r,n,o,i,a,l;return t=this.props.initialLeft,a=this.props.initialTop,null!=t&&null!=a&&null!=this.refs.contextMenu&&(l=u.viewport_dimensions(),i=15,o=e(this.refs.contextMenu.getDOMNode()).width(),n=e(this.refs.contextMenu.getDOMNode()).height(),s=l.width-i-o,t>s&&(t=s),r=l.height-i-n,a>r&&(a=r)),this.setState({left:t,top:a})},getSelectedItemDomId:function(){return null!=this.state.selectedIndex?"contextMenu"+this.props.level+"-item"+this.state.selectedIndex:""},_renderItem:function(e,t){var s,r,n,o,i;return n=this.state.selectedIndex===t,r=(null!=(i=e.subMenuItems)?i.length:void 0)>0,o="contextMenu"+this.props.level+"-item"+t,s={"context-menu-item":!0,"context-menu-item--has-submenu":r,"context-menu-item--selected":n,"context-menu-item--disabled":e.isDisabled},y.li({key:o,id:o,"data-action":e.text,className:S(s),role:"menuitem","aria-haspopup":r,"aria-disabled":e.isDisabled,onMouseEnter:function(s){return function(){return e.isDisabled?s.setState({selectedIndex:null}):s.selectItemWithMouse(t)}}(this),onClick:function(t){return function(s){return t.clickItem(e,s)}}(this)},null!=e.icon?b(a,{group:e.icon.group,name:e.icon.name,alt:"",text:e.text}):y.span({},e.text),r?y.span({className:"context-menu-item__accessory c-arrow--right"}):void 0,r&&n&&this.state.isSubMenuOpen?b(p,{initialLeft:null,initialTop:null,className:"context-menu--secondary",level:this.props.level+1,items:e.subMenuItems,onMenuClose:this.props.onMenuClose,onCurrentMenuClose:this.closeSubMenu,shouldAutoSelect:this.state.shouldAutoSelectSubMenu}):void 0)},render:function(){var e,t,s;return null!=this.state.left&&null!=this.state.top&&(s={left:this.state.left,top:this.state.top}),y.ul({id:"contextMenu"+this.props.level,ref:"contextMenu",className:S("no-padding","bubble-dropdown","context-menu",this.props.className),style:s,role:"menu",tabIndex:-1,"aria-activedescendant":this.getSelectedItemDomId(),onKeyDown:this._handleKeyDown},function(){var s,r,n,o;for(n=this.props.items,o=[],e=s=0,r=n.length;r>s;e=++s)t=n[e],t.shouldShow&&o.push(this._renderItem(t,e));return o}.call(this))}}),_=i(p,["/static/css/components/bubble_dropdown-vfl-t-5oN.css","/static/css/scooter/scooter-scoped-vfl6M_UYZ.css"]),{GlobalContextMenu:m,ContextMenuHandler:d,ContextMenu:p,ContextMenuItem:h}})}.call(this),function(){define("modules/clean/react/file_modal_controller",["external/react","external/underscore","modules/clean/filepath","modules/clean/react/browse/api","modules/clean/react/css","modules/clean/react/file_modals","modules/clean/react/modal"],function(e,t,s,r,n,o,i){var a,l,u,c,p,d,h,_;return u=o.FileTransferModal,h=o.RestoreFilesModal,d=o.PermanentlyDeleteModal,a=o.DeleteFileModal,c=i.Modal,_=e.createElement,p={COPY:"copy",MOVE:"move"},l=function(){function e(){}return e.showCopy=function(e,t,s){var r,n,o,i,a,l,d;return o=null!=(a=s.onSuccess)?a:null,i=null!=(l=s.onUndo)?l:null,n=null!=(d=s.onRequestNotSent)?d:null,r=_(u,{files:t,operation:p.COPY,user:e,onSuccess:o,onUndo:i,onRequestNotSent:n}),c.showInstance(r)},e.showMove=function(e,t,s,r){var n,o,i,a,l,d,h;return i=null!=(l=r.onSuccess)?l:null,a=null!=(d=r.onUndo)?d:null,o=null!=(h=r.onRequestNotSent)?h:null,n=_(u,{files:t,path:s,operation:p.MOVE,user:e,onSuccess:i,onUndo:a,onRequestNotSent:o}),c.showInstance(n)},e.showRestore=function(e,t,s){var r;return r=_(h,{files:t,userId:e.id,onSuccess:s}),c.showInstance(r)},e.showPermanentlyDelete=function(e,t,s){var r;return r=_(d,{files:t,userId:e.id,onSuccess:s}),c.showInstance(r)},e.showDelete=function(e,t,r,n){var o,i,l;return i=s.filename(r.currentFQPath),l=r.isInsideSharedFolder,o=_(a,{files:t,user:e,parentSharedFolderName:l?i:null,onUndo:n}),c.showInstance(o)},e}(),{FileModalController:l}})}.call(this),function(){define("modules/clean/react/file_modals",["external/react","external/underscore","modules/clean/react/browse/api","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/browse/render_partials","modules/clean/react/css","modules/clean/react/react_i18n","modules/clean/react/modal","modules/clean/react/tree_view","modules/clean/file_operations/notifications","modules/clean/filepath","modules/clean/user","modules/core/html","modules/core/i18n"],function(e,t,s,r,n,o,i,a,l,u,c,p,d,h,_){var m,f,g,b,S,y,v,T,w,E,P,F,I,D,C;return S=r.FileTypes,f=n.File,g=o.FileIcon,E=a.R_,v=l.Modal,y=u.FolderTreeView,F=_._,C=_.ungettext,D=e.DOM,I=e.createElement,T={COPY:"copy",MOVE:"move"},w=e.createClass({displayName:"PermanentlyDeleteModal",propTypes:{files:e.PropTypes.arrayOf(f).isRequired,userId:e.PropTypes.number.isRequired},getDefaultProps:function(){return{onSuccess:t.noop}},handlePurged:function(){return c.notifyPurgeSuccess(this.props.files.length),this.props.onSuccess.apply(null,arguments)},handleAccept:function(){return s.purgeFiles({files:this.props.files,userId:this.props.userId,onSuccess:this.handlePurged})},isSingleSharedFolder:function(e){return console.log(e),1===e.length&&e[0].type===S.SHARED_FOLDER},getTitle:function(e){var t;return t=e.length,this.isSingleSharedFolder(e)?F("Remove access to folder?"):C("Permanently delete %(num)s file?","Delete %(num)s items permanently?",t).format({num:t})},renderContent:function(e){var t,s;return t=e.length,1===t?(s=p.filename(e[0].fq_path),this.isSingleSharedFolder(e)?E({filename:s},"Are you sure you want to remove your access to <strong>%(filename)s</strong>? It will no longer be viewable in your list of shared folders, and you won’t be able to re-add it to your Dropbox unless you’re re-invited."):E({filename:s},"Are you sure you want to delete <strong>%(filename)s</strong> from your Dropbox permanently?")):D.span(null,C("Are you sure you want to permanently delete %(num)s item from your Dropbox?","Are you sure you want to permanently delete %(num)s items from your Dropbox?",t).format({num:t}))},render:function(){var e;return e={ref:"modal",title:this.getTitle(this.props.files),acceptButtonText:F(this.isSingleSharedFolder(this.props.files)?"Remove my access":"Delete permanently"),dismissButtonText:F("Cancel"),onAccept:this.handleAccept},I(v,e,this.renderContent(this.props.files))}}),P=e.createClass({displayName:"RestoreFilesModal",propTypes:{files:e.PropTypes.arrayOf(f).isRequired,userId:e.PropTypes.number.isRequired,onSuccess:e.PropTypes.func},getDefaultProps:function(){return{onSuccess:t.noop}},handleRestoreSuccess:function(){return c.notifyRestoreSuccess(this.props.files),this.props.onSuccess.apply(null,arguments)},handleRestoreClick:function(e){return e.preventDefault(),s.restoreFiles({files:this.props.files,userId:this.props.userId,onSuccess:this.handleRestoreSuccess}),this.refs.modal.close()},handleCancelClick:function(e){return e.preventDefault(),this.refs.modal.close()},getTitle:function(e){return C("Restore %(num)s file?","Restore %(num)s items…",e).format({num:e})},renderSingleFileContent:function(e,t){var s;return s=p.filename(e.fq_path),[E({filename:s},"The most recent version of <strong>%(filename)s</strong> will be restored."),D.div({className:"file-modal__single-file-row"},I(g,{file:e,className:"file-modal__single-file-row-icon"}),D.a({href:t,className:"file-modal__single-file-row-link"},s))]},renderMultiFileContent:function(e){return D.span({},C("Are you sure you want to restore %(num)s item?","Are you sure you want to restore %(num)s items?",e.length).format({num:e.length}))},renderButtons:function(e){return D.div({className:"file-modal__buttons"},e?D.div({className:"file-modal__buttons__alt",ref:"revisionButton"},D.a({href:e},F("View other versions"))):void 0,D.div({className:"file-modal__buttons__main"},D.button({className:"button-primary db-modal-button",onClick:this.handleRestoreClick,ref:"primaryButton"},F("Restore")),D.button({className:"button-tertiary db-modal-button",onClick:this.handleCancelClick,ref:"tertiaryButton"},F("Cancel"))))},render:function(){var e,t,r,n;return t=this.props.files.length,n=null,1===t&&(n=s.getFileHistoryUrl({fqPath:this.props.files[0].fq_path,userId:this.props.userId})),r={ref:"modal",title:this.getTitle(t),buttonComponent:this.renderButtons(n)},e=1===t?this.renderSingleFileContent(this.props.files[0],n):this.renderMultiFileContent(this.props.files),I(v,r,e)}}),P=i(P,["/static/css/react/file_modal-vfl5O9OmZ.css"]),b=e.createClass({displayName:"FileTransferModal",statics:{Operations:T},propTypes:{files:e.PropTypes.arrayOf(e.PropTypes.shape({fq_path:e.PropTypes.string,is_dir:e.PropTypes.bool})).isRequired,operation:e.PropTypes.oneOf([T.COPY,T.MOVE]).isRequired,user:e.PropTypes.instanceOf(d).isRequired,onSuccess:e.PropTypes.func,onUndo:e.PropTypes.func,onRequestNotSent:e.PropTypes.func,path:e.PropTypes.string},getDefaultProps:function(){return{onSuccess:t.noop}},getInitialState:function(){return{selectedPath:null}},handleOperationSuccess:function(e){var t,s,r,n;return t=e.changesets,r=e.rollbackHints,s=this.props.files.length,n=this.props.user,this.props.operation===T.MOVE?c.notifyMoveSuccess(s,n,t,this.state.selectedPath,r,this.props.onUndo):this.props.operation===T.COPY&&c.notifyCopySuccess(s,n,t,this.state.selectedPath,r,this.props.onUndo),this.props.onSuccess.apply(null,arguments)},handleAccept:function(){var e,t,r;if(this.props.operation===T.MOVE){if(r=s.moveFiles({path:this.props.path,files:this.props.files,newPath:this.state.selectedPath,userId:this.props.user.id,onSuccess:this.handleOperationSuccess}),!r)return"function"==typeof(e=this.props).onRequestNotSent?e.onRequestNotSent():void 0}else if(this.props.operation===T.COPY&&(r=s.copyFiles({files:this.props.files,newPath:this.state.selectedPath,userId:this.props.user.id,onSuccess:this.handleOperationSuccess}),!r))return"function"==typeof(t=this.props).onRequestNotSent?t.onRequestNotSent():void 0},handleFolderSelected:function(e){return this.setState({selectedPath:e})},_getTitle:function(){var e,t;return e=this.props.files.length,this.props.operation===T.MOVE?t=this.props.files[0].is_dir?C("Move %(num)s folder to…","Move %(num)s items to…",e,{comment:'"items" is a (potential) mix of files and folders'}):C("Move %(num)s file to…","Move %(num)s items to…",e,{comment:'"items" is a (potential) mix of files and folders'}):this.props.operation===T.COPY&&(t=this.props.files[0].is_dir?C("Copy %(num)s folder to…","Copy %(num)s items to…",e,{comment:'"items" is a (potential) mix of files and folders'}):C("Copy %(num)s file to…","Copy %(num)s items to…",e,{comment:'"items" is a (potential) mix of files and folders'})),t.format({num:e})},_getActionButtonText:function(){return this.props.operation===T.COPY?F("Copy"):this.props.operation===T.MOVE?F("Move"):void 0},handleModalShown:function(){var e;return e=this.refs.treeView.getDOMNode(),e?e.focus():void 0},render:function(){return I(v,{ref:"modal",title:this._getTitle(),acceptButtonText:this._getActionButtonText(),onAccept:this.handleAccept,acceptButtonDisabled:!this.state.selectedPath,autoFocusPrimaryInput:!1,onShow:this.handleModalShown,dismissButtonText:F("Cancel")},I(y,{ref:"treeView",rootPath:"/",user:this.props.user,onFolderSelected:this.handleFolderSelected,isRootSelectable:!0}))}}),m=e.createClass({displayName:"DeleteFileModal",propTypes:{files:e.PropTypes.arrayOf(e.PropTypes.shape({fq_path:e.PropTypes.string,is_dir:e.PropTypes.bool})).isRequired,user:e.PropTypes.instanceOf(d).isRequired,parentSharedFolderName:e.PropTypes.string,onUndo:e.PropTypes.func},getDefaultProps:function(){return{parentSharedFolderName:null}},handleNotify:function(e){var t,s;return t=e.changesets,s=e.rollbackHints,c.notifyDeleteSuccess(this.props.files.length,this.props.user,t,s,this.props.onUndo)},handleAccept:function(){return s.deleteFiles({files:this.props.files,userId:this.props.user.id,onSuccess:this.handleNotify})},_isRemovingSharedFolder:function(){return 1===this.props.files.length&&this.props.files[0].target_ns},_getTitle:function(){var e;return e=this.props.files,e.length<1?"":this._isRemovingSharedFolder()?F("Remove shared folder?"):1===e.length?F(e[0].is_dir?"Delete folder?":"Delete file?"):C("Delete %(item_count)s item?","Delete %(item_count)s items?",e.length).format({item_count:e.length})},_getContents:function(){var e,t,s,r;return e=this.props.files,null==(null!=e?e.length:void 0)||e.length<1?"":(s=p.filename(e[0].fq_path),t=e[0].target_ns,null!=this.props.parentSharedFolderName?(r=this.props.parentSharedFolderName,1===e.length&&t?E({filename:s},"Are you sure you want to remove the shared folder <b>%(filename)s</b> from your Dropbox?"):1===e.length?E({filename:s,shared_folder_name:r},"Are you sure you want to delete <b>%(filename)s</b> from the shared folder ‘%(shared_folder_name)s’?"):C("Are you sure you want to delete %(item_count)s item from the shared folder ‘%(shared_folder_name)s’?","Are you sure you want to delete %(item_count)s items from the shared folder ‘%(shared_folder_name)s’?",e.length).format({item_count:e.length,shared_folder_name:r})):1===e.length&&t?E({filename:s},"Are you sure you want to remove the shared folder <b>%(filename)s</b> from your Dropbox? This shared folder will stay shared with other members and you can re-add it later."):1===e.length?E({filename:s},"Are you sure you want to delete <b>%(filename)s</b> from your Dropbox?"):C("Are you sure you want to delete %(item_count)s item from your Dropbox?","Are you sure you want to delete %(item_count)s items from your Dropbox?",e.length).format({item_count:e.length}))},render:function(){return I(v,{ref:"modal",title:this._getTitle(),onAccept:this.handleAccept,acceptButtonText:F(this._isRemovingSharedFolder()?"Remove":"Delete"),dismissButtonText:F("Cancel")},this._getContents())}}),{FileTransferModal:b,RestoreFilesModal:P,PermanentlyDeleteModal:w,DeleteFileModal:m}})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,s=this.length;s>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/file_uploader/actions",["modules/core/i18n","modules/core/exception","modules/clean/flux/dispatcher","modules/clean/filepath","modules/clean/react/file_uploader/store","modules/clean/react/file_uploader/plu_wrapper","modules/clean/base64"],function(t,s,r,n,o,i,a){var l,u,c,p,d,h,_,m,f,g,b;return m=t._,f=s.assert,g=n.file_extension,b=n.file_extension_for_logging,_=o.UploaderStore,d=o.UploaderActionTypes,u=o.FileStatus,c=o.FileUpload,p=o.UploadErrorType,l=["pages","key","app","numbers","band","photolibrary","rcproject","rtfd","graffle","logic","logicx","lpdf","sketch","screenflow","scriv","dvdproj","mindnode","cmproj","xcodeproj","imovielibrary","mpkg","imovieproject","1password","agilekeychain","fcpbundle","abbu","mindnode","theater","gameproj","aplibrary","itlp","lrdata","ydevice","bundle","framework","plugin","kext","pkg"],h=function(){function t(){}return t.prototype.initPLU=function(){return i.isInitialized?void 0:(i.init(),i.onFilesAdded(function(t){return function(s){var n,o,i,a,u,c,h,_,f,g;for(o=function(){var e,t,r;for(r=[],e=0,t=s.length;t>e;e++)i=s[e],null==i.size&&r.push(i);return r}(),s=function(){var e,t,r;for(r=[],e=0,t=s.length;t>e;e++)i=s[e],null!=i.size&&r.push(i);return r}(),a=0,c=o.length;c>a;a++)n=o[a],r.dispatch({type:d.ADD_NEW_FAILED_FILE,data:{file:n,errorType:p.EMPTY_OR_FOLDER,errorMessage:m("This folder or empty file could not be uploaded because of browser limitations. Try zipping up the content before uploading it, or use the Dropbox desktop client to sync it.")}});for(_=function(t){var s;return s=b(t.name),e.call(l,s)>=0&&t.size%34===0},g=function(){var e,t,r;for(r=[],e=0,t=s.length;t>e;e++)i=s[e],_(i)&&r.push(i);return r}(),s=function(){var e,t,r;for(r=[],e=0,t=s.length;t>e;e++)i=s[e],_(i)||r.push(i);return r}(),u=0,h=g.length;h>u;u++)f=g[u],r.dispatch({type:d.ADD_NEW_FAILED_FILE,data:{file:f,errorType:p.PACKAGE_FILE,errorMessage:m("This file is a package file and can’t be uploaded directly. To upload a package file via the web, try zipping it first.")}});return o.length&&t.cancelUploads({files:o}),g.length&&t.cancelUploads({files:g}),r.dispatch({type:d.QUEUE_UPLOADS,data:{files:s}}),t._frobPLU()}}(this)),i.onUploadProgress(function(e){var t,s,n,o,a;return _.isUploadCancelled(e.uploadId)?void 0:(o=e.percentUploaded,s=o*_.currentUpload().size/100,a=s+_.totalSizeOfCompletedUploads(),t=i.bytesPerSec(),n=_.fileList().count(function(e){var t;return(t=e.status)===u.PENDING||t===u.UPLOADING}),r.dispatch({type:d.SET_CURRENT_UPLOAD_PROGRESS,data:{percentComplete:o,numSecondsLeft:(_.totalSize()-a)/t+n}}))}),i.onFileUploaded(function(e){return function(t,s){var n;return _.isUploadCancelled(t.uploadId)?void 0:(n=JSON.parse(s.response),"error"in n?(i.removeFiles({files:[t]}),"ignored"===n.error?r.dispatch({type:d.UPLOAD_ERROR,data:{uploadId:t.uploadId,errorType:p.IGNORED,errorMessage:m("This file was skipped because it’s an internal system file.")}}):r.dispatch({type:d.UPLOAD_ERROR,data:{uploadId:t.uploadId,errorType:p.GENERIC}})):(f("complete"===n.status),f(n.total_size===t.size),f(n.upload_id===t.uploadId),r.dispatch({type:d.COMPLETE_UPLOAD,data:{uploadId:t.uploadId}})),e._frobPLU())}}(this)),i.onError(function(e){return function(t,s,n){return _.fileList().has(t.uploadId)?r.dispatch({type:d.UPLOAD_ERROR,data:{uploadId:t.uploadId,errorType:s,errorMessage:n}}):r.dispatch({type:d.ADD_NEW_FAILED_FILE,data:{file:t,errorType:s,errorMessage:n}}),e._frobPLU()}}(this)))},t.prototype.setPath=function(e){var t,s,n;return s=e.path,t=null!=(n=e.hasPermissionToUploadToFolder)?n:!0,s!==_.path()||t!==_.hasPermissionToUploadToFolder()?r.dispatch({type:d.SET_PATH,data:{path:s,hasPermissionToUploadToFolder:t}}):void 0},t.prototype.setUser=function(e){var t;return t=e.user,r.dispatch({type:d.SET_USER,data:{user:t}})},t.prototype.setNumDraggingFiles=function(e){var t,s,n;return s=e.numDraggingFiles,t=null!=(n=e.isInternalTransfer)?n:!1,r.dispatch({type:d.SET_NUM_DRAGGING_FILES,data:{numDraggingFiles:s,isInternalTransfer:t}})},t.prototype.addFilesToPLU=function(e){var t;return t=e.files,i.addFiles({files:t}),this.setIsInlineStatusDismissed({isInlineStatusDismissed:!1})},t.prototype.addDirectoriesToPLU=function(t){var s,n,o,i,a,u,c,h,f,g,S,y;for(n=t.directoryEntries,s=_.path(),i=[],h=0,a=function(e){return function(){var t;return(t=function(){var s,r,n;return i.length>0?(n=i.pop(),r=n.entry,s=n.dest,r.file(function(r){return e.setPath({path:s}),e.addFilesToPLU({files:[r]}),t()})):void 0})()}}(this),f=function(e){var t,r;return h+=1,r=e.createReader(),(t=function(){return r.readEntries(function(r){var n,o,l;if(r.length>0){for(n=0,o=r.length;o>n;n++)l=r[n],l.isDirectory?f(l):i.push({entry:l,dest:s+e.fullPath});return t()}return h-=1,0===h?a():void 0})})()},S=[],u=0,c=n.length;c>u;u++)y=n[u],g=b(y.name),e.call(l,g)>=0?(o=new File({name:y.name,dest:s}),S.push(r.dispatch({type:d.ADD_NEW_FAILED_FILE,data:{file:o,errorType:p.PACKAGE_FILE,errorMessage:m('Due to browser limitations, OSX package files files cannot be uploaded using drag-and-drop. Please try using the "Upload…" dialog.')}}))):S.push(f(y));return S},t.prototype.setIsUploadModalOpen=function(e){var t;return t=e.isUploadModalOpen,r.dispatch({type:d.SET_IS_UPLOAD_MODAL_OPEN,data:{isUploadModalOpen:t}})},t.prototype.setIsInlineStatusDismissed=function(e){var t;return t=e.isInlineStatusDismissed,r.dispatch({type:d.SET_IS_INLINE_STATUS_DISMISSED,data:{isInlineStatusDismissed:t}})},t.prototype.cancelUploads=function(e){var t;return t=e.files,i.removeFiles({files:t}),r.dispatch({type:d.CANCEL_UPLOADS,data:{files:t}}),this._frobPLU()},t.prototype.manuallySetInErrorState=function(e){var t,s,n;return n=e.file,s=e.errorType,t=e.errorMessage,i.removeFiles({files:[n]}),r.dispatch({type:d.UPLOAD_ERROR,data:{uploadId:n.uploadId,errorType:s,errorMessage:t}}),this._frobPLU()},t.prototype._startUpload=function(e){var t,s,n,o;return s=e.file,r.dispatch({type:d.START_UPLOAD,data:{file:s}}),o="url"===(n=g(s.name,t=!0))||"webloc"===n||"website"===n?0:1,i.setAjaxParams({dest:s.dest,reported_total_size:s.size,uploadId:s.uploadId,_subject_uid:s.userId,offset:0,overwrite:o}),i.start(),!0},t.prototype._frobPLU=function(){var e;return e=_.nextUpload(),null!=e&&null==_.currentUpload()?(f(e instanceof c),this._startUpload({file:e})):void 0},t}(),{UploaderDispatcher:r,UploaderActions:new h}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/react/file_uploader/plu_wrapper",["jquery","modules/core/exception","external/plupload_dev","external/react","external/underscore","modules/clean/static_urls","modules/core/cookies","modules/clean/react/file_uploader/store","modules/constants/request","modules/constants/env","modules/core/i18n"],function(t,s,r,n,o,i,a,l,u,c,p){var d,h,_,m,f,g,b,S,y,v,T;return y=s.assert,g=i.UrlConstants,f=l.UploaderStore,d=l.FileUpload,m=l.UploadErrorType,v=l.generateUploadId,b=p._,T=window.plupload,S=function(e,t){var s,r;
return null==t&&(t={}),s=o.extend({},t,e),new d({uploadId:s.uploadId,dest:s.dest,name:s.name,size:s.size,userId:s.userId,percentUploaded:null!=(r=s.percent)?r:0})},_=function(){function s(){this.removeFiles=e(this.removeFiles,this),this.bytesPerSec=e(this.bytesPerSec,this),this.onError=e(this.onError,this),this.onFileUploaded=e(this.onFileUploaded,this),this.onUploadProgress=e(this.onUploadProgress,this),this.onFilesAdded=e(this.onFilesAdded,this),this.setBrowseButton=e(this.setBrowseButton,this),this.setAjaxParams=e(this.setAjaxParams,this),this.start=e(this.start,this),this.addFiles=e(this.addFiles,this),this.init=e(this.init,this),this.isInitialized=!1}return s.prototype.idToUploadIdMap={},s.prototype.PLU_CONTAINER_ID="flash-upload-container",s.prototype.init=function(){var e;if(!this.isInitialized)return this.isInitialized=!0,this.$secretBrowseButton=t("<button>").addClass("secret-file-uploader-button").hide().appendTo(t("body")),this.$pluContainer=t("<div>").attr("id",this.PLU_CONTAINER_ID).css({position:"absolute",left:-2e3}).appendTo(t("body")),this.$currentExternalBrowseButton=t(),e={url:"https://"+c.BLOCK_CLUSTER+"/chunked_upload",file_data_name:"file",runtimes:this._runtimes,multipart_params:{},multipart:!1,max_file_size:"50000mb",chunk_size:"8mb",max_retries:2,browse_button:this.$secretBrowseButton[0],container:this.PLU_CONTAINER_ID,flash_swf_url:g.MOXIE_SWF_URL,init:{ChunkUploaded:function(e){return function(t,s,r){var n,o;return o=e.idToUploadIdMap[s.id],y(JSON.parse(r.response).upload_id===o),n=f.fileList().get(o),e.setAjaxParams({dest:n.dest,reported_total_size:n.size,uploadId:o,_subject_uid:n.userId,offset:r.offset,overwrite:1})}}(this)}},this.uploader=new T.Uploader(e),this.uploader.init()},s.prototype._runtimes=function(){var e,t,s,r,n;r={"MSIE 8.0":"flash","MSIE 9.0":"flash"},s="html5";for(e in r)n=r[e],-1!==(null!=(t=navigator.userAgent)?t.indexOf(e):void 0)&&(s=n);return s}(),s.prototype.addFiles=function(e){var t;return t=e.files,this.isInitialized||this.init(),this.uploader.addFile(t)},s.prototype.start=function(){return this.isInitialized||this.init(),this.uploader.start()},s.prototype.setAjaxParams=function(e){var t,s,r,n,o,i;if(o=e.reported_total_size,s=e.dest,i=e.uploadId,r=e.offset,t=e._subject_uid,n=e.overwrite,this.isInitialized||this.init(),null==o||null==s||null==i||null==r||null==t||null==n)throw new Error("A required parameter to setAjaxParams was not given.");return this.uploader.settings.multipart_params={t:a.read(u.JS_CSRF_COOKIE),reported_total_size:o,dest:s,upload_id:i,offset:r,_subject_uid:t,overwrite:n}},s.prototype.setBrowseButton=function(e){var s;return this.isInitialized||this.init(),"flash"===this.uploader.runtime?(this.$currentExternalBrowseButton=t(e),this.$currentExternalBrowseButton.length?(t("#"+this.PLU_CONTAINER_ID).show().css({"z-index":1e3,position:"absolute",top:this.$currentExternalBrowseButton.offset().top,left:this.$currentExternalBrowseButton.offset().left,width:this.$currentExternalBrowseButton.outerWidth(),height:this.$currentExternalBrowseButton.outerHeight()}),s=t("#"+this.PLU_CONTAINER_ID+" > .moxie-shim"),s[0].style.top="0px",s[0].style.left="0px",s[0].style.width="100%",s[0].style.height="100%"):t("#"+this.PLU_CONTAINER_ID).hide()):(this.$currentExternalBrowseButton.off("click.PLUBrowseButton"),this.$currentExternalBrowseButton=t(e),this.$currentExternalBrowseButton.on("click.PLUBrowseButton",function(e){return function(){return e.$secretBrowseButton.click()}}(this)))},s.prototype.onFilesAdded=function(e){return this.isInitialized||this.init(),this.uploader.bind("FilesAdded",function(t){return function(s,r){var n;return n=r.map(function(e){var s;return s=v(),t.idToUploadIdMap[e.id]=s,S(e,{uploadId:s,dest:f.path(),userId:f.user().id})}),e(n)}}(this))},s.prototype.onUploadProgress=function(e){return this.isInitialized||this.init(),this.uploader.bind("UploadProgress",function(t){return function(s,r){var n,o;return o=t.idToUploadIdMap[r.id],n=f.fileList().get(o),e(n.set("percentUploaded",r.percent))}}(this))},s.prototype.onFileUploaded=function(e){return this.isInitialized||this.init(),this.uploader.bind("FileUploaded",function(t){return function(s,r,n){var o,i;return i=t.idToUploadIdMap[r.id],o=f.fileList().get(i),e(o,n)}}(this))},s.prototype.onError=function(e){return this.isInitialized||this.init(),this.uploader.bind("Error",function(t){return function(s,r){var n,o,i,a;if(null==r.file)throw new Error("PLU error without an associated file.");return o=function(){switch(r.code){case T.FILE_SIZE_ERROR:return m.FILE_SIZE_ERROR;case T.HTTP_ERROR:return 0===r.status?m.CONNECTION_ERROR:507===r.status?m.OVER_QUOTA_ERROR:m.HTTP_ERROR;default:return m.GENERIC}}(),n=function(){switch(o){case m.OVER_QUOTA_ERROR:return b("This file can’t be uploaded because you are over your storage quota. If you believe this message to be in error, try refreshing the page.");case m.FILE_SIZE_ERROR:return b("This file is too large to upload using the Dropbox website. Please use the desktop client.");case m.HTTP_ERROR:return b("Something went wrong while uploading this file. There was a server error during the upload request. If the problem persists, please try the basic uploader.");case m.CONNECTION_ERROR:return b("Something went wrong while uploading this file. Check your connection to the internet and try again.");default:return b("Something went wrong while uploading this file. If the problem persists, please try the basic uploader.")}}(),a=t.idToUploadIdMap[r.file.id],i=f.fileList().has(a)?f.fileList().get(a):S(r.file,{uploadId:v(),dest:f.path()}),e(i,o,n)}}(this))},s.prototype.bytesPerSec=function(){var e;return this.isInitialized||this.init(),null!=(e=this.uploader.total)?e.bytesPerSec:void 0},s.prototype.removeFiles=function(e){var t,s,r,n,i;for(s=e.files,this.isInitialized||this.init(),r=0,n=s.length;n>r;r++)t=s[r],i=o.find(this.uploader.files,function(e){return function(s){return e.idToUploadIdMap[s.id]===t.uploadId}}(this)),this.uploader.removeFile(i);return this.uploader.stop(),this.uploader.start()},s}(),h=new _})}.call(this),function(){var e=function(e,s){function r(){this.constructor=e}for(var n in s)t.call(s,n)&&(e[n]=s[n]);return r.prototype=s.prototype,e.prototype=new r,e.__super__=s.prototype,e},t={}.hasOwnProperty;define("modules/clean/react/file_uploader/store",["external/immutable","modules/clean/base64","modules/clean/flux/base_store","modules/clean/react/browse/constants","modules/core/browser","modules/core/exception"],function(t,s,r,n,o,i){var a,l,u,c,p,d,h,_,m,f;return a=n.BrowseActionTypes,_=i.assert,f=i.raiseAndReport,d={SET_PATH:"UPLOADER_SET_PATH",SET_USER:"UPLOADER_SET_USER",SET_NUM_DRAGGING_FILES:"SET_NUM_DRAGGING_FILES",QUEUE_UPLOADS:"QUEUE_UPLOADS",START_UPLOAD:"START_UPLOAD",COMPLETE_UPLOAD:"COMPLETE_UPLOAD",CANCEL_UPLOADS:"CANCEL_UPLOADS",SET_CURRENT_UPLOAD_PROGRESS:"SET_CURRENT_UPLOAD_PROGRESS",UPLOAD_ERROR:"UPLOAD_ERROR",SET_IS_UPLOAD_MODAL_OPEN:"SET_IS_UPLOAD_MODAL_OPEN",SET_IS_INLINE_STATUS_DISMISSED:"SET_IS_INLINE_STATUS_DISMISSED",ADD_NEW_FAILED_FILE:"ADD_NEW_FAILED_FILE"},l={PENDING:"PENDING",UPLOADING:"UPLOADING",COMPLETE:"COMPLETE",CANCELLED:"CANCELLED",FAILED:"FAILED"},p={FILE_SIZE_ERROR:"FILE_SIZE_ERROR",HTTP_ERROR:"HTTP_ERROR",CONNECTION_ERROR:"CONNECTION_ERROR",OVER_QUOTA_ERROR:"OVER_QUOTA_ERROR",IGNORED:"IGNORED",EMPTY_OR_FOLDER:"EMPTY_OR_FOLDER",PACKAGE_FILE:"PACKAGE_FILE",GENERIC:"GENERIC"},c=o.msie?"text":"application/x-dropbox-file-list",u=t.Record({uploadId:void 0,dest:"",userId:null,name:"",size:0,percentUploaded:0,status:l.PENDING,errorType:p.GENERIC,errorMessage:""}),m=function(){var e,t,r,n;for(e="",t=r=0;15>=r;t=++r)e+=String.fromCharCode(Math.floor(256*Math.random()));return n=s.encode(e),n=n.replace(/\+/g,"-"),n=n.replace(/\//g,"_"),n=n.replace(/\=*$/,"")},h=function(s){function r(){return r.__super__.constructor.apply(this,arguments)}return e(r,s),r.prototype._init=function(){return this._path="/",this._hasPermissionToUploadToFolder=!0,this._user=null,this._fileList=t.OrderedMap(),this._currentUploadId=null,this._numDraggingFiles=0,this._isInternalTransfer=!1,this._isUploadModalOpen=!1,this._isInlineStatusDismissed=!1,this._numSecondsLeft=0},r.prototype.fileList=function(){return this._fileList},r.prototype.currentUpload=function(){return this._fileList.get(this._currentUploadId)},r.prototype.currentUploadPercentage=function(){return this.currentUpload().percentUploaded},r.prototype.numSecondsLeft=function(){return this._numSecondsLeft},r.prototype.isUploadCancelled=function(e){var t;return(null!=(t=this._fileList.get(e))?t.status:void 0)===l.CANCELLED},r.prototype.isInlineStatusDismissed=function(){return this._isInlineStatusDismissed},r.prototype.path=function(){return this._path},r.prototype.hasPermissionToUploadToFolder=function(){return this._hasPermissionToUploadToFolder},r.prototype.user=function(){return this._user},r.prototype.nextUpload=function(){return this._fileList.find(function(e){return e.status===l.PENDING})},r.prototype.numDraggingFiles=function(){return this._numDraggingFiles},r.prototype.isInternalTransfer=function(){return this._isInternalTransfer},r.prototype.totalSizeOfCompletedUploads=function(){return this._fileList.reduce(function(e,t){return t.status===l.COMPLETE?e+t.size:e},0)},r.prototype.totalSize=function(){return this._fileList.reduce(function(e,t){var s;return(s=t.status)===l.COMPLETE||s===l.PENDING||s===l.UPLOADING?e+t.size:e},0)},r.prototype.isUploadModalOpen=function(){return this._isUploadModalOpen},r.prototype._setUser=function(e){var t;return t=e.user,this._user=t,this.emit_change()},r.prototype._setPath=function(e){var t,s,r;return s=e.path,t=null!=(r=e.hasPermissionToUploadToFolder)?r:!0,this._path=s,this._hasPermissionToUploadToFolder=t,this.emit_change()},r.prototype._initializeEverything=function(e){var t,s,r;return r=e.user,s=e.path,t=e.context,this._user=r,this._path=s,this._hasPermissionToUploadToFolder=t.isCurrentPathWriteable(),this.emit_change()},r.prototype._queueUploads=function(e){var t,s,r,n,o;for(s=e.files,o={},r=0,n=s.length;n>r;r++)t=s[r],o[t.uploadId]=t;return this._fileList=this._fileList.merge(o),this.emit_change()},r.prototype._startUpload=function(e){var t;return t=e.file,_(null==this._currentUpload),_(null!=t),_(this._fileList.get(t.uploadId)===t),this._fileList=this._fileList.update(t.uploadId,function(e){return e.set("status",l.UPLOADING)}),this._currentUploadId=t.uploadId,this.emit_change()},r.prototype._completeUpload=function(e){var t,s;return t=e.uploadId,s=this._fileList.find(function(e){return e.status===l.UPLOADING}),_(t===(null!=s?s.uploadId:void 0)),this._fileList=this._fileList.update(s.uploadId,function(e){return e.set("status",l.COMPLETE)}),this._currentUploadId=null,this.emit_change()},r.prototype._cancelUploads=function(e){var t,s,r,n;for(s=e.files,r=0,n=s.length;n>r;r++)t=s[r],this._fileList=this._fileList.update(t.uploadId,function(e){var t;return(t=e.status)===l.PENDING||t===l.UPLOADING?e.set("status",l.CANCELLED):e}),t.uploadId===this._currentUploadId&&(this._currentUploadId=null);return this.emit_change()},r.prototype._setCurrentUploadProgress=function(e){var t,s;return s=e.percentComplete,t=e.numSecondsLeft,this._fileList=this._fileList.update(this._currentUploadId,function(e){return e.set("percentUploaded",s)}),this._numSecondsLeft=t,this.emit_change()},r.prototype._handleUploadError=function(e){var t,s,r,n;return n=e.uploadId,s=e.errorType,t=e.errorMessage,r=this._fileList.get(n),r.uploadId!==this._currentUploadId&&f("Error reported for file upload that is not the current upload",{exc_extra:{file:r.toJS(),fileListLength:this._fileList.count(),errorType:s,errorMessage:t}}),this._fileList=this._fileList.update(r.uploadId,function(e){return e.set("status",l.FAILED).set("errorType",s).set("errorMessage",t)}),this._currentUploadId=null,this.emit_change()},r.prototype._setNumDraggingFiles=function(e){var t,s,r;return s=e.numDraggingFiles,t=null!=(r=e.isInternalTransfer)?r:!1,this._numDraggingFiles=s,this._isInternalTransfer=t,this.emit_change()},r.prototype._setIsUploadModalOpen=function(e){var t;return t=e.isUploadModalOpen,this._isUploadModalOpen=t,this.emit_change()},r.prototype._setIsInlineStatusDismissed=function(e){var t;return t=e.isInlineStatusDismissed,this._isInlineStatusDismissed=t,this.emit_change()},r.prototype._addNewFailedFile=function(e){var t,s,r;return r=e.file,s=e.errorType,t=e.errorMessage,null==r.uploadId&&(r=r.set("uploadId",m())),r=r.set("status",l.FAILED).set("errorType",s).set("errorMessage",t),this._fileList=this._fileList.set(r.uploadId,r),this.emit_change()},r.prototype._new_payload=function(e){switch(e.action.type){case a.INITIALIZE_EVERYTHING:return this._initializeEverything(e.action.data);case a.SET_USER:case d.SET_USER:return this._setUser(e.action.data);case a.SET_PATH:case d.SET_PATH:return this._setPath(e.action.data);case d.QUEUE_UPLOADS:return this._queueUploads(e.action.data);case d.START_UPLOAD:return this._startUpload(e.action.data);case d.COMPLETE_UPLOAD:return this._completeUpload(e.action.data);case d.CANCEL_UPLOADS:return this._cancelUploads(e.action.data);case d.SET_CURRENT_UPLOAD_PROGRESS:return this._setCurrentUploadProgress(e.action.data);case d.UPLOAD_ERROR:return this._handleUploadError(e.action.data);case d.SET_NUM_DRAGGING_FILES:return this._setNumDraggingFiles(e.action.data);case d.SET_IS_UPLOAD_MODAL_OPEN:return this._setIsUploadModalOpen(e.action.data);case d.SET_IS_INLINE_STATUS_DISMISSED:return this._setIsInlineStatusDismissed(e.action.data);case d.ADD_NEW_FAILED_FILE:return this._addNewFailedFile(e.action.data)}},r}(r),{UploaderStore:new h,UploaderActionTypes:d,FileUpload:u,FileStatus:l,UploadErrorType:p,generateUploadId:m,INTERNAL_FILE_DATA_TRANSFER_TYPE:c}})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,s=this.length;s>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/file_uploader/uploader",["jquery","external/immutable","external/react","external/underscore","modules/clean/browse_interface","modules/clean/browse/browse_drag_utils","modules/clean/datetime","modules/clean/display_format","modules/clean/em_string","modules/clean/filepath","modules/clean/flux/store_mixin","modules/clean/react/button","modules/clean/react/browse/store","modules/clean/react/file_uploader/actions","modules/clean/react/file_uploader/store","modules/clean/react/file_uploader/plu_wrapper","modules/clean/react/flag","modules/clean/react/image","modules/clean/react/modal","modules/clean/react/react_i18n","modules/clean/react/sprite","modules/clean/react/tooltip","modules/clean/static_urls","modules/clean/viewer","modules/constants/env","modules/constants/request","modules/constants/viewer","modules/core/browser","modules/core/cookies","modules/core/html","modules/core/i18n","modules/core/notify","modules/core/uri","require"],function(t,s,r,n,o,i,a,l,u,c,p,d,h,_,m,f,g,b,S,y,v,T,w,E,P,F,I,D,C,N,A,R,O,L){var M,x,U,k,B,q,H,G,W,V,j,K,z,Q,Y,J,X,$,Z,ee,te,se,re,ne,oe,ie,ae,le,ue,ce,pe,de,he,_e,me,fe,ge;return ae=o.get_browse_root_name,Z=o.browse_uri_for_fq_path,ee=d.button,ce=d.link_button,M=h.BrowseStore,Q=_.UploaderActions,Y=m.UploaderStore,U=m.FileUpload,x=m.FileStatus,z=m.UploadErrorType,q=m.INTERNAL_FILE_DATA_TRANSFER_TYPE,G=S.Modal,V=y.R_,W=y.RP_,j=T.Tooltip,K=T.TooltipPosition,me=w.static_url,J=A._,ge=A.ungettext,te=r.createElement,se=r.addons.classSet,he=r.DOM,ne=he.div,$=he.a,fe=he.ul,pe=he.ol,ue=he.li,_e=he.span,le=he.input,ie=he.form,de=he.p,re=r.DOM,X=function(e){var t,s,r,n,o,i,a,l;return null==e&&(e={}),a=e.user,r=e.path,s=null!=(n=e.maxLength)?n:1e3,l=E.get_viewer(),l.is_paired&&a.is_team&&(i=u.em_snippet(l.team_name,s)),o="/"===r?l.is_paired?a.is_team?J(" upload to your %(team_name)s Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({team_name:i}):J(" upload to your personal Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}):J(" upload to your Dropbox"):(t=u.em_snippet(c.filename(r),s),l.is_paired?a.is_team?J(" upload to the folder ‘%(folder)s’ in your %(team_name)s Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({folder:t,team_name:i}):J(" upload to the folder ‘%(folder)s’ in your personal Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({folder:t}):J(" upload to the folder ‘%(folder)s’",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({folder:t}))},B=r.createClass({displayName:"FileUploaderModal",mixins:[p(Y)],DROPZONE_ID:"upload-modal-dropzone",propTypes:{dragAndDropEnabled:r.PropTypes.bool,shouldShowDestinationLink:r.PropTypes.bool,onModalDismissed:r.PropTypes.func,clickOutToClose:r.PropTypes.bool},getDefaultProps:function(){return{dragAndDropEnabled:!0,shouldShowDestinationLink:!0,onModalDismissed:function(){},clickOutToClose:!0}},getInitialState:function(){return{isBasicOverquotaUser:!1,isLimitedTeamOverquotaUser:!1,usingBasicUploader:!1,basicUploaderFile:null}},_get_state_from_stores:function(){return{path:Y.path(),user:Y.user(),fileList:Y.fileList(),numDraggingFiles:Y.numDraggingFiles(),currentUpload:Y.currentUpload(),numSecondsLeft:Y.numSecondsLeft(),hasPermissionToUploadToFolder:Y.hasPermissionToUploadToFolder()}},componentDidMount:function(){var e;return this._setBrowseButton(),t(window).on("resize.uploaderModal",function(e){return function(){return e._setBrowseButton()}}(this)),e=I.quota_fraction>1&&0===this.state.user.paid,this.setState({isBasicOverquotaUser:this.state.user.role===I.ROLE_PERSONAL&&e}),this.state.user.role===I.ROLE_WORK?(M.add_change_listener(this._handleBrowseStoreChanged),this._handleBrowseStoreChanged()):void 0},_handleBrowseStoreChanged:function(){var e,t,s;return e=M.context(),e.cdmMveQuotaStats&&e.isInsideTeamFolderTree?(s=e.cdmMveQuotaStats,t=s.quotaRawBytesUsed>s.quotaRawBytes):t=I.quota_fraction>1&&0===this.state.user.paid,this.setState({isLimitedTeamOverquotaUser:t})},componentDidUpdate:function(e,s){var r,n,o,i,a;return this._setBrowseButton(),this.state.numDraggingFiles?this.state.usingBasicUploader?R.error("You can‖t drag and drop upload right now."):(r=t(this.refs.modal.refs.modalBox.getDOMNode()).find("#"+this.DROPZONE_ID),r.length||t("#"+this.DROPZONE_ID).clone().prependTo(t(this.refs.modal.refs.modalBox.getDOMNode())).css({width:"100%",height:"100%",position:"absolute",opacity:0}).show().fadeTo(500,1)):t(this.refs.modal.getDOMNode()).find("#"+this.DROPZONE_ID).remove(),this.state.fileList.count()>s.fileList.count()&&(i=t(this.refs.uploadFilesList.getDOMNode()),n=null!=(a=i.find(".upload-file"))?a.eq(s.fileList.count()):void 0,n.length&&i.scrollTop(i.scrollTop()+n.position().top)),o=t(this.getDOMNode()),o.find(".basic-uploader-link").off("click.switchUploader").on("click.switchUploader",function(e){return function(t){return t.preventDefault(),e.setState({usingBasicUploader:!0})}}(this)),o.find(".enhanced-uploader-link").off("click.switchUploader").on("click.switchUploader",function(e){return function(t){return t.preventDefault(),e.setState({usingBasicUploader:!1})}}(this))},componentWillUnmount:function(){return f.setBrowseButton(null),t(window).off("resize.uploaderModal"),this.state.user.role===I.ROLE_WORK?M.remove_change_listener(this._handleBrowseStoreChanged):void 0},FILENAME_SNIPPET_LENGTH:15,DEST_SNIPPET_LENGTH:13,_setBrowseButton:function(){var e;return f.setBrowseButton(null!=(e=this.refs.pluFileChooseButton)?e.getDOMNode():void 0)},_handleClose:function(){var e,t;t=this.state.fileList.find(function(e){var t;return(t=e.status)===x.PENDING||t===x.UPLOADING}),t||Q.setIsInlineStatusDismissed({isInlineStatusDismissed:!0}),Q.setIsUploadModalOpen({isUploadModalOpen:!1}),G.close(),"function"==typeof(e=this.props).onModalDismissed&&e.onModalDismissed()},_handleCancel:function(e){return Q.cancelUploads({files:[e]})},_handleBasicChooseButtonMouseClick:function(e){return null!=this.refs.fileInput?t(this.refs.fileInput.getDOMNode()).click():void 0},_handleBasicFileInputChange:function(e){var t,s,r,n,o;return r=this.refs.fileInput.getDOMNode(),s=null!=(n=r.files)&&"function"==typeof n.item?n.item(0):void 0,o=r.value,null!=s?this.setState({basicUploaderFile:new U({name:s.name,size:s.size,dest:this.state.path,userId:this.state.user.id,percentUploaded:100,status:x.UPLOADING})},function(e){return function(){return e.refs.basicUploadForm.getDOMNode().submit()}}(this)):null!=o?(t="C:\\fakepath\\",0===o.indexOf(t)?this.setState({basicUploaderFile:new U({name:o.slice(t.length),size:null,dest:this.state.path,userId:this.state.user.id,percentUploaded:100,status:x.UPLOADING})},function(e){return function(){return e.refs.basicUploadForm.getDOMNode().submit()}}(this)):this.refs.basicUploadForm.getDOMNode().submit()):void 0},_renderIntroModalButtons:function(){var e,t,s;return e=re.div({className:"u-font-small"},this.state.isBasicOverquotaUser?V({},'Before you can upload files, you need to <a class="overquota-uploader-link" href="/upgrade?oqa=upl">get more space</a>.'):this.state.isLimitedTeamOverquotaUser?V({},'Before you can upload files, you need to <a class="overquota-uploader-link" href="/team/upgrade?_tk=over_quota&_camp=upload_modal&oqa=upl"> get more space</a>.'):null!=this.state.basicUploaderFile?J("This may take a while depending on the size of the file."):this.state.usingBasicUploader?V({},'Uploading multiple files? Try our <a class="enhanced-uploader-link" href="#">enhanced uploader</a>.'):V({},'Having problems? Try the <a class="basic-uploader-link" href="#">basic uploader</a>.')),t=null,s=null,this.state.isBasicOverquotaUser?t=te(ce,{className:"dbmodal-button c-btn c-btn--primary",href:"/pro/buy?oqa=upl_b"},J("Upgrade to Upload")):this.state.isLimitedTeamOverquotaUser?t=te(ce,{className:"dbmodal-button c-btn c-btn--primary",href:"/team/upgrade?_tk=over_quota&_camp=upload_modal&oqa=upl_b"},J("Upgrade to Upload")):this.state.usingBasicUploader?null==this.state.basicUploaderFile&&(t=re.button({className:"dbmodal-button c-btn c-btn--primary",onClick:this._handleBasicChooseButtonMouseClick},J("Choose a file"))):t=re.button({ref:"pluFileChooseButton",className:"dbmodal-button c-btn c-btn--primary"},J("Choose files")),null==this.state.basicUploaderFile&&(s=re.button({importance:"tertiary",className:"dbmodal-button c-btn c-btn--secondary u-mar-left-s",onClick:this._handleClose},J("Cancel"))),this.state.isBasicOverquotaUser||this.state.isLimitedTeamOverquotaUser?re.div({className:"u-mar-vertical-l clearfix"},re.div({className:"u-l-fr"},t,s,re.div({id:"upload-overquota-banner",className:"c-banner c-banner--warning"},e))):re.div({className:"u-mar-top-l"},te(g,{spacing:"s",rightAttachment:re.div({},t,s)},e))},_renderFileListModalButtons:function(){var e,t,s,r;return s=this.state.fileList.find(function(e){var t;return(t=e.status)===x.PENDING||t===x.UPLOADING}),t=s?"tertiary":"primary",r=re.button({ref:"pluFileChooseButton",className:"dbmodal-button c-btn c-btn--secondary"},J("Add more files")),e=re.button({className:"dbmodal-button c-btn c-btn--"+t,onClick:this._handleClose},J(s?"Hide":"Done")),re.div({className:"u-mar-top-s"},te(g,{leftAttachment:r,rightAttachment:e,spacing:"s"},re.div({className:"u-font-small"},s?void 0:V({},'Having problems? Try the <a class="basic-uploader-link" href="#">basic uploader</a>.'))))},_renderIntroMessage:function(){var e;return e=X({user:this.state.user,path:this.state.path}),re.span({},this.state.isBasicOverquotaUser||this.state.isLimitedTeamOverquotaUser?V({},"You can’t upload files because you’re out of space. Before you can upload to Dropbox, you need to get more space."):this.state.usingBasicUploader?V({comment:'upload_folder_name contains a snippet such as " upload to your Dropbox"',upload_folder_name:e},"Choose a file to %(upload_folder_name)s. The basic uploader can only upload one file at a time."):this.props.dragAndDropEnabled?V({comment:'upload_folder_name contains a snippet such as " upload to your Dropbox"',upload_folder_name:e},"Choose files to %(upload_folder_name)s. You can select more than one file at a time. You can also drag and drop files anywhere on this page to start uploading."):V({comment:'upload_folder_name contains a snippet such as " upload to your Dropbox"',upload_folder_name:e},"Choose files to %(upload_folder_name)s. You can select more than one file at a time."))},_renderDropzone:function(){return re.div({ref:"dropzone",id:this.DROPZONE_ID,style:{display:"none"}},re.div({},W({comment:"upload_action is a phrase like 'upload to folder 'XYZ'",n:this.state.numDraggingFiles,upload_action:X({user:this.state.user,path:this.state.path,maxLength:20})},"Drop your file to %(upload_action)s","Drop your files to %(upload_action)s")))},_renderFileListRowStatus:function(e){var t;return re.div({className:"status-col"},e.status===x.UPLOADING&&100===e.percentUploaded?te(b,{src:me("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),srcHiRes:me("/static/images/icons/ajax-loading-small@2x-vflAxdZTP.gif")}):(t=e.status)===x.PENDING||t===x.UPLOADING?re.button({className:"button-as-link",onClick:function(t){return function(s){return s.preventDefault(),t._handleCancel(e)}}(this)},te(v,{group:"web",name:"xclose",alt:J("Cancel")})):e.status===x.COMPLETE?te(v,{group:"web",name:"s_check",alt:J("Upload successful")}):e.status===x.CANCELLED?te(b,{src:me("/static/images/cancelsync-vflGFIEUK.png"),srcHiRes:me("/static/images/cancelsync@2x-vflzmHGI0.png"),alt:J("Upload cancelled")}):e.status===x.FAILED?te(b,{src:me("/static/images/nosync-vfl18cuTS.png"),srcHiRes:me("/static/images/nosync@2x-vflgS4F07.png"),alt:J("Error")}):void 0)},_renderFileListRowError:function(e){var t,s;return t=(null!=(s=e.errorMessage)?s.length:void 0)>0?e.errorMessage:J("Something went wrong while uploading this file. If the problem persists, please try the basic uploader."),re.div({className:"error-col"},re.span({className:"error-msg"},J(e.errorType===z.FILE_SIZE_ERROR?"File too large":"Upload Error")),re.span({className:"error-details"},te(j,{position:K.RIGHT,tooltip_contents:re.div({},t),tooltip_classname:"upload-error-tooltip"},te(v,{group:"web",name:"information",alt:J("More information")}))))},_renderFileListRowDest:function(e){var t,s;return re.div({className:"dest-col"},e.status===x.CANCELLED?J("Canceled"):(s=E.get_viewer().get_user_by_id(e.userId),t=ae(s),re.a({href:Z(s,e.dest).toString()},u.em_snippet(""+t+e.dest,this.DEST_SNIPPET_LENGTH,0))))},_renderFileListRow:function(e,t){var s,r;return s=e.status===x.UPLOADING?e.percentUploaded:e.status===x.PENDING?0:100,r={"upload-file":!0,complete:e.status===x.COMPLETE,cancelled:e.status===x.CANCELLED,error:e.status===x.FAILED},re.li({className:se(r),key:e.uploadId},re.div({className:"upload-progress-bar",style:{width:s+"%"}}),re.div({className:"upload-file-info",style:{overflow:"hidden"}},re.div({className:"filename-col"},te(v,{group:"web",name:c.file_icon(e.name),alt:""}),re.span({className:"filename"},u.em_snippet(e.name,this.FILENAME_SNIPPET_LENGTH)),null!=e.size?re.span({className:"size"}," - ",l.format_bytes(e.size)):void 0),e.status!==x.FAILED?t?this._renderFileListRowDest(e):void 0:this._renderFileListRowError(e),this._renderFileListRowStatus(e)))},_renderFileList:function(e,t){var s,r,n;return n=null!=(r=(null!=t?t:{}).shouldShowDestinationLink)?r:!0,re.ol({ref:"uploadFilesList",id:"upload-files-list",style:{margin:0,padding:0,maxHeight:228,overflowY:"auto",position:"relative"}},function(){var t,r,o;for(o=[],t=0,r=e.length;r>t;t++)s=e[t],o.push(this._renderFileListRow(s,n));return o}.call(this))},_renderTimeLeft:function(){var e;return e=this.state.currentUpload,null!=e&&e.status===x.UPLOADING?re.div({style:{marginTop:8,textAlign:"right"}},J("%(time_left)s left").format({time_left:a.format_time(this.state.numSecondsLeft)})):void 0},_renderBasicUploaderForm:function(){return re.form({id:"basic-upload-form",ref:"basicUploadForm",encType:"multipart/form-data",noValidate:"novalidate",method:"post",action:"https://"+P.BLOCK_CLUSTER+"/upload"},re.input({type:"hidden",name:"t",value:C.read(F.JS_CSRF_COOKIE)}),re.input({type:"hidden",name:"_subject_uid",value:this.state.user.id}),re.input({type:"hidden",name:"plain",value:"yes"}),re.input({type:"hidden",name:"dest",value:this.state.path}),re.input({type:"file",name:"file","aria-label":J("Upload file"),tabIndex:"-1",style:{display:"none"},ref:"fileInput",onChange:this._handleBasicFileInputChange}))},render:function(){return re.div({ref:"container"},this._renderDropzone(),te(G,{ref:"modal",title:J("Upload to Dropbox"),showX:!1,clickOutToClose:this.props.clickOutToClose,buttonComponent:0===this.state.fileList.count()||this.state.usingBasicUploader?this._renderIntroModalButtons():this._renderFileListModalButtons(),onDismiss:function(e){return function(t){return null!=e.state.basicUploaderFile?void t.preventDefault():Q.setIsUploadModalOpen({isUploadModalOpen:!1})}}(this)},this.state.usingBasicUploader?this._renderBasicUploaderForm():void 0,null!=this.state.basicUploaderFile?this._renderFileList([this.state.basicUploaderFile],{shouldShowDestinationLink:!1}):0===this.state.fileList.count()||this.state.usingBasicUploader?this._renderIntroMessage():this._renderFileList(this.state.fileList.toArray(),{shouldShowDestinationLink:this.props.shouldShowDestinationLink}),this._renderTimeLeft()))}}),H=r.createClass({displayName:"InlineUploadStatus",propTypes:{fileList:r.PropTypes.instanceOf(s.OrderedMap).isRequired,currentUpload:r.PropTypes.instanceOf(U),numSecondsLeft:r.PropTypes.number,onViewDetails:r.PropTypes.func},FILENAME_SNIPPET_LENGTH:30,_getOverallUploadState:function(){return this.props.fileList.find(function(e){var t;return(t=e.status)===x.PENDING||t===x.UPLOADING})?"uploading":this.props.fileList.find(function(e){return e.status===x.FAILED})?"error":"complete"},_getProgressBarWidth:function(){var e;return e=this._getOverallUploadState(),"uploading"===e&&null!=this.props.currentUpload?this.props.currentUpload.percentUploaded:"complete"===e||"error"===e?100:0},_getNumPendingFiles:function(){return this.props.fileList.count(function(e){return e.status===x.PENDING})},_getNumCompletedFiles:function(){return this.props.fileList.count(function(e){return e.status===x.COMPLETE})},_getNumNoncancelledFiles:function(){return this.props.fileList.count(function(e){return e.status!==x.CANCELLED})},_getNumErrors:function(){return this.props.fileList.count(function(e){return e.status===x.FAILED})},_renderIcon:function(){var e;return e=this._getOverallUploadState(),"uploading"===e?te(v,{group:"web",name:"s_sync",alt:J("Uploading")}):"complete"===e?te(v,{group:"web",name:"s_check",alt:J("Upload successful")}):te(b,{src:me("/static/images/nosync-vfl18cuTS.png"),srcHiRes:me("/static/images/nosync@2x-vflgS4F07.png"),alt:J("Error")})},_renderCloseButton:function(){return re.button({className:"button-as-link",onClick:function(e){return e.preventDefault(),Q.setIsInlineStatusDismissed({isInlineStatusDismissed:!0})}},te(v,{group:"web",name:"xclose",alt:J("Close")}))},_renderViewDetailsLink:function(){var e;return e=this._getNumPendingFiles(),re.span({className:"details"}," - ",re.button({className:"view-details button-as-link",onClick:function(e){return function(t){var s;return t.preventDefault(),"function"==typeof(s=e.props).onViewDetails?s.onViewDetails():void 0}}(this)},e>0?ge("%(num_pending_files)d file left","%(num_pending_files)d files left",e).format({num_pending_files:e}):J("View details")))},_renderFileDescription:function(){var e,t,s,r;return r=this._getOverallUploadState(),s=this._getNumNoncancelledFiles(),t=this._getNumErrors(),re.span({className:"file-desc"},null!=this.props.currentUpload?J("Uploading %(filename)s").format({filename:u.em_snippet(this.props.currentUpload.name,this.FILENAME_SNIPPET_LENGTH)}):"uploading"===r?J("Starting upload..."):"complete"===r?s>1?J("Uploaded %(num_files)d files").format({num_files:s}):J("Uploaded %(filename)s").format({filename:u.em_snippet(this.props.fileList.last().name,this.FILENAME_SNIPPET_LENGTH)}):"error"===r?s>1?[J("Uploaded %(num_completed)d of %(num_files)d files").format({
num_completed:this._getNumCompletedFiles(),num_files:s})," ",re.span({className:"num-errors"},ge("- %d error","- %d errors",t).format(t))]:(e=this.props.fileList.last().errorType,e===z.GENERIC?J("Unable to upload %(filename)s").format({filename:u.em_snippet(this.props.fileList.last().name,this.FILENAME_SNIPPET_LENGTH)}):J("Unable to upload %(filename)s: %(reason)s").format({filename:u.em_snippet(this.props.fileList.last().name,this.FILENAME_SNIPPET_LENGTH),reason:function(){switch(e){case z.OVER_QUOTA_ERROR:return J("over quota");case z.FILE_SIZE_ERROR:return J("file too large");case z.CONNECTION_ERROR:return J("lost connection");case z.HTTP_ERROR:return J("server error");case z.EMPTY_OR_FOLDER:return J("can’t upload folders or empty files");case z.PACKAGE_FILE:return J("OSX package file")}}()})):void 0)},render:function(){var e,t;return e=this._getOverallUploadState(),t={"upload-file":!0,error:"error"===e,complete:"complete"===e},re.div({id:"inline-upload-status",className:se(t)},re.div({className:"inline-upload-info"},re.div({className:"icon"},this._renderIcon()),re.div({className:"files-info"},this._renderFileDescription(),re.span({className:"num-errors"}),this._renderViewDetailsLink()),re.div({className:"status"},"uploading"===e&&null!=this.props.numSecondsLeft?J("%(time_left)s left").format({time_left:a.format_time(this.props.numSecondsLeft)}):this._renderCloseButton())),re.div({className:"inline-upload-bar"},re.div({className:"inline-upload-progress",style:{width:this._getProgressBarWidth()+"%"}})))}}),oe=null,k=r.createClass({displayName:"FileUploader",mixins:[p(Y)],propTypes:{dragAndDropEnabled:r.PropTypes.bool,shouldShowDestinationLink:r.PropTypes.bool,onFileUploadComplete:r.PropTypes.func,onAllFileUploadsComplete:r.PropTypes.func,onModalDismissed:r.PropTypes.func,clickOutToClose:r.PropTypes.bool},statics:{showModal:function(){return oe?oe.showModal():void console.warn("Tried to show the file upload modal, but no FileUploader component has been instantiated on the page yet.")}},getDefaultProps:function(){return{dragAndDropEnabled:!0,shouldShowDestinationLink:!0,onFileUploadComplete:function(){},onAllFileUploadsComplete:function(){},onModalDismissed:function(){},clickOutToClose:!0}},_get_state_from_stores:function(){return{path:Y.path(),user:Y.user(),fileList:Y.fileList(),numDraggingFiles:Y.numDraggingFiles(),isInternalTransfer:Y.isInternalTransfer(),currentUpload:Y.currentUpload(),isUploadModalOpen:Y.isUploadModalOpen(),numSecondsLeft:Y.numSecondsLeft(),isInlineStatusDismissed:Y.isInlineStatusDismissed(),hasPermissionToUploadToFolder:Y.hasPermissionToUploadToFolder()}},INLINE_STATUS_CONTAINER_CLASS:"inline-upload-status-container",showModal:function(){return G.showInstance(te(B,{dragAndDropEnabled:this.props.dragAndDropEnabled,shouldShowDestinationLink:this.props.shouldShowDestinationLink,onModalDismissed:this.props.onModalDismissed,clickOutToClose:this.props.clickOutToClose})),Q.setIsUploadModalOpen({isUploadModalOpen:!0})},componentWillMount:function(){if(oe)throw new Error("Only one FileUploader component may be rendered to the page at any time. You have tried to instantiate multiple uploaders.");return oe=this},componentDidMount:function(){var s;return Q.initPLU(),this.dragEnterCount=0,this.lastEnteredElement=null,s=t(document),s.on("dragover.fileUploader",function(e){return e.preventDefault(),e.stopPropagation()}).on("dragenter.fileUploader",function(t){return function(s){var r,o,i,a;return s.preventDefault(),s.stopPropagation(),s.target!==t.lastEnteredElement?(t.lastEnteredElement=s.target,t.dragEnterCount+=1,i=function(){var e;try{return null!=(e=s.originalEvent.dataTransfer.mozItemCount)?e:Object.keys(s.originalEvent.dataTransfer.items).length}catch(e){return 1}}(),a=s.originalEvent.dataTransfer.types,r=["Files","application/x-moz-file",q,"text/x-moz-url","text/uri-list","Url"],null!=a&&(null!=a.indexOf&&n.intersection(a,r).length>0||a instanceof DOMStringList&&(a.contains("Files")||a.contains("text/x-moz-url")||D.msie&&(a.contains("Text")||a.contains("text/plain"))))?(o=e.call(a,q)>=0||e.call(a,"text/plain")>=0||a instanceof DOMStringList&&(a.contains("Text")||a.contains("text/plain")),Q.setNumDraggingFiles({numDraggingFiles:i,isInternalTransfer:o})):void 0):void 0}}(this)).on("dragleave.fileUploader",function(e){return function(t){return t.preventDefault(),t.stopPropagation(),e.lastEnteredElement=null,e.dragEnterCount-=1,e.dragEnterCount<1?(e.dragEnterCount=0,Q.setNumDraggingFiles({numDraggingFiles:0})):void 0}}(this)).on("drop.fileUploader",this._handleFileDrop),t("<div>").addClass(this.INLINE_STATUS_CONTAINER_CLASS).prependTo(t("#page-content")),t(window).on("beforeunload.fileUploader",function(e){return function(t){var s,r;return s=null!=e.state.fileList.find(function(e){var t;return(t=e.status)===x.PENDING||t===x.UPLOADING}),s&&e.state.fileList.count()>0?(r=J("Leaving this page will cancel your uploads."),t.returnValue=r,r):void 0}}(this))},updateInlineStatus:function(){var e,s,n;return n=null!=this.state.fileList.find(function(e){var t;return(t=e.status)===x.PENDING||t===x.UPLOADING}),s=!this.state.isUploadModalOpen&&(n||this.state.fileList.count()>0&&!n&&!this.state.isInlineStatusDismissed),e=t("."+this.INLINE_STATUS_CONTAINER_CLASS),s?r.render(te(H,{fileList:this.state.fileList,currentUpload:this.state.currentUpload,onViewDetails:this._handleInlineStatusViewDetails,numSecondsLeft:this.state.numSecondsLeft}),e[0]):r.unmountComponentAtNode(e[0])},componentWillUpdate:function(e,t){var s,r,n;return null==t.currentUpload&&null!=this.state.currentUpload&&"function"==typeof(s=this.props).onFileUploadComplete&&s.onFileUploadComplete(this.state.currentUpload),t.fileList!==this.state.fileList&&(n=null!=t.fileList.find(function(e){var t;return(t=e.status)===x.PENDING||t===x.UPLOADING}),!n&&t.fileList.count()>0)&&"function"==typeof(r=this.props).onAllFileUploadsComplete?r.onAllFileUploadsComplete(this.state.fileList):void 0},componentDidUpdate:function(e,s){var r,n;return r=t(".external-drop-indicator"),this.state.numDraggingFiles&&!this.state.isInternalTransfer?(s.numDraggingFiles||r.css("opacity",0).fadeTo(500,.6),this.state.hasPermissionToUploadToFolder?r.removeClass("external-drop-indicator--uploads-disabled"):r.addClass("external-drop-indicator--uploads-disabled"),this.state.isUploadModalOpen||(this.state.hasPermissionToUploadToFolder?(n=J("Drop your files to %(upload_action)s",{comment:"upload_action is a phrase like 'upload to folder 'XYZ'"}).format({upload_action:X({user:this.state.user,path:this.state.path})}),R.success(n,60)):R.error(J("You don’t have permission to add to this folder.")))):!this.state.numDraggingFiles&&s.numDraggingFiles&&(r.hide().removeClass("external-drop-indicator--uploads-disabled"),R.clear()),this.updateInlineStatus()},componentWillUnmount:function(){return t(document).off("dragover.fileUploader").off("dragenter.fileUploader").off("dragleave.fileUploader").off("drop.fileUploader"),t("."+this.INLINE_STATUS_CONTAINER_CLASS).remove(),t(window).off("beforeunload.fileUploader"),oe=null},_handleFileDrop:function(e){var t,s,r,n,o,a,l,u,c,p,d,h,_,m,f,g,b,S,y,v,T,w,E,P,F,I,C,N;if(e.preventDefault(),e.stopPropagation(),this.dragEnterCount=0,this.lastEnteredElement=null,Q.setNumDraggingFiles({numDraggingFiles:0}),t=e.originalEvent.dataTransfer,s=D.msie?"text":"application/x-dropbox-file-list",f=t.getData(s),null!=f)try{if(F=JSON.parse(f),N=F.userId,_=F.fromPath,p=F.filePaths,(null!=p?p.length:void 0)>0&&null!=_&&null!=N)return this.state.hasPermissionToUploadToFolder?N!==this.state.user.id?void R.error(J("You can’t move or copy files here from another Dropbox.")):(C=e.ctrlKey||e.altKey,void L(["modules/dirty/react/browse/actions"],function(e){return function(t){return C?t.copyFiles({files:p.map(function(e){return{fq_path:e}}),newPath:e.state.path}):_!==e.state.path?t.moveFiles({path:_,files:p.map(function(e){return{fq_path:e}}),newPath:e.state.path}):void 0}}(this))):void R.error(J("You don’t have permission to add to this folder."))}catch(e){}if(this.state.hasPermissionToUploadToFolder){if(n=i.getDraggedLink(t),null!=n)return P=i.buildUrlLinkfileContents(n),E=new Blob([P],{type:"text/plain"}),w=O.parse(n).getAuthority(),E.name=w+".url",E.overwrite=!1,void Q.addFilesToPLU({files:[E]});if(b=t.items,d=t.files,null!=(null!=b&&null!=(I=b[0])?I.webkitGetAsEntry:void 0)){for(a=function(){var e,t,s;for(s=[],m=e=0,t=b.length;t>=0?t>e:e>t;m=t>=0?++e:--e)s.push(b[m].webkitGetAsEntry());return s}(),u=function(){var e,t,s;for(s=[],e=0,t=a.length;t>e;e++)o=a[e],(null!=o?o.isFile:void 0)&&s.push(o);return s}(),r=function(){var e,t,s;for(s=[],e=0,t=a.length;t>e;e++)o=a[e],(null!=o?o.isDirectory:void 0)&&s.push(o);return s}(),S=0,v=u.length;v>S;S++)c=u[S],c.file(function(e){return Q.addFilesToPLU({files:[e]})});if(r.length>0)return Q.addDirectoriesToPLU({directoryEntries:r})}else if(null!=(null!=d?d.length:void 0)){for(g=function(e){return null!=e&&null!=e.type&&null!=e.size&&""===e.type&&e.size%4096===0},d=function(){var e,t,s;for(s=[],m=e=0,t=d.length;t>=0?t>e:e>t;m=t>=0?++e:--e)s.push(d.item(m));return s}(),h=function(e){return function(){var t;return g(l)?(t=new FileReader,t.onerror=function(){var t,s;return t=null!=(s=e.state.fileList.find(function(e){var t;return((t=e.status)===x.PENDING||t===x.UPLOADING)&&e.name===l.name}))?s.toJS():void 0,null!=t?Q.manuallySetInErrorState({file:t,errorType:z.EMPTY_OR_FOLDER,errorMessage:J("This folder or empty file could not be uploaded because of browser limitations. Try zipping up the content before uploading it, or use the Dropbox desktop client to sync it.")}):void 0},t.readAsArrayBuffer(l)):void 0}}(this),y=0,T=d.length;T>y;y++)l=d[y],h();return Q.addFilesToPLU({files:d})}}},_handleInlineStatusViewDetails:function(){return this.showModal()},render:function(){return re.div({})}}),{FileUploader:k}})}.call(this),function(){define("modules/clean/react/outside_event",["external/react","external/underscore","modules/clean/react/util"],function(e,t,s){var r,n,o,i,a,l;return l=s.mergeProps,i=e.createElement,a=e.DOM,o=function(s,r,n,o){var a,u,c;return a=null!=(c=s.displayName)?c:"UnnamedComponent",e.createClass({displayName:"Outside"+r+"Handled"+a,propTypes:(u={},u[""+n]=e.PropTypes.func,u[""+o]=e.PropTypes.func,u),componentDidMount:function(){return document.addEventListener(r,this._handleOutsideEvent,!1)},componentWillUnmount:function(){return document.removeEventListener(r,this._handleOutsideEvent,!1)},render:function(){var e,r;return r=l(t.omit(this.props,n,o,"children"),(e={},e[""+n]=this._handleInsideEvent,e)),i(s,r,this.props.children)},_handleOutsideEvent:function(e){var t;return"function"==typeof(t=this.props)[o]?t[o](e):void 0},_handleInsideEvent:function(e){var t,s;return e.stopPropagation(),"function"==typeof(t=e.nativeEvent).stopImmediatePropagation&&t.stopImmediatePropagation(),"function"==typeof(s=this.props)[n]?s[n](e):void 0}})},r=o("div","click","onClick","onOutsideClick"),n=o("div","mousedown","onMouseDown","onOutsideMouseDown"),{OutsideClickHandler:r,OutsideMouseDownHandler:n,addOutsideEventHandling:o}})}.call(this),function(){define("modules/clean/react/pro/pro_onboarding_tour_modal",["external/react","jquery","external/classnames","modules/clean/ajax","modules/clean/react/button","modules/clean/react/css","modules/clean/react/image","modules/clean/react/modal"],function(e,t,s,r,n,o,i,a){var l,u,c,p,d,h,_,m;return l=a.Modal,_=e.createElement,m=s,h=e.addons.CSSTransitionGroup,d=e.createClass({displayName:"ProOnboardingWelcomeScreen",propTypes:{tourPaths:e.PropTypes.array,onTourPathChange:e.PropTypes.func,contentSource:e.PropTypes.object},getInitialState:function(){return{tourPath:null}},setTourPathState:function(e){return this.setState({tourPath:e}),this.props.onTourPathChange(e)},renderMainText:function(t){var s;return t instanceof Array?(s=t.map(function(s,r){return e.createElement("li",{key:r,className:"onboarding-panel__checkmark"},t[r])}),e.createElement("ul",{className:"onboarding-panel__list"},s)):e.createElement("p",null,t)},render:function(){var t;return t=this.props.tourPaths.map(function(t){return function(s,r){var o,a,l,u,c;return c=t.props.contentSource[s].welcome,o=c["image-path"],a=null!=c["image-path-retina"]?c["image-path-retina"]:o,l=r<t.props.tourPaths.length-1,u=m({"onboarding-panel__column":!0,"onboarding-panel__column--rb":l}),e.createElement("div",{key:r,className:u},e.createElement("h2",{className:"onboarding-panel__title"},c.title),e.createElement("div",{className:"onboarding-panel__image"},e.createElement(i,{src:o,srcHiRes:a})),e.createElement("div",{className:"onboarding-panel__content"},t.renderMainText(c["main-text"])),e.createElement(n.link_button,{onClick:t.setTourPathState.bind(t,s),className:"onboarding-panel__button c-btn c-btn--primary"},c["button-text"]))}}(this)),e.createElement("div",{className:"onboarding-panel onboarding-panel--welcome"},t)}}),u=e.createClass({displayName:"ProOnboardingFeatureContent",propTypes:{tourStep:e.PropTypes.number,className:e.PropTypes.string,contentSource:e.PropTypes.object.isRequired,handleFeatureLinkClick:e.PropTypes.func},render:function(){var t,s,r;return t=m({"onboarding-panel__image":!0,"onboarding-panel__image--center":!0,"onboarding-panel__image--b":!0}),s=this.props.contentSource["image-path"],r=null!=this.props.contentSource["image-path-retina"]?this.props.contentSource["image-path-retina"]:s,e.createElement("div",{key:this.props.tourStep,className:"onboarding-panel__column"},e.createElement("h2",{className:"onboarding-panel__title"},this.props.contentSource.title),e.createElement("div",{className:t},e.createElement(i,{src:s,srcHiRes:r})),e.createElement("div",{className:"onboarding-panel__text"},this.props.contentSource["main-text"]),e.createElement(n.link_button,{className:"onboarding-panel__button c-btn c-btn--primary",href:this.props.contentSource["button-href"],target:"_blank",onClick:this.props.handleFeatureLinkClick},this.props.contentSource["button-text"]))}}),c=e.createClass({displayName:"ProOnboardingNavigation",propTypes:{handleTourForward:e.PropTypes.func,handleTourBackward:e.PropTypes.func,handleTourEnd:e.PropTypes.func,atTourEnd:e.PropTypes.bool},render:function(){var t,s;return s=e.createElement("div",{className:"onboarding-panel__nav--next",onClick:this.props.handleTourForward}),this.props.atTourEnd&&(t=m({"c-btn":!0,"c-btn--secondary":!0,"c-btn--big":!0,"c-btn--full":!0,"onboarding-panel__button":!0,"onboarding-panel__nav--fin":!0}),s=e.createElement("button",{onClick:this.props.handleTourEnd,className:t},"Go to my Dropbox")),e.createElement("div",{className:"onboarding-panel__nav"},e.createElement("div",{className:"onboarding-panel__nav--prev",onClick:this.props.handleTourBackward}),s)}}),p=e.createClass({displayName:"ProOnboardingTourModal",propTypes:{className:e.PropTypes.string,modalId:e.PropTypes.string.isRequired,onboardingPaths:e.PropTypes.array.isRequired,contentSource:e.PropTypes.object.isRequired},statics:{renderWithProps:function(e){var s,r,n;return s=o(p,["/static/css/payments/pro_trial_onboarding_tour-vfl8U7rsY.css"]),n={style:"lightbox",onDismiss:t("#pro-trial-tour-header-bubble").removeClass("force-hidden")},r=_(s,e),l.showInstance(_(l,n,r))}},getInitialState:function(){return{tourStep:0,tourPath:null,tourPathNumStep:null,atTourStart:!0,atTourEnd:!1}},onTourPathChange:function(e){var t;return t={selected_path:e},this._log("pro_onboarding_path_selected",t),this.setState({tourPath:e,atTourStart:!1,tourPathNumStep:this.props.contentSource[e].features.length-1})},tourForward:function(){var e;return e={selected_path:this.state.tourPath,tour_step:this.state.tourStep},this._log("pro_onboarding_tour_forward",e),this.setState({tourStep:this.state.tourStep+1,atTourStart:!1,atTourEnd:this.state.tourStep===this.state.tourPathNumStep-1})},tourBackward:function(){var e;return e={selected_path:this.state.tourPath,tour_step:this.state.tourStep},this._log("pro_onboarding_tour_backward",e),0===this.state.tourStep?this.setState({atTourStart:!0}):this.setState({tourStep:this.state.tourStep-1,atTourEnd:!1})},tourEnd:function(){var e;return e={selected_path:this.state.tourPath,tour_step:this.state.tourStep},this._log("pro_onboarding_tour_finish",e),l.close()},logLinkClick:function(){var e;return e={selected_path:this.state.tourPath,tour_step:this.state.tourStep},this._log("pro_onboarding_tour_link_click",e)},_log:function(e){return function(e,t){return r.WebRequest({url:"/pro/trial_onboarding_tour_log",data:{evt:e,extra_data:JSON.stringify(t)}})}}(this),render:function(){var t;return t=[],this.state.atTourStart?t.push(e.createElement(d,{key:"onboardingWelcome",contentSource:this.props.contentSource,tourPaths:this.props.onboardingPaths,onTourPathChange:this.onTourPathChange})):t.push(e.createElement(h,{component:"div",transitionName:"fade",transitionLeave:!1},e.createElement(u,{key:this.state.tourPath+"-"+this.state.tourStep,tourStep:this.state.tourStep,handleFeatureLinkClick:this.logLinkClick,contentSource:this.props.contentSource[this.state.tourPath].features[this.state.tourStep]})),e.createElement(c,{key:"onboardingNav",atTourEnd:this.state.atTourEnd,handleTourForward:this.tourForward,handleTourBackward:this.tourBackward,handleTourEnd:this.tourEnd})),e.createElement("div",{id:this.props.modalId,className:this.props.className},t)}}),{ProOnboardingTourModal:p,ProOnboardingFeatureContent:u,ProOnboardingNavigation:c,ProOnboardingWelcomeScreen:d}})}.call(this),function(){var e=[].slice,t={}.hasOwnProperty;define("modules/clean/react/selectable_list",["jquery","external/underscore","external/react","external/immutable","external/keymaster","modules/clean/keycode","modules/clean/react/outside_event","modules/core/browser","modules/core/exception","modules/clean/react/helpers"],function(s,r,n,o,i,a,l,u,c,p){var d,h,_,m,f,g,b,S,y,v,T,w,E,P,F;return S=l.addOutsideEventHandling,y=c.assert,F=p.shallowCompareStateAndProps,m="",f=n.PropTypes,b=o.Record({selected:new o.OrderedSet,anchor:null}),w=function(e,t){return null==e&&(e=[]),null==t&&(t=null),new b({selected:new o.OrderedSet(e),anchor:t||e[0]})},_="up",h="down",P=function(e){return u.mac&&e.metaKey||!u.mac&&e.ctrlKey},v=function(){var t;return t=1<=arguments.length?e.call(arguments,0):[],function(){var e,s,n,o;for(o=[],s=0,n=t.length;n>s;s++)e=t[s],r.isFunction(e)&&o.push(e.apply(this,arguments));return o}},g={onMouseEnter:"handleMouseEnterRow",onMouseDown:"handleMouseDownInRow",onMouseUp:"handleMouseUpInRow",onToggleRowSelected:"handleToggleRowSelected"},d={onMouseDown:"handleMouseDownInCheckbox",onToggleRowSelected:"handleToggleRowSelected",onMouseEnter:"noop",onMouseUp:"noop"},E=function(){var e;return"INPUT"===(e=document.activeElement.tagName)||"TEXTAREA"===e||"SELECT"===e||"BUTTON"===e},T=function(e,i){var a,l;return l=null!=(a=(null!=i?i:{}).shouldComponentUpdate)?a:F,e=S(e,"mouseup","onMouseUp","onOutsideMouseUp"),n.createClass({displayName:"Selectable"+e.displayName,propTypes:{onSelectionChange:n.PropTypes.func,selection:n.PropTypes.instanceOf(b),defaultSelection:n.PropTypes.instanceOf(b),keyScope:n.PropTypes.string,linkedOutsideClasses:n.PropTypes.array,addTabbingClassWhenKeyboardNavigating:n.PropTypes.bool,isCheckboxes:n.PropTypes.bool},getDefaultProps:function(){return{onSelectionChange:r.noop,selection:null,defaultSelection:new b,keyScope:"SelectableList",linkedOutsideClasses:[],addTabbingClassWhenKeyboardNavigating:!0}},getInitialState:function(){return{selection:this.props.defaultSelection}},componentWillMount:function(){return this._focusedItem=null,this._handlerCache={},this._isFocused=!1,this._mostRecentMousedownTarget=null,this._isSelecting=!1},componentDidMount:function(){return this._setupKeyboardShortcuts(),this._focusItem(this._selection().anchor),s(this.getDOMNode()).on("focusin.SelectableList",this.getFocusHandler(!0)).on("focusout.SelectableList",this.getFocusHandler(!1))},shouldComponentUpdate:l,componentDidUpdate:function(e,t){var s,r;return(null!=(s=e.selection)?s.anchor:void 0)!==(null!=(r=this.props.selection)?r.anchor:void 0)&&this._selection().selected.size&&(this._focusedItem=this._selection().anchor),this._focusedItem?(this._focusItem(this._focusedItem),this._focusedItem=null):void 0},componentWillUnmount:function(){return this._handlerCache=null,m!==this.props.keyScope&&(key.clearScope(this.props.keyScope),key.setScope(m)),s(this.getDOMNode()).off(".SelectableList")},getFocusHandler:function(e){return function(t){return function(){return t._isFocused=e,!0}}(this)},_setupKeyboardShortcuts:function(){var e,t,s,r,n,o,i,a,l;return m=key.getScope(),m!==this.props.keyScope&&key.setScope(this.props.keyScope),o=function(e){return function(t){return e._isFocused&&"BUTTON"!==t.target.tagName}}(this),n=function(e){return function(t){return!document.activeElement||document.activeElement===document.body||e.getDOMNode().contains(t.target)&&"INPUT"!==t.target.nodeName}}(this),r=function(e,t){return function(s){return e(s)?(s.preventDefault(),t(s)):null}},l=function(e){return function(){return e._selectNeighboringItem({direction:_})}}(this),s=function(e){return function(){return e._extendSelectionRange({direction:_})}}(this),a=function(e){return function(){return e._selectNeighboringItem({direction:h})}}(this),t=function(e){return function(){return e._extendSelectionRange({direction:h})}}(this),i=function(e){return function(){return e._selectAllItems()}}(this),e=function(e){return function(){return e._deselectAllItems()}}(this),key("up",this.props.keyScope,r(n,l)),key("shift+up",this.props.keyScope,r(n,s)),key("down",this.props.keyScope,r(n,a)),key("shift+down",this.props.keyScope,r(n,t)),key("escape",this.props.keyScope,r(n,e)),u.mac?key("command+a",this.props.keyScope,r(o,i)):key("ctrl+a",this.props.keyScope,r(o,i))},_focusItem:function(e){var t;return t=this.refs[e],t?t.getDOMNode().focus():void 0},_itemIds:function(){var e;return e=[],n.Children.forEach(this.props.children,function(t){return function(t){var s;return(null!=t&&null!=(s=t.props)?s.selectableListId:void 0)?e.push(t.props.selectableListId):(null!=t?t.key:void 0)?e.push(t.key):void 0}}(this)),o.List(e)},_selection:function(){return this.props.selection?this.props.selection:this.state.selection},_updateState:function(e){return o.is(this._selection(),e)?void 0:(this.props.selection||this.setState({selection:e}),this.props.onSelectionChange(e))},_selectAllItems:function(){return this.setSelectedItems({itemIds:this._itemIds().toArray()})},_deselectAllItems:function(){return this.setSelectedItems({itemIds:[]}),this.getDOMNode().contains(document.activeElement)?document.activeElement.blur():void 0},_toggleItemSelected:function(e){var t,s,r,n,o,i,a,l,u,c,p;if(r=e.itemId,p=this._selection(),p.selected.has(r)){for(p=p.update("selected",function(e){return e.delete(r)}),a=null,t=this._itemIds().indexOf(r),s=o=l=t+1,u=this._itemIds().count();u>=l?u>o:o>u;s=u>=l?++o:--o)if(n=this._itemIds().get(s),p.selected.has(n)){a=n;break}if(!a)for(s=i=c=t-1;0>=c?0>=i:i>=0;s=0>=c?++i:--i)if(n=this._itemIds().get(s),p.selected.has(n)){a=n;break}a||(a=this._itemIds().get(0)),p=p.set("anchor",a)}else p=p.update("selected",function(e){return e.add(r)}).set("anchor",r);return this._updateState(p)},_selectItemsInRangeTo:function(e){var t,s,r,n,o,i,a,l,u,c,p,d,h;return i=e.itemId,d=this._selection(),(t=null!=(c=d.anchor)?c:this._itemIds().get(0))?(s=this._itemIds().indexOf(t),u=this._itemIds().indexOf(i),p=this._rangeOfSelectedBlockSurrounding(t),h=p.startIndex,r=p.endIndex,a=function(){var e,t,s,i;for(s=this._itemIds().toArray(),i=[],o=e=0,t=s.length;t>e;o=++e)n=s[o],o>=h&&r>=o&&i.push(n);return i}.call(this),l=function(){var e,t,r,i;for(r=this._itemIds().toArray(),i=[],o=e=0,t=r.length;t>e;o=++e)n=r[o],(o>=u&&s>=o||o>=s&&u>=o)&&i.push(n);return i}.call(this),s>u&&l.reverse(),d=d.update("selected",function(e){return e.subtract(a).union(l)}),this._updateState(d)):void 0},_selectNeighboringItem:function(e){var t,r,n,o;return t=e.direction,n=this._itemIds().indexOf(this._selection().selected.last()),r=0,t===_?r=Math.max(0,n-1):t===h&&(r=Math.min(this._itemIds().count()-1,n+1)),o=this._itemIds().get(r),this._focusedItem=o,this.setSelectedItems({itemIds:[o]}),this.props.addTabbingClassWhenKeyboardNavigating?s(document.body).addClass("tabbing"):void 0},_extendSelectionRange:function(e){var t,r,n,o,i,a,l,u,c;return n=e.direction,u=i=this._selection(),(t=null!=(a=u.anchor)?a:this._itemIds().get(0))?(r=this._itemIds().indexOf(t),l=this._rangeOfSelectedBlockSurrounding(t),c=l.startIndex,o=l.endIndex,n===_?r===o?c-1>=0&&(u=u.update("selected",function(e){return function(t){return t.add(e._itemIds().get(c-1))}}(this))):u=u.update("selected",function(e){return function(t){return t.delete(e._itemIds().get(o))}}(this)):n===h&&(r===c||r!==o?o+1<this._itemIds().count()&&(u=u.update("selected",function(e){return function(t){return t.add(e._itemIds().get(o+1))}}(this))):u=u.update("selected",function(e){return function(t){return t.delete(e._itemIds().get(c))}}(this))),u!==i&&(this._focusedItem=u.selected.last(),this._updateState(u)),this.props.addTabbingClassWhenKeyboardNavigating?s(document.body).addClass("tabbing"):void 0):void 0},_rangeOfSelectedBlockSurrounding:function(e){var t,s,r,n;for(s=this._itemIds().indexOf(e);;)if(n=s,s-=1,0>s||!this._selection().selected.has(this._itemIds().get(s)))break;for(s=n;;){if(r=this._itemIds().get(s),null==r||!this._selection().selected.has(r))break;t=s,s+=1}return{startIndex:n,endIndex:t}},setSelectedItems:function(e){var t,s,r;return s=e.itemIds,r=this._selection().set("selected",o.OrderedSet(s)),t=s.length>0?s[0]:this._itemIds().get(0),this._updateState(r.set("anchor",t))},handleMouseEnterRow:function(e,t){return this._isSelecting?this._selectItemsInRangeTo({itemId:e}):void 0},handleMouseDownInRow:function(e,t){return 2===t.button?void(this._selection().selected.has(e)||this.setSelectedItems({itemIds:[e]})):t.shiftKey?void this._selectItemsInRangeTo({itemId:e}):P(t)?void this._toggleItemSelected({itemId:e}):(this._selection().selected.has(e)||(this.setSelectedItems({itemIds:[e]}),this._isSelecting=!0),this._mostRecentMousedownTarget=e)},handleMouseUpInRow:function(e,t,s){return e===this._mostRecentMousedownTarget&&this.setSelectedItems({itemIds:[e]}),this._isSelecting=!1},handleToggleRowSelected:function(e,t){return this._toggleItemSelected({itemId:e})},handleOutsideMouseUp:function(e){var t;return this._isSelecting=!1,this._mostRecentMousedownTarget=null,t=this.getDOMNode(),t.contains(e.target)||s(e.target).closest(this.props.linkedOutsideClasses.join()).length||this._mostRecentMousedownTarget?void 0:this._deselectAllItems()},handleMouseDownInCheckbox:function(e,t){return t.shiftKey?void this._selectItemsInRangeTo({itemId:e}):this._toggleItemSelected({itemId:e})},noop:function(e,t){},render:function(){var s,o,i,a;return o=this._handlerCache,this._handlerCache={},s=n.Children.map(this.props.children,function(e){return function(s){var i,a,l,u,c,p,h,_,m;if(!(null!=s&&null!=(h=s.props)?h.selectableListId:void 0)&&!(null!=s?s.key:void 0))return s;p=null!=(_=null!=s&&null!=(m=s.props)?m.selectableListId:void 0)?_:s.key,u={},c=e.props.isCheckboxes?d:g;for(l in c)t.call(c,l)&&(a=c[l],y(!s.props[l],"SelectableList does not support children having seperate "+l+" listeners"),i=l+p,u[l]=o[i]||e[a].bind(e,p),e._handlerCache[i]=u[l]);return n.addons.cloneWithProps(s,r.extend(u,{ref:p,isSelected:e._selection().selected.has(p)}))}}(this)),i=Object.keys(this.constructor.propTypes),a=r.extend({},r.omit(this.props,i),{selection:this._selection(),onOutsideMouseUp:this.props.isCheckboxes?r.noop():this.handleOutsideMouseUp}),n.createElement(e,a,s)}})},{createSelectableList:T,createSelection:w}})}.call(this),function(){define("modules/clean/react/sharing/shared_with_view",["external/react","modules/clean/avatar/inherited_count_avatar","modules/clean/avatar/not_shared_avatar","modules/clean/avatar/shared_link_avatar","modules/clean/avatar/size","modules/clean/components/title_bubble","modules/clean/datetime","modules/clean/react/browse/models","modules/clean/sharing/member_avatars","modules/clean/sharing/constants","modules/clean/sharing/ui_util","modules/clean/viewer","modules/constants/viewer","modules/core/i18n"],function(e,t,s,r,n,o,i,a,l,u,c,p,d,h){var _,m,f,g,b,S,y,v,T,w,E,P;return m=n.AVATAR_DIMENSION_BY_SIZE,P=i.nice_date_with_month_name,f=a.File,y=u.SHMODEL_LINK_TOKEN_VISIBILITY,g=c.GoldenGate,T=h._,E=e.DOM,w=e.createElement,b=5,_=m.SMALL,S="--",v=e.createClass({displayName:"SharedWithView",mixins:[l],propTypes:{user:e.PropTypes.object.isRequired,file:e.PropTypes.instanceOf(f),onOverflowCountClick:e.PropTypes.func,onAvatarClick:e.PropTypes.func,groups:e.PropTypes.array,invitations:e.PropTypes.array,joinedMembers:e.PropTypes.array,numUndisplayableUsersAndInvites:e.PropTypes.number,isSharedFolderDataLoaded:e.PropTypes.bool,numInheritedMembers:e.PropTypes.number,parentFolderName:e.PropTypes.string,animation:e.PropTypes.bool,titleButtonDirection:e.PropTypes.string,avatarDimension:e.PropTypes.number,maxVisibleAvatars:e.PropTypes.number,sharedLinkInfo:e.PropTypes.object,onSharedLinkClick:e.PropTypes.func},getDefaultProps:function(){return{titleButtonDirection:"south",avatarDimension:_,maxVisibleAvatars:b,file:null}},render:function(){return E.div({className:this.getClassName()},this.renderAvatars())},getClassName:function(){return e.addons.classSet({"shared-with-members":!0,clearfix:!0})},renderAvatars:function(){var e,t,s,r,n,o,i,a,l;if(null!=(i=this.props.file)?i.isDeleted:void 0)return E.span({"aria-hidden":!0},T("deleted"));if(r=this.props.joinedMembers?this.props.joinedMembers:[],t=this.props.groups?this.props.groups.slice():[],s=this.props.invitations?this.props.invitations.slice():[],e=[],this.props.sharedLinkInfo&&e.push(this.renderSharedLink(this.props.sharedLinkInfo)),a=this.findOwnerAndMeInJoinedMembers(r),o=a[0],n=a[1],l=[],null!=o&&o===n&&(o=null),null!=o&&(l.push(o.user_id),e.push(this.renderJoinedMember(o))),null!=n&&l.push(n.user_id),this.addGroupsMembersInvitations(e,t,r,s,l),g.hasNewMembershipUI(this.props.user.id)){if(this.props.isSharedFolderDataLoaded&&0===this.props.numInheritedMembers&&0===e.length)return E.span({"aria-hidden":!0},this.renderNotSharedIcon())}else if(0===e.length)return E.span({"aria-hidden":!0},S);return this.renderAvatarList(e)},renderNotSharedIcon:function(){return w(o,{key:"not_shared",text:T("Not shared"),direction:"south"},w(s,{alt:T("Not shared"),dimension:this.props.avatarDimension,onClick:this.props.onAvatarClick}))},renderSharedLink:function(e){var t,s;return t=this.sharedLinkAccessTypeString(e),s=w(r,{alt:t,dimension:this.props.avatarDimension,onClick:function(t){return function(){return t.props.onSharedLinkClick(e)}}(this)}),w(o,{key:"shared_link",text:t,direction:"south"},s)},sharedLinkAccessTypeString:function(e){var t,s,r,n,o,i,a,l,u,c,d;if(d=e.visibility_type,r=e.expires_posix,u=e.shared_folder_link_policy,r){if(a=(new Date).getTime()/1e3,l=r-a,s=Math.floor(l/86400),0>l)return T("Link Disabled");t=new Date(1e3*r),c=!1,o=!0,n=s>180,t=P(t,n,c,o)}if(i="MEMBERS_ONLY"===u,t){if(d===y.PUBLIC)return e.is_editable?i?T("Folder members with the link can edit until %(date)s").format({date:t}):T("People with the link can edit until %(date)s").format({date:t}):i?T("Folder members with the link can view until %(date)s").format({date:t}):T("People with the link can view until %(date)s").format({date:t});if(d===y.PASSWORD)return e.is_editable?i?T("Folder members with the password can edit until %(date)s").format({date:t}):T("People with the password can edit until %(date)s").format({date:t}):i?T("Folder members with the password can view until %(date)s").format({date:t}):T("People with the password can view until %(date)s").format({date:t});if(d===y.TEAM_ONLY)return e.is_editable?i?T("Folder members at %(team_name)s can edit until %(date)s").format({team_name:p.get_viewer().team_name,date:t}):T("People at %(team_name)s can edit until %(date)s").format({team_name:p.get_viewer().team_name,
date:t}):i?T("Folder members at %(team_name)s can view until %(date)s").format({team_name:p.get_viewer().team_name,date:t}):T("People at %(team_name)s can view until %(date)s").format({team_name:p.get_viewer().team_name,date:t})}else{if(d===y.PUBLIC)return T(e.is_editable?i?"Folder members with the link can edit":"People with the link can edit":i?"Folder members with the link can view":"People with the link can view");if(d===y.PASSWORD)return T(e.is_editable?i?"Folder members with the password can edit":"People with the password can edit":i?"Folder members with the password can view":"People with the password can view");if(d===y.TEAM_ONLY)return e.is_editable?i?T("Folder members at %(team_name)s with the link can edit").format({team_name:p.get_viewer().team_name}):T("People at %(team_name)s with the link can edit").format({team_name:p.get_viewer().team_name}):i?T("Folder members at %(team_name)s with the link can view").format({team_name:p.get_viewer().team_name}):T("People at %(team_name)s with the link can view").format({team_name:p.get_viewer().team_name})}}}),{SharedWithView:v}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/search/actions",["external/immutable","modules/clean/filepath","modules/clean/flux/dispatcher","modules/clean/history","modules/clean/react/browse/models","modules/clean/search/api","modules/clean/search/constants","modules/clean/search/store","modules/constants/viewer","modules/core/uri"],function(t,s,r,n,o,i,a,l,u,c){var p,d,h,_,m;return p=o.File,h=a.SearchActionTypes,m=a.SearchLoadingStates,d=u.ROLE_WORK,new(_=function(){function t(){this._loadDeletedResults=e(this._loadDeletedResults,this),this.loadMoreResults=e(this.loadMoreResults,this),this.searchApi=new i}return t.prototype.focusSearchBar=function(){return r.dispatch({type:h.FOCUS_SEARCH_BAR})},t.prototype.blurSearchBar=function(){return r.dispatch({type:h.BLUR_SEARCH_BAR})},t.prototype.setSearchQuery=function(e){var t,s,n;return t=e.path,s=e.query,n=e.user,s!==l.rawQuery()?(r.dispatch({type:h.SET_SEARCH_QUERY,data:{query:s}}),l.isSearchBarLoading()?this.searchApi.loadSuggestions({user:n,path:t,query:l.normalizedQuery(),onSuccess:this.setSearchSuggestions}):void 0):void 0},t.prototype.setSearchSuggestions=function(e){var t;return t=e.searchResults,r.dispatch({type:h.SET_SEARCH_SUGGESTIONS,data:{searchResults:t}})},t.prototype.setHighlightedRow=function(e){var t;return t=e.index,r.dispatch({type:h.SET_HIGHLIGHTED_ROW,data:{index:t}})},t.prototype.highlightPreviousRow=function(){return r.dispatch({type:h.HIGHLIGHT_PREVIOUS_ROW})},t.prototype.highlightNextRow=function(){return r.dispatch({type:h.HIGHLIGHT_NEXT_ROW})},t.prototype.runSearch=function(e){var t,s,n;return n=e.user,t=e.path,s=e.query,r.dispatch({type:h.START_SEARCH,data:{query:s}}),this.searchApi.loadResults({user:n,path:t,query:s,loadDeleted:!1,start:0,onSuccess:function(e){return function(s){var r,o;return o=s.searchResults,r=s.context,e._setSearchResults({searchResults:o,context:r}),e._loadDeletedResults({path:t,user:n})}}(this)})},t.prototype.loadMoreResults=function(e){var t,s,n;if(t=e.path,n=e.user,l.loadingState()===m.LOADED){if(l.hasMoreResults())s=!1;else{if(!l.hasMoreResults(!0))return;s=!0}return r.dispatch({type:h.CONTINUE_SEARCH,data:{didLoadDeletedResults:s}}),this.searchApi.loadResults({user:n,path:t,query:l.latestQuery(),loadDeleted:s,start:s?l.numDeletedResults():l.searchResults().size,onSuccess:function(e){return function(s){var r,o,i;return i=s.searchResults,r=s.context,o=s.deleted,e._appendSearchResults({searchResults:i,context:r,deleted:o}),e._loadDeletedResults({path:t,user:n})}}(this)})}},t.prototype._setSearchResults=function(e){var t,s;return s=e.searchResults,t=e.context,r.dispatch({type:h.SET_SEARCH_RESULTS,data:{searchResults:s,context:t}})},t.prototype._appendSearchResults=function(e){var t,s,n;return n=e.searchResults,t=e.context,s=e.deleted,r.dispatch({type:h.APPEND_SEARCH_RESULTS,data:{searchResults:n,context:t,deleted:s}})},t.prototype._loadDeletedResults=function(e){var t,s;return t=e.path,s=e.user,l.hasMoreResults()||l.didLoadDeletedResults()?void 0:this.loadMoreResults({path:t,user:s})},t.prototype.setSearchSelection=function(e){var t;return t=e.selection,r.dispatch({type:h.SET_SEARCH_SELECTION,data:{selection:t}})},t.prototype.applyUpdatesFromNotserver=function(e){var t,n,o,i,a,u,c,d,_,m,f,g,b,S,y,v,T,w,E,P;for(y=e.payload,S=e.path,t=y.added,g=y.moved,w=y.removed,i=[],P=l.searchResults(),u=0,_=t.length;_>u;u++)n=t[u],n.fq_path.startsWith(S)&&(o=P.find(function(e){return s.paths_are_equal(e.fq_path,n.fq_path)}),o&&o.isDeleted&&(a=o.filename_highlights,b=p.fromServerObject(n).set("filename_highlights",a),i.push({before:o.fq_path,after:b})),o||i.push({before:null,after:p.fromServerObject(n)}));for(c=0,m=g.length;m>c;c++)T=g[c],v=T[0],n=T[1],v.startsWith(S)&&(o=P.find(function(e){return s.paths_are_equal(e.fq_path,v)}),o&&(a=o.filename_highlights,b=p.fromServerObject(n).set("filename_highlights",a),i.push({before:o.fq_path,after:null}),i.push({before:null,after:b})));for(d=0,f=w.length;f>d;d++)E=w[d],E.startsWith(S)&&(o=P.find(function(e){return s.paths_are_equal(e.fq_path,E)}),o&&!o.isDeleted&&(a=o.filename_highlights,b=o.set("isDeleted",!0).set("filename_highlights",a),i.push({before:o.fq_path,after:b})));return r.dispatch({type:h.CHANGE_FILES,data:{fileDeltas:i}})},t.prototype.removeSearchResults=function(e){var t,s;return s=e.fq_paths,t=s.map(function(e){return{before:e,after:null}}).toArray(),r.dispatch({type:h.CHANGE_FILES,data:{fileDeltas:t}})},t.prototype.clearSearch=function(){return r.dispatch({type:h.CLEAR_SEARCH})},t}())})}.call(this),function(){define("modules/clean/search/api",["modules/clean/ajax","modules/clean/react/browse/models","modules/clean/search/constants","modules/constants/browse"],function(e,t,s,r){var n,o,i;return n=t.BrowseContext,o=s.MaxResults,i=function(){function t(){this._activeRequest=null}return t.prototype.loadSuggestions=function(e){var t,s,n,i,a,l;return l=e.user,n=e.path,i=e.query,s=e.onSuccess,t=e.onError,a={query:i,fq_path:n,filename_only:!0,max_results:o.MAX_SEARCH_SUGGESTIONS,show_paper_results:r.SHOW_PAPER_SEARCH_RESULTS},this._fetchResults(a,l,!1,s,t)},t.prototype.loadResults=function(e){var t,s,n,i,a,l,u,c;return c=e.user,i=e.path,a=e.query,t=e.loadDeleted,u=e.start,n=e.onSuccess,s=e.onError,l={query:a,fq_path:i,filename_only:!1,max_results:o.MAX_SEARCH_RESULTS,deleted:t,start:u,show_paper_results:r.SHOW_PAPER_SEARCH_RESULTS},this._fetchResults(l,c,t,n,s)},t.prototype.getUpdatesForResults=function(t){var s,r,n,o,i,a,l,u;return i=t.query,s=t.namespaceToJournalIdMap,a=t.showDeleted,u=t.user,n=t.onSuccess,o={all_terms:i,ns_map:function(){var e;e=[];for(r in s)l=s[r],e.push(r+"_"+l);return e}().join(","),show_deleted:a},e.WebRequest({url:"/update/list_search",data:o,dataType:"json",subject_user:u,success:function(e){return n(e)}})},t.prototype._extractBrowseContext=function(e){return new n({isInFolderMode:e.inside_dir,inactiveNSIDByFQPath:e.old_path_to_ns_id,permanentDeletionDisabledStateByNSID:e.permanent_delete_is_disabled_by_ns_id})},t.prototype._fetchResults=function(t,s,r,n,o){var i;return null!=(i=this._activeRequest)&&i.abort(),this._activeRequest=e.WebRequest({url:"/ajax_fulltext_search",data:t,dataType:"json",subject_user:s,success:function(e){return function(t,s,o){var i,a;return i=e._extractBrowseContext(t),a=t.search_results,n({context:i,searchResults:a,loadDeleted:r})}}(this),error:function(e,t,s){return"abort"!==t&&"function"==typeof o?o(s):void 0},complete:function(){return this._activeRequest=null}})},t}()})}.call(this),function(){define("modules/clean/search/constants",["modules/clean/flux/action_type"],function(e){var t,s;return s=e.withActionNamespace,t={},t.MaxResults={MAX_SEARCH_SUGGESTIONS:8,MAX_SEARCH_RESULTS:100},t.SearchActionTypes=s("search",{SET_USER:"SET_USER",FOCUS_SEARCH_BAR:"FOCUS_SEARCH_BAR",BLUR_SEARCH_BAR:"BLUR_SEARCH_BAR",SET_SEARCH_QUERY:"SET_SEARCH_QUERY",SET_SEARCH_SUGGESTIONS:"SET_SEARCH_SUGGESTIONS",SET_HIGHLIGHTED_ROW:"SET_HIGHLIGHTED_ROW",HIGHLIGHT_PREVIOUS_ROW:"HIGHLIGHT_PREVIOUS_ROW",HIGHLIGHT_NEXT_ROW:"HIGHLIGHT_NEXT_ROW",START_SEARCH:"START_SEARCH",SET_SEARCH_RESULTS:"SET_SEARCH_RESULTS",CONTINUE_SEARCH:"CONTINUE_SEARCH",APPEND_SEARCH_RESULTS:"APPEND_SEARCH_RESULTS",CLEAR_SEARCH:"CLEAR_SEARCH",SET_SEARCH_SELECTION:"SET_SEARCH_SELECTION",CHANGE_FILES:"CHANGE_SEARCH_FILES"}),t.SearchLoadingStates={LOADED:"LOADED",LOADING_FIRST_PAGE:"LOADING_FIRST_PAGE",LOADING_ADDITIONAL_PAGE:"LOADING_ADDITIONAL_PAGE"},t})}.call(this),function(){define("modules/clean/search/search_bar",["jquery","external/purify","external/react","external/underscore","modules/core/uri","modules/clean/analytics","modules/clean/filepath","modules/clean/flux/store_mixin","modules/clean/keycode","modules/clean/react/browse/models","modules/clean/react/button","modules/clean/react/css","modules/clean/react/input","modules/clean/react/react_i18n","modules/clean/react/sprite","modules/clean/search/actions","modules/clean/search/search_helpers","modules/clean/search/store","modules/core/accessible_announce","modules/core/browser","modules/core/i18n"],function(e,t,s,r,n,o,i,a,l,u,c,p,d,h,_,m,f,g,b,S,y){var v,T,w,E,P,F,I,D,C,N,A,R,O,L,M,x,U;return R=o.TeamsWebActionsLogger,v=u.File,T=u.Paper,w=h.R_,O=y._,U=y.ungettext,L=s.createElement,M=s.addons.classSet,x=s.DOM,E=s.createClass({displayName:"SearchBar",mixins:[a(g)],propTypes:{user:s.PropTypes.object.isRequired,currentPath:s.PropTypes.string.isRequired,onSearch:s.PropTypes.func.isRequired,onFileOrFolderOpen:s.PropTypes.func.isRequired,isPagelet:s.PropTypes.bool,limitedTeamBannerUpsell:s.PropTypes.bool,trademarkBusiness:s.PropTypes.string},_get_state_from_stores:function(){return{isFocused:g.isSearchBarFocused(),isActive:g.isSearchBarActive(),isSearchActive:!!g.latestQuery(),rawQuery:g.rawQuery(),normalizedQuery:g.normalizedQuery(),suggestions:g.searchSuggestions(),searchBarLoading:g.isSearchBarLoading()}},_handleInputChange:function(e){return m.setSearchQuery({path:this.props.currentPath,query:e.target.value,user:this.props.user})},_handleInputKeydown:function(e){return e.keyCode===l.ESC?void this.props.onSearch(""):(e.stopPropagation(),e.keyCode===l.UP?(e.preventDefault(),m.highlightPreviousRow()):e.keyCode===l.DOWN?(e.preventDefault(),m.highlightNextRow()):void 0)},_handleInputSubmit:function(e){return e.preventDefault(),0===g.highlightedSearchRow()?this.props.onSearch(this.state.normalizedQuery):this.props.onFileOrFolderOpen(g.highlightedSuggestion())},_handleHighlightDropdownItem:function(e){return m.setHighlightedRow({index:e})},render:function(){var e;return e=r.extend({onInputChange:this._handleInputChange,onInputKeydown:this._handleInputKeydown,onInputSubmit:this._handleInputSubmit,onSearchBarFocus:m.focusSearchBar,onSearchBarBlur:m.blurSearchBar,onHighlightDropdownItem:this._handleHighlightDropdownItem,ref:"searchBarView",highlightedRow:g.highlightedSearchRow()},this.state,this.props),L(A,e)}}),A=s.createClass({displayName:"SearchBarView",propTypes:{isSearchActive:s.PropTypes.bool.isRequired,isActive:s.PropTypes.bool.isRequired,isFocused:s.PropTypes.bool.isRequired,isPagelet:s.PropTypes.bool.isRequired,searchBarLoading:s.PropTypes.bool.isRequired,onFileOrFolderOpen:s.PropTypes.func.isRequired,onInputChange:s.PropTypes.func.isRequired,onInputKeydown:s.PropTypes.func.isRequired,onInputSubmit:s.PropTypes.func.isRequired,onSearch:s.PropTypes.func.isRequired,onSearchBarBlur:s.PropTypes.func.isRequired,onSearchBarFocus:s.PropTypes.func.isRequired,onHighlightDropdownItem:s.PropTypes.func.isRequired,currentPath:s.PropTypes.string.isRequired,highlightedRow:s.PropTypes.number.isRequired,suggestions:s.PropTypes.array.isRequired,rawQuery:s.PropTypes.string,normalizedQuery:s.PropTypes.string,limitedTeamBannerUpsell:s.PropTypes.bool,trademarkBusiness:s.PropTypes.string},getDefaultProps:function(){return{rawQuery:"",normalizedQuery:""}},handleNavigation:function(){var e;return e=this.refs.searchBarInput.refs.searchBarTextInput.getDOMNode(),e.blur()},_renderUpsellBar:function(){return this.props.limitedTeamBannerUpsell?x.div({className:"search-bar__upsell"},x.div({className:"search-bar__upsell__message"},O("Search through file contents in addition to file names with %(trademark_business)s").format({trademark_business:this.props.trademarkBusiness})),x.div({className:"search-bar__upsell__action"},L(c.button,{className:"search-bar__upsell__cta-button",onClick:function(){return S.redirect(n({path:"/team/upgrade",query:{tk:"search_upsell_bar",camp:"web"}}))},onMouseDown:function(e){return e.stopPropagation(),e.preventDefault()}},O("Upgrade")))):void 0},render:function(){var e,t,s;return e={"search-bar":!0,"is-expanded":this.props.isSearchActive,"is-focused":this.props.isFocused,"is-active":this.props.isActive},x.div({className:"search-bar--container u-l-fr"},x.div({className:M(e)},s=L(N,{isActive:this.props.isActive,isFocused:this.props.isFocused,isPagelet:this.props.isPagelet,onFileOrFolderOpen:this.props.onFileOrFolderOpen,onInputChange:this.props.onInputChange,onInputKeydown:this.props.onInputKeydown,onInputSubmit:this.props.onInputSubmit,onSearchBarBlur:this.props.onSearchBarBlur,onSearchBarFocus:this.props.onSearchBarFocus,rawQuery:this.props.rawQuery,highlightedRow:this.props.highlightedRow,ref:"searchBarInput"}),(null!=(t=this.props.normalizedQuery)?t.length:void 0)?L(P,{onFileOrFolderOpen:function(e){return function(t){return e.props.onFileOrFolderOpen(t),e.handleNavigation()}}(this),onSearch:function(e){return function(t){return e.props.onSearch(t),e.handleNavigation()}}(this),currentPath:this.props.currentPath,highlightedRow:this.props.highlightedRow,isOpen:this.props.isFocused,isPagelet:this.props.isPagelet,normalizedQuery:this.props.normalizedQuery,onHighlightDropdownItem:this.props.onHighlightDropdownItem,ref:"searchBarDropdown",suggestions:this.props.suggestions,bottomBanner:this._renderUpsellBar(),searchBarLoading:this.props.searchBarLoading}):void 0))}}),N=s.createClass({displayName:"SearchBarInput",propTypes:{isActive:s.PropTypes.bool.isRequired,isFocused:s.PropTypes.bool.isRequired,isPagelet:s.PropTypes.bool.isRequired,onFileOrFolderOpen:s.PropTypes.func.isRequired,onInputChange:s.PropTypes.func.isRequired,onInputKeydown:s.PropTypes.func.isRequired,onInputSubmit:s.PropTypes.func.isRequired,onSearchBarBlur:s.PropTypes.func.isRequired,onSearchBarFocus:s.PropTypes.func.isRequired,rawQuery:s.PropTypes.string,highlightedRow:s.PropTypes.number.isRequired},componentDidMount:function(){return e(this.refs.searchBarTextInput.getDOMNode()).on("keydown.SearchBarInput",this._onKeydown),e(this.refs.searchBarTextInput.getDOMNode()).on("focusout.SearchBarInput",this.props.onSearchBarBlur)},componentWillUnmount:function(){return e(this.refs.searchBarTextInput.getDOMNode()).off(".SearchBarInput")},_onKeydown:function(e){return e.keyCode===l.ESC&&this.refs.searchBarTextInput.getDOMNode().blur(),this.props.onInputKeydown(e)},_onSubmit:function(e){return this.refs.searchBarTextInput.getDOMNode().blur(),this.props.onInputSubmit(e)},render:function(){var e;return e=O(this.props.isPagelet?"Search files...":"Search"),x.form({className:"search-bar__input",onSubmit:this._onSubmit},x.input({"aria-activedescendant":"search-dropdown-suggestion"+this.props.highlightedRow,"aria-autocomplete":"list","aria-expanded":this.props.isFocused&&this.props.isActive,"aria-label":O("Search"),"aria-owns":"search-bar__suggestions",className:"search-bar__text-input",onChange:this.props.onInputChange,onFocus:this.props.onSearchBarFocus,placeholder:e,ref:"searchBarTextInput",role:"combobox",value:this.props.rawQuery}),x.input({"aria-label":e,className:"search-bar__button",ref:"searchBarSearchButton",type:"submit",value:""}))}}),P=s.createClass({displayName:"SearchBarDropdown",propTypes:{isOpen:s.PropTypes.bool.isRequired,isPagelet:s.PropTypes.bool.isRequired,onFileOrFolderOpen:s.PropTypes.func.isRequired,onSearch:s.PropTypes.func.isRequired,onHighlightDropdownItem:s.PropTypes.func.isRequired,currentPath:s.PropTypes.string.isRequired,normalizedQuery:s.PropTypes.string.isRequired,suggestions:s.PropTypes.array.isRequired,searchBarLoading:s.PropTypes.bool.isRequired,bottomBanner:s.PropTypes.element},componentDidMount:function(){return this.props.searchBarLoading?this._announceLoading():void 0},componentDidUpdate:function(e){return this.props.searchBarLoading&&!e.searchBarLoading&&this._announceLoading(),this.props.normalizedQuery&&e.searchBarLoading&&!this.props.searchBarLoading?b.polite(U("Found %(num)s search result","Found %(num)s search results",this.props.suggestions.length).format({num:this.props.suggestions.length})):void 0},_announceLoading:function(){return b.polite(O("Loading search…"))},render:function(){return!this.props.searchBarLoading&&this.props.isOpen&&this.props.bottomBanner&&!this._banner_view_logged&&(this._banner_view_logged=!0,R.log("banner_search_displayed",{location:"search_bar",item_count:this.props.suggestions.length})),this.props.isPagelet?this._renderForMaestro():this._renderForDefault()},_renderForMaestro:function(){var e,t,s,r,n,o;return t=function(){var e,t,s,r;for(s=this.props.suggestions,r=[],e=0,t=s.length;t>e;e++)n=s[e],n instanceof v&&r.push(n);return r}.call(this),r=function(){var e,t,s,r;for(s=this.props.suggestions,r=[],e=0,t=s.length;t>e;e++)n=s[e],n instanceof T&&r.push(n);return r}.call(this),e={"search-bar__dropdown":!0,"is-expanded":this.props.isOpen},x.div({className:M(e),"aria-hidden":!this.props.isOpen},x.div({className:"search-bar__suggestions",id:"search-bar__suggestions"},L(D,{isPagelet:!0,onSearch:this.props.onSearch,onHighlightDropdownItem:this.props.onHighlightDropdownItem,currentPath:this.props.currentPath,normalizedQuery:this.props.normalizedQuery,highlightedRow:this.props.highlightedRow}),t.length||r.length?x.hr({className:"search-bar__title-items-divider"}):void 0,t.length?[x.h3({className:"search-bar__filetype-title"},O("FILES")),x.ul({className:"search-bar__filetype-list",role:"presentation listbox"},function(){var e,r,n;for(n=[],s=e=0,r=t.length;r>e;s=++e)o=t[s],n.push(L(F,{resultObject:o,isPagelet:!0,key:o.fq_path,onFileOrFolderOpen:this.props.onFileOrFolderOpen,onHighlightDropdownItem:this.props.onHighlightDropdownItem,rank:s,highlightedRow:this.props.highlightedRow}));return n}.call(this))]:void 0,r.length?[x.h3({className:"search-bar__filetype-title"},O("PAPER DOCUMENTS")),x.ul({className:"search-bar__filetype-list",role:"presentation listbox"},function(){var e,n,i;for(i=[],s=e=0,n=r.length;n>e;s=++e)o=r[s],i.push(L(I,{resultObject:o,isPagelet:!0,key:o.pad_id,onFileOrFolderOpen:this.props.onFileOrFolderOpen,onHighlightDropdownItem:this.props.onHighlightDropdownItem,rank:t.length+s,highlightedRow:this.props.highlightedRow}));return i}.call(this))]:void 0),this.props.searchBarLoading?x.div({className:"search-bar__loading"},x.span({className:"ax-visually-hidden"},O("Loading search..."))):this.props.bottomBanner)},_renderForDefault:function(){var e,t,s,r,n;return e={"search-bar__dropdown":!0,"is-expanded":this.props.isOpen},x.div({className:M(e),"aria-hidden":!this.props.isOpen},x.ul({className:"search-bar__suggestions",id:"search-bar__suggestions",role:"listbox"},L(D,{isPagelet:!1,onSearch:this.props.onSearch,onHighlightDropdownItem:this.props.onHighlightDropdownItem,currentPath:this.props.currentPath,normalizedQuery:this.props.normalizedQuery,highlightedRow:this.props.highlightedRow}),function(){var e,o,i,a;if(this.props.suggestions.length){for(i=this.props.suggestions,a=[],r=e=0,o=i.length;o>e;r=++e)n=i[r],t=null,s=null,n instanceof v?(t=F,s=n.fq_path):n instanceof T&&(t=I,s=n.pad_id),t?a.push(L(t,{resultObject:n,isPagelet:!1,key:s,onFileOrFolderOpen:this.props.onFileOrFolderOpen,onHighlightDropdownItem:this.props.onHighlightDropdownItem,rank:r,highlightedRow:this.props.highlightedRow})):a.push(void 0);return a}}.call(this)),this.props.searchBarLoading?x.div({className:"search-bar__loading"},x.span({className:"ax-visually-hidden"},O("Loading search..."))):this.props.bottomBanner)}}),D=s.createClass({displayName:"SearchBarDropdownSearchItem",propTypes:{isPagelet:s.PropTypes.bool.isRequired,onSearch:s.PropTypes.func.isRequired,onHighlightDropdownItem:s.PropTypes.func.isRequired,currentPath:s.PropTypes.string.isRequired,normalizedQuery:s.PropTypes.string.isRequired,highlightedRow:s.PropTypes.number.isRequired},render:function(){var e,t,s;return s=0===this.props.highlightedRow,t=this.props.isPagelet?w({query:this.props.normalizedQuery},"Display all results for <strong>%(query)s</strong> in a page"):w({current_path:i.filename(this.props.currentPath),query:this.props.normalizedQuery},"Search for ‘<strong>%(query)s</strong>’ in %(current_path)s"),e={"search-bar__suggestion":!0,"search-bar__suggestion--is-highlighted":s},x.div({className:M(e),id:"search-dropdown-suggestion0",onMouseDown:function(e){return function(){return e.props.onSearch(e.props.normalizedQuery)}}(this),onMouseEnter:function(e){return function(){return e.props.onHighlightDropdownItem(0)}}(this),role:"option","aria-selected":s},x.div({className:"search-bar__suggestion-icon--search"}),x.div({className:M({"search-bar__suggestion-name":!this.props.isPagelet,"search-bar__suggestion-first-row-name":this.props.isPagelet})},t))}}),I=s.createClass({displayName:"SearchBarDropdownPaperSuggestion",propTypes:{resultObject:s.PropTypes.instanceOf(T).isRequired,isPagelet:s.PropTypes.bool.isRequired},render:function(){var t,s;return s=this.props.resultObject,t={icon:"paper_white_32",title:f.highlightMatchString(s.title,s.title_highlights),location:"Paper"},L(C,e.extend(t,this.props))}}),F=s.createClass({displayName:"SearchBarDropdownFileSuggestion",propTypes:{resultObject:s.PropTypes.instanceOf(v).isRequired,isPagelet:s.PropTypes.bool.isRequired},render:function(){var t,s,r,n,o,a,l;return n=this.props.resultObject,o=i.filename(n.fq_path),a=i.parent_dir(n.fq_path),this.props.isPagelet?(r="Dropbox",s=a.split("/"),l=s[s.length-1],s.length>=3&&(r+="/..."),(null!=l?l.length:void 0)&&(r+="/"+l)):r=a,t={icon:n.icon,title:f.highlightMatchString(o,n.filename_highlights),location:r},L(C,e.extend(t,this.props))}}),C=s.createClass({displayName:"SearchBarDropdownSuggestion",propTypes:{resultObject:s.PropTypes.oneOfType([s.PropTypes.instanceOf(v),s.PropTypes.instanceOf(T)]).isRequired,isPagelet:s.PropTypes.bool.isRequired,icon:s.PropTypes.string,title:s.PropTypes.string,location:s.PropTypes.string,onFileOrFolderOpen:s.PropTypes.func.isRequired,onHighlightDropdownItem:s.PropTypes.func.isRequired,rank:s.PropTypes.number.isRequired,highlightedRow:s.PropTypes.number.isRequired},render:function(){var e,s,r,n;return r=this.props.rank+1,s=r===this.props.highlightedRow,e={"search-bar__suggestion":!0,"search-bar__suggestion--is-highlighted":s},n=[x.div({className:"search-bar__suggestion-name",dangerouslySetInnerHTML:{__html:t.sanitize(this.props.title)}}),x.div({className:"search-bar__suggestion-desc"},w({preposition:this.props.isPagelet?"":"in ",location:this.props.location,comment:"Describes the parent directory of a file in a list of search results."},"<span title='%(location)s'>%(preposition)s%(location)s</span>"))],x.li({className:M(e),id:"search-dropdown-suggestion"+r,role:"option","aria-selected":s,onMouseDown:function(e){return function(){return e.props.onFileOrFolderOpen(e.props.resultObject)}}(this),onMouseEnter:function(e){return function(){return e.props.onHighlightDropdownItem(r)}}(this)},L(_,{group:"web",name:this.props.icon,className:"search-bar__suggestion-icon",alt:""}),this.props.isPagelet?x.div({},n):n)}}),E=p(E,["/static/css/search/search_bar_react-vflSa0ZVO.css"])})}.call(this),function(){var e=function(e,s){function r(){this.constructor=e}for(var n in s)t.call(s,n)&&(e[n]=s[n]);return r.prototype=s.prototype,e.prototype=new r,e.__super__=s.prototype,e},t={}.hasOwnProperty;define("modules/clean/search/store",["external/immutable","modules/clean/ajax","modules/clean/filepath","modules/clean/flux/base_store","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/selectable_list","modules/clean/search/constants","modules/clean/viewer"],function(t,s,r,n,o,i,a,l,u){var c,p,d,h,_,m,f,g,b,S;return c=o.BrowseActionTypes,d=i.File,p=i.BrowseContext,_=i.Paper,S=a.createSelection,h=l.MaxResults,m=l.SearchActionTypes,f=l.SearchLoadingStates,g={FILE:"FILE",PAPER:"PAPER"},new(b=function(s){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,s),n.prototype._init=function(){return this._resetSearchBar(),this._resetSearchResults()},n.prototype._resetSearchBar=function(){return this._isSearchBarFocused=!1,this._isSearchBarLoading=!1,this._rawQuery="",this._normalizedQuery="",this._searchSuggestions=[],this._highlightedSearchRow=0},n.prototype._resetSearchResults=function(){return this._browseContext=new p,this._latestQuery="",this._loadingState=f.LOADED,this._searchResults=t.List(),this._selection=S(),this._hasMoreLiveResults=!0,this._numDeletedResults=0,this._hasMoreDeletedResults=!0,this._didLoadDeletedResults=!1},n.prototype.isSearchBarFocused=function(){return this._isSearchBarFocused},n.prototype.isSearchBarActive=function(){return!!this._rawQuery},n.prototype.isSearchBarLoading=function(){return this._isSearchBarLoading},n.prototype.rawQuery=function(){return this._rawQuery},n.prototype.normalizedQuery=function(){return this._rawQuery.trim().replace(/\ +/g," ")},n.prototype.searchSuggestions=function(){return this._searchSuggestions},n.prototype.highlightedSearchRow=function(){return this._highlightedSearchRow},n.prototype.highlightedSuggestion=function(){var e,t;return t=this._highlightedSearchRow-1,e=this._searchSuggestions[t],this._searchSuggestions[t]},n.prototype.browseContext=function(){return this._browseContext},n.prototype.latestQuery=function(){return this._latestQuery},n.prototype.loadingState=function(){return this._loadingState},n.prototype.searchResults=function(){return this._searchResults},n.prototype.hasMoreResults=function(e){return null==e&&(e=!1),this._hasMoreLiveResults||e&&this._hasMoreDeletedResults},n.prototype.numDeletedResults=function(){return this._numDeletedResults},n.prototype.didLoadDeletedResults=function(){return this._didLoadDeletedResults},n.prototype.selection=function(){return this._selection},n.prototype.selectedFiles=function(){return this._searchResults.filter(function(e){return function(t){return e._selection.selected.has(t.fq_path)}}(this)).toOrderedSet()},n.prototype._focusSearchBar=function(){return this._isSearchBarFocused=!0,this._highlightedSearchRow=0,this.emit_change()},n.prototype._blurSearchBar=function(){return this._isSearchBarFocused=!1,this.emit_change()},n.prototype._setSearchQuery=function(e){var t;return t=e.query,this._rawQuery=t,this._searchSuggestions=[],this._highlightedSearchRow=0,this._isSearchBarLoading=!!this.normalizedQuery(),this.emit_change()},n.prototype._parseSearchResultsToList=function(e){var t,s,r,n,o;for(o=e.searchResults,n=[],t=0,s=o.length;s>t;t++)switch(r=o[t],r.search_result_type){case g.FILE:n.push(d.fromServerObject(r));break;case g.PAPER:n.push(_.fromServerObject(r))}return n},n.prototype._setSearchSuggestions=function(e){var t;return t=e.searchResults,this._isSearchBarLoading=!1,this._searchSuggestions=this._parseSearchResultsToList({searchResults:t}),this.emit_change()},n.prototype._setHighlightedSearchRow=function(e){var t;return t=e.index,this._highlightedSearchRow=t,this.emit_change()},n.prototype._highlightPreviousSearchRow=function(){return this._highlightedSearchRow=Math.max(0,this._highlightedSearchRow-1),this.emit_change()},n.prototype._highlightNextSearchRow=function(){return this._highlightedSearchRow=Math.min(this._searchSuggestions.length,this._highlightedSearchRow+1),this.emit_change()},n.prototype._startSearch=function(e){var t;return t=e.query,this._resetSearchResults(),this._rawQuery=t,this._latestQuery=this.normalizedQuery(),this._loadingState=f.LOADING_FIRST_PAGE,this.emit_change()},n.prototype._setSearchResults=function(e){var s,r;return r=e.searchResults,s=e.context,this._searchResults=t.List(this._parseSearchResultsToList({searchResults:r})),this._loadingState=f.LOADED,this._browseContext=s,this._updateMoreResults(r),this.emit_change()},n.prototype._continueSearch=function(e){var t;return t=e.didLoadDeletedResults,t&&(this._didLoadDeletedResults=!0),this._loadingState=f.LOADING_ADDITIONAL_PAGE,this.emit_change()},n.prototype._appendSearchResults=function(e){var t,s,r;return s=e.deleted,r=e.searchResults,t=e.context,s&&(this._numDeletedResults+=r.length),this._searchResults=this._searchResults.concat(this._parseSearchResultsToList({searchResults:r})),this._loadingState=f.LOADED,this._browseContext=t,this._updateMoreResults(r),this.emit_change()},n.prototype._clearSearch=function(){return this._resetSearchBar(),this._resetSearchResults(),this.emit_change()},n.prototype._updateMoreResults=function(e){var t;return t=e.length===h.MAX_SEARCH_RESULTS,this._hasMoreLiveResults?this._hasMoreLiveResults=t:this._hasMoreDeletedResults?this._hasMoreDeletedResults=t:void 0},n.prototype._setSearchSelection=function(e){var t;return t=e.selection,this._selection=t,this.emit_change()},n.prototype._applyFileDeltas=function(e){var t,s,n,o,i,a,l;if(o=e.fileDeltas){for(i=0,a=o.length;a>i;i++)l=o[i],s=l.before,t=l.after,!s&&t?this._searchResults=this._searchResults.push(t):s&&!t?(n=this._searchResults.findIndex(function(e){return r.paths_are_equal(e.fq_path,s)}),this._searchResults=this._searchResults.delete(n)):s&&t&&(n=this._searchResults.findIndex(function(e){return r.paths_are_equal(e.fq_path,s)}),n>-1?this._searchResults=this._searchResults.set(n,t):this._searchResults=this._searchResults.push(t));return this.emit_change()}},n.prototype._new_payload=function(e){switch(e.action.type){case m.FOCUS_SEARCH_BAR:return this._focusSearchBar();case m.BLUR_SEARCH_BAR:return this._blurSearchBar();case m.SET_SEARCH_QUERY:return this._setSearchQuery(e.action.data);case m.SET_SEARCH_SUGGESTIONS:return this._setSearchSuggestions(e.action.data);case m.SET_HIGHLIGHTED_ROW:return this._setHighlightedSearchRow(e.action.data);case m.HIGHLIGHT_PREVIOUS_ROW:return this._highlightPreviousSearchRow();case m.HIGHLIGHT_NEXT_ROW:return this._highlightNextSearchRow();case m.START_SEARCH:return this._startSearch(e.action.data);case m.SET_SEARCH_RESULTS:return this._setSearchResults(e.action.data);case m.CONTINUE_SEARCH:return this._continueSearch(e.action.data);case m.APPEND_SEARCH_RESULTS:return this._appendSearchResults(e.action.data);case m.SET_SEARCH_SELECTION:return this._setSearchSelection(e.action.data);case m.CHANGE_FILES:return this._applyFileDeltas(e.action.data);case m.CLEAR_SEARCH:return this._clearSearch();case c.SET_URL:return this._clearSearch()}},n}(n))})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,s=this.length;s>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/sharing/member_avatars",["external/react","modules/clean/avatar/avatar_with_default","modules/clean/avatar/inherited_count_avatar","modules/clean/avatar/initials_avatar","modules/clean/avatar/initials_avatar_with_color","modules/clean/avatar/photo_avatar","modules/clean/avatar/viewer_avatar","modules/clean/avatar/list","modules/clean/components/title_bubble","modules/clean/sharing/ui_util","modules/clean/viewer","modules/constants/viewer","modules/core/i18n","modules/clean/static_urls"],function(t,s,r,n,o,i,a,l,u,c,p,d,h,_){var m,f,g,b,S,y,v;return m=c.GoldenGate,g=h._,v=h.ungettext,y=_.static_url,b=t.createElement,S=t.DOM,f={getInitialState:function(){return{paired_users_in_sf:!1}},componentWillMount:function(){var e;return e=this.arePairedUsersInSf(this.props.joinedMembers),this.setState({paired_users_in_sf:e,paired_users_in_sf:e})},componentWillReceiveProps:function(e){var t;return t=this.arePairedUsersInSf(e.joinedMembers),this.setState({paired_users_in_sf:t,paired_users_in_sf:t
})},_wrap_with_avatar_type_and_data:function(e,t,s){return function(){return e(t,s)}},arePairedUsersInSf:function(t){var s,r,n,o,i,a,l;return t?(l=p.get_viewer(),!!(l.is_paired&&(a=l.get_user_ids(s=!0),r=function(){var e,s,r;for(r=[],e=0,s=t.length;s>e;e++)n=t[e],r.push(n.user_id);return r}(),o=a[0],e.call(r,o)>=0&&(i=a[1],e.call(r,i)>=0)))):!1},findOwnerAndMeInJoinedMembers:function(e){var t,s,r,n,o,i;for(i=null,n=null,t=s=0,r=e.length;r>s&&(o=e[t],"owner"===o.access_type&&(i=o),o.user_id===this.props.user.id&&(n=o),null==i||null==n);t=++s);return[i,n]},addGroupsMembersInvitations:function(t,s,r,n,o){var i,a,l,u,c,p,d,h,_,m,f;for(null==o&&(o=[]),l=0,p=s.length;p>l;l++)i=s[l],t.push(this.renderGroup(i));for(u=0,d=r.length;d>u;u++)_=r[u],m=_.user_id,e.call(o,m)<0&&t.push(this.renderJoinedMember(_));for(f=[],c=0,h=n.length;h>c;c++)a=n[c],f.push(t.push(this.renderInvitedPerson(a)));return f},renderAvatarList:function(e,t){return null==t&&(t=""),b(l,{avatars:e,avatarDimension:this.props.avatarDimension,maxVisible:this.props.maxVisibleAvatars,undisplayableCount:this.props.numUndisplayableUsersAndInvites||0,onOverflowCountClick:this.props.onOverflowCountClick,animation:this.props.animation,inheritedCountAvatar:this.renderInheritedCount(e.length),className:t})},renderJoinedMember:function(t){var r,n,i,l,c,h,_,m,f,g,S,y;return S=p.get_viewer(),g=t.user_id,_=e.call(S.get_user_ids(n=!0),g)>=0,c=null,_&&this.state.paired_users_in_sf?(h=t.user_id,f=S.get_user_by_role(d.ROLE_PERSONAL,!0),y=S.get_user_by_role(d.ROLE_WORK,!0),h===f.id?c="Personal":h===y.id&&null!=S.team_name&&(c=S.team_name)):c=t.display_name,r=this.individualAccessTypeString(c,t.access_type,_,this.state.paired_users_in_sf),m=this._wrap_with_avatar_type_and_data(this.props.onAvatarClick,"member",t),l={alt:r,dimension:this.props.avatarDimension,onPhotoClick:m,photoUrl:t.photo_url,defaultAvatar:b(o,{alt:r,dimension:this.props.avatarDimension,name:t.display_name,initials:t.initials,shape:"CIRCLE",onClick:m})},i=_?b(a,l):b(s,l),b(u,{key:"user:"+t.user_id+":"+t.photo_url,text:r,direction:this.props.titleButtonDirection},i)},renderGroup:function(e){var t,s,r;return s=this._wrap_with_avatar_type_and_data(this.props.onAvatarClick,"group",e),e.is_automatic?(r=this.teamAccessTypeString(e.name,e.access_type),t=b(i,{alt:r,dimension:this.props.avatarDimension,photoUrl:y("/static/images/icons/team_32-vflk8mBzO.png"),shape:"SQUARE",onClick:s})):(r=this.groupAccessTypeString(e.name,e.access_type,e.num_users),t=b(o,{alt:r,dimension:this.props.avatarDimension,name:e.name,shape:"SQUARE",initials:this.getInitials(e.name),onClick:s})),b(u,{key:"group:"+e.gid+":"+e.name,text:r,direction:this.props.titleButtonDirection},t)},renderInvitedPerson:function(e){var t,s;return s=this._wrap_with_avatar_type_and_data(this.props.onAvatarClick,"invited",e),t=this.individualAccessTypeString(e.email_or_fbname,"pending",!1),b(u,{key:"invitation:"+e.invitation_id,text:t,direction:this.props.titleButtonDirection},b(n,{alt:t,dimension:this.props.avatarDimension,color:"#aaa",initials:this.getInitials(e.email_or_fbname),shape:"CIRCLE",onClick:s}))},renderInheritedCount:function(e){var t;return m.hasNewMembershipUI(this.props.user.id)&&this.props.numInheritedMembers>0?(t=v("%(inherited_count)s inherited member from %(parent_folder)s folder","%(inherited_count)s inherited members from %(parent_folder)s folder",this.props.numInheritedMembers).format({inherited_count:this.props.numInheritedMembers,parent_folder:this.props.parentFolderName}),S.div({},b(u,{text:t,direction:"south"},b(r,{inheritedMemberCount:this.props.numInheritedMembers,key:"count",onClick:this.props.onAvatarClick})),e>0?S.span({className:"members-column__plus-sign u-pad-left-xxs"},"+"):void 0)):void 0},getInitials:function(e){var t,s,r;return null!=e&&e.length>0?(r=e.split(" "),t=function(){var e,t,n;for(n=[],e=0,t=r.length;t>e;e++)s=r[e],n.push(s.charAt(0).toLowerCase());return n}(),t.length>2&&(t=t.splice(0,2)),t.join("")):""},teamAccessTypeString:function(e,t){var s;return s=g("editor"===t?"%(team_group_name)s can edit":"%(team_group_name)s can view"),s.format({team_group_name:e})},groupAccessTypeString:function(e,t,s){var r;return r="editor"===t?v("%(num_users)s person in %(group_name)s can edit","%(num_users)s people in %(group_name)s can edit",s):v("%(num_users)s person in %(group_name)s can view","%(num_users)s people in %(group_name)s can view",s),r.format({group_name:e,num_users:s})},individualAccessTypeString:function(e,t,s,r){var n,o,i,a;return null==r&&(r=!1),n={viewer:g("You can view"),editor:g("You can edit"),owner:g("You’re the owner"),team:g("You’re a member of this team folder"),default:g("You")},a={viewer:g("%(name)s can view"),editor:g("%(name)s can edit"),owner:g("%(name)s is the owner"),pending:g("%(name)s hasn’t added this to their Dropbox yet"),team:g("%(name)s is a member of this team folder"),default:g("%(name)s"),"no access":g("No access")},o={viewer:g("You (%(name)s) can view"),editor:g("You (%(name)s) can edit"),owner:g("You (%(name)s) are the owner")},i=s?r&&null!=e?o:n:a,i[t].format({name:e})}}})}.call(this),function(){define("modules/clean/sharing/models/file",["modules/clean/react/browse/constants","modules/constants/legacy"],function(e,t){var s,r;return s=e.FileTypes,r=function(e,r){var n;return e.type!==s.FOLDER?!1:(r.config.isPublicFolderEnabled||null!=r.config.publicAppToken)&&(n=e.fq_path.toLowerCase(),"/public"===n||n.startsWith("/public/"))?!1:r.isCurrentPathWriteable()?!(e.ns_id!==t.root_ns&&!r.currentNSAllowsNesting):!1},{canConvertToSharedFolder:r}})}.call(this),function(){define("modules/clean/teams/cdm_mve_quota_usage",["external/react","modules/clean/react/browse/models","modules/clean/teams/cdm_mve_util","modules/core/i18n"],function(e,t,s,r){var n,o,i,a,l,u;return o=t.QuotaStats,a=s.calculateQuotaClass,i=r._,u=r.format_percent,l=e.DOM,n=e.createClass({displayName:"CdmMveQuotaUsage",propTypes:{quotaStats:e.PropTypes.instanceOf(o).isRequired},mixins:[e.addons.PureRenderMixin],render:function(){var e,t,s,r,n,o,c;return c=this.props.quotaStats,r=c.quotaRawBytes,n=c.quotaRawBytesUsed,e=c.formattedQuota,o=n/r,s="cdm_mve_quota_percent_used "+a(o),t=u(Math.floor(100*o)),l.span({},l.span({className:"u-mar-horizontal-xs"},"•"),l.span({className:s},i("%(used_percent)s of %(available_quota)s used").format({used_percent:t,available_quota:e})))}})})}.call(this),function(){define("modules/clean/teams/cdm_mve_util",[],function(){return{calculateQuotaClass:function(e){return e>=1?"quota-status-overquota":e>=.9?"quota-status-nearquota":""}}})}.call(this),function(){define("modules/clean/teams/team_promo_banner",["external/classnames","external/react","modules/clean/react/button"],function(e,t,s){var r,n,o,i;return o=t.DOM,n=t.createElement,i=t.PropTypes,r=t.createClass({displayName:"TeamPromoBanner",propTypes:{className:i.string,title:i.string,description:i.node,buttons:i.arrayOf(i.shape({text:i.string,handler:i.func}))},render:function(){var t,r;return o.div({className:e("team-promo-banner",this.props.className)},o.div({className:"team-promo-banner-contents"},o.div({className:"team-promo-banner-body"},o.div({className:"team-promo-banner-title"},this.props.title),o.div({className:"team-promo-banner-description"},this.props.description)),o.div({className:"team-promo-banner-buttons"},function(){var e,i,a,l;for(a=this.props.buttons,l=[],r=e=0,i=a.length;i>e;r=++e)t=a[r],l.push(o.span({className:"team-promo-banner-button",key:"button-"+r},n(s.button,{importance:"tertiary",onClick:t.handler},t.text)));return l}.call(this))))}})})}.call(this),function(){define("modules/clean/unity_browse_interface",["jquery","modules/clean/unity/check_file_cache","modules/clean/unity/features"],function(e,t,s){var r;if(null!=t&&null!=s)return r=function(){function e(){}return e.BATCH_SIZE_LIMIT=100,e.CHECK_FILES_PADDING=50,e.check_file_callback=function(e){return t.set_batch(e)},e.browse_visible_change_callback=function(t,r,n,o){var i,a,l,u,c,p;if(t.length&&(u=Math.max(0,n-e.CHECK_FILES_PADDING),p=Math.min(t.length-1,o+e.CHECK_FILES_PADDING),a=t.slice(u,+p+1||9e9),l=e._get_files_to_check(a),l.length)){for(e._remove_unneeded_items_from_cache(a),c=[];l.length;)i=l.splice(0,e.BATCH_SIZE_LIMIT),c.push(s.check_file_batch(i,r,e.check_file_callback));return c}},e._get_files_to_check=function(e){var s;return function(){var r,n,o;for(o=[],r=0,n=e.length;n>r;r++)s=e[r],s.bytes>=0&&t.is_cached_and_locally_available(s.ns_id,s.ns_path)!==!0&&o.push(s);return o}()},e._remove_unneeded_items_from_cache=function(e){var r,n,o,i,a;for(n={},i=0,a=e.length;a>i;i++)o=e[i],t.is_cached_and_locally_available(o.ns_id,o.ns_path)===!0&&(r=t.get(o.ns_id,o.ns_path),n[s.server_path(o.ns_id,o.ns_path)]=r);return t.clear(),t.set_batch(n)},e}()})}.call(this),function(){define("modules/clean/upsell/prompt_loader",["jquery","modules/clean/uirequest"],function(e,t){var s,r,n,o;return s={init:function(s,r,n,o){return s?new t(e("#ha-container"),"/prompt/ha",{data:{ref_controller:r,ref_action:n,campaign_id:o},subject_user:s}):void 0}},r={init:function(s,r,n,o,i,a){return null==a&&(a={}),new t(e("#outer-frame"),"/prompt/main_campaign",{data:{ref_controller:r,ref_action:n,in_app:o,sprite_group:i,skip_main_campaign:a.skip_main_campaign},dataType:"json",subject_user:s,success:function(t){return e(".db-modal-overlay").is(":visible")||e("#db-modal-upsell-home-modal").addClass("show-upsell-modal").trigger("show-upsell-modal"),"function"==typeof a.success?a.success(t):void 0}})}},o={init:function(s,r){return new t(e("#page-header"),"/prompt/top_notification_bar",{data:{ref_controller:s,ref_action:r},success:function(t){return e("body").addClass(e("[data-body-class]").data("body-class"))}})}},n={_didCampaignLoad:function(e,t,s){var r,n,o,i,a,l,u;for(null==s&&(s=null),a=e.actions||[],l=0,u=a.length;u>l;l++)if(r=a[l],i=r[0],n=r[1],o=r[2],o===t&&n)return s?n.indexOf(s)>=0:!0;return!1},_didHeaderBubbleLoad:function(e){return this._didCampaignLoad(e,"^body #notification-feed-nav-link","header-bubble-container")},_didHeaderLinkLoad:function(e){return!this._didHeaderBubbleLoad(e)&&this._didCampaignLoad(e,"^body #notification-feed-nav-link","header-link")},didMainCampaignLoad:function(e){return this._didHeaderBubbleLoad(e)||this._didCampaignLoad(e,"^body #outer-frame")},didAccountHeaderCampaignLoad:function(e){return this._didHeaderBubbleLoad(e)||this._didHeaderLinkLoad(e)},didTopNotificationLoad:function(){return!!e("#top-notification-bar-container").length},init:function(e,t,n,o,i){var a;return a=this.didTopNotificationLoad()?{skip_main_campaign:!0,success:function(r){return function(o){return r.didAccountHeaderCampaignLoad(o)?void 0:s.init(e,t,n)}}(this)}:{success:function(r){return function(o){return r.didMainCampaignLoad(o)?void 0:s.init(e,t,n)}}(this)},r.init(e,t,n,o,i,a)}},{HALoader:s,MainAndAccountHeaderLoader:r,MutuallyExclusiveLoader:n,TopNotificationBarLoader:o}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/dirty/react/browse/actions",["jquery","external/underscore","modules/clean/browse_interface","modules/clean/css","modules/clean/downloads","modules/clean/em_string","modules/clean/file_operations/notifications","modules/clean/filepath","modules/clean/flux/dispatcher","modules/clean/history","modules/clean/pagination_manager","modules/clean/react/browse/api","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/browse/store","modules/clean/react/file_modal_controller","modules/clean/react/selectable_list","modules/clean/sharing/ui_util","modules/clean/undo","modules/constants/env","modules/constants/python","modules/constants/request","modules/constants/viewer","modules/constants/viewer","modules/core/browser","modules/core/cookies","modules/core/html","modules/core/i18n","modules/core/notify","modules/core/uri","modules/dirty/react/file_viewer/controller"],function(t,s,r,n,o,i,a,l,u,c,p,d,h,_,m,f,g,b,S,y,v,T,w,E,P,F,I,D,C,N,A){var R,O,L,M,x,U,k,B,q,H,G,W,V,j,K,z;return R=h.BrowseActionTypes,B=h.LoadingStates,q=h.REACT_FILE_VIEWER_ELEMENT_ID,G=h.SEARCH_PREFIX,x=_.File,L=_.BrowseContext,M=m.BrowseStore,U=f.FileModalController,K=g.createSelection,k=b.GoldenGate,H=E.ROLE_WORK,W=D._,z=D.ungettext,V=["#page-header","#page-sidebar","#browse-box",".growth-onboarding-progress-bar__container",".team-progress-bar-experience","#flash-upload-container"].join(),j=function(e){var r,n,o,i,a,l,u,c,p,d;return r=e.files,n=e.indexOfPreviewFile,d=e.user,c=e.shouldFocusComment,p=null!=(a=e.updateBrowserLocation)?a:!0,o=null!=(l=e.onCloseViewer)?l:s.noop,i=null!=(u=e.onViewerUnmount)?u:s.noop,A.open(r,n,d,q,{fileViewTarget:v.FileViewTargetType.PRIVATE,fileViewOrigin:v.FileViewOriginType.BROWSE,fileViewAction:v.FileViewActionType.CLICK,shouldFocusCommentInput:c,disableRouting:!p,onCloseViewer:o,onComponentDidMount:function(){return t(V).hide()},onComponentWillUnmount:function(){return t(V).show(),i()}})},new(O=function(){function n(){this.setShouldShowDeletedFiles=e(this.setShouldShowDeletedFiles,this),this.navigateToParentFolder=e(this.navigateToParentFolder,this),this.navigateToFileOrFolder=e(this.navigateToFileOrFolder,this),this.computeAndApplyDeltasFromNotServer=e(this.computeAndApplyDeltasFromNotServer,this),this.pasteClipboardFilesToCurrentPath=e(this.pasteClipboardFilesToCurrentPath,this)}return n.prototype.initializeEverything=function(e){var t,s,r,n,o,i,a,l,c,p;return p=e.user,i=e.path,s=e.files,c=e.urlPrefix,t=e.context,o=e.mountPoints,a=e.shouldShowDeletedFiles,r=e.fqPathsToSelect,n=e.loadingState,l=e.teamFolders,u.dispatch({type:R.INITIALIZE_EVERYTHING,data:{user:p,path:i,files:s,urlPrefix:c,context:t,mountPoints:o,shouldShowDeletedFiles:a,fqPathsToSelect:r,loadingState:n,teamFolders:l}})},n.prototype._dataApi=d,n.prototype.load=function(e){var t,s,r;return r=e.path,s=e.files,t=e.context,u.dispatch({type:R.LOAD_PATH,data:{path:r,files:s,context:t}})},n.prototype.add=function(e){var t,s;return s=e.path,t=e.files,u.dispatch({type:R.ADD_FILES,data:{path:s,files:t}})},n.prototype.setLoadingState=function(e){var t,s;return t=e.loadingState,s=e.path,u.dispatch({type:R.SET_LOADING_STATE,data:{loadingState:t,path:s}})},n.prototype.setMountPoints=function(e){var t;return t=e.mountPoints,u.dispatch({type:R.SET_MOUNT_POINTS,data:{mountPoints:t}})},n.prototype.setTeamFolders=function(e){var t;return t=e.teamFolders,u.dispatch({type:R.SET_TEAM_FOLDERS,data:{teamFolders:t}})},n.prototype.setPath=function(e){var t,s,r,n,o;return n=e.path,r=e.onPathLoaded,s=e.nsId,u.dispatch({type:R.SET_PATH,data:{path:n}}),this.setLoadingState({loadingState:B.LOADING_FIRST_PAGE,path:n}),o=M.user().id,t=function(e){return function(t){var s,i,a,l,u,c;return a=t.path,i=t.data,e.setMountPoints({mountPoints:i.ns_id_to_mount_point}),e.setTeamFolders({teamFolders:i.team_folders_js_info}),s=L.fromServerObject(i),i.paginated?(e.setLoadingState({loadingState:B.LOADING_REMAINING_PAGES,path:n}),e.load({path:a,files:[],context:s}),l=function(t,s){return e.add({path:a,files:s}),t.areAllItemsReady()?(e.setLoadingState({loadingState:B.LOADED,path:n}),t.stopAutoFetching()):void 0},u=new p,u.initialize(i.first_page,"sjid","/browse_get_next",o,l),u.startAutoFetching()):(c=i.file_info,e.load({path:a,files:c,context:s}),e.setLoadingState({loadingState:B.LOADED,path:n})),"function"==typeof r?r():void 0}}(this),this._dataApi.loadPath({path:n,userId:o,sortFoldersFirst:!P.mac,includeDeletedFiles:M.shouldShowDeletedFiles(),nsId:s,onSuccess:t,onError:function(e){return function(){return"/"!==n?e.setPath({path:"/",onPathLoaded:r}):void 0}}(this)})},n.prototype.reloadCurrentPath=function(){return this.setPath({path:M.path()})},n.prototype.setUser=function(e){var t;return t=e.user,u.dispatch({type:R.SET_USER,data:{user:t}})},n.prototype.updatePreview=function(e){var t;return t=e.files,A.updateFiles(t)},n.prototype.closeFileViewer=function(){return A.close()},n.prototype.setUrlPrefix=function(e){var t;return t=e.prefix,u.dispatch({type:R.SET_URL_PREFIX,data:{prefix:t}})},n.prototype.setUrl=function(e){var t,s,n,o,i,a;t=e.path,s=e.prefix,n=e.qargs,s===G?(a=M.user(),i=a.role===H?r.WORK_ROOT:r.PERSONAL_ROOT,s+=i,c.push_state(s,n)):(o={},"1"===c.deconstruct_url().qargs.d&&(o.d="1"),c.push_state(M.urlPrefix()+N.encode_parts(t),o),u.dispatch({type:R.SET_SELECTION,data:{selection:K()}}))},n.prototype.copySelectedFilesToClipboard=function(){var e,t,s;return t=M.selectedFiles(),t&&t.size?t.some(function(e){return e.isDeleted})?(C.error(W("Deleted files cannot be added to the clipboard")),!1):k.canDeepNest(M.user().id)&&(e=t.some(function(e){return x.isTeamSharedFolder(e)}))?void C.error(W("Team Folders can’t be copied.")):(s=z("Added %(num_items)s item to clipboard","Added %(num_items)s items to clipboard",t.size).format({num_items:t.size}),C.success(s),u.dispatch({type:R.COPY_SELECTED_FILES_TO_CLIPBOARD})):void 0},n.prototype.pasteClipboardFilesToCurrentPath=function(){return this.copyFiles({files:M.clipboardFiles().toArray(),newPath:M.path()})},n.prototype.selectRowsFromNotServer=function(e){return null==e&&(e=[]),this.setFilePathsToSelectOnNextUpdate({fqPathsToSelect:e.map(function(e){return e.fq_path})})},n.prototype.setFilePathsToSelectOnNextUpdate=function(e){var t;return t=e.fqPathsToSelect,u.dispatch({type:R.SET_FILE_PATHS_TO_SELECT_ON_NEXT_UPDATE,data:{fqPathsToSelect:t}})},n.prototype.copyFiles=function(e){var t,s,r;return t=e.files,s=e.newPath,r=M.user(),this._dataApi.copyFiles({files:t,newPath:s,userId:r.id,onSuccess:function(e){return function(n){var o,i;return i=n.files,o=n.changesets,a.notifyCopySuccess(t.length,r,o,s,function(){return e.selectRowsFromNotServer(t)}),e.selectRowsFromNotServer(i)}}(this)})},n.prototype.deleteFiles=function(e){var t,s;return t=e.files,s=M.user(),this._dataApi.deleteFiles({files:t,userId:s.id,onSuccess:function(e){var r,n,o;return n=e.fileDeltas,r=e.changesets,o=e.rollbackHints,a.notifyDeleteSuccess(t.length,s,r,o,function(e){return function(){return e.selectRowsFromNotServer(t)}}(this))}})},n.prototype.moveFiles=function(e){var t,s,r,n;return r=e.path,t=e.files,s=e.newPath,n=M.user(),this._dataApi.moveFiles({path:r,files:t,newPath:s,userId:n.id,onSuccess:function(e){return function(r){var o,i,l;return l=r.path,i=r.fileDeltas,o=r.changesets,a.notifyMoveSuccess(t.length,n,o,s,function(){return e.selectRowsFromNotServer(t)})}}(this)})},n.prototype.showFileRename=function(e){var t;return t=e.file,u.dispatch({type:R.REQUEST_NEW_FILE_NAME,data:{file:t}})},n.prototype.cancelFileRename=function(e){var t;return t=e.file,u.dispatch({type:R.CANCEL_FILE_RENAME,data:{file:t}})},n.prototype.renameFile=function(e){var t,s,r;return t=e.file,s=e.newName,u.dispatch({type:R.SET_FILE_RENAME_PENDING,data:{file:t}}),r=M.user(),this._dataApi.renameFile({file:t,newName:s,userId:r.id,onSuccess:function(e){return function(s){var n,o,i;return o=s.renamedFile,n=s.changesets,i=s.rollbackHints,a.notifyRenameSuccess(r,n,i,function(){return e.selectRowsFromNotServer([t])}),e.selectRowsFromNotServer([o])}}(this),onError:function(e){return function(s,r,n){return e.cancelFileRename({file:t})}}(this)})},n.prototype.applyFileDeltas=function(e){var t,s;return s=e.path,t=e.fileDeltas,u.dispatch({type:R.CHANGE_FILES,data:{path:s,fileDeltas:t}})},n.prototype._getMountPointUpdateForCurrentPath=function(e){var t,r,n,o,i,a,l,u;return n=M.path(),t=(null!=(u=M.mountPoints())?u.toJS():void 0)||{},o=function(e){return function(e){return e===n}}(this),r=parseInt(s.findKey(t,o),10),r?(a=e[r]||null,l=t[r]||null):(l=null,i=Boolean(s.findKey(e,o)),a=i?n:null),[l,a]},n.prototype._getPathForNewMountPoint=function(e,t){return e&&!t?M.path():e&&t?l.paths_are_equal(e,t)?null:t:!e&&t?M.path():null},n.prototype._showUserNotificationForPathChange=function(e,t){var n,o,i,a,u,c,p,d,h;return c=t.old_fq_path,h=r.get_browse_root(e)+t.new_fq_path,n=function(e){return s.escape(l.filename(e))},i=function(e){return C.success(new I(e))},o=function(e){return C.error(new I(e))},u=!t.is_changing_view,a=null!=(d=t.change_type)?d.toLowerCase():void 0,"moved"===a?u?i(W("This folder has been moved")):(p=W('The folder ‘%(folder_name)s’ has been moved. <a href="%(href)s">View</a>'),p=p.format({folder_name:n(c),href:s.escape(h)}),o(p)):"renamed"===a?u?(p=W("This folder has been renamed to ‘%(folder_name)s’"),p=p.format({folder_name:n(t.change_to_fq_path)}),i(p)):(p=W('The folder ‘%(folder_name)s’ has been renamed. <a href="%(href)s">View</a>'),p=p.format({folder_name:n(c),href:s.escape(h)}),o(p)):"deleted"===a?(p=W("The folder ‘%(folder_name)s’ has been deleted"),p=p.format({folder_name:n(c)}),o(p)):void 0},n.prototype.computeAndApplyDeltasFromNotServer=function(e){var t,s,r,n,o,i,a,l,u,c,p,d,h,_,m,f,g,b,S,y,v,T,w,E,P,F,I;if(y=e.path,v=e.payload,o=e.currentNSId,t=v.added,f=v.moved,P=v.removed,m=v.mount_points,S=v.parent_changes,null!=S?S.change_to_fq_path:void 0)return I=M.user(),this._showUserNotificationForPathChange(I,S),void this.setUrl({path:S.change_to_fq_path});if(w=this._getMountPointUpdateForCurrentPath(m),n=w[0],g=w[1],n&&!g&&C.success(W("The folder was unshared.")),F=this._getPathForNewMountPoint(n,g))return void this.setPath({path:F,nsId:o});for(this.setMountPoints({mountPoints:m}),i=M.filesMap(),a=[],u=0,d=t.length;d>u;u++)b=t[u],r=null,s=x.fromServerObject(b),a.push({before:r,after:s});for(c=0,h=f.length;h>c;c++)E=f[c],T=E[0],b=E[1],r=i.get(T,null),s=x.fromServerObject(b),a.push({before:r,after:s});for(p=0,_=P.length;_>p;p++)l=P[p],r=i.get(l,null),s=null,a.push({before:r,after:s});return this.applyFileDeltas({path:y,fileDeltas:a})},n.prototype.setSelection=function(e){var t;return t=e.selection,u.dispatch({type:R.SET_SELECTION,data:{selection:t}})},n.prototype.selectFilesByFqPath=function(e){var t;return t=e.fqPathsToSelect,u.dispatch({type:R.SELECT_FILES_BY_FQ_PATH,data:{fqPathsToSelect:t}})},n.prototype.toggleFqPathSelected=function(e){var t;return t=e.path,u.dispatch({type:R.TOGGLE_FQ_PATH_SELECTED,data:{path:t}})},n.prototype.setActiveTab=function(e){var t;return t=e.tabName,u.dispatch({type:R.SET_ACTIVE_TAB,data:{tabName:t}})},n.prototype.navigateToFileOrFolder=function(e){var t,s,r,n,o,i,a;return t=e.file,a=null!=(o=e.shouldFocusComment)?o:!1,n=e.onFileViewerUnmount,t.is_dir?this.setUrl({path:t.fq_path}):(s=M.getIndexOfFile(t),s>-1?r=null!=(i=M.files())?i.toJS():void 0:(s=0,r=[t]),t.isDeleted?U.showRestore(M.user(),[t]):"download"===t.preview_type?P.unsafe_open_tab(t.href):j({files:r,indexOfPreviewFile:s,shouldFocusComment:a,user:M.user(),onViewerUnmount:n}))},n.prototype.openPreviewForFile=function(e){var t,s;return t=e.file,s=e.onCloseViewer,j({files:[t],indexOfPreviewFile:0,user:M.user(),updateBrowserLocation:!1,onCloseViewer:function(){return"function"==typeof s?s():void 0}})},n.prototype.navigateToParentFolder=function(){var e;return e=l.parent_dir(M.path()),this.setUrl({path:e})},n.prototype.setShouldShowDeletedFiles=function(e){var t,s,r;return r=e.shouldShowDeletedFiles,s=null!=(t=e.shouldReloadFolder)?t:!0,r?c.update_query_param("d","1"):c.remove_query_param("d"),u.dispatch({type:R.SET_SHOULD_SHOW_DELETED_FILES,data:{shouldShowDeletedFiles:r}}),s?this.reloadCurrentPath():void 0},n.prototype.sortFiles=function(e){var t,s;return s=e.sortField,t=e.direction,u.dispatch({type:R.SORT_FILES,data:{sortField:s,direction:t}})},n.prototype.setCopyMode=function(e){var t;return t=e.copyMode,u.dispatch({type:R.SET_COPY_MODE,data:{copyMode:t}})},n.prototype.downloadFiles=function(e){var t,s,r,n,i,a;return r=e.files,t=e.context,a=e.user,1!==r.count()||r.first().is_dir?t.blockHash?(i=t.currentFQPath,n=function(){var e,t,n,o;for(n=r.toArray(),o=[],e=0,t=n.length;t>e;e++)s=n[e],o.push(s.fq_path);return o}(),o.get_zip({fq_paths:n,subject_uid:a.id,block_hash:t.blockHash,parent_path:i})):!1:void o.get_blockserver_link({url:r.first().direct_blockserver_link})},n.prototype.nameNewFolder=function(){return u.dispatch({type:R.REQUEST_FOLDER_NAME})},n.prototype.createFolder=function(e){var t,s,r;return s=e.pathName,t=e.folderName,u.dispatch({type:R.CREATE_FOLDER_PENDING}),r=M.user(),this._dataApi.createNewFolder({pathName:s,folderName:t,userId:r.id,onSuccess:function(e){return function(s){var n,o;return n=s.changesets,o=s.createdFolder,u.dispatch({type:R.CREATE_FOLDER_COMPLETE}),a.notifyFolderCreationSuccess(t,r,n),e.selectRowsFromNotServer([o])}}(this),onError:function(){return u.dispatch({type:R.CANCEL_CREATE_FOLDER})}})},n.prototype.cancelCreateFolder=function(){return u.dispatch({type:R.CANCEL_CREATE_FOLDER})},n.prototype.addCommentStatusBatch=function(e){var t;return t=e.commentStatusByFqPath,u.dispatch({type:R.ADD_COMMENT_STATUS_BATCH,data:{commentStatusByFqPath:t}})},n.prototype.viewInPhotos=function(e){var s,r,n,o,i,a,l,u,c,p;return i=e.files,p=e.user,i=i.toArray(),a=N({scheme:"https",authority:y.WEBSERVER,path:"/app/view_in_timeline"}).updateQuery(w.UID_PARAM_NAME,p.id).toString(),c=t("<form>",{action:a,method:"post"}),r=t("<input>",{name:"t",value:F.read(T.JS_CSRF_COOKIE)}),r.appendTo(c),l=JSON.stringify(function(){var e,t,s;for(s=[],e=0,t=i.length;t>e;e++)o=i[e],s.push(o.ns_id);return s}()),s=t("<input>",{name:"ns_ids",value:l}),s.appendTo(c),u=JSON.stringify(function(){var e,t,s;for(s=[],e=0,t=i.length;t>e;e++)o=i[e],s.push(o.ns_path);return s}()),n=t("<input>",{name:"ns_paths",value:u}),n.appendTo(c),t(document.body).append(c),c.submit(),c.remove()},n.prototype.setDropTarget=function(e){var t;return t=e.target,u.dispatch({type:R.SET_DROP_TARGET,data:{target:t}})},n.prototype.setDataApi=function(e){return this._dataApi=e},n}())})}.call(this),function(){define("modules/dirty/react/browse/browse",["jquery","external/immutable","external/react","external/underscore","external/classnames","modules/clean/account/email","modules/clean/browse_interface","modules/clean/em_string","modules/clean/flux/store_mixin","modules/clean/history","modules/clean/notserver","modules/clean/pagination_manager","modules/clean/react/app_actions_view","modules/clean/react/browse/api","modules/clean/react/browse/cdm_mve_work_usage_banner","modules/clean/react/browse/constants","modules/dirty/react/browse/file_actions","modules/clean/react/browse/models","modules/clean/react/browse/store","modules/clean/react/css","modules/clean/react/file_modal_controller","modules/clean/react/file_uploader/uploader","modules/clean/react/file_uploader/store","modules/clean/react/user_notifications/dropdown","modules/clean/react/file_viewer/account_menu/account_menu","modules/clean/search/actions","modules/clean/search/search_bar","modules/clean/search/store","modules/clean/sharing/ui_util","modules/clean/viewer","modules/clean/web_timing_logger","modules/constants/comments_panel","modules/core/browser","modules/core/i18n","modules/core/notify","modules/core/uri","modules/dirty/react/browse/actions","modules/dirty/react/browse/browse_location","modules/dirty/react/browse/comment_status","modules/dirty/react/browse/context_menu","modules/dirty/react/browse/global_actions","modules/dirty/react/browse/item_list","modules/dirty/react/browse/selection_actions","modules/dirty/react/browse/preview_sf_members","modules/dirty/react/browse/pinned_team_folder","modules/dirty/react/file_viewer/controller","modules/dirty/search/search_results","modules/dirty/sharing/browse_ui_util","require"],function(e,t,s,r,n,o,i,a,l,u,c,p,d,h,_,m,f,g,b,S,y,v,T,w,E,P,F,I,D,C,N,A,R,O,L,M,x,U,k,B,q,H,G,W,V,j,K,z,Q){var Y,J,X,$,Z,ee,te,se,re,ne,oe,ie,ae,le,ue,ce,pe,de,he,_e,me,fe,ge,be,Se,ye,ve,Te,we,Ee,Pe,Fe,Ie,De;return ne=o.EmailVerification,_e=c.NotClients,be=m.REACT_FILE_VIEWER_ELEMENT_ID,re=m.DropTargetHighlightMode,ae=m.FileTypes,de=m.LoadingStates,he=m.NameSpaceAccess,ye=m.ShareFolderModalTypes,Se=m.SEARCH_PREFIX,Z=m.BrowseSortField,oe=g.File,J=g.BrowseContext,me=g.Paper,ee=b.BrowseStore,ie=y.FileModalController,le=v.FileUploader,ve=T.UploaderStore,ce=D.GoldenGate,Ie=D.showZendeskFlyoutIfAllowed,Te=O._,De=O.ungettext,X=B.BrowseContextMenu,ue=q.GlobalActions,Pe=q.getGlobalActions,pe=H.ItemListController,$=G.BrowseSelectionMenu,ge=W.PreviewSFMembersPanel,fe=V.PinnedTeamFolder,Fe=z.showTiburonUIIfAllowed,Ee=s.DOM,we=s.createElement,Y=s.createClass({displayName:"BrowseAppController",mixins:[l(ee,ve,I)],propTypes:{"from-scl-sync-modal":s.PropTypes.bool,"init-data":s.PropTypes.object,"limited-team-banner-upsell":s.PropTypes.bool,"notify-path-does-not-exist":s.PropTypes.string,"notify-path-is-deleted":s.PropTypes.string,"share-link":s.PropTypes.bool,"share-prefill-email":s.PropTypes.string,"trademark-business":s.PropTypes.string,"email-just-verified":s.PropTypes.bool,"email-just-verified-and-changed":s.PropTypes.bool,"send-verification-email":s.PropTypes.bool,"is-pagelet":s.PropTypes.bool},_get_state_from_stores:function(){var e;return e=ee.path(),{context:ee.context(),files:ee.files(),filesWithoutTeamFolders:"/"===e?ee.filesWithoutTeamFolders():t.List(),teamFolders:ee.teamFolders(),loadingState:ee.loadingState(),path:e,selection:ee.selection(),selectedFiles:ee.selectedFiles(),fileRename:ee.fileRename(),user:ee.user(),shouldShowDeletedFiles:ee.shouldShowDeletedFiles(),isDraggingInternalFiles:ve.numDraggingFiles()>0&&ve.isInternalTransfer(),isDraggingExternalFiles:ve.numDraggingFiles()>0&&!ve.isInternalTransfer(),activeDropTarget:ee.activeDropTarget(),isUploadModalOpen:ve.isUploadModalOpen(),isTextSelectable:!!ee.fileRename(),inCopyMode:ee.inCopyMode(),createNewFolderState:ee.newFolderCreationState(),isSearchMode:!!I.latestQuery(),currentSort:ee.currentSort()}},_preloadLargeModules:function(){return Q(["dropbox"])},componentWillMount:function(){var e,t,s,r,n,o,a,l,c,d,h,_,m,f,g,b,S,y,v;return this.previousHistoryCallbackPath=null,this.hasLoadedFilesForTheVeryFirstTime=!1,this.props["from-scl-sync-modal"]&&Ie("tiburon_receive",Te("You just received a folder with Dropbox")),v=C.get_viewer().get_user_by_id(this.props["user-id"]),y=i.get_browse_root(v),t=u.deconstruct_url(),m=this.props["init-fq-path"]||"/",f=Boolean(this.props["should-show-deleted-files"]),n=Boolean(this.props["search-query"]),n||this._setupFileEventListener(v.id),a=this.props["init-data"],a?(e=J.fromServerObject(a),c=Boolean(a.paginated)?de.LOADING_REMAINING_PAGES:de.LOADED,l=c===de.LOADING_REMAINING_PAGES,s=l?[]:a.file_info,d=a.ns_id_to_mount_point,r=this.props["select-fq-paths"],b=a.team_folders_js_info,x.initializeEverything({user:v,path:m,files:s,urlPrefix:y,context:e,mountPoints:d,fqPathsToSelect:r,loadingState:c,shouldShowDeletedFiles:f,teamFolders:b}),l&&(_=new p,h=function(e,t){return x.add({path:m,files:t}),e.areAllItemsReady()?(x.setLoadingState({loadingState:de.LOADED,path:m}),e.stopAutoFetching()):void 0},_.initialize(a.first_page,"sjid","/browse_get_next",v.id,h),"undefined"!=typeof RUNNING_IN_REACTSERVER&&null!==RUNNING_IN_REACTSERVER||_.startAutoFetching())):(x.setUrlPrefix({prefix:y}),x.setUser({user:v}),x.setShouldShowDeletedFiles({shouldShowDeletedFiles:f,shouldReloadFolder:!1}),r=this.props["select-fq-paths"],x.setFilePathsToSelectOnNextUpdate({fqPathsToSelect:r}),this.hasTTIBeenLogged=!1,this.props["search-query"]||this.navigateToPath(m)),this.props["search-query"]||(o=Boolean(this.props["preview-file-info"]),o||(S=this._getUrlForFQPath(m),this._sanitizeBrowserLocation(S))),g=!n,u.add_callback(y,this.handleFileLocationChange,!0),u.add_callback(Se,this.handleSearchLocationChange,g),u.add_exit_callback(Se,P.clearSearch),this.setState(this._get_state_from_stores())},componentDidMount:function(){var e,t,s,r;return this.props["init-data"]&&(this.hasTTIBeenLogged||(N.mark_time_to_view(),N.mark_time_to_interactive(),this.hasTTIBeenLogged=!0,this._preloadLargeModules())),this._mountFileViewerTarget(),t=this.props["initial-share-modal-type"],r=this.props["preview-file-info"],r?(s=oe.fromServerObject(r),x.openPreviewForFile({file:s,onCloseViewer:this._restoreUrlAfterFileViewClose}),t&&Fe(this.state.user,s,{origin:this.props["share-prefill-email"]?"GRANT_ACCESS":"DESKTOP_CLIENT",prefillEmail:this.props["share-prefill-email"]})):t&&this._showShareModal(t,this.state.path,this.state.user),
this._maybeShowLegacySharedLinkModalIfQargPresent(),null!=this.props["notify-path-is-deleted"]?(e=Te("The folder ‘%(folder_name)s’ is deleted.").format({folder_name:a.em_snippet(this.props["notify-path-is-deleted"],15)}),L.error(e)):null!=this.props["notify-path-does-not-exist"]&&(e=Te("The folder ‘%(folder_name)s’ doesn’t exist.").format({folder_name:a.em_snippet(this.props["notify-path-does-not-exist"],15)}),L.error(e)),this.props["email-just-verified"]?ne.getForRole(this.state.user.role).show_verified_modal():this.props["email-just-verified-and-changed"]?ne.getForRole(this.state.user.role).show_verified_and_changed_modal():this.props["send-verification-email"]&&ne.getForRole(this.state.user.role).show_sent_modal(),A.ALLOW_STATUS_IN_BROWSE?k.setup():void 0},componentWillUpdate:function(e,t){return t.isSearchMode&&!this.state.isSearchMode?_e[this.state.user.id].unsubscribe(this.handlerId):!t.isSearchMode&&this.state.isSearchMode&&this._setupFileEventListener(this.state.user.id),t.files.equals(this.state.files)?void 0:setTimeout(function(e){return function(){return e.handleFileListUpdated()}}(this),0)},_restoreUrlAfterFileViewClose:function(){var e,t;return t=this._getUrlForFQPath(this.state.path),Boolean(this.props["loaded-with-explicit-preview"])?(e=u.deconstruct_url().qargs,delete e.preview):e={},u.replace_state(t,e)},_getUrlForFQPath:function(e){var t;return t="/"===e?"":M.encode_parts(e),ee.urlPrefix()+t},_sanitizeBrowserLocation:function(e){var t,s;return t=u.deconstruct_url().qargs,s=r.pick(t,"d","select","preview"),u.replace_state(e,s)},_mountFileViewerTarget:function(){var e;return e=document.getElementById(be),e?void 0:(e=document.createElement("div"),e.id=be,document.body.insertBefore(e,document.body.children[0]))},_showShareModal:function(e,t,s){return Fe(s,{fqPath:this.props["init-fq-path"],isFolder:!0,nsId:this.props["ns-id"]&&this.props["ns-path"]?this.props["ns-id"]:null,origin:this.props["share-prefill-email"]?"GRANT_ACCESS":"DESKTOP_CLIENT",targetNsId:this.props["ns-id"]&&!this.props["ns-path"]?this.props["ns-id"]:null,prefillEmail:this.props["share-prefill-email"]})?void 0:Q(["dropbox"],function(r){var n;switch(n=r.SharingModals,e){case ye.ShareExisting:return n.show_share_existing_modal(t,s);case ye.EditShared:return n.show_shared_folder_options_modal(t,s);case ye.EditSharedSubFolder:return n.show_shared_subfolder_modal(t,s)}})},_setupFileEventListener:function(e){var t;return t=_e[e],this.handlerId=t.subscribe_sfj({name:"BrowseEventDispatcher",handler:function(s){return function(){var r;return r=s.state.path,h.getChangesForDirectory({path:r,userId:e,namespaceToJournalIdMap:t.get_ns_map(),includeDeletedFiles:s.state.shouldShowDeletedFiles,onSuccess:function(e){return x.computeAndApplyDeltasFromNotServer({payload:e,path:r}),t.handler_success(s.handlerId,{ns_map:e.ns_map})}})}}(this)})},_maybeShowLegacySharedLinkModalIfQargPresent:function(){var e,t;return this.props["share-link"]&&1===this.state.selectedFiles.count()?(e=this.state.selectedFiles.toArray()[0].fq_path,t=this.state.user,Q(["dropbox"],function(s){var r;return r=s.SharingModals,r.show_share_existing_modal(e,t)})):void 0},_ensureFileViewerIsOpenedOrClosedIfNeeded:function(e){var t,s;if(null==e&&(e={}),t=j.isShown(),e.preview&&!t){if(s=ee.getFileByFilename(e.preview))return x.navigateToFileOrFolder({file:s})}else if(t&&!e.preview)return x.closeFileViewer()},handleFileLocationChange:function(e,t){return e="undefined"!=typeof RUNNING_IN_REACTSERVER&&null!==RUNNING_IN_REACTSERVER?this.props["init-fq-path"]||"/":"/"+M.decode(e),this._ensureFileViewerIsOpenedOrClosedIfNeeded(t),e!==this.previousHistoryCallbackPath?(this.previousHistoryCallbackPath=e,e!==ee.path()?this.navigateToPath(e):void 0):void 0},handleSearchLocationChange:function(e,t){var s,r,n;if(t&&(s=t.query||t.query_unnormalized,e=t.path||t.last_fq_path||"/",s&&(e!==this.state.path||s!==I.latestQuery())))return n=null!=(r=this.state.user)?r:C.get_viewer().get_user_by_id(this.props["user-id"]),this.previousHistoryCallbackPath=e,e!==ee.path()&&x.setPath({path:e}),P.runSearch({user:n,path:e,query:s})},navigateToPath:function(e){var t;return t=function(e){return function(){return e.hasTTIBeenLogged?void 0:(N.mark_time_to_view(),N.mark_time_to_interactive(),e.hasTTIBeenLogged=!0,e._preloadLargeModules(),e._maybeShowLegacySharedLinkModalIfQargPresent())}}(this),x.setPath({path:e,onPathLoaded:t})},handleFileListUpdated:function(){var e,t;return j.isShown()?this.state.files.isEmpty()?x.closeFileViewer():x.updatePreview({files:this.state.files.toJS()}):(e=null!=(t=u.deconstruct_url())?t.qargs:void 0,this._ensureFileViewerIsOpenedOrClosedIfNeeded(e))},handleDelete:function(){var e,t;return e=ce.canDeepNest(this.state.user.id)&&this.state.selectedFiles.toArray().some(function(e){return oe.isTeamSharedFolder(e)}),this.state.context.isCurrentPathWriteable()&&!e?(t=this.state.selectedFiles.toArray(),ie.showDelete(this.state.user,t,this.state.context,function(){return x.selectRowsFromNotServer(t)})):e?L.error(Te("Team folders can’t be deleted.")):L.warning(Te("You don’t have permission to delete files in this folder."))},handleRestoreMulti:function(){return ie.showRestore(this.state.user,this.state.selectedFiles.toArray())},handlePermanentDelete:function(){var e;return e=function(){return x.reloadCurrentPath()},ie.showPermanentlyDelete(this.state.user,this.state.selectedFiles.toArray(),e)},render:function(){var e,t;return e=this.props["sync-vars"],e.sync_user_role=this.state.user.role,t=r.extend({},{isPagelet:this.props["is-pagelet"],syncVars:e,limitedTeamBannerUpsell:this.props["limited-team-banner-upsell"],trademarkBusiness:this.props["trademark-business"],shouldOpenUploadModal:this.props["should-open-upload-modal"],actionHandlers:{onDelete:this.handleDelete,onRestoreMulti:this.handleRestoreMulti,onPermanentDelete:this.handlePermanentDelete}},this.state),we(se,t)}}),te=s.createClass({displayName:"BrowseView",mixins:[s.addons.PureRenderMixin],propTypes:{context:s.PropTypes.instanceOf(J).isRequired,files:s.PropTypes.instanceOf(t.List).isRequired,filesWithoutTeamFolder:s.PropTypes.instanceOf(t.List),teamFolders:s.PropTypes.object,path:s.PropTypes.string.isRequired,shouldShowDeletedFiles:s.PropTypes.bool.isRequired,isUploadModalOpen:s.PropTypes.bool.isRequired,isTextSelectable:s.PropTypes.bool.isRequired,inCopyMode:s.PropTypes.bool.isRequired,user:s.PropTypes.object.isRequired,selection:s.PropTypes.object,loadingState:s.PropTypes.oneOf(r.values(de)),selectedFiles:s.PropTypes.instanceOf(t.OrderedSet),isDraggingInternalFiles:s.PropTypes.bool,isDraggingExternalFiles:s.PropTypes.bool,activeDropTarget:s.PropTypes.instanceOf(oe),isSearchMode:s.PropTypes.bool,isPagelet:s.PropTypes.bool,syncVars:s.PropTypes.object,limitedTeamBannerUpsell:s.PropTypes.bool,trademarkBusiness:s.PropTypes.string,actionHandlers:s.PropTypes.object},getDefaultProps:function(){return{selectedFiles:t.OrderedSet(),selection:void 0}},getInitialState:function(){return{currentMultiColumnSortField:Z.SHARED_WITH}},componentDidMount:function(){return this._maybeRenderSyncFolderModal(),this._maybeOpenUploaderOnMount()},componentWillUnmount:function(){return this._unmountFileViewerTarget(),A.ALLOW_STATUS_IN_BROWSE?k.teardown():void 0},_maybeRenderSyncFolderModal:function(){var e;return(null!=(e=this.props.syncVars)?e.sync_ns_id:void 0)?Q(["dropbox"],function(e){return function(t){var s;return s=t.SharingModel,s.show_shared_content_sync_modal("can_edit",e.props.syncVars.sync_ns_id,e.props.syncVars.sync_folder_name,e.props.syncVars.sync_folder_size,e.props.syncVars.sync_user_role,e.props.syncVars.sync_out_of_quota)}}(this)):void 0},_maybeOpenUploaderOnMount:function(){return this.props.shouldOpenUploadModal?this.showFileUploader():void 0},_unmountFileViewerTarget:function(){var e;return e=document.getElementById(be),e?document.body.removeChild(e):void 0},_getCurrentDropTargetHighlightMode:function(){var e;return!this.props.context.isInsideSharedFolder||(e=this.props.context.currentSharedFolderPermissionRole)!==he.ACCESS_NO_ACCESS&&e!==he.ACCESS_READER?this.props.isDraggingInternalFiles?this.props.selectedFiles.count(function(e){return e.isDeleted})?re.NONE:this.props.selectedFiles.count(function(e){return e.type===ae.TEAM_SHARED_FOLDER})?re.NONSELECTED_NONSHARED_NONTEAM_FOLDERS:this.props.selectedFiles.count(function(e){return e.type===ae.SHARED_FOLDER})?re.NONSELECTED_NONSHARED_FOLDERS:re.NONSELECTED_FOLDERS:this.props.isDraggingExternalFiles&&!this.props.isUploadModalOpen?re.ALL_FOLDERS:re.NONE:re.NONE},_getCurrentAppActionsProps:function(){var e,t,s,r;return s=this.props.selectedFiles.count(),r=s>0?De("%(count)d Item Selected","%(count)d Items Selected",s).format({count:s}):"",e=s>0?f.getActionsForFileCollection({files:this.props.selectedFiles,context:this.props.context,user:this.props.user,skipSharing:!0,actionHandlers:this.props.actionHandlers,isPagelet:this.props.isPagelet}):Pe({context:this.props.context,user:this.props.user,showDeletedFiles:this.props.shouldShowDeletedFiles,onFileUpload:this.showFileUploader,isPagelet:this.props.isPagelet}),t=e.map(function(e,t){var s;return s={displayName:e.label,handleClick:e.performAction},t>0&&(s.iconName=e.spriteName),s}),{headerText:r,primaryMenuItem:t[0],secondaryMenuItems:t.slice(1)}},showFileUploader:function(){var e;return this.props.isPagelet||this.refs.contextMenu.closeMenu(),null!=(e=this.refs.fileUploader)?e.showModal():void 0},openContextMenuAtPosition:function(e,t,s){return null==s&&(s=null),this.props.isPagelet?void 0:this.refs.contextMenu.openMenuAtPosition(e,t,s)},handleSelectionChange:function(e){return x.setSelection({selection:e})},handleFileListSortChange:function(e,t){return x.sortFiles({sortField:e,direction:t})},_handleSearch:function(e){return e?x.setUrl({prefix:Se,qargs:{path:ee.path(),query:e}}):x.setUrl({path:ee.path()})},_handleSearchSuggestionOpen:function(e){return e instanceof oe?x.navigateToFileOrFolder({file:e}):e instanceof me?R.open_tab(e.url):void 0},_shouldShowPinnedTeamFolder:function(){var e;return e=this.props.loadingState===de.LOADED,this.props.context.showPinnedTeamFolder&&null!=this.props.teamFolders.first()&&e},_renderSearchResults:function(e){return we(K,{path:this.props.path,user:this.props.user,topMenuItems:e,limitedTeamBannerUpsell:this.props.limitedTeamBannerUpsell,trademarkBusiness:this.props.trademarkBusiness,isPagelet:this.props.isPagelet,onFullSearch:function(e){var t;return e.preventDefault(),t={path:"/",query:I.latestQuery()},x.setUrl({prefix:Se,qargs:t})}})},render:function(){var e,t,s,r,o,i,a,l,u,c,p,h;return p=we(F,{user:this.props.user,currentPath:this.props.path,isPagelet:this.props.isPagelet,isSearchActive:this.props.isSearchMode&&!this.props.isPagelet,onSearch:this._handleSearch,onFileOrFolderOpen:this._handleSearchSuggestionOpen,limitedTeamBannerUpsell:this.props.limitedTeamBannerUpsell,trademarkBusiness:this.props.trademarkBusiness}),h=this.props.isPagelet?Ee.div({className:"top-menu-container"},p,Ee.div({className:"notifications-widget-container"},we(w,{isPagelet:!0})),Ee.div({className:"account-menu-widget-container"},we(E,{user:this.props.user,viewer:C.get_viewer(),onSelectUser:function(e,t){return ensemble.switchAccount(t.id)},showAccountSwitcher:!0,showNameOnButton:!1,arrowPosition:"top-right",openLinksInNewTab:!0}))):p,this.props.isSearchMode?this._renderSearchResults(h):(a=this.props.loadingState!==de.LOADING_FIRST_PAGE&&!this.props.context.isInsideDeletedFolder,l=a&&this.props.context.isInFolderMode&&this.props.context.isInsideSharedFolder,t=a&&this.props.context.cdmMveQuotaStats&&"work"===this.props.user.role&&!this.props.context.isInsideSharedFolder,o=l&&!ce.hasNewMembershipUI(this.props.user.id),r=l&&ce.hasNewMembershipUI(this.props.user.id),s=this.props.context.showSharedFolderCreateTeamPromo,e={"browse-box":!0,list_view:!0,"file-browse":!0,"has-preview-sf-members":o,"has-preview-sf-members--golden-gate":r,"has-preview-sf-members--with-team-promo":l&&s,"has-pinned-team-folder":this._shouldShowPinnedTeamFolder(),"has-cdm-mve-banner":t},Ee.div({id:"browse-box",className:n(e)},Ee.div({id:"browse-header",className:"browse-header"},Ee.div({id:"browse-global-actions-bar",className:"browse__global-actions clearfix u-mar-bottom-m"},we(U,{path:this.props.path,user:this.props.user,selectedFiles:this.props.selectedFiles,isDraggingInternalFiles:this.props.isDraggingInternalFiles,shouldHighlightDropTargets:this.props.isDraggingInternalFiles||this.props.isDraggingExternalFiles&&!this.props.isUploadModalOpen}),h,Ee.div({id:"browse-rightmenu",className:"u-l-fr"},i=null!=this.props.context.currentFQPath,this.props.user&&i?[we(le,{ref:"fileUploader",key:1})]:void 0,!this.props.isPagelet&&this.props.user&&i?[we(ue,{shouldShowDeletedFiles:this.props.shouldShowDeletedFiles,isActionsBarDisabled:this.props.loadingState===de.LOADING_FIRST_PAGE,context:this.props.context,user:this.props.user,onFileUpload:this.showFileUploader,key:0})]:void 0)),l?we(ge,{context:this.props.context,user:this.props.user}):t?we(_,{userQuota:this.props.context.cdmMveQuotaStats}):void 0,this._shouldShowPinnedTeamFolder()?we(fe,{teamFolder:this.props.teamFolders.first(),context:this.props.context,user:this.props.user,selection:this.props.selection,loadingState:this.props.loadingState,activeDropTarget:this.props.activeDropTarget,dropTargetHighlightMode:this._getCurrentDropTargetHighlightMode(),isDraggingInternalFiles:this.props.isDraggingInternalFiles,isDraggingExternalFiles:this.props.isDraggingExternalFiles,isTextSelectable:this.props.isTextSelectable}):void 0),this.props.isPagelet?void 0:[we($,{onActionButtonClick:function(e){return function(){return e.refs.itemListController.getWrappedComponent().focusSelectedRow()}}(this),selectedFiles:this.props.selectedFiles,user:this.props.user,context:this.props.context,actionHandlers:this.props.actionHandlers})],we(pe,{ref:"itemListController",items:this.props.context.showPinnedTeamFolder?this.props.filesWithoutTeamFolders:this.props.files,selection:this.props.selection,selectedFiles:this.props.selectedFiles,onSelectionChange:this.handleSelectionChange,fileRename:this.props.fileRename,user:this.props.user,path:this.props.path,context:this.props.context,loadingState:this.props.loadingState,isTextSelectable:this.props.isTextSelectable,shouldShowDeletedFiles:this.props.shouldShowDeletedFiles,isDraggingInternalFiles:this.props.isDraggingInternalFiles,isDraggingExternalFiles:this.props.isDraggingExternalFiles,isPagelet:this.props.isPagelet,activeDropTarget:this.props.activeDropTarget,dropTargetHighlightMode:this._getCurrentDropTargetHighlightMode(),createNewFolderState:this.props.createNewFolderState,openContextMenuAtPosition:this.openContextMenuAtPosition,activeSortField:null!=(u=this.props.currentSort)?u.sortField:void 0,activeSortDirection:null!=(c=this.props.currentSort)?c.direction:void 0,onSortChange:this.handleFileListSortChange,initialMultiColumnSortField:this.state.currentMultiColumnSortField,actionHandlers:this.props.actionHandlers}),this.props.isPagelet?void 0:we(X,{user:this.props.user,selectedFiles:this.props.selectedFiles,context:this.props.context,shouldShowDeletedFiles:this.props.shouldShowDeletedFiles,onFileUpload:this.showFileUploader,actionHandlers:this.props.actionHandlers,ref:"contextMenu"}),this.props.isPagelet?[we(d,this._getCurrentAppActionsProps())]:void 0))}}),se=S(te,["/static/css/browse/browse-vflMD7V38.css"]),{BrowseApp:Y,BrowseView:te}})}.call(this),function(){define("modules/dirty/react/browse/browse_location",["jquery","external/immutable","external/react","modules/clean/browse_interface","modules/clean/react/sprite","modules/clean/react/sprite_div","modules/clean/filepath","modules/clean/viewer","modules/dirty/react/browse/actions","modules/clean/em_string","modules/clean/react/bubble_menu","modules/core/i18n","modules/clean/react/file_uploader/actions"],function(e,t,s,r,n,o,i,a,l,u,c,p,d){var h,_,m,f,g,b,S,y,v,T,w,E,P,F,I,D,C;return F=r.browse_uri_for_fq_path,g=c.BubbleMenu,b=c.BubbleMenuItem,P=p._,E=d.UploaderActions,C=s.DOM,I=s.createElement,D=s.addons.classSet,y=2.625,v=20,S=1.64,T=37,f=s.createClass({displayName:"BrowseLocation",mixins:[s.addons.PureRenderMixin],propTypes:{path:s.PropTypes.string,user:s.PropTypes.object,selectedFiles:s.PropTypes.instanceOf(t.OrderedSet),isDraggingInternalFiles:s.PropTypes.bool,shouldHighlightDropTargets:s.PropTypes.bool,isBrowseInContentManager:s.PropTypes.bool},getDefaultProps:function(){return{path:"/",selectedFiles:t.OrderedSet(),isDraggingInternalFiles:!1,shouldHighlightDropTargets:!1,isBrowseInContentManager:!1}},_getFirstBreadcrumbName:function(){var e,t,s;return this.props.isBrowseInContentManager?P("Team Folders"):(e=null!=(s=this.props.user.cdm_path)?s:"",t=this.props.path,e?P(t.substr(0,e.length)===e?"Team files":"My files"):i.filename("",a.get_root_name(this.props.user)))},_generateBreadcrumbData:function(){var e,t,s,r,n,o,a,l,c,p,d,h,_,m,f,g,b,y,v,T;for(s=this.props.user.cdm_path,null==s&&(s=""),t="",h=this.props.path,s&&h.substr(0,s.length)===s&&(h=h.substr(s.length),t=s),y=this._getFirstBreadcrumbName(),n=function(){var e,t,s,n;for(s=h.split("/"),n=[],e=0,t=s.length;t>e;e++)r=s[e],r.length>0&&n.push(r);return n}(),e=[{path:t,folderName:y,icon:"work"===this.props.user.role?"work_icon":"personal_icon",alt:P("work"===this.props.user.role?"Work":"Personal")}],o=a=0,_=n.length;_>=0?_>a:a>_;o=_>=0?++a:--a)h=t+("/"+n.slice(0,o+1).join("/")),e.push({path:h,folderName:i.filename(h),icon:"folder_32",alt:P("Folder")});if(e.length<3)return{dropdownCrumbs:[],inlineCrumbs:e,root:e[0]};for(b=null!=(m=null!=(f=e[0])?f.folderName:void 0)?m:"",c=this._getMaxBreadcrumbWidth(b,!1),T=function(){var t,s,n,o;for(o=[],t=0,s=e.length;s>t;t++)r=e[t],o.push(new u(null!=(n=r.folderName)?n:"").length);return o}(),d=1,v=T[e.length-1],o=l=g=e.length-2;(1>=g?1>=l:l>=1)&&(v+=S,v+=T[o],!(v>c));o=1>=g?++l:--l)d+=1;return e.length===d+1&&(d+=1),p=e.length-d,{dropdownCrumbs:e.slice(0,p),inlineCrumbs:e.slice(p),root:e[0]}},_getMaxBreadcrumbWidth:function(e,t){var s;return s=t?y:new u(e).length,v-s},render:function(){var t,s,r,n,o,a,l,u,c;return l=this._generateBreadcrumbData(),r=l.dropdownCrumbs,o=l.inlineCrumbs,c=l.root,a=this._getMaxBreadcrumbWidth(null!=(u=null!=c?c.folderName:void 0)?u:"",r.length>0),t="page-header-text u-l-fl",o.length>1||r.length>0?C.span({},C.h1({className:"ax-visually-hidden"},i.filename(this.props.path)),C.nav({className:t,id:"browse-location","aria-label":P("Folder hierarchy"),role:"navigation"},r.length>0?I(h,{crumbs:r,currentPath:this.props.path,selectedFiles:this.props.selectedFiles,isDraggingInternalFiles:this.props.isDraggingInternalFiles,shouldHighlightDropTargets:this.props.shouldHighlightDropTargets}):void 0,function(){var t,i,l;for(l=[],n=t=0,i=o.length;i>t;n=++t)s=o[n],l.push(I(m,e.extend({},s,{key:encodeURI(s.path),user:this.props.user,isOnlyCrumb:0===n&&1===o.length&&0===r.length,isLastCrumb:n===o.length-1,maxWidth:a,currentPath:this.props.path,selectedFiles:this.props.selectedFiles,isDraggingInternalFiles:this.props.isDraggingInternalFiles,isHighlightedDropTarget:this.props.shouldHighlightDropTargets})));return l}.call(this))):C.h1({className:t},this._getFirstBreadcrumbName())}}),w=s.createClass({displayName:"Spacer",render:function(){return C.span({}," ",I(n,{group:"web",name:"chevron",className:"breadcrumb__spacer",alt:""})," ")}}),m=s.createClass({displayName:"BreadCrumbSegment",propTypes:{path:s.PropTypes.string.isRequired,user:s.PropTypes.object,folderName:s.PropTypes.string.isRequired,isLastCrumb:s.PropTypes.bool.isRequired,isOnlyCrumb:s.PropTypes.bool,maxWidth:s.PropTypes.number.isRequired,currentPath:s.PropTypes.string.isRequired,selectedFiles:s.PropTypes.instanceOf(t.OrderedSet),isDraggingInternalFiles:s.PropTypes.bool,isHighlightedDropTarget:s.PropTypes.bool},getDefaultProps:function(){return{isOnlyCrumb:!1,isDraggingInternalFiles:!1,isHighlightedDropTarget:!1,selectedFiles:t.OrderedSet()}},getInitialState:function(){return{isDraggedOver:!1}},handleMouseEnter:function(e){return this.props.isDraggingInternalFiles?this.setState({isDraggedOver:!0}):void 0},handleMouseLeave:function(e){return this.state.isDraggedOver?this.setState({isDraggedOver:!1}):void 0},handleMouseUp:function(e){return this.state.isDraggedOver?this.setState({isDraggedOver:!1}):void 0},componentDidMount:function(){var t,s;return t=0,s=null,e(this.getDOMNode()).on("dragenter.breadcrumb",function(e){return function(r){return r.preventDefault(),r.target!==s?(s=r.target,t+=1,e.setState({isDraggedOver:!0}),e.props.isLastCrumb?void 0:E.setPath({path:e.props.path})):void 0}}(this)).on("dragleave.breadcrumb",function(e){return function(r){return r.preventDefault(),s=null,t-=1,1>t&&(t=0,e.state.isDraggedOver)?(E.setPath({path:e.props.currentPath}),e.setState({isDraggedOver:!1})):void 0}}(this)).on("drop.breadcrumb",function(e){return function(t){return e.setState({isDraggedOver:!1})}}(this)).on("dragover.breadcrumb",function(e){return e.preventDefault(),e.stopPropagation()}).on("mouseenter.breadcrumb",this.handleMouseEnter).on("mouseleave.breadcrumb",this.handleMouseLeave).on("mouseup.breadcrumb",this.handleMouseUp)},componentWillUnmount:function(){return e(this.getDOMNode()).off(".breadcrumb")},render:function(){var e,t;return t=this.props.isOnlyCrumb?this.props.folderName:u.em_snippet(this.props.folderName,this.props.maxWidth),e={"breadcrumb-segment--is-drop-target":!this.props.isLastCrumb&&this.props.isHighlightedDropTarget,"breadcrumb-segment--file-dragged-over":!this.props.isLastCrumb&&this.state.isDraggedOver},this.props.isLastCrumb?C.span({},t):C.span({},C.a({href:F(this.props.user,this.props.path),onClick:this.navigateToFolder,className:D(e)},t),I(w))},navigateToFolder:function(e){return e.preventDefault(),l.setUrl({path:this.props.path})}}),_=s.createClass({displayName:"BreadCrumbDropdownMenuItem",propTypes:{path:s.PropTypes.string.isRequired,icon:s.PropTypes.string.isRequired,folderName:s.PropTypes.string.isRequired,alt:s.PropTypes.string,isHighlightedDropTarget:s.PropTypes.bool,closeFunc:s.PropTypes.func,isDraggingInternalFiles:s.PropTypes.bool,selectedFiles:s.PropTypes.instanceOf(t.OrderedSet),currentPath:s.PropTypes.string.isRequired},getDefaultProps:function(){return{isHighlightedDropTarget:!1,closeFunc:function(){},alt:"",isDraggingInternalFiles:!1,selectedFiles:t.OrderedSet()}},getInitialState:function(){return{isDraggedOver:!1}},handleMouseEnter:function(e){return this.props.isDraggingInternalFiles?this.setState({isDraggedOver:!0}):void 0},handleMouseLeave:function(e){return this.state.isDraggedOver?this.setState({isDraggedOver:!1}):void 0},handleMouseUp:function(e){return this.state.isDraggedOver&&this.setState({isDraggedOver:!1}),this.props.isDraggingInternalFiles&&!this.props.isLastCrumb?this.props.closeFunc():void 0},componentDidMount:function(){var t,s;return t=0,s=null,e(this.getDOMNode()).on("dragenter.breadcrumbMenuItem",function(e){return function(r){return r.preventDefault(),r.target!==s?(s=r.target,t+=1,e.setState({isDraggedOver:!0}),E.setPath({path:e.props.path})):void 0}}(this)).on("dragleave.breadcrumbMenuItem",function(e){return function(r){return r.preventDefault(),s=null,t-=1,1>t&&(t=0,e.state.isDraggedOver)?(E.setPath({path:e.props.currentPath}),e.setState({isDraggedOver:!1})):void 0}}(this)).on("drop.breadcrumbMenuItem",function(e){return function(t){return e.setState({isDraggedOver:!1})}}(this)).on("dragover.breadcrumbMenuItem",function(e){return e.preventDefault(),e.stopPropagation()}).on("mouseenter.breadcrumbMenuItem",this.handleMouseEnter).on("mouseleave.breadcrumbMenuItem",this.handleMouseLeave).on("mouseup.breadcrumbMenuItem",this.handleMouseUp)},componentWillUnmount:function(){return e(this.getDOMNode()).off(".breadcrumbMenuItem")},handleCrumbClick:function(e){return e.preventDefault(),l.setUrl({path:this.props.path})},render:function(){var e;return e={"breadcrumb-menu-item":!0,"breadcrumb-menu-item--is-drop-target":this.props.isHighlightedDropTarget,"breadcrumb-menu-item--file-dragged-over":this.state.isDraggedOver},I(b,{onClick:this.handleCrumbClick,closeFunc:this.props.closeFunc,className:D(e)},C.span({className:"force-no-break"},I(o,{group:"web",name:this.props.icon,alt:this.props.alt,text:u.em_snippet(this.props.folderName,T)})))}}),h=s.createClass({displayName:"BreadCrumbDropdown",propTypes:{crumbs:s.PropTypes.array.isRequired,currentPath:s.PropTypes.string.isRequired,shouldHighlightDropTargets:s.PropTypes.bool,selectedFiles:s.PropTypes.instanceOf(t.OrderedSet),isDraggingInternalFiles:s.PropTypes.bool},getDefaultProps:function(){return{shouldHighlightDropTargets:!1,selectedFiles:t.OrderedSet(),isDraggingInternalFiles:!1}},componentDidMount:function(){return e(this.getDOMNode()).on("dragenter.breadcrumbDropdown",function(e){return function(t){return t.preventDefault(),e.refs.bubbleMenu.show()}}(this)).on("mouseenter.breadcrumbDropdown",function(e){return function(t){return e.props.isDraggingInternalFiles?(t.preventDefault(),e.refs.bubbleMenu.show()):void 0}}(this))},componentWillUnmount:function(){return e(this.getDOMNode()).off(".breadcrumbDropdown")},render:function(){var e,t,s,r;return t=this.props.crumbs,t.reverse(),r=C.button({className:"u-unbutton breadcrumb-overflow-button u-l-fl"},I(n,{group:"web",name:"folder_arrow_32",alt:P("Show parent folders (descending)")})),s=function(){var s,r,n;for(n=[],s=0,r=t.length;r>s;s++)e=t[s],n.push(I(_,{key:encodeURI(e.path),path:e.path,icon:e.icon,alt:e.alt,folderName:e.folderName,currentPath:this.props.currentPath,isHighlightedDropTarget:this.props.shouldHighlightDropTargets,isDraggingInternalFiles:this.props.isDraggingInternalFiles,selectedFiles:this.props.selectedFiles}));return n}.call(this),C.span({className:"breadcrumb-dropdown-container"},I(g,{ref:"bubbleMenu",arrow_position:"top-left",targetButton:r,items:s}),I(w))}}),f})}.call(this),function(){define("modules/dirty/react/browse/comment_status",["modules/clean/activity/activity","modules/clean/comments/utils","modules/clean/file_activity/api","modules/clean/flux/dispatcher","modules/clean/react/browse/constants","modules/clean/react/browse/store","modules/dirty/react/browse/actions"],function(e,t,s,r,n,o,i){var a,l,u,c,p,d,h,_,m,f,g,b,S,y,v,T,w;return a=e.ActivityContext,l=n.BrowseActionTypes,c=n.FileTypes,u=o.BrowseStore,T={},p=function(e){var t;return s.fetchCommentStatusBatch({actorId:null!=(t=u.user())?t.id:void 0,context:a.BROWSE_FILE_VIEWER,contextDataList:e,isBackgroundRequest:!0})},h=function(e){return null==e.feedback_off&&null==e.comment_count&&null==e.unresolved_comment_count},_=function(e){return e.type===c.FILE},m=function(e){return null!=e.after},d=function(e){var t,s;return t=e.files,s=t.filter(_).filter(h).map(function(e){return e.fq_path}),s.length>0?p(s).then(function(e){return i.addCommentStatusBatch({commentStatusByFqPath:e})}):void 0},y=d,b=d,g=d,S=function(e){var t,s,r;return t=e.fileDeltas,r=e.path,s=t.filter(m).map(function(e){var t;return t=e.after}),d({files:s})},f=function(e){var t;switch(t=e.action,t.type){case l.LOAD_PATH:return y(t.data);case l.ADD_FILES:return b(t.data);case l.INITIALIZE_EVERYTHING:return g(t.data);case l.CHANGE_FILES:return S(t.data)}},v=function(e){return null==e&&(e=r),T={dispatcher:e,dispatchToken:e.register(f)},d({files:u.files().toArray()})},w=function(){return T.dispatcher.unregister(T.dispatchToken),T={}},{setup:v,teardown:w}})}.call(this),function(){define("modules/dirty/react/browse/context_menu",["external/immutable","external/react","external/underscore","modules/dirty/react/browse/file_actions","modules/dirty/react/browse/global_actions","modules/clean/react/browse/models","modules/clean/react/context_menu_v2"],function(e,t,s,r,n,o,i){var a,l,u,c,p,d,h;return d=r.getActionsForFileCollection,h=n.getGlobalActions,a=o.BrowseContext,c=i.GlobalContextMenu,u=i.ContextMenuItem,p=t.createElement,l=t.createClass({displayName:"BrowseContextMenu",propTypes:{context:t.PropTypes.instanceOf(a).isRequired,selectedFiles:t.PropTypes.instanceOf(e.OrderedSet).isRequired,shouldShowDeletedFiles:t.PropTypes.bool,shouldShowGlobalActions:t.PropTypes.bool,user:t.PropTypes.object.isRequired,onFileUpload:t.PropTypes.func,actionHandlers:t.PropTypes.object},getDefaultProps:function(){return{onFileUpload:function(){},actionHandlers:{},shouldShowDeletedFiles:!1,shouldShowGlobalActions:!0}},openMenuAtPosition:function(e,t,s){return null==s&&(s=null),this.refs.contextMenu.openMenuAtPosition(e,t),null!=s?this.elemToFocusAfterClose=s:void 0},closeMenu:function(){return this.refs.contextMenu.closeMenu()},toggleMenu:function(e){return this.refs.contextMenu.toggleMenu(e)},render:function(){var e,t,r,n,o,i,a,l,_,m;if(n=[],this.props.shouldShowGlobalActions&&this.props.selectedFiles.isEmpty())r=h({context:this.props.context,user:this.props.user,showDeletedFiles:this.props.shouldShowDeletedFiles,onFileUpload:this.props.onFileUpload});else{if(this.props.selectedFiles.isEmpty())return null;r=d({files:this.props.selectedFiles,context:this.props.context,user:this.props.user,actionHandlers:this.props.actionHandlers})}for(e=function(e){return u({text:e.label,icon:{group:"web",name:e.spriteName},onClick:e.performAction,href:e.href,isDisabled:e.disabled})},o=0,a=r.length;a>o;o++)t=r[o],l=e(t),(null!=(_=t.subItems)?_.length:void 0)&&(m=s.map(t.subItems,e),l=l.set("subMenuItems",m)),n.push(l);return i=["a:not(.filename-link)","input","button","textarea","select","#notify-wrapper",".db-modal-wrapper",".react-file-viewer",".bubble-dropdown",".pinned-team-folder__file-row"],p(c,{alwaysOpenOnCapture:!0,ignoreSelectors:i.join(),items:n,onMenuClose:function(e){return function(t){var s;return null!=e.elemToFocusAfterClose?("function"==typeof(s=e.elemToFocusAfterClose).focus&&s.focus(),e.elemToFocusAfterClose=null):void 0}}(this),ref:"contextMenu"},this.props.children)}}),{BrowseContextMenu:l}})}.call(this),function(){define("modules/dirty/react/browse/file_actions",["external/underscore","modules/clean/filepath","modules/clean/react/browse/api","modules/clean/react/browse/constants","modules/clean/react/browse/util","modules/clean/react/file_modal_controller","modules/clean/sharing/ui_util","modules/clean/unity/check_file_cache","modules/clean/unity/features","modules/clean/viewer","modules/constants/browse","modules/constants/viewer","modules/core/browser","modules/core/i18n","modules/dirty/react/browse/actions","modules/dirty/react/browse/sharing_shims","modules/dirty/sharing/browse_ui_util","require"],function(e,t,s,r,n,o,i,a,l,u,c,p,d,h,_,m,f,g){var b,S,y,v,T,w,E,P,F,I,D,C,N;return y=r.FileTypes,I=n.getRevisionsUri,S=o.FileModalController,v=i.GoldenGate,T=h._,D=m.hasMultipleSharingOptions,C=m.showShareFolderModal,N=m.showShareLinkModal,b={showTiburonShare:!1,showLegacyShareFolder:!1,showLegacyShareLink:!1,showCopyPublicFolderFileLink:!1,showOpen:!1,showDownload:!1,showComment:!1,showDelete:!1,showRemove:!1,showRename:!1,showMove:!1,showCopy:!1,showPhotos:!1,showVersions:!1,showRestore:!1,showReadd:!1,showPermanentDelete:!1,showRemoveAccess:!1},F=function(t){var s,r,n,o,i,a;return a=t.user,r=t.context,n=t.files,s=e.clone(b),i=n.every(function(e){return!e.isDeleted}),o=!i&&n.every(function(e){return e.isDeleted}),i?E({actions:s,files:n,context:r,user:a}):o?w({actions:s,files:n,context:r}):s},E=function(e){var t,s,r,n,o,i,c,p,d,h,_,m,g,b,S,T;return t=e.actions,n=e.files,s=e.context,T=e.user,h=1===n.count(),_=h&&n.first().is_dir,m=h&&!n.first().is_dir,d=n.some(function(e){return e.type===y.SHARED_FOLDER||e.type===y.TEAM_SHARED_FOLDER}),g=n.some(function(e){return e.type===y.TEAM_SHARED_FOLDER}),i=n.every(function(e){return e.in_root_coll}),p=T.id===(null!=(S=u.get_viewer().photos_user)?S.id:void 0),b=!1,v.canUseRecursiveCopy(T.id)?t.showCopy=!g:t.showCopy=!d,g||(h&&d?t.showRemove=!0:t.showDelete=!0,t.showRename=s.isInFolderMode&&h,t.showMove=!0),h&&(r=n.first(),c=f.fileIsInPublicFolder(s,r),c||(f.isTiburonUIAllowed(T,r,s.isInFolderMode?s:null)?t.showTiburonShare=!0:(o=D(T,r,s),t.showLegacyShareLink=!g,t.showLegacyShareFolder=g||o)),
b=null!=l&&(null!=a?a.is_cached_and_locally_available(r.ns_id,r.ns_path):void 0),b&&(t.showOpen=!0)),m&&(t.showComment=!0,t.showVersions=!0,s.isInFolderMode?t.showCopyPublicFolderFileLink=c:t.showCopyPublicFolderFileLink=!1),t.showPhotos=i&&p,b||(t.showDownload=s.isInFolderMode||m),t},w=function(e){var t,s,r,n,o,i,a,l;return t=e.actions,o=e.files,s=e.context,a=1===o.count()&&o.first().is_dir,l=a?(r=o.first(),s.inactiveNSIDByFQPath[r.fq_path.toLowerCase()]):!1,l?t.showReadd=!0:t.showRestore=!0,s.isInFolderMode?i=s.permanentDeletionDisabledStateByNSID[s.currentNSID]:(n=o.map(function(e){return e.ns_id}),i=n.some(function(e){return s.permanentDeletionDisabledStateByNSID[e]})),i||(l?t.showRemoveAccess=!0:t.showPermanentDelete=!0),t},P=function(r){var n,o,i,a,u,c,p,h,m,b,y,v,w,E,P,D,A,R,O,L,M,x,U,k,B,q,H,G,W,V;return c=r.files,a=r.context,V=r.user,o=r.actionHandlers,W=null!=(B=r.skipSharing)?B:!1,M=null!=(q=r.isPagelet)?q:!1,D=function(){return C(V,c.first(),a)},A=function(){return N(V,c.first(),a,"file_row_sharing_menu")},R=function(){return f.showTiburonUIIfAllowed(V,c.first(),{browseContext:a,origin:"BROWSE_FILE_ROW"})},v=function(){var e;return e=f.getLegacyPublicFolderShareURI(V,c.first(),a),e?g(["dropbox"],function(t){var s;return s=t.BrowseActions,s.showCopyPublicUrlModal(e)}):void 0},y=function(){var e;return e=c.first(),l.open_file(e.ns_id,e.ns_path,V.id,l.standard_open_file_handler,function(e){return l.standard_open_file_handler(!1)})},m=function(){return _.downloadFiles({files:c,context:a,user:V})},p=function(){return _.navigateToFileOrFolder({file:c.first(),shouldFocusComment:!0})},E=function(){return _.showFileRename({file:c.first()})},b=function(){return S.showMove(V,c.toArray(),a.currentFQPath,{onSuccess:null,onUndo:function(){return _.selectRowsFromNotServer(c.toArray())},onRequestNotSent:function(){var e;return _.selectFilesByFqPath({fqPathsToSelect:function(){var t,s,r,n;for(r=c.toArray(),n=[],t=0,s=r.length;s>t;t++)e=r[t],n.push(e.fq_path);return n}()})}})},h=function(){return S.showCopy(V,c.toArray(),{onSuccess:function(e){var t;return t=e.files,_.selectRowsFromNotServer(t)},onUndo:function(){return _.selectRowsFromNotServer(c.toArray())},onRequestNotSent:function(){var e;return _.selectFilesByFqPath({fqPathsToSelect:function(){var t,s,r,n;for(r=c.toArray(),n=[],t=0,s=r.length;s>t;t++)e=r[t],n.push(e.fq_path);return n}()})}})},P=function(){var e,t;return e=1===c.size&&c.first().is_dir,e?(t=s.getRestoreFileUrl({fqPath:c.first().fq_path,userId:V.id}),d.redirect(t)):o.onRestoreMulti()},w=function(){var e,s,r,n;return e=c.first(),r=e.fq_path.toLowerCase(),n=a.inactiveNSIDByFQPath[r],s=t.filename(e.fq_path),n?g(["dropbox"],function(e){var t;return t=e.SharingModel,t.sync_shared_folder(n,V.role,"BROWSE_FILE_ACTIONS",!1,!0)}):void 0},L=function(){return _.viewInPhotos({files:c,user:V})},u=!a.isCurrentPathWriteable(),H=!a.isCurrentPathWriteable(),U=!a.isCurrentPathWriteable(),i=F({files:c,context:a,user:V}),x=[],O=function(){var e;return e=I(c.first().fq_path,V).toString(),d.redirect(e)},n=function(t,s,r,n){var o;return o={label:t,spriteName:s,performAction:r},e.extend(o,n)},M?(i.showTiburonShare&&x.push(n(T("Share"),"s_rainbow",R)),i.showCopyPublicFolderFileLink&&x.push(n(T("Copy Public Link"),"world_link",v)),i.showOpen&&x.push(n(T("Open"),"open",y)),i.showDownload&&x.push(n(T("Download"),"download",m)),i.showComment&&x.push(n(T("Add Comment"),"s_file_comment",p)),i.showVersions&&x.push(n(T("Previous Versions"),"previous_versions",O)),i.showRename&&(k={ref:"rename",disabled:H},x.push(n(T("Rename"),"rename",E,k))),i.showMove&&(k={disabled:U},x.push(n(T("Move"),"move_16",b,k))),i.showCopy&&x.push(n(T("Copy"),"copy",h)),i.showDelete&&(k={disabled:u},x.push(n(T("Delete"),"delete_16",o.onDelete,k))),x):(W||(i.showTiburonShare?x.push(n(T("Share…"),"s_rainbow",R)):(i.showLegacyShareFolder||i.showLegacyShareLink)&&(G=[],i.showLegacyShareFolder&&G.push(n(T("Invite people to collaborate…"),"user_add",D)),i.showLegacyShareLink&&G.push(n(T("Send link…"),"s_link",A)),x.push(n(T("Sharing…"),"s_rainbow",null,{subItems:G})))),i.showCopyPublicFolderFileLink&&x.push(n(T("Copy public link…"),"world_link",v)),i.showOpen&&x.push(n(T("Open"),"open",y)),i.showDownload&&x.push(n(T("Download"),"download",m)),i.showComment&&x.push(n(T("Comment"),"s_file_comment",p)),i.showDelete&&(k={disabled:u},x.push(n(T("Delete..."),"delete_16",o.onDelete,k))),i.showRemove&&(k={disabled:u},x.push(n(T("Remove..."),"delete_16",o.onDelete,k))),i.showRename&&(k={ref:"rename",disabled:H},x.push(n(T("Rename"),"rename",E,k))),i.showMove&&(k={disabled:U},x.push(n(T("Move..."),"move_16",b,k))),i.showCopy&&x.push(n(T("Copy..."),"copy",h)),i.showPhotos&&x.push(n(T("View in Photos"),"s_photo",L)),i.showVersions&&(k={href:I(c.first().fq_path,V).toString()},x.push(n(T("Previous versions"),"previous_versions",null,k))),i.showRestore&&x.push(n(T("Restore…"),"restore",P)),i.showReadd&&x.push(n(T("Re-add shared folder"),"restore",w)),i.showPermanentDelete&&x.push(n(T("Permanently delete…"),"cancel",o.onPermanentDelete)),i.showRemoveAccess&&x.push(n(T("Remove my access"),"cancel",o.onPermanentDelete)),x)},{getActionsForFileCollection:P}})}.call(this),function(){define("modules/dirty/react/browse/folder_list_row",["jquery","external/classnames","external/immutable","external/react","external/underscore","modules/clean/filepath","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/sprite","modules/core/i18n","modules/dirty/react/browse/actions","modules/clean/react/browse/name_input","modules/clean/react/flag","modules/clean/sharing/ui_util","modules/clean/static_urls"],function(e,t,s,r,n,o,i,a,l,u,c,p,d,h,_){var m,f,g,b,S,y,v,T;return b=i.NewFolderCreationState,m=a.BrowseContext,S=u._,f=h.GoldenGate,T=_.static_url,v=r.DOM,y=r.createElement,g=r.createClass({displayName:"NewFolderCreationListRow",mixins:[r.addons.PureRenderMixin],propTypes:{newFolderState:r.PropTypes.oneOf(n.values(b)),context:r.PropTypes.instanceOf(m),user:r.PropTypes.object},_handleCancel:function(){return c.cancelCreateFolder()},_handleSubmit:function(e){return c.createFolder({pathName:this.props.context.currentFQPath,folderName:e})},_renderIcon:function(){var e,t;return e=null!=this.props.user&&f.hasGoldenGateIconography(this.props.user.id),t=o.new_folder_icon(this.props.context.isInsideTeamFolderTree,e),y(l,{group:"web",name:T("/static/images/icons/icon_spacer-vflN3BYt2.gif"),className:"u-pad-right-xs sprite sprite_web browse-file-row__accessory "+t,alt:""})},_renderNewFolderCreationColumn:function(){var e,t;return e=this._renderIcon(),t=v.div({}),this.props.newFolderState===b.PENDING_INPUT?t=y(p,{defaultValue:"",label:S("Folder name"),onSubmit:this._handleSubmit,onCancel:this._handleCancel,className:"browse-file-row__input"}):this.props.newFolderState===b.SAVING_INPUT&&(t=v.div({className:"creating_folder_text",role:"status","aria-live":"polite"},S("Creating new folder…"))),v.div({className:"o-grid__col--1-of-2",role:"gridcell"},y(d,{leftAttachment:e},t))},_renderPlaceholder:function(){return v.div({role:"gridcell"})},render:function(){var e;return e={"browse-file-row":!0,"o-grid":!0,"o-grid--no-gutter":!0,"browse-file-row--is-selected":!0},v.li({className:t(e),role:"row"},this._renderPlaceholder(),this._renderNewFolderCreationColumn(),this._renderPlaceholder(),this._renderPlaceholder(),this._renderPlaceholder())}})})}.call(this),function(){define("modules/dirty/react/browse/global_actions",["external/classnames","external/react","modules/clean/analytics","modules/clean/components/title_bubble","modules/clean/payments/pro_trial_onboarding_tour","modules/clean/css","modules/clean/filepath","modules/dirty/react/browse/actions","modules/dirty/sharing/browse_ui_util","modules/clean/react/browse/api","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/sprite","modules/clean/react/sprite_div","modules/clean/sharing/ui_util","modules/clean/user","modules/constants/browse","modules/clean/react/bubble_menu","modules/core/i18n","require"],function(e,t,s,r,n,o,i,a,l,u,c,p,d,h,_,m,f,g,b,S){var y,v,T,w,E,P,F,I,D,C,N,A,R,O,L,M,x,U;return D=s.SharingExperimentsLogger,F=n.ProOnboardingTooltips,M=l.generateModalSessionId,U=l.showTiburonUIIfAllowed,P=c.NameSpaceAccess,y=p.BrowseContext,C=_.Tiburon,I=_.SharingExperiments,v=g.BubbleMenu,T=g.BubbleMenuItem,N=b._,L=t.DOM,R=t.createElement,O=e,E={INLINE:0,INLINE_WITH_TEXT:1},A=function(e,t){var s;return s="/"===e.currentFQPath,N(t?s?"New Shared Folder":"Share Folder":e.isInsideAutoTeamFolder?"Team folder options…":e.isInsideSharedFolder?"Shared folder options…":s?"Share a folder…":"Share this folder…")},x=function(e){var t,s,r,n,o,l,c,p,d,h,_,m,g,b,y,v,T,w,R,O,L,x,k,B,q,H,G,W;return t=e.context,W=e.user,B=e.showDeletedFiles,L=e.onFileUpload,w=e.isPagelet,T="/"===t.currentFQPath,v=t.isInsideSharedFolder&&t.currentSharedFolderPermissionRole===P.ACCESS_READER,s=E.INLINE,k=E.INLINE,O=f.SUBGROWTH_PRO_ONBOARDING_LAST_SEEN_STEP,o="V1"===f.SUBGROWTH_PRO_ONBOARDING_UPLOAD&&0===O,n="V1"===f.SUBGROWTH_PRO_ONBOARDING_SHARING&&1===O,c=N("Getting started?\nClick here to upload your files to Dropbox"),l=N("Have you tried using Dropbox to collaborate with others?\nClick here to share a project folder"),d=function(e){return D.log(W.id,"CONSOLIDATE_NEW_FOLDER::NEW_FILE_CLICK"),e.preventDefault(),o&&F.setUserOnboardingAttribute(e.currentTarget,O+1),L(e)},h=function(e){return D.log(W.id,"CONSOLIDATE_NEW_FOLDER::NEW_FOLDER_CLICK"),e.preventDefault(),a.nameNewFolder()},b=function(e){return D.log(W.id,"CONSOLIDATE_NEW_FOLDER::SHARE_FOLDER_CLICK"),e.preventDefault(),n&&F.setUserOnboardingAttribute(e.currentTarget,O+1),U(W,t,{origin:"BROWSE_GLOBAL_ACTIONS"})?void 0:S(["dropbox"],function(e){var s,r,n;return s=e.SharingModals,t.isInsideSharedFolder?s.show_shared_folder_options_modal(t.currentFQPath,W):T?(n=M(),D.log(W.id,"SIMPLIFIED_WIZARD_UI::BEGIN_SHARED_FOLDER_WIZARD_FLOW",{modalSessionId:n}),I.simplifiedWizardUI(W.id)?(r=function(){var e,t,s,r;for(s="/",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=t=1;100>=t;e=++t)s+=r.charAt(Math.floor(Math.random()*r.length));return s},U(W,{fqPath:r(),isFolder:!0,exists:!1,origin:"BROWSE_GLOBAL_ACTIONS",inputContentName:!0,modalSessionId:n})):s.show_shared_folder_wizard(W,n)):s.show_share_existing_modal(t.currentFQPath,W)})},g=function(e){return D.log(W.id,"CONSOLIDATE_NEW_FOLDER::SHARE_LINK_CLICK"),e.preventDefault(),U(W,t,{origin:"BROWSE_GLOBAL_ACTIONS"})?void 0:S(["dropbox"],function(e){var s,r;return r=e.SharingShmodel,s=e.Browse,null==s.active_user&&(s.active_user=W),r.shmodel(t.currentFQPath,"global_actions_basic_global_token_share")})},y=function(e){return D.log(W.id,"CONSOLIDATE_NEW_FOLDER::TRASH_CAN_CLICK"),e.preventDefault(),a.setShouldShowDeletedFiles({shouldShowDeletedFiles:!B})},m=function(e){return D.log(W.id,"CONSOLIDATE_NEW_FOLDER::RESTORE_FOLDER_CLICK"),e.preventDefault(),u.redirectToFolderRestore({fqPath:t.currentFQPath,userId:W.id})},_=function(e){var s,r,n;return e.preventDefault(),r=t.currentFQPath.toLowerCase(),n=t.inactiveNSIDByFQPath[r],s=i.filename(t.currentFQPath),n?S(["dropbox"],function(e){var t;return t=e.SharingModel,t.sync_shared_folder(n,W.role,"BROWSE_GLOBAL_ACTIONS")}):void 0},R=[],t.isInsideDeletedSharedFolder?R.push({label:N("Re-add shared folder"),spriteName:"restore",performAction:_,style:s}):t.isInsideDeletedFolder||t.isInsideDeletedNestedSharedFolder?R.push({label:N("Restore folder"),spriteName:"restore",performAction:m,style:s}):(G=N(w?T?"Upload File":"Upload Files":"Upload…"),H={label:G,tooltip:o?c:void 0,spriteName:"upload_16",performAction:d,disabled:v,active_onboarding_step:o,style:s},p={label:N(w?"New Folder":"New folder"),spriteName:"folder_add",performAction:h,disabled:v,style:s},x={label:A(t,w),tooltip:n?l:void 0,spriteName:"rainbow_16",performAction:b,active_onboarding_step:n,style:k},I.consolidateNewFolder(W.id)&&T&&(r=[{label:N("Folder"),sublabel:N("For private files"),spriteName:"folder_32",performAction:h,disabled:v,style:s},{label:N("Shared folder"),sublabel:N("For collaborating on a project"),spriteName:"folder_user_32",performAction:b,style:k}],p={label:N("New folder…"),spriteName:"folder_add",dropdownItems:r,disabled:v,active_onboarding_step:n,style:s},x=null),R=w?T?R.concat([H,x,p]):R.concat([x,H,p]):R.concat([H,p,x]),R=R.filter(function(e){return null!=e}),T||C.foldersUI(W)||R.push({label:N("Share link…"),spriteName:"s_link",performAction:g,style:s}),f.HIDE_TRASH_CAN_BUTTON||(q=N(w?B?"Hide Deleted Files":"Show Deleted Files":B?"Hide deleted files":"Show deleted files"),R.push({label:q,spriteName:B?"trash-can-open":"trash-can",performAction:y,style:s}))),R},w=t.createClass({displayName:"GlobalActions",propTypes:{shouldShowDeletedFiles:t.PropTypes.bool.isRequired,context:t.PropTypes.instanceOf(y).isRequired,user:t.PropTypes.instanceOf(m).isRequired,onFileUpload:t.PropTypes.func.isRequired,isActionsBarDisabled:t.PropTypes.bool.isRequired},_renderButton:function(e){var t,s,r,n,o,i;return s=e.buttonClasses,n=e.message,i=e.spriteName,o=e.onClick,r=e.disabled,t=L.button({className:O(s),disabled:r,onClick:o},R(d,{className:"global-actions__button-sprite",group:"web",name:i,alt:n})),r||(t=this._wrapWithTitleBubble(t,n)),t},_renderButtonWithText:function(e){var t,s,r,n,o;return t=e.buttonClasses,r=e.message,o=e.spriteName,n=e.onClick,s=e.disabled,L.button({className:O(t,"button-as-link"),disabled:s,onClick:n},R(h,{className:"global-actions__button-sprite",group:"web",name:o,text:r,alt:"",spritePosition:"left"}))},_wrapWithTitleBubble:function(e,t){return R(r,{text:t,direction:"south",respectLineBreaks:!0},e)},_wrapInlineButton:function(e,t){return L.li({className:"global-actions__action",key:t},e)},_renderInlineItem:function(e){var t,s,r;switch(s={"global-actions__button":!0,"sprite-button":!0,"global-actions__button--onboarding":null!=e.active_onboarding_step},r={buttonClasses:s,message:e.tooltip||e.label,spriteName:e.spriteName,onClick:e.performAction,disabled:e.disabled||this.props.isActionsBarDisabled},e.style){case E.INLINE_WITH_TEXT:t=this._renderButtonWithText(r);break;default:t=this._renderButton(r)}return null!=e.dropdownItems&&(t=this._renderDropdownButton(t,e.dropdownItems)),t},_renderDropdownButton:function(e,t){var s;return s=["global-actions__button","global-actions__button__action--dropdown-link","sprite-button","u-mar-left-xs"],R(v,{className:"global-actions__dropdown",targetButton:e,items:this._renderDropdownItems(t),arrow_position:"top-left",vertical_displacement:8})},_renderDropdownItems:function(e){var t,s,r,n,o,i;for(t=[],n=0,o=e.length;o>n;n++)r=e[n],i=r.tooltip||r.label,s=r.disabled||this.props.isActionsBarDisabled,t.push(R(T,{onClick:r.performAction,disabled:s},L.div({className:"sprite-div"},L.div({className:O(["sprite-frame","small","icon-left"])},R(d,{alt:"",group:"web",name:r.spriteName})),L.div({className:O(["sprite-text"])},L.h3({className:O(["global-actions__dropdown__item-label","u-trim-margin","u-font-strong"])},r.label),L.p({className:O(["global-actions__dropdown__item-sublabel","u-font-meta"])},r.sublabel)))));return t},render:function(){var e,t,s,r,n,o;return o=x({context:this.props.context,user:this.props.user,showDeletedFiles:this.props.shouldShowDeletedFiles,onFileUpload:this.props.onFileUpload}),t=function(){var e,t,s;for(s=[],e=0,t=o.length;t>e;e++)n=o[e],s.push(this._renderInlineItem(n));return s}.call(this),s={"global-actions":!0,"u-mar-top-xs":!0},L.div({className:O(s)},L.ul({className:"horizontal"},function(){var s,n,o;for(o=[],r=s=0,n=t.length;n>s;r=++s)e=t[r],o.push(this._wrapInlineButton(e,r));return o}.call(this)))}}),{getGlobalActions:x,GlobalActions:w}})}.call(this),function(){define("modules/dirty/react/browse/item_list",["jquery","external/classnames","external/immutable","external/keymaster","external/react","external/underscore","modules/clean/components/loading_indicator","modules/clean/filepath","modules/clean/keycode","modules/clean/react/browse/constants","modules/clean/react/browse/file_list_empty_folder","modules/clean/react/browse/internal_drag_status","modules/clean/react/browse/keyboard_shortcuts","modules/clean/react/browse/models","modules/clean/react/browse/file_list_utils","modules/clean/react/columnheader","modules/clean/react/css","modules/clean/react/file_modal_controller","modules/clean/react/file_uploader/actions","modules/clean/react/file_uploader/store","modules/clean/react/helpers","modules/clean/react/modal","modules/clean/react/outside_event","modules/clean/react/selectable_list","modules/clean/react/sprite","modules/clean/search/actions","modules/clean/sharing/ui_util","modules/clean/undo","modules/clean/viewer","modules/core/accessible_announce","modules/core/browser","modules/core/i18n","modules/core/notify","modules/dirty/react/browse/actions","modules/dirty/react/browse/item_list_row","modules/dirty/react/browse/folder_list_row","modules/dirty/react/file_viewer/controller","modules/clean/react/browse/file_jump","modules/clean/unity_browse_interface"],function(e,t,s,r,n,o,i,a,l,u,c,p,d,h,_,m,f,g,b,S,y,v,T,w,E,P,F,I,D,C,N,A,R,O,L,M,x,U,k){var B,q,H,G,W,V,j,K,z,Q,Y,J,X,$,Z,ee,te,se,re,ne,oe,ie,ae,le,ue,ce,pe,de,he,_e,me,fe,ge,be,Se,ye;return W=u.Direction,q=u.BrowseSortField,V=u.DropTargetHighlightMode,J=u.FileTypes,re=u.LoadingStates,oe=u.NewFolderCreationState,ee=p.InternalDragStatus,j=h.File,ae=h.Paper,B=h.BrowseContext,Y=h.FileRename,z=_.FileListHelpers,H=m.ColumnHeader,G=m.ColumnTypes,ue=m.SortDirections,Q=g.FileModalController,ce=b.UploaderActions,$=S.INTERNAL_FILE_DATA_TRANSFER_TYPE,Se=y.shallowCompareStateAndProps,ne=v.Modal,de=T.addOutsideEventHandling,_e=w.createSelectableList,me=w.createSelection,X=F.GoldenGate,pe=A._,K=L.FileItemRow,le=L.PaperItemRow,fe=n.DOM,he=n.createElement,Z="ItemList",ie="",ge={},te=_e(n.createClass({displayName:"ItemList",propTypes:{user:n.PropTypes.object.isRequired,context:n.PropTypes.instanceOf(B).isRequired,path:n.PropTypes.string.isRequired,isPagelet:n.PropTypes.bool,selectedFiles:n.PropTypes.instanceOf(s.OrderedSet),isBrowseInContentManager:n.PropTypes.bool,isRenaming:n.PropTypes.bool,openContextMenuAtPosition:n.PropTypes.func,onFocus:n.PropTypes.func,focusSelectedRow:n.PropTypes.func,className:n.PropTypes.string,actionHandlers:n.PropTypes.object},getDefaultProps:function(){return{isPagelet:!1,selectedFiles:s.OrderedSet(),isDraggingExternalFiles:!1,activeDropTarget:!1,isRenaming:!1,onFocus:o.noop,isBrowseInContentManager:!1,className:null,actionHandlers:{}}},componentWillMount:function(){return this.isFocused=!1},componentDidMount:function(){return e(document).on("keydown.ItemList",this.handleKeyDown).on("keypress.ItemList",this.handleKeyPress).on("keyup.ItemList",this.handleKeyUp),this._setupFocusHandler(),this._setupExternalDragHandler(),this._setupKeyboardShortcuts()},componentWillUnmount:function(){return key.clearScope(Z),key.setScope(ie),e(document).off(".ItemList"),e(this.getDOMNode()).off(".ItemList")},_setupFocusHandler:function(){var t;return t=e(this.getDOMNode()),t.on("focusin.ItemList",function(e){return function(){return e.isFocused=!0,e.props.onFocus(),!0}}(this)),t.on("focusout.ItemList",function(e){return function(){return e.isFocused=!1,!0}}(this))},_setupExternalDragHandler:function(){return e(document).on("dragenter.ItemList",function(t){return function(s){return(t.props.isDraggingExternalFiles||t.props.isDraggingInternalFiles)&&!e(s.target).closest(".browse-file-row").length&&t.props.activeDropTarget?(O.setDropTarget({target:null}),ce.setPath({path:t.props.path,hasPermissionToUploadToFolder:t.props.context.isCurrentPathWriteable()})):void 0}}(this))},_setupKeyboardShortcuts:function(){var t,s,r,n,o,i,a,l,u,c,p,h,_;return ie=key.getScope(),key.setScope(Z),o=function(e){return function(t){return e.isFocused&&"BUTTON"!==t.target.tagName}}(this),n=function(e){return function(t){return!document.activeElement||document.activeElement===document.body||e.getDOMNode().contains(t.target)}}(this),r=function(e,t){var s;return s=function(s){return e(s)?(s.preventDefault(),"function"==typeof t?t(s):void 0):void 0}},l=function(e){return function(){return 1===e.props.selectedFiles.size&&e.props.selectedFiles.first().is_dir?O.navigateToFileOrFolder({file:e.props.selectedFiles.first()}):void 0}}(this),a=function(e){return function(){return 1===e.props.selectedFiles.size?O.navigateToFileOrFolder({file:e.props.selectedFiles.first(),onFileViewerUnmount:e.props.focusSelectedRow}):void 0}}(this),c=function(e){return function(){var t;return 1===e.props.selectedFiles.size?e.props.context.isCurrentPathWriteable()?(t=e.props.selectedFiles.first(),t.isDeleted?R.error(pe("Deleted files can’t be renamed.")):O.showFileRename({file:t})):R.warning(pe("You don’t have permission to rename files in this folder.")):void 0}}(this),t=function(){return O.copySelectedFilesToClipboard()},u=function(){return O.pasteClipboardFilesToCurrentPath()},_=function(){return I.perform_undo()},h=function(){var e;return e=he(d),ne.showInstance(e)},i=function(){return O.navigateToParentFolder()},p=function(t){return function(s){var r,n,o,i,a,l;return t.props.selectedFiles.size?(l=e(s.target).closest(".browse-file-row--is-selected").first(),l.length?(i=l[0].offsetLeft+200,a=l[0].offsetTop+5,o=l.get(0),"function"==typeof(r=t.props).openContextMenuAtPosition?r.openContextMenuAtPosition(i,a,o):void 0):void 0):"function"==typeof(n=t.props).openContextMenuAtPosition?n.openContextMenuAtPosition(10,10):void 0}}(this),s=function(){return e(".search-bar__text-input").focus()},key("right",Z,r(o,l)),key("enter",Z,r(o,a)),key("f2",Z,r(o,c)),key("left",Z,r(n,i)),key("/",Z,r(n,s)),key("alt+a",Z,r(n,p)),key("shift+/",Z,r(n,h)),N.mac?(key("command+c",Z,r(o,t)),key("backspace",Z,r(o,this.props.actionHandlers.onDelete)),key("command+v",Z,r(n,u)),key("command+z",Z,r(n,_))):(key("ctrl+c",Z,r(o,t)),key("delete",Z,r(o,this.props.actionHandlers.onDelete)),key("ctrl+v",Z,r(n,u)),key("ctrl+z",Z,r(n,_)))},handleKeyDown:function(e){var t,s;return t=null!=(s=e.which)?s:e.keyCode,t===l.CONTROL||t===l.ALT?O.setCopyMode({copyMode:!0}):void 0},handleKeyPress:function(e){return key.getScope()===Z?U.handleKeyPress(e):void 0},handleKeyUp:function(e){var t,s;return t=null!=(s=e.which)?s:e.keyCode,t===l.CONTROL||t===l.ALT?O.setCopyMode({copyMode:!1}):void 0},getFocusHandler:function(e){return function(t){return function(){return t.isFocused=e,!0}}(this)},render:function(){var e;return e=t(this.props.className,{"browse-files o-list-ui":!this.props.isBrowseInContentManager,"browse-files__content-manager":this.props.isBrowseInContentManager,"browse-files--single-selection":1===this.props.selectedFiles.size}),fe.ul({className:e,role:"presentation",onMouseMove:this.handleMouseMove},this.props.children)}})),se=n.createClass({displayName:"ItemListController",propTypes:{context:n.PropTypes.instanceOf(B).isRequired,items:n.PropTypes.instanceOf(s.List).isRequired,user:n.PropTypes.object.isRequired,path:n.PropTypes.string.isRequired,isPagelet:n.PropTypes.bool,isSearchMode:n.PropTypes.bool,selection:n.PropTypes.shape({selected:n.PropTypes.instanceOf(s.OrderedSet),anchor:n.PropTypes.string}),selectedFiles:n.PropTypes.instanceOf(s.OrderedSet),createNewFolderState:n.PropTypes.oneOf(o.values(oe)),customEmptyFolderView:n.PropTypes.func,dropTargetHighlightMode:n.PropTypes.oneOf(function(){var e;e=[];for(be in V)ye=V[be],e.push(ye);return e}()),fileRename:Y.propTypes,isArchiveState:n.PropTypes.bool,isBrowseInContentManager:n.PropTypes.bool,isSyncColumnVisible:n.PropTypes.bool,isTextSelectable:n.PropTypes.bool,loadingState:n.PropTypes.oneOf(o.values(re)),mostRecentlyDraggedOverFile:n.PropTypes.instanceOf(j),openContextMenuAtPosition:n.PropTypes.func,isDraggingExternalFiles:n.PropTypes.bool,isDraggingInternalFiles:n.PropTypes.bool,activeDropTarget:n.PropTypes.object,onSelectionChange:n.PropTypes.func,showFilenameHighlights:n.PropTypes.bool,disableColumnDetail:n.PropTypes.bool,enableDoubleClickTraversal:n.PropTypes.bool,onFocus:n.PropTypes.func,settingsGearMenuAlt:n.PropTypes.string,settingsGearMenuItems:n.PropTypes.arrayOf(n.PropTypes.shape({label:n.PropTypes.string,action:n.PropTypes.func})),activeSortField:n.PropTypes.oneOf(o.values(q)),activeSortDirection:n.PropTypes.oneOf(o.values(ue)),onSortChange:n.PropTypes.func,initialMultiColumnSortField:n.PropTypes.string,actionHandlers:n.PropTypes.object},getDefaultProps:function(){return{isPagelet:!1,isSearchMode:!1,selection:me(),selectedFiles:s.OrderedSet(),createNewFolderState:oe.CREATE_FOLDER_INACTIVE,customEmptyFolderView:null,dropTargetHighlightMode:V.NONE,fileRename:null,isArchiveState:!1,isColumnHeaderVisible:!0,isMultiColumnGroupVisible:!0,isBrowseInContentManager:!1,isPaginating:!1,isSyncColumnVisible:!1,isTextSelectable:!0,mostRecentlyDraggedOverFile:null,shouldHighlightDropTargets:!1,shouldHighlightNonselectedDropTargets:!1,showFilenameHighlights:!1,disableColumnDetails:!1,enableDoubleClickTraversal:!0,isDraggingExternalFiles:!1,isDraggingInternalFiles:!1,onFocus:o.noop,activeSortField:null,activeSortDirection:null,onSortChange:o.noop,initialMultiColumnSortField:null}},getInitialState:function(){return{activeMultiColumnField:this.props.initialMultiColumnSortField}},componentDidMount:function(){var e,t;return this.props.selection.selected.size&&!x.isShown()?(e=this.props.selection.selected.first(),t=this.getIndexOfItem(e),this.scrollItemRowsIntoView([t])):void 0},shouldComponentUpdate:Se,componentDidUpdate:function(e){var t;return k.browse_visible_change_callback(this.props.items.toArray(),this.props.user.id,0,this.props.items.size-1),t=this.props.selection.selected.subtract(e.selection.selected),t.size&&!x.isShown()&&this.scrollItemRowsIntoView(t.map(this.getIndexOfItem).toArray()),this.props.createNewFolderState!==oe.CREATE_FOLDER_INACTIVE&&this.scrollItemRowsIntoView([0]),e.loadingState!==this.props.loadingState&&this.props.loadingState===re.LOADED?C.polite(pe("Finished loading files")):void 0},focusSelectedRow:function(){var t,s,r;return s=this.props.selectedFiles.first(),s&&(r=this.getIndexOfItem(s.fq_path),t=e(this.getDOMNode()).find(".browse-files .browse-file-row:eq("+r+")"),!t.is(":focus"))?t.focus():void 0},getIndexOfItem:function(e){var t;return t=this.props.items.findIndex(function(t){return t instanceof j?a.paths_are_equal(t.fq_path,e):t instanceof ae?t.pad_id===e:void 0})},scrollItemRowsIntoView:function(t){var s,r,n,o,i,a,l,u,c,p,d,h,_,m;if(0!==t.length){for(s=e(this.getDOMNode()).find(".browse-files"),i="fixed"===e(".browse-header").css("position"),m=i?parseInt(s.css("paddingTop"))||142:0,n=e(window),o=n.height(),h=n.scrollTop(),_=null,l=0,u=t.length;u>l;l++)if(a=t[l],r=e(this.getDOMNode()).find(".browse-file-row:eq("+a+")"),0!==r.length)if(d=r.offset().top-h,p=r.height(),c=d+p,m>d)null==_&&(_=h-(m-d));else{if(!(c>o))return;null==_&&(_=h+(c-o))}return null!=_?n.scrollTop(_):void 0}},getSharedWithTitle:function(){return pe(X.hasNewMembershipUI(this.props.user.id)?"Members":this.props.context.isInsideSharedFolder?"Additional sharing":"Shared with")},_getColumns:function(){return[{type:G.STATIC,label:pe("Row selection"),headerClassName:"ax-visually-hidden"},{type:G.SINGLE,label:pe("Name"),headerClassName:"o-grid__col o-grid__col--6-of-12",sortField:q.FILENAME},{type:G.SINGLE,label:pe("Modified"),headerClassName:"o-grid__col o-grid__col--3-of-12",sortField:q.MODIFIED},{type:G.MULTI,columns:[{label:this.getSharedWithTitle(),headerClassName:"o-grid__col o-grid__col--3-of-12",sortField:q.SHARED_WITH},{label:pe("Kind"),headerClassName:"o-grid__col o-grid__col--3-of-12",sortField:q.CATEGORY},{label:pe("Extension"),headerClassName:"o-grid__col o-grid__col--3-of-12",sortField:q.EXTENSION},{label:pe("Size"),headerClassName:"o-grid__col o-grid__col--3-of-12",sortField:q.SIZE}]},{type:G.STATIC,label:pe("Actions"),headerClassName:"ax-visually-hidden"}]},handleDragStart:function(e,t){var s,r,n,o,i;return i=null!=t?t:this.props.selectedFiles.toArray(),X.canDeepNest(this.props.user.id)&&(r=i.some(function(e){return j.isTeamSharedFolder(e)}))?void R.error(pe("Team Folders can’t be moved.")):(n={userId:this.props.user.id,fromPath:this.props.path,filePaths:function(){var e,t,s;for(s=[],e=0,t=i.length;t>e;e++)o=i[e],s.push(o.fq_path);return s}()},null!=e.dataTransfer?("function"==typeof(s=e.dataTransfer).setDragImage&&s.setDragImage(this.refs.dragIcon.getDOMNode(),-10,-10),e.dataTransfer.setData($,JSON.stringify(n)),e.dataTransfer.effectAllowed="copyMove"):void 0)},_renderPaperRow:function(e){return he(le,{paper:e,key:e.pad_id,showTitleHighlights:!0,isPagelet:this.props.isPagelet})},_renderFileRow:function(e,t){var s,r,n,o,i,a,l;return r=z.shouldFileBeHighlightedDropTarget({file:e,isSelected:this.props.selection.selected.has(e.fq_path),dropTargetHighlightMode:this.props.dropTargetHighlightMode}),o=e===this.props.activeDropTarget,(null!=(i=this.props.fileRename)?i.file:void 0)===e&&(l=null!=(a=this.props.fileRename)?a.state:void 0),n=[e.hashCode(),t,l,r,o,this.props.selectedFiles.count()>0].join("_"),n in ge?ge[n]:(s=he(K,{selectableListId:e.fq_path,key:encodeURI(e.fq_path),file:e,user:this.props.user,shouldFocus:this.props.selection.selected.last()===e.fq_path||!this.props.selection.selected.size&&0===t,enableDoubleClickTraversal:this.props.enableDoubleClickTraversal,isPagelet:this.props.isPagelet,isSearchMode:this.props.isSearchMode,isDraggingInternalFiles:this.props.isDraggingInternalFiles,isDraggingExternalFiles:this.props.isDraggingExternalFiles,isAvailableDropTarget:r,isActiveDropTarget:o,isArchiveState:this.props.isArchiveState,isModifiedColumnVisible:this.props.isModifiedColumnVisible,isSyncColumnVisible:this.props.isSyncColumnVisible,isMultiColumnGroupVisible:this.props.isMultiColumnGroupVisible,isTextSelectable:this.props.isTextSelectable,context:this.props.context,renameState:l,settingsGearMenuAlt:this.props.settingsGearMenuAlt,settingsGearMenuItems:this.props.settingsGearMenuItems,showColumnDetail:!this.props.isColumnHeaderVisible&&!this.props.disableColumnDetails,showFilenameHighlights:this.props.showFilenameHighlights,showCheckboxes:this.props.selectedFiles.count()>0,onDragStart:this.handleDragStart}),ge[n]=s,s)},_renderLoadingIndicator:function(e){return fe.div({className:"u-font-center u-pad-top-m",key:"loadingIndicator"},he(i,{style:i.LoadingIndicatorStyle.BLUE_SPINNER,startMessage:e}))},_renderEmptyFolder:function(){var e;return e=this.props.context.isInsideAutoTeamFolder&&1===this.props.path.match(/\//g).length,he(c,{currentSharedFolderPermissionRole:this.props.context.currentSharedFolderPermissionRole,isArchiveState:this.props.isArchiveState,isBrowseInContentManager:this.props.isBrowseInContentManager,isInsideSharedFolder:this.props.context.isInsideSharedFolder,isViewingTeamFolder:e,isInCdmMve:Boolean(this.props.context.cdmMveQuotaStats),userId:this.props.user.id,userFamiliarName:this.props.user.familiar_name})},_getPerformanceHackColumnClassName:function(){switch(this.state.activeMultiColumnField){case q.SHARED_WITH:return"is-sharedwith-column-visible";case q.CATEGORY:return"is-kind-column-visible";case q.EXTENSION:return"is-extension-column-visible";case q.SIZE:return"is-size-column-visible"}},_renderItemList:function(e,t){var s;return he(te,{ref:"itemList",user:this.props.user,path:this.props.path,context:this.props.context,isPagelet:this.props.isPagelet,selectedFiles:this.props.selectedFiles,isBrowseInContentManager:this.props.isBrowseInContentManager,isRenaming:!!this.props.fileRename,openContextMenuAtPosition:this.props.openContextMenuAtPosition,isDraggingExternalFiles:this.props.isDraggingExternalFiles,isDraggingInternalFiles:this.props.isDraggingInternalFiles,activeDropTarget:this.props.activeDropTarget,keyScope:Z,linkedOutsideClasses:[".bubble-menu-item-wrapper",".browse-menu",".context-menu",".react-file-viewer",".db-modal"],selection:this.props.selection,onFocus:this.props.onFocus,onSelectionChange:this.props.onSelectionChange,focusSelectedRow:this.focusSelectedRow,
className:this._getPerformanceHackColumnClassName(),actionHandlers:this.props.actionHandlers,isCheckboxes:this.props.isPagelet},t?he(M,{newFolderState:this.props.createNewFolderState,context:this.props.context,user:this.props.user}):void 0,this.props.loadingState===re.LOADING_FIRST_PAGE?this._renderLoadingIndicator(pe("Loading files…")):e.length||t?this._renderItemRows(e):("function"==typeof(s=this.props).customEmptyFolderView?s.customEmptyFolderView():void 0)||this._renderEmptyFolder())},_renderItemRows:function(e){var t,s,r,n,o;for(o=[],t=r=0,n=e.length;n>r;t=++r)s=e[t],s instanceof j?o.push(this._renderFileRow(s,t)):s instanceof ae&&o.push(this._renderPaperRow(s));return this.props.loadingState===re.LOADING_REMAINING_PAGES&&o.push(this._renderLoadingIndicator(pe("Loading files…"))),o},handleMultiColumnChange:function(e){return this.setState({activeMultiColumnField:e.sortField})},renderColumnHeader:function(){var e;return e=["browse-file-list-header o-grid o-grid--no-gutter",{"ax-visually-hidden":this.props.selection.selected.size}],he(H,{columns:this._getColumns(),className:t(e),tabbable:!this.props.selection.selected.size,disabled:this.props.loadingState!==re.LOADED,activeSortField:this.props.activeSortField,initialMultiColumnSortField:this.state.activeMultiColumnField,activeSortDirection:this.props.activeSortDirection,onSortChange:this.props.onSortChange,onMultiColumnChange:this.handleMultiColumnChange})},render:function(){var e,t;return t=this.props.items.toArray(),e=this.props.createNewFolderState!==oe.CREATE_FOLDER_INACTIVE,fe.div({role:"grid","aria-readonly":"true"},this.props.isColumnHeaderVisible?this.renderColumnHeader():void 0,this._renderItemList(t,e),fe.div({className:"offscreen-drag-icon",ref:"dragIcon"},this.props.selectedFiles.count()?he(ee,{files:this.props.selectedFiles.toArray()}):void 0))}}),{ItemListController:f(se,["/static/css/scooter/scooter-scoped-vfl6M_UYZ.css","/static/css/components/loading_indicator-vflbadB1S.css","/static/css/browse/browse-vflMD7V38.css"]),ItemList:te}})}.call(this),function(){define("modules/dirty/react/browse/item_list_row",["jquery","external/underscore","external/classnames","external/immutable","external/react","modules/clean/analytics","modules/clean/browse_interface","modules/clean/css","modules/clean/filepath","modules/clean/keycode","modules/clean/viewer","modules/clean/react/browse/constants","modules/clean/react/browse/name_input","modules/clean/react/browse/settings_gear_menu","modules/clean/react/browse/models","modules/clean/react/browse/store","modules/clean/react/browse/render_partials","modules/clean/react/file_uploader/actions","modules/clean/react/react_i18n","modules/clean/react/selectable_list","modules/clean/react/sprite","modules/clean/search/search_helpers","modules/constants/env","modules/core/browser","modules/core/i18n","modules/core/uri","modules/dirty/react/browse/actions","modules/dirty/react/browse/share_button","modules/dirty/react/browse/shared_with","modules/dirty/sharing/browse_ui_util","modules/clean/react/flag","modules/clean/react/helpers"],function(e,t,s,r,n,o,i,a,l,u,c,p,d,h,_,m,f,g,b,S,y,v,T,w,E,P,F,I,D,C,N,A){var R,O,L,M,x,U,k,B,q,H,G,W,V,j,K,z,Q,Y,J,X,$,Z,ee,te;return j=o.TeamsWebActionsLogger,Y=i.browse_uri_for_fq_path,Z=i.get_browse_root_name,H=p.RenameStates,U=p.FileTypes,G=h.SettingsGearMenuBubble,L=_.File,R=_.BrowseContext,k=_.Paper,O=m.BrowseStore,M=f.FileIcon,K=g.UploaderActions,q=b.R_,X=S.createSelection,z=T.WEBSERVER,Q=E._,W=I.ShareButton,V=D.SharedWithController,ee=C.isShareButtonEnabled,te=A.shallowCompareStateAndProps,$=n.DOM,J=n.createElement,x=n.createClass({displayName:"FileItemRow",propTypes:{context:n.PropTypes.instanceOf(R).isRequired,file:n.PropTypes.instanceOf(L).isRequired,user:n.PropTypes.object,columnClasses:n.PropTypes.string,shouldFocus:n.PropTypes.bool,enableDoubleClickTraversal:n.PropTypes.bool,isPagelet:n.PropTypes.bool,isSearchMode:n.PropTypes.bool,isSelected:n.PropTypes.bool,isDraggingInternalFiles:n.PropTypes.bool,isDraggingExternalFiles:n.PropTypes.bool,isAvailableDropTarget:n.PropTypes.bool,isActiveDropTarget:n.PropTypes.bool,isArchiveState:n.PropTypes.bool,isTextSelectable:n.PropTypes.bool,isMultiColumnGroupVisible:n.PropTypes.bool,isSyncColumnVisible:n.PropTypes.bool,isModifiedColumnVisible:n.PropTypes.bool,renameState:n.PropTypes.oneOf(t.values(H)),showColumnDetail:n.PropTypes.bool,showFilenameHighlights:n.PropTypes.bool,showCheckboxes:n.PropTypes.bool,settingsGearMenuAlt:n.PropTypes.string,settingsGearMenuItems:n.PropTypes.arrayOf(n.PropTypes.shape({label:n.PropTypes.string,action:n.PropTypes.func})),onMouseEnter:n.PropTypes.func,onMouseDown:n.PropTypes.func,onMouseUp:n.PropTypes.func,onDragStart:n.PropTypes.func,onToggleRowSelected:n.PropTypes.func},getDefaultProps:function(){return{columnClasses:"browse-file-row__column o-grid__col o-grid__col--am",isPagelet:!1,isSearchMode:!1,isSelected:!1,shouldFocus:!1,enableDoubleClickTraversal:!0,isDraggingInternalFiles:!1,isDraggingExternalFiles:!1,isAvailableDropTarget:!1,isActiveDropTarget:!1,isArchiveState:!1,isTextSelectable:!0,renameState:null,isMultiColumnGroupVisible:!0,isSyncColumnVisible:!1,isModifiedColumnVisible:!0,showColumnDetail:!1,showFilenameHighlights:!1,showCheckboxes:!1,onMouseEnter:null,onMouseDown:null,onMouseUp:null,onToggleRowSelected:null,onDragStart:function(){}}},getInitialState:function(){return{hasThumbErrored:!1,wasSelectedBeforeMostRecentMouseDown:!1,shouldShowSettingsBubble:!1}},componentDidMount:function(){return a.require_css("/static/css/scooter/scooter-scoped-vfl6M_UYZ.css"),this.focusIfSelected(),e(this.getDOMNode()).on("dragenter.fileRow",function(e){return function(t){var s;if(e.props.isDraggingExternalFiles||e.props.isDraggingInternalFiles){if(s=e.props.file.is_dir&&!(e.props.isSelected&&e.props.isDraggingInternalFiles)){if(e.props.isActiveDropTarget)return;return F.setDropTarget({target:e.props.file}),K.setPath({path:e.props.file.fq_path,hasPermissionToUploadToFolder:!e.props.file.is_read_only_mount&&e.props.context.isCurrentPathWriteable()})}return F.setDropTarget({target:null}),K.setPath({path:O.path(),hasPermissionToUploadToFolder:e.props.context.isCurrentPathWriteable()})}}}(this)).on("focusin.fileRow",function(e){return function(t){return e.state.focusedIn?void 0:e.setState({focusedIn:!0})}}(this)).on("focusout.fileRow",function(e){return function(t){return e.setState({focusedIn:!1})}}(this)).on("mouseup.fileRow",this.handleMouseUp)},componentWillReceiveProps:function(e){return this.props.isSelected&&!e.isSelected?this.setState({wasSelectedBeforeMostRecentMouseDown:!1,shouldShowSettingsBubble:!1}):void 0},shouldComponentUpdate:te,componentDidUpdate:function(e){var t,s,r;return r=this.props.isSelected!==e.isSelected,t=this.props.shouldFocus!==e.shouldFocus,s=this.props.renameState!==e.renameState,r||t||s?this.focusIfSelected():void 0},componentWillUnmount:function(){return e(this.getDOMNode()).off(".fileRow")},focusIfSelected:function(){return this.props.isSelected&&this.props.shouldFocus&&!this.props.renameState?this.getDOMNode().focus():void 0},handleMouseEnter:function(e){return this.props.isDraggingInternalFiles||this.props.isDraggingExternalFiles?void F.setDropTarget({target:this.props.file}):this.props.onMouseEnter(e)},handleMouseLeave:function(e){return this.props.isDraggingInternalFiles||this.props.isDraggingExternalFiles?F.setDropTarget({target:null}):void 0},handleMouseDown:function(e){return this.setState({wasSelectedBeforeMostRecentMouseDown:this.props.isSelected}),this.props.onMouseDown(e)},handleMouseUp:function(e){return this.handleSettingsGearMenuMouseUp(e),this.props.onMouseUp(e)},handleSettingsGearMenuMouseUp:function(t){if(null!=this.props.settingsGearMenuItems){if(this.state.shouldShowSettingsBubble)return this.setState({shouldShowSettingsBubble:!1});if(e.contains(this.refs.settings.getDOMNode(),t.target))return this.setState({shouldShowSettingsBubble:!0})}},handleFilenameClick:function(e){return this.props.isTextSelectable||(e.preventDefault(),e.stopPropagation(),this.props.file.type===U.TEAM_SHARED_FOLDER&&j.log("clicked_team_folder_web",{team_id:c.get_viewer().team_id}),this.props.isArchiveState)?void 0:F.navigateToFileOrFolder({file:this.props.file,onFileViewerUnmount:function(e){return function(){var t;return null!=(t=e.getDOMNode())?t.focus():void 0}}(this)})},handleDoubleClick:function(e){return this.props.enableDoubleClickTraversal?this.handleFilenameClick(e):void 0},handleRenameSubmit:function(e){return F.renameFile({file:this.props.file,newName:e})},handleRenameCancel:function(){return F.cancelFileRename({file:this.props.file})},handleDragStart:function(e){return this.props.isPagelet&&!this.props.isSelected&&this.toggleSelected(e),this.props.onDragStart(e)},toggleSelected:function(e){return e.stopPropagation(),this.props.onToggleRowSelected(e)},handleCheckboxKeyPress:function(e){var t;return t=e.which||e.keyCode,t===u.SPACE?(e.stopPropagation(),this.toggleSelected(e)):void 0},_renderSelectionToggleColumn:function(){return[this.props.isPagelet?$.div({className:s({"file-select-checkbox":!0,"show-boxes":this.props.showCheckboxes}),role:"gridcell",onDoubleClick:function(e){return e.stopPropagation()},onClick:function(e){return e.stopPropagation()},onMouseDown:function(e){return function(t){return t.stopPropagation(),e.props.onMouseDown(t)}}(this),onMouseUp:function(e){return function(t){return t.stopPropagation(),e.props.onMouseUp(t)}}(this),onKeyPress:this.handleCheckboxKeyPress},$.button({role:"checkbox","aria-checked":this.props.isSelected,"aria-label":Q("Select row"),className:this.props.isSelected?"checkbox-button checked":"checkbox-button"})):$.div({className:"ax-visually-hidden",role:"gridcell"},$.input({ref:"selectionToggleInput",type:"checkbox","aria-label":Q("Select row"),checked:this.props.isSelected,onChange:this.props.onToggleRowSelected,tabIndex:-1}))]},_renderPlaceholder:function(){return $.span({"aria-hidden":"true"},"--")},_renderScreenReaderExtraInfo:function(){var e,t;return e=[],this.props.file.isDeleted&&e.push(Q("Deleted")),this.props.isSelected&&e.push(Q("Selected")),this.props.file.is_dir&&(this.props.file.type===U.SHARED_FOLDER?this.props.file.is_read_only_mount?e.push(Q("Read-only shared folder")):e.push(Q("Shared folder")):this.props.file.type===U.TEAM_SHARED_FOLDER?this.props.file.is_read_only_mount?e.push(Q("Read-only team shared folder")):e.push(Q("Team shared folder")):e.push(Q("Folder"))),e.length>0?(t=" "+e.join(" "),$.span({className:"ax-visually-hidden"},t)):void 0},_renderFilename:function(){var e,r,n,o,i,a,u;return e=this.props.file,r=l.filename(e.fq_path),n=this.props.showFilenameHighlights?v.highlightMatchString(r,e.filename_highlights):t.escape(r),i=l.parent_dir(e.fq_path),a=Y(this.props.user,i),u="/"===i?Z(this.props.user):this.props.isPagelet?i.slice(1):i,this.props.renameState===H.PENDING_INPUT?(o=Q(e.is_dir?"Rename directory…":"Rename file…"),J(d,{ref:"nameInput",label:o,defaultValue:l.filename(e.fq_path),onSubmit:this.handleRenameSubmit,onCancel:this.handleRenameCancel,className:"browse-file-row__input"})):this.props.renameState===H.SAVING_INPUT?$.span({ref:"renameStatus",role:"status"},Q("Renaming…")):$.div({className:"browse-file-row__name-location"},$.a({ref:"filenameLabel",className:"filename-link u-ellip browse-file-row__name",href:e.href,onDragStart:function(e){return function(t){return e.props.isPagelet||(t.stopPropagation(),e.props.isArchiveState)?void 0:(F.setSelection({selection:X([e.props.file.fq_path])}),e.props.onDragStart(t,[e.props.file]))}}(this),onMouseDown:function(e){return function(t){var s;if(!e.props.isPagelet)return s=2===t.button||2===t.buttons,e.props.file.is_dir&&!s?t.stopPropagation():void 0}}(this),onClick:this.handleFilenameClick},$.span({dangerouslySetInnerHTML:{__html:n}}),this._renderScreenReaderExtraInfo()),this.props.showColumnDetail?$.div({className:s({"u-ellip":!0,"browse-file-row__location":!0,"u-font-meta":this.props.isPagelet})},this.props.isPagelet?Q("in %(location)s",{comment:"Describes the parent directory of a file in a list of search results."}).format({location:u}):$.a({href:a,onClick:function(e){return F.setUrl({path:i}),e.preventDefault()}},q({comment:"Describes the parent directory of a file in a list of search results.",location:u},"in <strong>%(location)s</strong>"))):void 0)},_renderFilenameColumn:function(e){var t,r,n;return r=J(M,{className:"u-pad-right-xs",ref:"icon",file:this.props.file,onClick:this.handleFilenameClick,onDragStart:function(e){return function(t){return t.stopPropagation(),F.setSelection({selection:X([e.props.file.fq_path])}),e.props.onDragStart(t,[e.props.file])}}(this),onMouseDown:function(e){return function(t){return e.props.file.is_dir?t.stopPropagation():void 0}}(this)}),n=this._renderFilename(),t=this.props.isPagelet&&!this.props.isMultiColumnGroupVisible?8:6,$.div({ref:"filenameColumn",className:s(""+this.props.columnClasses,"column--filename","u-ellip","o-grid__col--"+t+"-of-12"),role:"rowheader"},J(N,{leftAttachment:r},n))},_renderModifiedColumn:function(){var e,t,r;return e=this.props.file.last_modified_fname||"",t=this.props.file.ago||this._renderPlaceholder(),this.props.showColumnDetail&&!this.props.isPagelet&&(t=this.props.file.ago?Q("Modified %(ago)s").format({ago:this.props.file.ago}):""),$.div({className:s((r={},r[""+this.props.columnClasses]=!0,r["u-ellip"]=!0,r["o-grid__col--3-of-12"]=this.props.isMultiColumnGroupVisible||this.props.isPagelet,r["o-grid__col--6-of-12"]=!(this.props.isMultiColumnGroupVisible||this.props.isPagelet),r)),role:"gridcell"},t,e.length?$.span({className:"browse-file-row__modifier u-font-meta"},(this.props.isPagelet?"by ":"")+e):void 0)},_renderSyncColumn:function(){var e,t;return t="","sync"===this.props.file.default_sync_setting?t=Q("Sync by default"):"no_sync"===this.props.file.default_sync_setting&&(t=Q("Don’t sync by default")),$.div({className:s((e={},e[""+this.props.columnClasses]=!0,e["u-ellip"]=!0,e["o-grid__col--3-of-12"]=this.props.isMultiColumnGroupVisible||this.props.isPagelet,e["o-grid__col--6-of-12"]=!(this.props.isMultiColumnGroupVisible||this.props.isPagelet),e)),role:"gridcell"},t)},_renderMultiColumnGroup:function(){var e;return e=function(e){return function(t,s){return $.div({className:"column--multi "+e.props.columnClasses+" column--"+t+" o-grid__col--3-of-12",role:"gridcell",key:t},s)}}(this),[e("sharedwith",J(V,{file:this.props.file,browseContext:this.props.context})),e("kind",L.getCategoryDescription(this.props.file)),e("extension",L.getExtension(this.props.file)||this._renderPlaceholder()),e("size",this.props.file.size||this._renderPlaceholder())]},_renderActionsColumn:function(){return this.props.isSearchMode?void 0:$.div({className:"sharing__actions",role:"gridcell"},ee(this.props.user,this.props.file,this.props.context)?J(W,{ref:"shareButton",browseContext:this.props.context,file:this.props.file,user:this.props.user,isPagelet:this.props.isPagelet}):void 0)},_renderSettingsGearColumn:function(){return $.div({className:"settings-gear-button",role:"gridcell"},J(G,{ref:"settings",alt:this.props.settingsGearMenuAlt,isShowing:this.state.shouldShowSettingsBubble,menuItems:this.props.settingsGearMenuItems,browseContext:this.props.context,file:this.props.file}))},_renderEmptyColumns:function(){return $.div({className:s(""+this.props.columnClasses,"u-ellip","o-grid__col--3-of-12"),role:"gridcell"})},render:function(){var e,t,r;return e={"browse-file-row":!0,"browse-file-row--focused-in":this.state.focusedIn,"browse-file-row--is-selected":this.props.isSelected,"browse-file-row--is-archived":this.props.isArchiveState,"browse-file-row--is-deleted":this.props.file.isDeleted,"browse-file-row--is-drop-target":this.props.isAvailableDropTarget,"browse-file-row--file-dragged-over":this.props.isAvailableDropTarget&&this.props.isActiveDropTarget,"o-grid":!0,"o-grid--no-gutter":!0},$.li({className:s(e),"data-filename":this.props.file.fq_path.split("/").slice(-1),role:"row",tabIndex:"-1",draggable:(this.props.isPagelet||this.props.isSelected&&this.state.wasSelectedBeforeMostRecentMouseDown)&&!((r=this.props.renameState)===H.PENDING_INPUT||r===H.SAVING_INPUT),onContextMenuCapture:this.handleContextMenu,onMouseEnter:this.handleMouseEnter,onMouseDown:function(e){return function(t){return e.props.isPagelet?t.stopPropagation():e.handleMouseDown(t)}}(this),onMouseUp:this.handleMouseUp,onMouseLeave:this.handleMouseLeave,onClick:this.props.isPagelet?this.handleFilenameClick:this.props.onClick,onDoubleClick:this.handleDoubleClick,onDragStart:this.handleDragStart},this._renderSelectionToggleColumn(),this._renderFilenameColumn(),this.props.isArchiveState?this._renderEmptyColumns():this.props.isSyncColumnVisible?this._renderSyncColumn():this.props.isModifiedColumnVisible?this._renderModifiedColumn():void 0,this.props.isMultiColumnGroupVisible?function(){var e,s,r,n;for(r=this._renderMultiColumnGroup(),n=[],e=0,s=r.length;s>e;e++)t=r[e],n.push(t);return n}.call(this):void 0,null!=this.props.settingsGearMenuItems?this._renderSettingsGearColumn():this._renderActionsColumn())}}),B=n.createClass({displayName:"PaperItemRow",propTypes:{paper:n.PropTypes.instanceOf(k).isRequired,columnClasses:n.PropTypes.string,showTitleHighlights:n.PropTypes.bool,isPagelet:n.PropTypes.bool,onMouseEnter:n.PropTypes.func,onMouseDown:n.PropTypes.func,onMouseUp:n.PropTypes.func},getDefaultProps:function(){return{columnClasses:"browse-file-row__column o-grid__col o-grid__col--am",showTitleHighlights:!1,isPagelet:!1,onMouseEnter:null,onMouseDown:null,onMouseUp:null}},render:function(){var e,r,n,o,i,a,l,u;return l=J(y,{group:"web",name:"paper_white_32",ref:"icon",className:"u-pad-right-xs browse-file-row__accessory",alt:""}),u=this.props.paper.title,n=this.props.showTitleHighlights?v.highlightMatchString(u,this.props.paper.title_highlights):t.escape(u),a=P({scheme:"https",authority:z,path:"/paper"}),e=$.div({className:"browse-file-row__name-location"},$.a({className:"filename-link u-ellip browse-file-row__name",href:this.props.paper.url},$.span({dangerouslySetInnerHTML:{__html:n}})),$.div({className:"u-ellip browse-file-row__location"},this.props.isPagelet?Q("in Paper",{comment:"The Dropbox Paper page"}):$.a({href:a},q({comment:"The Dropbox Paper page."},"in <strong>Paper</strong>")))),i=this.props.paper.last_modified_date?Q("Modified %(date)s").format({date:this.props.paper.last_modified_date}):"",this.props.isPagelet?(r=8,o=3):(r=6,o=6),$.li({className:s("browse-file-row","o-grid","o-grid--no-gutter"),"data-filename":this.props.paper.title,role:"row",tabIndex:"-1"},$.div({className:s(""+this.props.columnClasses,"column--filename","u-ellip","o-grid__col--"+r+"-of-12"),role:"rowheader"},J(N,{leftAttachment:l},e)),$.div({className:s(""+this.props.columnClasses,"u-ellip","o-grid__col--"+o+"-of-12"),role:"gridcell"},i,$.span({className:"browse-file-row__modifier u-font-meta"},this.props.paper.creator_name)))}}),{FileItemRow:x,PaperItemRow:B}})}.call(this),function(){define("modules/dirty/react/browse/pinned_team_folder",["external/underscore","external/react","external/classnames","modules/clean/react/browse/api","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/browse/file_list_utils","modules/clean/react/css","modules/clean/react/tooltip","modules/clean/react/sprite","modules/core/i18n","modules/dirty/react/browse/item_list_row"],function(e,t,s,r,n,o,i,a,l,u,c,p){var d,h,_,m,f,g,b,S,y,v,T,w,E,P;return h=n.DropTargetHighlightMode,g=n.LoadingStates,_=o.File,d=o.BrowseContext,f=i.FileListHelpers,S=l.Tooltip,y=l.TooltipPosition,v=c._,m=p.FileItemRow,w=t.DOM,T=t.createElement,b=t.createClass({displayName:"PinnedTeamFolder",propTypes:{teamFolder:t.PropTypes.instanceOf(_).isRequired,context:t.PropTypes.instanceOf(d).isRequired,user:t.PropTypes.object,selection:t.PropTypes.object,loadingState:t.PropTypes.oneOf(e.values(g)),activeDropTarget:t.PropTypes.instanceOf(_),dropTargetHighlightMode:t.PropTypes.oneOf(function(){var e;e=[];for(E in h)P=h[E],e.push(P);return e}()),isDraggingInternalFiles:t.PropTypes.bool,isDraggingExternalFiles:t.PropTypes.bool,isTextSelectable:t.PropTypes.bool},_renderTeamFolderHeader:function(e,t){return w.div({},w.span({className:"pinned-team-folder__header-text"},e),w.div({className:"pinned-team-folder__info-button"},T(S,{position:y.RIGHT,tooltip_contents:w.div({},t),tooltip_classname:"pinned-team-folder__tooltip"},T(u,{group:"web",name:"info",alt:v("File section information")}))))},render:function(){var e;return e=f.shouldFileBeHighlightedDropTarget({file:this.props.teamFolder,isSelected:this.props.selection.selected.has(this.props.teamFolder.fq_path),dropTargetHighlightMode:this.props.dropTargetHighlightMode}),w.div({className:"pinned-team-folder"},w.div({className:"u-pad-top-xs"},this._renderTeamFolderHeader(v("Team Folder"),v("Everything in a Team folder is automatically shared with your team. Team folders can also contain shared folders for collaborating with people outside your team."))),w.div({className:"pinned-team-folder__file-row u-pad-top-xs"},T(m,{selectableListId:this.props.teamFolder.fq_path,key:encodeURI(this.props.teamFolder.fq_path),file:this.props.teamFolder,user:this.props.user,context:this.props.context,shouldFocus:this.props.selection.selected.last()===this.props.teamFolder.fq_path,isDraggingInternalFiles:this.props.isDraggingInternalFiles,isDraggingExternalFiles:this.props.isDraggingExternalFiles,isAvailableDropTarget:e,isActiveDropTarget:this.props.teamFolder===this.props.activeDropTarget,isTextSelectable:this.props.isTextSelectable,isModifiedColumnVisible:!1,onDragStart:function(){},onMouseEnter:function(){},onMouseDown:function(){},onMouseUp:function(){}})),w.div({className:"u-pad-top-m"},this._renderTeamFolderHeader(v("Other Folders"),v("These folders help you organize your private work files."))))}}),{PinnedTeamFolder:a(b,["/static/css/scooter/scooter-scoped-vfl6M_UYZ.css","/static/css/browse/browse-vflMD7V38.css"])}})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,s=this.length;s>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/dirty/react/browse/preview_sf_members",["jquery","external/classnames","external/react","modules/clean/ajax","modules/clean/analytics","modules/clean/avatar/photo_avatar","modules/clean/avatar/size","modules/clean/components/loading_indicator","modules/clean/components/title_bubble","modules/clean/em_string","modules/clean/filepath","modules/clean/flux/dispatcher","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/css","modules/clean/react/flag","modules/clean/react/image","modules/clean/react/modal","modules/clean/react/sprite","modules/clean/react/react_i18n","modules/clean/sharing/member_avatars","modules/clean/static_urls","modules/clean/sharing/api","modules/clean/sharing/ui_util","modules/clean/teams/cdm_mve_quota_usage","modules/clean/teams/limited_team_invite_modal","modules/clean/teams/suggest_invites_modal","modules/clean/viewer","modules/core/i18n","modules/dirty/sharing/browse_ui_util","require"],function(t,s,r,n,o,i,a,l,u,c,p,d,h,_,m,f,g,b,S,y,v,T,w,E,P,F,I,D,C,N,A){var R,O,L,M,x,U,k,B,q,H,G,W,V,j,K,z,Q,Y,J,X,$,Z,ee,te,se,re;return j=o.SharedFolderActivityLogger,Y=o.TeamsWebActionsLogger,L=a.AVATAR_DIMENSION_BY_SIZE,K=h.SharedWithActionTypes,M=_.BrowseContext,W=_.QuotaStats,q=b.Modal,V=y.R_,se=T.static_url,z=w.SharingApi,U=E.GoldenGate,J=E.Tiburon,X=C._,re=C.ungettext,te=N.showTiburonUIIfAllowed,Z=r.createElement,ee=r.DOM,B=15,x=10,O=L.MEDIUM,Q="south",R=!0,H=r.createClass({displayName:"PreviewSFMembersPanel",propTypes:{context:r.PropTypes.instanceOf(M).isRequired,user:r.PropTypes.object.isRequired,viewer:r.PropTypes.instanceOf(D)},getInitialState:function(){return{viewProps:{}}},getDefaultProps:function(){return{viewer:D.get_viewer()}},componentDidMount:function(){return this._fetchSharedFolderMembers(),this._log_event("preview_sf_members_shown"),t(document).on(z.REQUEST_SUCCEEDED_EVENT,this._sharing_api_request_handler),this._dispatchToken=d.register(this.onEventDispatched)},componentWillUnmount:function(){var e;return null!=(e=this._currentRequest)&&e.abort(),t(document).off(z.REQUEST_SUCCEEDED_EVENT,this._sharing_api_request_handler),this._dispatchToken?d.unregister(this._dispatchToken):void 0},componentDidUpdate:function(e){var t,s;return(null!=(t=e.context)?t.currentFQPath:void 0)!==(null!=(s=this.props.context)?s.currentFQPath:void 0)?(this._fetchSharedFolderMembers(),this._log_event("preview_sf_members_shown")):void 0},onEventDispatched:function(t){var s,r,n;return s=null!=t&&null!=(r=t.action)?r.type:void 0,n=[K.SIGNAL_SHARED_FILE_DATA_OUT_OF_DATE,K.SIGNAL_SHARED_FOLDER_DATA_OUT_OF_DATE,K.SIGNAL_SHARED_LINK_DATA_OUT_OF_DATE],s&&e.call(n,s)>=0?this._fetchSharedFolderMembers():void 0},_canShareAsNestedSharedFolder:function(){return this.props.context.currentNSPath&&this.props.context.currentNSAllowsNesting},_isViewingTeamRootFolder:function(){return this.props.context.isInsideAutoTeamFolder&&"/"===p.parent_dir(this.props.context.currentFQPath)},_isViewingLimitedTeamRootFolder:function(){return this._isViewingTeamRootFolder()&&this.props.viewer.team_is_limited&&!this._isViewingCdmMveFolder()},_isViewingCdmMveFolder:function(){return this._isViewingTeamRootFolder()&&Boolean(this.props.context.cdmMveQuotaStats)},_cdmMveRootFolderShareButtonText:function(){return X(this._isViewingCdmMveFolderAndCanInvite()?"Invite members":"Suggest team members")},_isViewingCdmMveFolderAndCanInvite:function(){return this._isViewingCdmMveFolder()&&(this.props.viewer.team_is_limited||this.props.user.is_team_admin)},_sharing_api_request_handler:function(e,t){var s;return s=t.request_url,s.indexOf("/share_ajax/leave")>-1||s.indexOf("/share_ajax/unshare")>-1||!this.props.context.isInFolderMode||t.ns_id!==this.props.context.currentNSID?void 0:this._fetchSharedFolderMembers()},_getMaxVisibleAvatars:function(){return U.hasNewMembershipUI(this.props.user.id)?x:B},_fetchSharedFolderMembers:function(){var e;return e="/share_ajax/preview_members/"+this.props.context.currentNSID,this._currentRequest=n.WebRequest({url:e,subject_user:this.props.user,data:{max_results:this._getMaxVisibleAvatars(),is_loading_cdm_mve_preview:this._isViewingCdmMveFolder()},success:function(e){return function(t){var s;return t=JSON.parse(t),t.ns_id===e.props.context.currentNSID?(s={numUndisplayableUsersAndInvites:t.num_avatars_not_shown,numUsersAndInvites:t.num_users_and_invites,numUsersAndInvitesOutsideTeam:t.num_users_and_invites_outside_team,groups:t.groups,invitations:t.invitations,joinedMembers:t.joined_members},t.user_can_invite&&(e.props.context.isInsideSharedFolder&&!e.props.context.isInsideAutoTeamFolder||e._canShareAsNestedSharedFolder())&&(s.inviteButton=Z(k,{onClick:e.invite_button_click_handler})),e.setState({viewProps:s})):void 0}}(this),complete:function(e){return function(){return e._currentRequest=null}}(this)})},settings_button_click_handler:function(){return this._isViewingCdmMveFolder()?this._show_invite_team_members_modal():(this._log_event("preview_sf_members_settings_button_clicked"),te(this.props.user,this.props.context,{origin:"BROWSE_SHARED_FOLDER_BANNER"})?void 0:this._show_shared_folder_members_modal())},invite_button_click_handler:function(){return this._log_event("preview_sf_members_invite_button_clicked"),this._show_add_people_modal()},avatar_click_handler:function(){return this._log_event("preview_sf_members_avatar_clicked"),document.activeElement!==document.body&&document.activeElement.blur(),te(this.props.user,this.props.context,{origin:"BROWSE_SHARED_FOLDER_BANNER"})},overflow_click_handler:function(){return this._log_event("preview_sf_members_overflow_number_clicked"),te(this.props.user,this.props.context,{origin:"BROWSE_SHARED_FOLDER_BANNER"})?void 0:this._show_shared_folder_members_modal()},focus_sharing_options_modal_invite_form:function(){return A(["dropbox","modules/clean/dbmodal"],function(e){return function(s,r){var n,o;return o=s.ExistingSharedFolderOptionsContent,n=r.DBModalStack,n.unregister(o.CONTENT_LOADED_EVENT,e.focus_sharing_options_modal_invite_form),t("#sharing-options-new-collab-input").focus()}}(this))},_show_invite_team_members_modal:function(){return Y.log("preview_sf_members_cdm_mve_invite_button_clicked"),this._isViewingCdmMveFolderAndCanInvite()?q.showInstance(Z(F)):q.showInstance(Z(I))},_show_shared_folder_members_modal:function(){return A(["dropbox"],function(e){return function(t){var s;return s=t.SharingModals,e._canShareAsNestedSharedFolder()?s.show_share_existing_modal(e.props.context.currentFQPath,e.props.user):s.show_shared_folder_options_modal(e.props.context.currentMountPoint,e.props.user,!0)}}(this))},_show_add_people_modal:function(){return A(["dropbox","modules/clean/dbmodal"],function(e){return function(t,s){var r,n,o;return n=t.ExistingSharedFolderOptionsContent,o=t.SharingModals,r=s.DBModalStack,e._canShareAsNestedSharedFolder()?o.show_share_existing_modal(e.props.context.currentFQPath,e.props.user):(r.register(n.CONTENT_LOADED_EVENT,e.focus_sharing_options_modal_invite_form),o.show_shared_folder_options_modal(e.props.context.currentMountPoint,e.props.user))}}(this))},_log_event:function(e,t){return null==t&&(t={}),t.ns_id=this.props.context.currentNSID,j.log("web",e,this.props.user,t)},render:function(){var e,s;return e={folderName:this.props.context.getNameOfTargetFolder(),user:this.props.user,viewer:this.props.viewer,onSettingsButtonClick:this.settings_button_click_handler,onOverflowCountClick:this.overflow_click_handler,onAvatarClick:this.avatar_click_handler,maxVisibleAvatars:this._getMaxVisibleAvatars(),folderType:this.props.context.isInsideAutoTeamFolder?"TEAM":"SHARED",buttonText:this._isViewingCdmMveFolder()?this._cdmMveRootFolderShareButtonText():null,isViewingLimitedTeamRootFolder:this._isViewingLimitedTeamRootFolder(),cdmMveQuotaStats:this._isViewingCdmMveFolder()?this.props.context.cdmMveQuotaStats:void 0,showCreateTeamPromo:this.props.context.showSharedFolderCreateTeamPromo},s=t.extend(e,this.state.viewProps),ee.div({className:"PreviewSFMembersPanel"},Z(G,s))}}),$=r.createClass({displayName:"PreviewSFMembersView",mixins:[v],propTypes:{folderName:r.PropTypes.string.isRequired,folderType:r.PropTypes.oneOf(["SHARED","TEAM"]).isRequired,user:r.PropTypes.object.isRequired,viewer:r.PropTypes.instanceOf(D).isRequired,onSettingsButtonClick:r.PropTypes.func.isRequired,onOverflowCountClick:r.PropTypes.func,onAvatarClick:r.PropTypes.func,inviteButton:r.PropTypes.element,buttonText:r.PropTypes.string,isViewingLimitedTeamRootFolder:r.PropTypes.bool,numUndisplayableUsersAndInvites:r.PropTypes.number,numUsersAndInvites:r.PropTypes.number,numUsersAndInvitesOutsideTeam:r.PropTypes.number,groups:r.PropTypes.array,invitations:r.PropTypes.array,joinedMembers:r.PropTypes.array,avatarDimension:r.PropTypes.number,cdmMveQuotaStats:r.PropTypes.instanceOf(W),titleButtonDirection:r.PropTypes.string,maxVisibleAvatars:r.PropTypes.number,showCreateTeamPromo:r.PropTypes.bool},getDefaultProps:function(){return{titleButtonDirection:Q,avatarDimension:O,maxVisibleAvatars:B,animation:R}},renderCreateTeamPromo:function(){var e,t,s;return t="",s=this.props.viewer.personal_email,null!=this.props.joinedMembers&&(t=function(){var t,r,n,o;for(n=this.props.joinedMembers,o=[],t=0,r=n.length;r>t;t++)e=n[t],e.email!==s&&o.push(e.email);return o}.call(this).join()),ee.div({className:"team-upsell-banner c-card c-card--arrow c-card--arrow-sw"},V({user_emails:t},'<a href="/team?tk=sf_upsell&_camp=sf&invite_members=%(user_emails)s">Create a Team Dropbox</a> with the people in this folder'),ee.span({className:"u-mar-left-xxs"},Z(u,{text:X("With teams you get access to a shared team folder, a separate work Dropbox, groups, and other tools and features."),direction:"north"},Z(S,{className:"team-upsell-banner__info-sprite",group:"web",name:"info",alt:X("More information about teams")}))))},_renderContent:function(){return[this.renderFolderInfo(),this.props.numUsersAndInvites?"SHARED"===this.props.folderType?this.renderAvatars():this.renderTeamFolder():this._renderLoadingIndicator()];
},_renderCdmMveContent:function(){return this.props.numUsersAndInvites?ee.div({className:"cdm-mve-sf-info-banner"},ee.div({className:"shared-folder-info u-mar-bottom-xs"},ee.span({className:"u-font-strong"},this._buildNumberOfMembersString()),this.props.viewer.team_is_limited?Z(P,{quotaStats:this.props.cdmMveQuotaStats}):void 0),this.renderAvatars()):this._renderLoadingIndicator()},_renderGoldenGateContent:function(){return this.props.numUsersAndInvites?Z(f,{rightAttachment:this.renderAvatars()},this.renderGoldenGateFolderInfo()):this._renderLoadingIndicator()},_renderLoadingIndicator:function(){return ee.div({className:"loading-indicator-container"},Z(l,null))},render:function(){return ee.div({className:"sf-member-preview-container"},this.props.showCreateTeamPromo?this.renderCreateTeamPromo():void 0,ee.div({className:this.getClassName()},Z(f,{rightAttachment:this.renderButtons()},this.props.cdmMveQuotaStats?this._renderCdmMveContent():U.hasNewMembershipUI(this.props.user.id)?this._renderGoldenGateContent():this._renderContent())))},getClassName:function(){return r.addons.classSet({"preview-sf-members--with-team-promo":this.props.showCreateTeamPromo,"c-banner c-banner--unpinned u-pad-s":!0,"team-folder":"TEAM"===this.props.folderType})},renderTeamFolder:function(){var e,t;return e=null,this.props.groups&&(t=this.props.groups[0],t&&t.is_automatic&&(e=X("editor"===t.access_type?"%(group_name)s can edit":"%(group_name)s can view"),e=e.format({group_name:t.name}))),e||(e=X("Shared with all members of %(team_name)s").format({team_name:this.props.viewer.team_name})),ee.div({className:"team-folder-member-entry"},Z(i,{dimension:32,photoUrl:se("/static/images/icons/team_32-vflk8mBzO.png"),shape:"SQUARE",optionalClass:"u-mar-right-xs"}),ee.span({className:"u-l-ib u-l-ib--m"},e))},renderButtons:function(){var e,t,r;if(!this.props.isViewingLimitedTeamRootFolder||this.props.user.is_team_admin)return t=U.hasNewMembershipUI(this.props.user.id),r=J.foldersUI(this.props.user)&&!this.props.isViewingLimitedTeamRootFolder,e=this.props.buttonText?this.props.buttonText:X(r?"Share":"Settings"),ee.div(null,r?void 0:this.props.inviteButton,ee.button({className:s(["c-btn","settings-button",t?"c-btn--primary":"c-btn--secondary"]),onClick:this.props.onSettingsButtonClick,title:e},e))},renderFolderInfo:function(){return ee.div({className:"shared-folder-info u-mar-bottom-xs"},ee.strong({className:"shared-folder-name"},c.em_snippet(this.props.folderName,18)),this.props.numUsersAndInvites?ee.span({className:"u-mar-horizontal-xs"},"•"):void 0,this.props.numUsersAndInvites?ee.span({className:"members-string u-font-meta"},this._buildNumberOfMembersString()):void 0)},renderGoldenGateFolderInfo:function(){var e,t;return this.props.numUsersAndInvites?(e=re("%(num_total)s member","%(num_total)s members",this.props.numUsersAndInvites,{comment:'Another pluralized string MAY be concatenated to this to make a string like: "15 members (4 outside of TechCorp Inc.)"'}).format({num_total:this.props.numUsersAndInvites}),t=re("%(num_outside)s outside your Dropbox team","%(num_outside)s outside your Dropbox team",this.props.numUsersAndInvitesOutsideTeam,{comment:'This will be concatenated to another string to make a string like: "15 members (4 outside your Dropbox team)"'}).format({num_outside:this.props.numUsersAndInvitesOutsideTeam}),ee.div({className:"u-l-ib"},ee.strong({},e),this.props.numUsersAndInvitesOutsideTeam?ee.div({className:"u-font-meta"},t):void 0)):void 0},_buildNumberOfMembersString:function(){var e,t;return t=re("%(num_total)s member","%(num_total)s members",this.props.numUsersAndInvites,{comment:'Another pluralized string MAY be concatenated to this to make a string like: "15 members (4 outside of TechCorp Inc.)"'}),this.props.numUsersAndInvitesOutsideTeam?(t+=re(" (%(num_outside)s outside your Dropbox team)"," (%(num_outside)s outside your Dropbox team)",this.props.numUsersAndInvitesOutsideTeam,{comment:'This will be concatenated to another string to make a string like: "15 members (4 outside your Dropbox team)"'}),e=t.format({num_total:this.props.numUsersAndInvites,num_outside:this.props.numUsersAndInvitesOutsideTeam,team_name:c.em_snippet(this.props.viewer.team_name,16)})):e=t.format({num_total:this.props.numUsersAndInvites}),e},renderAvatars:function(){var e,t,s,r,n,o;return e=[],o=[],this.props.numUsersAndInvites&&(n=this.findOwnerAndMeInJoinedMembers(this.props.joinedMembers),r=n[0],s=n[1],null!=r&&(e.push(this.renderJoinedMember(r)),o.push(r.user_id)),null!=s&&s!==r&&(e.push(this.renderJoinedMember(s)),o.push(s.user_id)),t=this.props.cdmMveQuotaStats?[]:this.props.groups,this.addGroupsMembersInvitations(e,t,this.props.joinedMembers,this.props.invitations,o)),this.renderAvatarList(e,this.getAvatarListClassName())},getAvatarListClassName:function(){return s({"u-pad-right-m":U.hasNewMembershipUI(this.props.user.id)})}}),k=r.createClass({displayName:"InviteButton",propTypes:{onClick:r.PropTypes.func.isRequired},render:function(){return ee.button({className:"c-btn c-btn--secondary u-mar-right-xs",onClick:this.props.onClick,title:X("Add members")},Z(g,{alt:X("Add members"),src:se("/static/images/account_photo/icon-add-people-vfl6PECU8.png"),srcHiRes:se("/static/images/account_photo/icon-add-people@2x-vflNPmgwH.png")}))}}),G=m($,["/static/css/avatar_list-vflW4vhKE.css","/static/css/components/loading_indicator-vflbadB1S.css","/static/css/scooter/scooter-scoped-vfl6M_UYZ.css","/static/css/shared_folder_members_preview/team_promo-vflu998jd.css","/static/css/shared_folder_members_preview/cdm_mve_banner-vflRBgSZE.css"]),{PreviewSFMembersPanel:H,PreviewSFMembersView:G}})}.call(this),function(){define("modules/dirty/react/browse/selection_actions",["external/immutable","external/react","modules/clean/filepath","modules/clean/react/browse/models","modules/clean/react/browse/util","modules/clean/react/bubble_menu","modules/clean/react/sprite","modules/clean/em_string","modules/core/i18n","modules/dirty/react/browse/file_actions"],function(e,t,s,r,n,o,i,a,l,u){var c,p,d,h,_,m,f,g,b;return c=r.BrowseContext,b=n.describeFiles,d=o.BubbleMenu,h=o.BubbleMenuItem,_=l._,g=t.DOM,f=t.addons.classSet,m=t.createElement,p=t.createClass({displayName:"BrowseSelectionMenu",mixins:[t.addons.PureRenderMixin],propTypes:{context:t.PropTypes.instanceOf(c).isRequired,selectedFiles:t.PropTypes.instanceOf(e.OrderedSet).isRequired,user:t.PropTypes.object.isRequired,onActionButtonClick:t.PropTypes.func,actionHandlers:t.PropTypes.object},getDefaultProps:function(){return{actionHandlers:{},onActionButtonClick:function(){}}},componentDidUpdate:function(){var e;return null!=(e=this.refs.moreActionsBubbleMenu)?e.hideIfShown():void 0},_renderMenuButton:function(e){var t,s,r,n,o,a,l,u,c,p;return n=e.label,p=e.spriteName,a=e.performAction,r=e.href,l=e.ref,s=null!=(u=e.disabled)?u:!1,null!=a?(t={ref:l,className:"button-as-link browse-menu__action-button",onClick:function(e){return function(t){return s?void 0:(e.props.onActionButtonClick(),a(t))}}(this)},s&&(t.disabled=!0),c=g.button(t,m(i,{group:"web",name:p,alt:"",className:"browse-menu__action-button-sprite"}),g.span({className:"browse-menu__action-button-label"},n))):null!=r&&(c=g.a({ref:l,className:"browse-menu__action-button",href:r},m(i,{group:"web",name:p,alt:"",className:"browse-menu__action-button-sprite"}),g.span({className:"browse-menu__action-button-label"},n))),o={"browse-menu__action":!0,"browse-menu__action--disabled":s},g.li({key:n,className:f(o)},c)},_renderMoreActionsDropdown:function(e){var t,s;return s=g.button({className:"button-as-link browse-menu__action-button"},_("More")," ",m(i,{group:"web",name:"arrow-down-blue",alt:"",className:"browse-menu__more-dropdown-arrow"})),t=e.map(function(e){var t,s,r,n,o,a;return r=e.label,a=e.spriteName,n=e.performAction,s=e.href,t=null!=(o=e.disabled)?o:!1,m(h,{href:s,onClick:function(){return"function"==typeof n?n():void 0},disabled:t},m(i,{group:"web",name:a,alt:"",className:"browse-menu__action-button-sprite"}),g.span({className:"browse-menu__action-button-label"},r))}),g.li({className:"browse-menu__action"},m(d,{ref:"moreActionsBubbleMenu",targetButton:s,arrow_position:"top-right",items:t}))},render:function(){var e,t,s,r,n,o,i,l,c,p,d,h,_,m,f;if(this.props.selectedFiles.isEmpty())return null;for(t=b(this.props.selectedFiles),n=1!==this.props.selectedFiles.count()||this.props.selectedFiles.first().is_dir?"":this.props.selectedFiles.first().size,_=u.getActionsForFileCollection({files:this.props.selectedFiles,context:this.props.context,user:this.props.user,skipSharing:!0,actionHandlers:this.props.actionHandlers}),f=800,o=12,s=new a(t).length*o,r=new a(n).length*o,d=f-(s+r+10+20),e=0,i=l=0,p=_.length;p>l;i=++l)if(h=_[i],e+=new a(h.label).length*o+16+3+8,e>d||i>=6){c=i-1,m=_.slice(c),_=_.slice(0,c);break}return g.div({className:"c-column-header browse-menu browse-file-list-header"},g.span({className:"browse-menu__description"},t),g.ul({className:"browse-menu__actions"},function(){var e,t,s;for(s=[],e=0,t=_.length;t>e;e++)h=_[e],s.push(this._renderMenuButton(h));return s}.call(this),m?this._renderMoreActionsDropdown(m):void 0),g.span({className:"browse-menu__filesize-label"},n))}}),{BrowseSelectionMenu:p}})}.call(this),function(){define("modules/dirty/react/browse/share_button",["require","external/classnames","external/react","modules/clean/css","modules/clean/keycode","modules/clean/react/button","modules/clean/react/browse/models","modules/clean/react/sprite","modules/core/i18n","modules/dirty/react/browse/sharing_shims"],function(e,t,s,r,n,o,i,a,l,u){var c,p,d,h,_,m,f,g,b;return _=o.button,c=i.BrowseContext,p=i.File,h=l._,b=u.initiateSharingFromUIElement,g=u.hasMultipleSharingOptions,f=s.DOM,m=s.createElement,d=s.createClass({displayName:"ShareButton",mixins:[s.addons.PureRenderMixin],propTypes:{browseContext:s.PropTypes.instanceOf(c).isRequired,file:s.PropTypes.instanceOf(p).isRequired,user:s.PropTypes.object.isRequired,isPagelet:s.PropTypes.bool},handleClick:function(e){var t,s,r,n,o;return r=this.props,o=r.user,s=r.file,t=r.browseContext,n=this.refs.button.getDOMNode(),b(n,o,s,t,"BROWSE_FILE_ROW"),this.props.isPagelet?e.stopPropagation():void 0},handleDoubleClick:function(e){return e.stopPropagation(),this.handleClick()},render:function(){var e,s,r;return r=g(this.props.user,this.props.file,this.props.browseContext),s={"c-btn c-btn--tertiary":!0,"inline-button":!0,"inline-share-button":!0,"variant-DROPDOWN":!0,"extra-padding":!r},e=h(this.props.browseContext.isNonUserRelativeContext?"Manage access":"Share"),m(_,{className:t(s),onClick:this.handleClick,onDoubleClick:this.handleDoubleClick,ref:"button",importance:"secondary"},f.span({className:"inline-share-button-label"},e),r?m(a,{group:"web",name:"arrow-down-blue",alt:""}):void 0)}}),{ShareButton:d}})}.call(this),function(){var e=function(e,s){function r(){this.constructor=e}for(var n in s)t.call(s,n)&&(e[n]=s[n]);return r.prototype=s.prototype,e.prototype=new r,e.__super__=s.prototype,e},t={}.hasOwnProperty,s=[].indexOf||function(e){for(var t=0,s=this.length;s>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/dirty/react/browse/shared_with",["jquery","external/react","external/underscore","modules/core/user_i18n","modules/clean/account/email","modules/clean/ajax","modules/clean/flux/base_store","modules/clean/flux/dispatcher","modules/clean/flux/store_mixin","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/browse/store","modules/clean/react/sharing/shared_with_view","modules/clean/sharing/api","modules/clean/sharing/api/client","modules/clean/sharing/api/types/metadata","modules/clean/sharing/ui_util","modules/clean/file_events","modules/dirty/sharing/browse_ui_util","require"],function(t,r,n,o,i,a,l,u,c,p,d,h,_,m,f,g,b,S,y,v){var T,w,E,P,F,I,D,C,N,A,R,O,L,M,x,U,k,B,q,H,G,W;return P=i.EmailVerification,T=p.BrowseActionTypes,M=p.SharedWithActionTypes,w=d.BrowseContext,F=d.File,E=h.BrowseStore,q=_.SharedWithView,H=m.SharingApi,I=f.FileShareApiClient,D=f.FolderShareApiClient,O=g.MemberCounts,W=y.showTiburonUIIfAllowed,G=r.createElement,R=5,C=3,N=100,L=100,A="file_row_sharing_menu",B=function(t){function s(){return s.__super__.constructor.apply(this,arguments)}return e(s,t),s.prototype._init=function(){return this._sharedFolderDataByTargetNs={},this._sharedFolderMemberCountsByTargetNs={},this._sharedLinkDataMapsByFolderFQPath={},this._filesWeHaveSharedLinkDataFor={},this._sharedFileDataByFileId={},this._isSharedFolderDataLoaded=!1},s.prototype.hasLinkDataForFile=function(e){return e.fq_path in this._filesWeHaveSharedLinkDataFor},s.prototype.isSharedFolderDataLoaded=function(){return this._isSharedFolderDataLoaded},s.prototype.clearSharedLinkDataCache=function(){return this._filesWeHaveSharedLinkDataFor={}},s.prototype.getDataForFile=function(e){var t,s,r,n,o;return s=null,null!=e.target_ns&&(s=this._sharedFolderDataByTargetNs[e.target_ns]),this._canBeSharedFile(e)&&(s=this._sharedFileDataByFileId[null!=(r=e.file_id)?r:e.fq_path]),t=E.path(),o=this._sharedLinkDataMapsByFolderFQPath[t],o&&(n=o[this._sharedLinkKey(e)],n?(s||(s={}),s.sharedLinkInfo=n):null!=s&&delete s.sharedLinkInfo),s||(s={}),s.inheritedMemberCounts=this._getMemberCounts(),s},s.prototype._sharedLinkKey=function(e){return e.fq_path+"_"+e.ns_id+"_"+e.sjid},s.prototype._new_payload=function(e){switch(e.action.type){case T.LOAD_PATH:return this._pathLoaded(e.action.data);case T.ADD_FILES:return this._filesAdded(e.action.data);case T.INITIALIZE_EVERYTHING:return this._browseInitializeEverything(e.action.data);case T.CHANGE_FILES:return this._filesChanged(e.action.data);case M.SIGNAL_SHARED_FILE_DATA_OUT_OF_DATE:return this._signalSharedFileDataOutOfDate(e.action.data);case M.SIGNAL_SHARED_FOLDER_DATA_OUT_OF_DATE:return this._signalSharedFolderDataOutOfDate(e.action.data);case M.SIGNAL_SHARED_LINK_DATA_OUT_OF_DATE:return this._signalSharedLinkDataOutOfDate(e.action.data);case M.SET_SHARED_FOLDER_DATA:return this._setNSSharedWithData(e.action.data);case M.SET_MEMBER_COUNTS_FOR_NS:return this._setMemberCountsForNs(e.action.data);case M.SET_SHARED_LINK_DATA:return this._setSharedLinkData(e.action.data);case M.SET_SHARED_FILE_DATA:return this._setSharedFileData(e.action.data);case M.CLEAR_SHARED_FOLDER_DATA_FOR_NS:return this._clearSharedFolderDataForNs(e.action.data);case M.REMOVE_SHARED_LINK_DATA:return this._removeSharedLinkData(e.action.data)}},s.prototype._fillInMissingSharedLinkData=function(e){var t,s,r,n,o,i,a;for(a=e.parentPath,r=e.files,n=[],o=0,i=r.length;i>o;o++)s=r[o],this.hasLinkDataForFile(s)||(this._filesWeHaveSharedLinkDataFor[s.fq_path]=!0,n.push(s));return x.loadLinkDataForFiles({parentPath:a,fileFqPaths:function(){var e,s,r;for(r=[],e=0,s=n.length;s>e;e++)t=n[e],r.push(t.fq_path);return r}()})},s.prototype._getMemberCounts=function(){var e;return e=E.context().currentNSID,e in this._sharedFolderMemberCountsByTargetNs?this._sharedFolderMemberCountsByTargetNs[e]:new O},s.prototype._canBeSharedFile=function(e){return!(e.is_dir||e.isDeleted)},s.prototype._loadSharedFileData=function(e){var t,s,r,n,o,i,a;if(n=(null!=e?e:{invalidateCache:!1}).invalidateCache,a=E.user(),b.Tiburon.filesFacesUI(a.id)){for(n&&(this._sharedFileDataByFileId={}),s=[],i=E.files().toArray(),r=0,o=i.length;o>r;r++)t=i[r],!this._canBeSharedFile(t)||t.file_id in this._sharedFileDataByFileId||s.push(t.file_id);return x.loadSharedFileDataForFiles({fileIds:s})}},s.prototype._pathLoaded=function(e){var t,s;return t=e.files,s=e.path,this._isSharedFolderDataLoaded=!1,x.loadMemberCountsForContainingNs(),x.loadSFDataForPath({parentPath:s}),this._loadSharedFileData({invalidateCache:!0}),this._filesAdded({files:t,path:s})},s.prototype._filesAdded=function(e){var t,s;return t=e.files,s=e.path,this._fillInMissingSharedLinkData({parentPath:s,files:t}),this._loadSharedFileData()},s.prototype._filesChanged=function(e){var t,s,r;return r=e.path,s=e.fileDeltas,r===E.path()&&null!=s&&s.length?(u.waitFor([E.dispatchToken]),this._isSharedFolderDataLoaded=!1,x.loadSFDataForPath({parentPath:r}),this.clearSharedLinkDataCache(),t=E.files().toArray(),this._fillInMissingSharedLinkData({parentPath:r,files:t}),this._loadSharedFileData({invalidateCache:!0})):void 0},s.prototype._signalSharedFileDataOutOfDate=function(e){var t;return t=e.fileIds,x.loadSharedFileDataForFiles({fileIds:t})},s.prototype._signalSharedFolderDataOutOfDate=function(e){var t;return t=e.parentPath,null==t&&(t=E.path()),this._isSharedFolderDataLoaded=!1,x.loadMemberCountsForContainingNs(),x.loadSFDataForPath({parentPath:t})},s.prototype._signalSharedLinkDataOutOfDate=function(e){var t,s;return s=e.parentPath,t=e.fileFqPaths,null==s&&(s=E.path()),x.loadLinkDataForFiles({parentPath:s,fileFqPaths:t})},s.prototype._setNSSharedWithData=function(e){var t;return t=e.sharedFolderData,this._sharedFolderDataByTargetNs=t,this._isSharedFolderDataLoaded=!0,this.emit_change()},s.prototype._setMemberCountsForNs=function(e){var t,s;return s=e.targetNs,t=e.memberCounts,this._sharedFolderMemberCountsByTargetNs[s]=t,this.emit_change()},s.prototype._setSharedLinkData=function(e){var t,s,r,n,o,i,a,l;for(n=e.parentPath,i=e.sharedLinkData,l=this._sharedLinkDataMapsByFolderFQPath[n]||{},s=0,r=i.length;r>s;s++)o=i[s],t=o.file,a=o.sharedLinkToken,l[this._sharedLinkKey(t)]=a;return this._sharedLinkDataMapsByFolderFQPath[n]=l,this.emit_change()},s.prototype._setSharedFileData=function(e){var t;return t=e.sharedFileData,n.extend(this._sharedFileDataByFileId,t),this.emit_change()},s.prototype._clearSharedFolderDataForNs=function(e){var t;return t=e.targetNs,this._isSharedFolderDataLoaded=!1,this._sharedFolderDataByTargetNs[t]=void 0,this.emit_change()},s.prototype._browseInitializeEverything=function(e){var t,s;return s=e.path,t=e.files,this._isSharedFolderDataLoaded=!1,x.loadMemberCountsForContainingNs(),x.loadSFDataForPath({parentPath:s}),this._filesAdded({path:s,files:t})},s.prototype._removeSharedLinkData=function(e){var t,s,r,n,o,i;for(o=e.parentPath,s=e.files,i=this._sharedLinkDataMapsByFolderFQPath[o]||{},r=0,n=s.length;n>r;r++)t=s[r],i[this._sharedLinkKey(t)]=void 0;return this._sharedLinkDataMapsByFolderFQPath[o]=i,this.emit_change()},s}(l),k=new B,t(document).on(H.REQUEST_SUCCEEDED_EVENT,function(e,t){var s;return s=t.request_url,s.indexOf("/share_ajax/leave")>-1||s.indexOf("/share_ajax/unshare")>-1?u.dispatch({type:M.CLEAR_SHARED_FOLDER_DATA_FOR_NS,data:{targetNs:t.ns_id}}):u.dispatch({type:M.SIGNAL_SHARED_FOLDER_DATA_OUT_OF_DATE,data:{parentPath:E.path()}})}).on(S.LINKS_REMOVE,function(e,t){return u.dispatch({type:M.SIGNAL_SHARED_LINK_DATA_OUT_OF_DATE,data:{parentPath:E.path(),fileFqPaths:[t.fq_path]}})}).on(S.LINKS_ADD,function(e,t){return u.dispatch({type:M.SIGNAL_SHARED_LINK_DATA_OUT_OF_DATE,data:{parentPath:E.path(),fileFqPaths:[t.fq_path]}})}),x=function(){function e(){}return e.loadSFDataForPath=function(e){var t,s;return t=e.parentPath,s=E.user(),a.WebRequest({url:"/share_ajax/shared_with",dataType:"json",subject_user:s,data:{max_results:R,fq_path_prefix:t,include_inherited:!E.context().isInsideSharedFolder,admin_console:E.context().isNonUserRelativeContext?"true":void 0},success:function(e){var t,s,r,n,o;for(o={},t=0,s=e.length;s>t;t++)n=e[t],r={numUndisplayableUsersAndInvites:n.num_avatars_not_shown,groups:n.groups,invitations:n.invitations,joinedMembers:n.joined_members,includeInherited:!E.context().isInsideSharedFolder},o[n.ns_id]=r;return u.dispatch({type:M.SET_SHARED_FOLDER_DATA,data:{sharedFolderData:o}})}})},e.loadMemberCountsForContainingNs=function(){var e,t,s;return s=E.user(),t=E.context().isInsideSharedFolder?E.context().currentNSID:void 0,s.is_email_verified&&t?(e=new D({userId:s.id}),e.getMemberCounts({contentId:t}).then(function(e){return u.dispatch({type:M.SET_MEMBER_COUNTS_FOR_NS,data:{memberCounts:e,targetNs:t}})})):void 0},e.loadSharedFileDataForFiles=function(e){var t,s,r,n;return s=e.fileIds,n=E.user(),n.is_email_verified?(t=new I({userId:n.id}),(r=function(e){var s,n,o;if(0!==e.length)return o=e.slice(0,L),s=e.slice(L),n=t.listMembersBatch({contentIds:o,limit:R}),n.then(function(e){var t;return t={},e.forEach(function(e,s){return t[s]={numUndisplayableUsersAndInvites:0,groups:e.groups.valueSeq().map(b.apiGroupMemberToAvatarInfo).toArray(),invitations:e.invitees.valueSeq().map(b.apiInviteeMemberToAvatarInfo).toArray(),joinedMembers:e.users.valueSeq().map(b.apiUserMemberToAvatarInfo).toArray()}}),u.dispatch({type:M.SET_SHARED_FILE_DATA,data:{sharedFileData:t}}),s?r(s):void 0})})(s)):void 0},e.loadLinkDataForFiles=function(e){var t,r,n,o;return r=e.parentPath,t=e.fileFqPaths,o=E.user(),(n=function(e){var t,i;if(0!==e.length)return i=e.slice(0,N),t=e.slice(N),a.SilentBackgroundRequest({url:"/sm/get_token_info",dataType:"json",data:{paths:JSON.stringify(i)},subject_user:o,success:function(e){var o,a,l,c,p,d,h,_,m,f,g;for(l=E.filesMap(),m=[],h=e.shmodels,c=0,p=h.length;p>c;c++)g=h[c],g.disabled||(o=l.get(g.path),o&&m.push({file:o,sharedLinkToken:g}));return m.length&&u.dispatch({type:M.SET_SHARED_LINK_DATA,data:{parentPath:r,sharedLinkData:m}}),f=function(){var t,s,r,n;for(r=e.shmodels,n=[],t=0,s=r.length;s>t;t++)_=r[t],n.push(_.path);return n}(),a=function(){var e,t,r;for(r=[],e=0,t=i.length;t>e;e++)d=i[e],s.call(f,d)>=0||r.push(l.get(d));return r}().filter(function(e){return null!=e}),a.length&&u.dispatch({type:M.REMOVE_SHARED_LINK_DATA,data:{parentPath:r,files:a}}),t?n(t):void 0}})})(t)},e}(),U=r.createClass({displayName:"SharedWithController",mixins:[c(k)],propTypes:{browseContext:r.PropTypes.instanceOf(w).isRequired,file:r.PropTypes.instanceOf(F).isRequired},_get_state_from_stores:function(e){var t,s,r,n,o,i,a,l;return t=k.getDataForFile(e.file),{numUndisplayableUsersAndInvites:null!=(s=null!=t?t.numUndisplayableUsersAndInvites:void 0)?s:0,numInheritedMembers:null!=(r=null!=t&&null!=(n=t.inheritedMemberCounts)?n.total_unique_users:void 0)?r:0,groups:null!=(o=null!=t?t.groups:void 0)?o:[],invitations:null!=(i=null!=t?t.invitations:void 0)?i:[],joinedMembers:null!=(a=null!=t?t.joinedMembers:void 0)?a:[],sharedLinkInfo:null!=(l=null!=t?t.sharedLinkInfo:void 0)?l:null}},componentWillReceiveProps:function(e){return this.setState(this._get_state_from_stores(e))},_showSharingModal:function(){var e,t,s;return t=[E.user(),this.props.file],s=t[0],e=t[1],W(s,e,{browseContext:this.props.browseContext,origin:"BROWSE_FILE_ROW"})?void 0:v(["dropbox"],function(t){var r;return r=t.ExistingSharedFolderOptionsModal,e.is_dir?new r(s,e.fq_path).show():void 0})},handleOverflowCountClick:function(){return this._showSharingModal()},handleAvatarClick:function(){return this._showSharingModal()},handleSharedLinkClick:function(){var e;return e=E.user(),P.get_for_user(e).verified_or_show()&&!W(e,this.props.file,{browseContext:this.props.browseContext,origin:"BROWSE_FILE_ROW"})?v(["dropbox"],function(t){return function(s){var r,n;return n=s.SharingShmodel,r=s.Browse,null==r.active_user&&(r.active_user=e),n.shmodel(t.props.file.fq_path,A)}}(this)):void 0},_getMaxVisibleAvatars:function(){return b.GoldenGate.hasNewMembershipUI(E.user().id)?C:R},render:function(){return G(q,{user:E.user(),file:this.props.file,numUndisplayableUsersAndInvites:this.state.numUndisplayableUsersAndInvites,numInheritedMembers:this.state.numInheritedMembers,parentFolderName:E.context().getNameOfTargetFolder(),groups:this.state.groups,invitations:this.state.invitations,joinedMembers:this.state.joinedMembers,sharedLinkInfo:this.state.sharedLinkInfo,animation:!1,onOverflowCountClick:this.handleOverflowCountClick,onAvatarClick:this.handleAvatarClick,onSharedLinkClick:this.handleSharedLinkClick,maxVisibleAvatars:this._getMaxVisibleAvatars(),isSharedFolderDataLoaded:k.isSharedFolderDataLoaded()})}}),{SharedWithActions:x,SharedWithController:U,SharedWithStore:k}})}.call(this),function(){define("modules/dirty/react/browse/sharing_shims",["modules/clean/analytics","modules/clean/react/browse/constants","modules/clean/sharing/models/file","modules/dirty/sharing/browse_ui_util","require","external/rsvp"],function(e,t,s,r,n,o){var i,a,l,u,c,p,d,h,_,m,f,g,b;return u=e.ShmodelUILogger,a=t.NameSpaceAccess,i=t.FileTypes,p=s.canConvertToSharedFolder,b=r.showTiburonUIIfAllowed,m=r.isTiburonUIAllowed,l=o.Promise,_=function(e){return e.type===i.SHARED_FOLDER||e.type===i.TEAM_SHARED_FOLDER},c=function(e,t){var s;return s=u.TARGET_ITEMS,e.is_dir?_(e)?s.FOLDER_IS_SF:p(e,t)?s.FOLDER_CAN_SF:s.FOLDER_NO_SF:s.FILE},f=function(e,t,s){return b(e,t,{browseContext:s})?new l(function(e){return e()}):new l(function(e,t){return n(["dropbox"],function(t){return e(t)},function(e){return t(e)})}).then(function(r){var n,o,i,l,u;return n=r.Browse,o=r.BrowseSelection,null==n.active_user&&(n.active_user=e),l=c(t,s),s.isInsideSharedFolder?(u=s.currentSharedFolderPermissionRole,i=u===a.ACCESS_OWNER):i=!0,o.show_share_modal_if_email_verified(e,_(t),l,t.fq_path,i)})},g=function(e,t,s,r){return b(e,t,{browseContext:s})?new l(function(e){return e()}):new l(function(e,t){return n(["dropbox"],function(t){return e(t)},function(e){return t(e)})}).then(function(n){var o,i,a;return o=n.Browse,i=n.SharingShmodel,null==o.active_user&&(o.active_user=e),a=c(t,s),u.log("token_share",r,a),i.shmodel(t.fq_path,r)})},d=function(e,t,s){var r;return r=t.type===i.TEAM_SHARED_FOLDER,m(e,t,s)||r?!1:_(t)||p(t,s)},h=function(e,t,s,r,o){return new l(function(e,t){return n(["dropbox"],function(t){return e(t)},function(e){return t(e)})}).then(function(n){var a,l,u,p,h,m;return a=n.Browse,u=n.SharingGrowthExperimentsDropdown,l=n.ExistingSharedFolderOptionsModal,b(t,s,{browseContext:r,origin:o})?void 0:(null==a.active_user&&(a.active_user=t),p=s.type===i.TEAM_SHARED_FOLDER,h=c(s,r),d(t,s,r)?u.open(s.fq_path,_(s),e,t,h):p?(m=new l(t,s.fq_path),m.show()):g(t,s,r,"browse_file_row"))})},{hasMultipleSharingOptions:d,initiateSharingFromUIElement:h,showShareFolderModal:f,showShareLinkModal:g}})}.call(this),function(){define("modules/dirty/search/search_results",["external/immutable","external/react","external/underscore","modules/clean/flux/store_mixin","modules/clean/notserver","modules/clean/react/css","modules/clean/react/file_modal_controller","modules/clean/search/actions","modules/clean/search/api","modules/clean/search/store","modules/dirty/search/search_results_view"],function(e,t,s,r,n,o,i,a,l,u,c){var p,d,h,_,m;return d=n.NotClients,p=i.FileModalController,m=t.DOM,_=t.createElement,h=t.createClass({displayName:"SearchResultsController",mixins:[r(u)],_get_state_from_stores:function(){return{context:u.browseContext(),hasMoreResults:u.hasMoreResults(),loadingState:u.loadingState(),latestQuery:u.latestQuery(),numDeletedResults:u.numDeletedResults(),searchResults:u.searchResults(),selection:u.selection(),selectedFiles:u.selectedFiles(),didLoadDeletedResults:u.didLoadDeletedResults()}},propTypes:{isPagelet:t.PropTypes.bool,limitedTeamBannerUpsell:t.PropTypes.bool,onFullSearch:t.PropTypes.func,onPathOpen:t.PropTypes.func,path:t.PropTypes.string,topMenuItems:t.PropTypes.element.isRequired,trademarkBusiness:t.PropTypes.string,user:t.PropTypes.object},componentWillMount:function(){return this._setupFileEventListener(this.props.user.id)},componentWillUnmount:function(){return d[this.props.user.id].unsubscribe(this.handlerId)},_setupFileEventListener:function(){var e;return this.searchApi=new l,e=d[this.props.user.id],this.handlerId=e.subscribe_sfj({name:"SearchEventDispatcher",handler:function(t){return function(){return t.state.latestQuery?t.searchApi.getUpdatesForResults({query:t.state.latestQuery,namespaceToJournalIdMap:e.get_ns_map(),showDeleted:t.state.didLoadDeletedResults,user:t.props.user,onSuccess:function(s){return a.applyUpdatesFromNotserver({payload:s,path:t.props.path}),e.handler_success(t.handlerId,{ns_map:s.ns_map})}}):void e.handler_success(t.handlerId,{ns_map:e.get_ns_map()})}}(this)})},_handleScroll:function(){var e;return e=this.getDOMNode().getBoundingClientRect(),e.bottom<=window.innerHeight?a.loadMoreResults({path:this.props.path,user:this.props.user}):void 0},handleSelectionChange:function(e){return a.setSearchSelection({selection:e})},handleDelete:function(){var e;return e=this.state.selectedFiles.toArray(),p.showDelete(this.props.user,e,this.state.context,s.noop)},handleRestoreMulti:function(){var e;return e=this.state.selectedFiles.toArray(),p.showRestore(this.props.user,e,function(){})},handlePermanentDelete:function(){var e,t;return e=this.state.selectedFiles,t=function(){return a.removeSearchResults({fq_paths:e.map(function(e){return e.fq_path})})},p.showPermanentlyDelete(this.props.user,e.toArray(),t)},render:function(){return _(c,s.extend({},{isPagelet:this.props.isPagelet,limitedTeamBannerUpsell:this.props.limitedTeamBannerUpsell,onFullSearch:this.props.onFullSearch,onScroll:s.throttle(this._handleScroll,200),onSelectionChange:this.handleSelectionChange,path:this.props.path,topMenuItems:this.props.topMenuItems,trademarkBusiness:this.props.trademarkBusiness,user:this.props.user,actionHandlers:{onDelete:this.handleDelete,onRestoreMulti:this.handleRestoreMulti,onPermanentDelete:this.handlePermanentDelete}},this.state))}}),h=o(h,["/static/css/browse/browse-vflMD7V38.css","/static/css/scooter/scooter-scoped-vfl6M_UYZ.css"])})}.call(this),function(){define("modules/dirty/search/search_results_view",["jquery","external/classnames","external/immutable","external/react","external/underscore","modules/clean/analytics","modules/clean/browse_interface","modules/clean/filepath","modules/clean/react/app_actions_view","modules/clean/react/browse/constants","modules/clean/react/image","modules/clean/react/sprite","modules/clean/react/user_notifications/dropdown","modules/clean/search/constants","modules/clean/search/search_helpers","modules/clean/teams/team_promo_banner","modules/clean/static_urls","modules/constants/browse","modules/constants/viewer","modules/core/browser","modules/core/i18n","modules/core/uri","modules/dirty/react/browse/actions","modules/dirty/react/browse/context_menu","modules/dirty/react/browse/file_actions","modules/dirty/react/browse/item_list","modules/dirty/react/browse/selection_actions"],function(e,t,s,r,n,o,i,a,l,u,c,p,d,h,_,m,f,g,b,S,y,v,T,w,E,P,F){var I,D,C,N,A,R,O,L,M,x,U,k,B,q,H,G;return x=o.TeamsWebActionsLogger,C=u.DropTargetHighlightMode,A=u.LoadingStates,R=u.NewFolderCreationState,L=h.SearchLoadingStates,H=f.static_url,O=b.ROLE_WORK,U=y._,G=y.ungettext,I=w.BrowseContextMenu,q=E.getActionsForFileCollection,N=P.ItemListController,D=F.BrowseSelectionMenu,B=r.DOM,k=r.createElement,M=r.createClass({displayName:"SearchResultsView",propTypes:{hasMoreResults:r.PropTypes.bool,isPagelet:r.PropTypes.bool,loadingState:r.PropTypes.oneOf(n.values(L)),latestQuery:r.PropTypes.string,limitedTeamBannerUpsell:r.PropTypes.bool,onFullSearch:r.PropTypes.func,onScroll:r.PropTypes.func,path:r.PropTypes.string,topMenuItems:r.PropTypes.element,searchResults:r.PropTypes.instanceOf(s.List),selection:r.PropTypes.object,selectedFiles:r.PropTypes.instanceOf(s.OrderedSet),trademarkBusiness:r.PropTypes.string,user:r.PropTypes.object,actionHandlers:r.PropTypes.object},componentDidMount:function(){return e(window).on("scroll.SearchResults",this.props.onScroll)},componentWillUnmount:function(){return e(window).off("scroll.SearchResults")},renderFullSearchLink:function(){var e,t;return t=this.props.user.role===O?i.WORK_ROOT:i.PERSONAL_ROOT,e=v.parse("/search"+t).setQuery({path:"/",query:this.props.latestQuery}).toString(),B.a({href:e,onClick:this.props.onFullSearch},U("Search all of my Dropbox instead"))},renderEmptyFolderView:function(){return B.div({className:"u-font-center u-pad-top-xl"},k(c,{src:H("/static/images/empty_states/search-vfl6DaX2I.png"),srcHiRes:H("/static/images/empty_states/search@2x-vflBsUhDE.png"),alt:""}),B.h2({className:"u-pad-top-l"},U("No results found")),B.div({},"/"===this.props.path?U("Please update your search and try again"):this.renderFullSearchLink()))},renderUpsellPromoBanner:function(){return this.props.loadingState!==A.LOADED||this.props.hasMoreResults||this._banner_view_logged||(this._banner_view_logged=!0,x.log("banner_search_displayed",{
location:"search_results",item_count:this.props.searchResults.size})),k(m,{description:[U("Search through file contents in addition to file names with %(trademark_business)s").format({trademark_business:this.props.trademarkBusiness}),B.a({className:"upsell_info u-pad-xxs",href:"/help/6635",target:"_blank",key:"info-link"},k(p,{group:"web",name:"info",alt:"more info"}))],buttons:[{text:U("Upgrade"),handler:function(){return S.redirect(v({path:"/team/upgrade",query:{tk:"search_upsell_results",camp:"web"}}))}}]})},render:function(){var e,s,r,o,i,u;return r=this.props.loadingState===L.LOADING_FIRST_PAGE?A.LOADING_FIRST_PAGE:this.props.loadingState===L.LOADING_ADDITIONAL_PAGE?A.LOADING_REMAINING_PAGES:A.LOADED,i="/"===this.props.path&&g.SHOW_PAPER_SEARCH_RESULTS?G("%(num_results)d result in files, folders, Paper docs, and content.","%(num_results)d results in files, folders, Paper docs, and content.",this.props.searchResults.size).format({num_results:this.props.searchResults.size}):G("%(num_results)d result in files, folders, and content.","%(num_results)d results in files, folders, and content.",this.props.searchResults.size).format({num_results:this.props.searchResults.size}),B.div({className:t({"search-results":!0,promo:this.props.limitedTeamBannerUpsell}),id:"browse-box"},B.div({className:"browse-header search-results__header"},B.h1({className:"search-results__title"},this.props.loadingState!==L.LOADED?U("Searching…"):this.props.isPagelet?U("Search results"):"/"===this.props.path?U("Results for ‘%(query)s’ in ‘%(path)s’",{comment:"Path is a folder name in the user's Dropbox"}).format({query:this.props.latestQuery,path:a.filename(this.props.path)}):void 0),this.props.topMenuItems,this.props.limitedTeamBannerUpsell?this.renderUpsellPromoBanner():void 0,this.props.loadingState!==L.LOADING_FIRST_PAGE&&this.props.searchResults.size?B.div({className:t({"search-results__info":!0,"o-grid--no-gutter":this.props.isPagelet})},this.props.hasMoreResults?i:[B.span({className:t({"o-grid__col":this.props.isPagelet,"o-grid__col--8-of-12":this.props.isPagelet})},i),this.props.isPagelet?B.span({},U("Modified")):"/"!==this.props.path?B.span({className:"u-pad-horizontal-xs"},this.renderFullSearchLink()):void 0]):void 0),this.props.isPagelet?this.props.selectedFiles.size?(s=q({files:this.props.selectedFiles,context:this.props.context,user:this.props.user,actionHandlers:this.props.actionHandlers}),o={displayName:s[0].label,handleClick:s[0].performAction},u=function(){var t,r,n,o;for(n=s.slice(1),o=[],t=0,r=n.length;r>t;t++)e=n[t],o.push({displayName:e.label,handleClick:e.performAction,iconName:e.spriteName});return o}(),k(l,{primaryMenuItem:o,secondaryMenuItems:u})):void 0:(k(I,{user:this.props.user,selectedFiles:this.props.selectedFiles,context:this.props.context,shouldShowGlobalActions:!1,actionHandlers:this.props.actionHandlers}),k(D,{user:this.props.user,selectedFiles:this.props.selectedFiles,context:this.props.context,actionHandlers:this.props.actionHandlers})),k(N,{context:this.props.context,items:this.props.searchResults,loadingState:r,isPagelet:this.props.isPagelet,isSearchMode:this.props.isPagelet,isColumnHeaderVisible:!1,isMultiColumnGroupVisible:!1,isPaginating:!1,isTextSelectable:!1,isDragAndDropEnabled:!1,shouldShowDeletedFiles:!1,showContainingPaths:!0,showFilenameHighlights:!0,user:this.props.user,path:this.props.path,selection:this.props.selection,selectedFiles:this.props.selectedFiles,onSelectionChange:this.props.onSelectionChange,customEmptyFolderView:this.renderEmptyFolderView,actionHandlers:this.props.actionHandlers,onOutsideMouseUp:this.props.isPagelet?n.noop:void 0}))}})})}.call(this),function(){define("modules/dirty/sharing/sf_access_type",["jquery","modules/core/controller_helpers","modules/core/i18n","modules/core/notify","modules/clean/analytics","modules/clean/components/bubble_picker","modules/clean/dbmodal","modules/clean/dbmodal_loading","modules/clean/groups/api","modules/clean/sharing/api","modules/clean/viewer"],function(e,t,s,r,n,o,i,a,l,u,c){var p,d,h,_,m,f;return f=s._,_=n.SharedFolderActivityLogger,p=i.DBModal,d=i.DBModalStack,m=u.SharingApi,h=function(){function e(e,s){this.$access_type_el=e,this.ajax_data=s,this.bubble_picker=t.get_controller(this.$access_type_el),this.$access_type_el.on(o.CHANGED,function(e){return function(t,s){var r,n,o,i,a,l;return o=s.old_val,n=s.clicked_val,Number(o)===Number(n)?!1:(e.ajax_data&&(l=c.get_viewer().get_user_by_id(e.ajax_data.user_id),i=e.ajax_data.params,r=e.ajax_data.access_types,a=e.$access_type_el.closest(".bs-row").find(".sf-display-name").text(),"owner"===r[n]?(e.show_make_owner_modal(l,i.member_uid,i.ns_id,a,n),e.bubble_picker.set_value(o)):e.update_access_type(l,i,a,n)),!1)}}(this))}return e.prototype.show_make_owner_modal=function(e,t,s,n,o){return require(["dropbox"],function(r){var i;return i=r.MakeOwnerModal,d.push(new i(e,{element_id:"make-owner-confirm-modal",member_uid:t,member_name:n,ns_id:s,access_type:o}))},function(){return r.error(r.DEFAULT_ERROR)})},e.prototype.update_access_type=function(e,t,s,n){var o,i,u;return o={ns_id:t.ns_id,access_type:n},u=function(n){return function(i){var l,u,c;if(c=JSON.parse(i.responseText),o.member_id=t.member_uid,"OK"===c.status){switch(o.succes=!0,c.access_type){case"viewer":u=f("%(name)s can only view now.").format({name:s});break;case"editor":u=f("%(name)s can edit now.").format({name:s});break;case"owner":u=f("%(name)s is the owner now.").format({name:s})}u&&r.success(u)}else"ERROR"===c.status&&(o.succes=!1,c.msg&&(o.message=c.msg,r.error(c.msg)),c.reload&&(l=p.get_containing_modal(n.$access_type_el),l&&l instanceof a&&l.fetch()));return _.log("web","invite_modal_change_callback",e,o)}}(this),i=new m(e),t.member_uid?(i.update_member_access_type(t.ns_id,t.member_uid,n,u),o.member_uid=t.member_uid,_.log("web","invite_modal_change_collaborator",e,o)):t.invite_id?(i.update_invite_access_type(t.invite_id,n,u),o.invite_id=t.invite_id,_.log("web","invite_modal_change_invite",e,o)):t?(l.change_group_access_type({ns_id:t.ns_id,group_id:t.group_gid,access_type:n},u),o.group_id=t.group_gid,_.log("web","invite_modal_change_group",e,o)):void 0},e}()})}.call(this);
//# sourceMappingURL=pkg-ag.min.js-vflYUuTYd.map