define("dropbox",["modules/clean/teams/modals/suggest_team_invite_modal","modules/clean/browse_interface","modules/clean/react/previews/preview_linkfile","modules/clean/base64","modules/clean/sharing/api/client","modules/clean/avatar/stacked_avatars","modules/core/uri","modules/clean/file_events","modules/clean/previews/preview_actions_helper","modules/clean/em_string","modules/constants/debug","libs","modules/constants/legacy","modules/clean/uirequest","modules/clean/react/file_viewer/file_preview_update_watcher","modules/clean/history","modules/clean/sharing/content_info","external/underscore","modules/clean/ajax","modules/clean/sso_login_checks","modules/core/notify","modules/clean/display_format","modules/clean/search/search_helpers","modules/clean/job_progress","modules/clean/pagination_manager","modules/constants/static","modules/constants/file_viewer","modules/clean/previews/pdf_loader","modules/constants/viewer","modules/clean/sharing/constants","modules/clean/account/email","modules/clean/dbmodal","modules/clean/teams/team_folder_modal","modules/clean/events/rollback","modules/clean/react/browse/constants","modules/clean/page_role_observer","modules/clean/sharing/api","modules/clean/event_load","modules/clean/contacts/facebook_modal","modules/clean/contacts/facebook_oauth","modules/clean/components/role_picker","external/plupload_dev","external/keymaster","modules/clean/image_size","modules/clean/viewer","modules/core/controller_helpers","modules/clean/sharing/shared_content_link_sync_modal","modules/constants/python","modules/clean/sprite","modules/clean/dbmodal_loading","modules/clean/undo","modules/dirty/sharing/browse_ui_util","modules/clean/notserver","modules/clean/gandalf_util","modules/clean/multiaccount_login","modules/dirty/sharing/wizard_modals","modules/clean/datetime","modules/clean/video_util","modules/clean/react/previews/preview_flippable","modules/clean/downloads","modules/clean/contacts/types","external/react","modules/clean/profile_services/profile_services_constants","external/flash_detect","external/purify","modules/dirty/react/file_viewer/controller","modules/constants/env","modules/clean/react/previews/image_helpers","jquery","modules/core/exception","modules/clean/components/bubble_picker","modules/clean/groups/api","external/modernizr","modules/clean/flux/dispatcher","modules/clean/components/ajax_form","modules/clean/browse_events","modules/clean/react/modal","modules/clean/contacts/list","modules/clean/sharing/ui_util","modules/clean/profile_services/profile_services_link","modules/core/i18n","modules/constants/request","modules/clean/top_notif","modules/core/dom","modules/clean/web_timing_logger","modules/clean/form","modules/core/cookies","modules/clean/clipboard","modules/clean/payments/cash","modules/clean/browse/browse_drag_utils","modules/clean/account/email_verify_reasons","modules/clean/payments/dfb_util","modules/clean/search/search_type","external/jquery_ui","modules/clean/contacts/cache","modules/clean/frame_messenger","modules/clean/analytics","modules/clean/photos/legacy_thumb_loader","modules/core/browser","modules/clean/react/previews/preview_blank","modules/clean/filepath","modules/core/html","modules/clean/static_urls"],function(e,t,n,i,r,o,s,a,_,l,u,d,c,h,f,p,m,v,g,w,b,y,k,E,x,C,S,T,A,D,O,N,I,L,R,q,M,P,F,U,j,B,z,V,H,Y,W,K,G,J,X,Q,Z,ee,te,ne,ie,re,oe,se,ae,_e,le,ue,de,ce,he,fe,pe,me,ve,ge,we,be,ye,ke,Ee,xe,Ce,Se,Te,Ae,De,Oe,$e,Ne,Ie,Le,Re,qe,Me,Pe,Fe,Ue,je,Be,ze,Ve,He,Ye,We,Ke,Ge){var Je,Xe={},Qe=n.PreviewLinkfile,Ze=r.FolderShareApiClient,et=_.LegacyFileViewerActions,tt=(m.ContentInfo,E.Job),nt=E.ModalProgress,it=O.EmailVerification,rt=N.DBModal,ot=N.DBModalStack,st=N.DBUserModal,at=R.FileTypes,_t=R.SharedWithActionTypes,lt=M.SharingApi,ut=M.UserlessSharingApi,dt=j.RolePickerState,ct=V.image_best_fit_size,ht=Q.showTiburonUIIfAllowed,ft=(Z.NotServer,Z.NotClients),pt=ne.showShareNewFolderWizardModalIfAllowed,mt=ne.showShareExistingFolderWizardModalIfAllowed,vt=ne.showShareAFolderWizardModalIfAllowed,gt=oe.PreviewFlippable,wt=me.SEVERITY,bt=me.assert,yt=me.raiseAndReport,kt=me.reportException,Et=me.stackTrace,xt=Ee.SimpleModal,Ct=Se.LinkedProfileServices,St=Se.ProfileServicesLinkingHandler,Tt=Te.ungettext,At=Te._,Dt=(Te.N_,Te.E_,Te.render_sentences,De.TopNotificationBar),Ot=Re.CashUtil,$t=Pe.DfBTransitionInfoFetcher,Nt=je.DefaultContactsCache,It=je.LegacyContactsCache;INLINE_JS.$=$,INLINE_JS.$u=v,Function.prototype.defer=Function.prototype.defer.wrap(function(e){var t;return t=$A(arguments).slice(1),this.__tb__=Et(),e.apply(this,t)}),String.prototype.evalScripts=String.prototype.evalScripts.wrap(function(e){var t,n,i;t=$A(arguments).slice(1);try{return e.apply(this,t)}catch(e){return n=e,bt(0,n.toString())}}),Je={cache:{},set:function(e,t,n){var i;return i=Je.cache[e],null==i&&(i=Je.cache[e]={}),i.value=t,i.expires=n?(new Date).getTime()+n:0},get:function(e){var t;return t=Je.cache[e],null==t||(new Date).getTime()>t.expires?(delete Je.cache[e],!1):t.value}},Function.prototype.cached=function(e){var t,n;return monkey_check(),n=Math.random(),t=this,function(){var i;return i=Je.get(n),i!==!1?i:(i=t(),Je.set(n,i,e),i)}},Array.prototype.sort_by_key=function(e,t){var n;return null==t&&(t=!1),monkey_check(),n=t?-1:1,this.sort(function(t,i){return t=e(t),i=e(i),i>t?-1*n:t>i?1*n:0})},Array.prototype.contains=function(e){return monkey_check(),-1!==this.indexOf(e)},Array.prototype.remove=function(e,t){return monkey_check(),t=t||e+1,this.splice(e,t-e)},Array.prototype.removeItem=function(e){var t;return monkey_check(),t=this.indexOf(e),t>=0?this.remove(t):!1},Array.prototype.dict_by=function(e){var t,n,i,r,o;for(monkey_check(),o={},t=i=0,r=this.length;r>i;t=++i)n=this[t],o[this[t][e]]=this[t];return o},Array.prototype.unique=function(){var e,t,n,i,r;for(monkey_check(),e={},n=0,i=this.length;i>n;n++){if(t=this[n],"string"!=typeof t)return this;e[t]=0}r=[];for(t in e)r.push(t);return r},String.prototype.widthSplit=function(e){var t,n,i,r;for(null==e&&(e=15),monkey_check(),t=[],n=this,r=0,i=n.substring(r,r+e);""!==i;)t.push(i),r+=e,i=n.substring(r,r+e);return t},Object.extend(Effect.Transitions,{EaseIn:function(e){return Math.pow(e,2)},EaseOut:function(e){return Math.pow(e,.5)}}),function(e){var t,n;return n=function(e){var t,n,i,r,o,s,a,_,l;if(e)if(Object.isArray(e)){for(t=[],i=0,o=e.length;o>i;i++)n=e[i],t.push(Ke.escape(n).toHTML());e=new Ke(t.join(""))}else if(e.top||e.bottom||e.before||e.after)for(_=["top","bottom","before","after"],r=0,s=_.length;s>r;r++)a=_[r],l=e[a],l&&(e[a]=arguments.callee(l));else Rt.isElm(e)||e.toElement||e.toHTML||(e=Ke.escape(e));return e},Element.addMethods({db_observe:function(e,t,n){return monkey_check(),e.observe(t,function(t){return n(t,e)})},smoothScrollIntoView:function(e,t){var n,i,r,o,s,a;return null==t&&(t={}),monkey_check(),n={duration:.3,offset:0,padding:0,transition:Effect.Transitions.EaseOut},t=Object.extend(n,t),r=e.viewportOffset(e),i=e.getDimensions(),a=document.viewport.getDimensions(),s=t.padding||0,r.top>s&&r.top+i.height<a.height-s?void 0:(o=r.top<s?-1*Math.floor(a.height/4):-1*Math.floor(3*a.height/4),t.offset=t.offset||o,new Effect.ScrollTo(e,t))},__sert:function(e,t){return Element.insert(e,n(t))},__date:function(e,t){return Element.update(e,n(t))},replace:t=function(t,i){return e(t,n(i))}})}(Element.replace),String.prototype.lpad=function(e,t){var n;for(null==t&&(t="0"),monkey_check(),n=this;n.length<e;)n=t+n;return n.toString()},String.prototype.reverse=function(){var e,t,n;return monkey_check(),n=this.split(""),t=n.reverse(),e=t.join("")},String.prototype.count=function(e){return monkey_check(),(this.length-this.gsub(e,"").length)/e.length},String.prototype.repeat=function(e){return monkey_check(),new Array(e+1).join(this)},String.prototype.title=function(){return monkey_check(),this.charAt(0).toUpperCase()+this.substr(1)},Ajax.DBRequest=Class.create(Ajax.Request,{initialize:function($super,e,t){var n,i,r,o,a,_,l,d,h,f,p,m,v,g,w;if(null==t&&(t={}),monkey_check(),this.orig_req={url:e,options:t},this.start_time=ie.time(),t.method=t.method||"post",t.evalJS=!1,t.suppress_nonstandard_headers=!0,t.parameters=t.parameters||{},t.parameters.t=Ie.read(Ae.JS_CSRF_COOKIE),t.parameters.is_xhr=!0,("post"===t.method.toLowerCase()||u.CPROFILE_ENABLED)&&(t.parameters.parent_request_id=Ae.REQUEST_ID),u.CPROFILE_ENABLED&&(t.parameters.cProfile=u.CPROFILE_PARAMETER),c.PUBLIC_MODE_OVERRIDE&&(t.parameters.public_mode_override="1"),c.COUNTRY_OVERRIDE&&(t.parameters.public_mode_override=c.COUNTRY_OVERRIDE),Ajax.DBRequest.restrict&&(t.parameters.restrict=Ajax.DBRequest.restrict),i=t.cleanUp||function(){},this.subject_user=t.subject_user||t.job_user,t.job&&(this.job_id=Rt.nonce(),t.parameters.job_id=this.job_id,yr.watch(this,t.dont_hide_progress_on_complete)),t.no_watch||Pt.watch(this,!!t.job),f=t.onFailure,p=t.onSuccess,h=t.onComplete,d=function(e){return function(n){var i,r;return t.parameters.xhr_retry||!t.allow_retries?!1:0===(i=n.status)||500===i||502===i||503===i?(e.orig_req.options.parameters.xhr_retry=!0,e.orig_req.options.onFailure=f,e.orig_req.options.onSuccess=p,r=new Ajax.DBRequest(e.orig_req.url,e.orig_req.options),!0):!1}}(this),t.onFailure=function(n){var r,o,s;if(!tt.handled(n.request.job_id)&&!d(n))return t.noAutonotify||(!he.IS_PROD&&500===n.status&&n.getHeader("X-Debug-Url")?(e=n.getHeader("X-Debug-Url"),r=At("There was a problem completing this request.")+(' <a href="'+e+'" target="_blank">View debug</a>'),b.error(new Ke(r))):b.error()),i(!1),f&&f(n),403===n.status&&(s=Rt.session_storage_get("reload-timestamp"),(!s||ie.time()-s>3e4)&&(Rt.session_storage_set("reload-timestamp",ie.time()),location.reload(!0))),bt(t.noAutonotify||403===(o=n.status)||404===o||502===o,"Ajax "+n.status+" on "+n.request.url)},t.onComplete=function(e){return function(e){return e.responseText.length&&h&&0!==e.responseText.indexOf("async_task_started:")?h(e):void 0}}(this),t.onSuccess=function(n){return function(r){var o,a,_,l,u,c,h,m,v,g,w,y,k,E,x,C,S;if(S=ie.time()-r.request.start_time,!tt.handled(r.request.job_id)){if(r.responseText.length){if(0===r.responseText.indexOf("err:"))t.noAutonotify||(m=r.responseText.substr(4),t.html_in_error_msg&&(m=new Ke(m)),b.error(m)),f&&f(r);else if(0===r.responseText.indexOf("async_task_started:")?(n.async_task_id=r.responseText.split(":")[1],yr.watch(n)):p&&(0===r.responseText.indexOf("ok:")&&b.success(r.responseText.substr(3)),p(r)),C=r.getHeader("X-Server-Response-Time")||"-1",t.log_timing&&$e.log_ajax_transition.defer(S,void 0,void 0,void 0,C,e=Lt.absolutize(n.url)),a=pe("#cprofile"),!t.no_watch&&a.length){if(k=Ae.REQUEST_ID+"-"+r.getHeader("X-Dropbox-Request-Id"),e=r.request.url.replace(/[^\/]*\/\/[^\/]+/,"").replace(/\?.*$/,""),g={request_id:k},y=r.request.url,-1!==y.indexOf(he.BLOCK_CLUSTER))g.block=1;else for(w=he.BATCH_THUMB_ENDPOINTS,c=0,h=w.length;h>c;c++)if(u=w[c],-1!==y.indexOf(u)){g.block=1;break}o=function(e,t,n,i){var r,o;return r=pe(i?'<a target="_blank" />':"<a />"),o=r.attr("href",String(s({authority:he.WEBSERVER,path:t,query:n}))).text(e+" ")},v=[["svg","/profile/cprofile/svg",!0],["pstats","/profile/cprofile/pstats",!1],["callgrind","/profile/cprofile/callgrind",!1],["IO","/profile/ioprofile",!0],["DB","/profile/dbprofile",!0]],x=function(){var e,t,n;for(n=[],e=0,t=v.length;t>e;e++)_=v[e],n.push(o(_[0],_[1],g,_[2]));return n}(),E=pe('<div class="ajax">').text("Ajax: "+e+" ("+C+"ms)").prepend(x),l=a.find(".ajax"),l.length>=10&&l.last().remove(),a.prepend(E)}}else if(!t.job){if(d(r))return;t.noAutonotify||r&&0===r.status||b.error(),f&&f(r)}return i(!0)}}}(this),t.onException=function(t,n){var i;if(window.console)throw n;return i="Error with AJAX callback for: "+e+" :::: "+n.toString(),kt({err:n})},t.job&&(e+=(-1===e.indexOf("?")?"?":"&")+"long_running=1"),t.subject_user&&!(null!=(v=t.parameters)?v[A.UID_PARAM_NAME]:void 0)&&(e=s.parse(e).updateQuery(A.UID_PARAM_NAME,t.subject_user).toString()),n=$H({url:e}),t.parameters){for(n.update(t.parameters),g=n.keys(),r=0,_=g.length;_>r;r++)for(a=g[r],w=["passwd","password","oauth","ccn","host_id"],o=0,l=w.length;l>o;o++)m=w[o],-1!==a.indexOf(m)&&n.unset(a);n.unset("t")}return t.onSuccess.__tb_ajax_info__=t.onFailure.__tb_ajax_info__=Object.toJSON(n),$super(e,t)}}),"undefined"!=typeof z&&null!==z&&Object.extend(z,{main_modifier:function(){return monkey_check(),Rt.is_mac()?decodeURIComponent("%E2%8C%98"):"ctrl"}}),Object.extend(Prototype.BrowserFeatures,{DB_CORS:window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}),INLINE_JS.$j=pe;var Lt,Rt,qt;Rt=INLINE_JS.Util=Xe.Util={scroll_to_thumb:function(e){var t,n,i,r;return n=e.cumulativeOffset().top,t=e.getHeight(),r=Oe.scroll_offsets().top,i=Oe.viewport_dimensions().height,r>n||n+t>r+i?Oe.scroll_to(0,n-i/2):void 0},decode_sort_key:function(e){var t,n,r,o;for(o=[],n=0,r=e.length;r>n;n++)t=e[n],"string"==typeof t?o.push(i.decode(t)):o.push(t);return o},sort_by_rank_or_key:function(e,t){return null!=e.sort_rank&&null!=t.sort_rank?e.sort_rank-t.sort_rank:(bt(null!=e.sort_key&&null!=t.sort_key,"expected sort keys on both elms"),this._sort_by_key(e,t))},sort_by_key:function(e,t){return this._sort_by_key(e,t)},_sort_by_key:function(e,t){var n,i,r,o,s;for(o=e.sort_key,s=t.sort_key,n=i=0,r=o.length;r>=0?r>i:i>r;n=r>=0?++i:--i){if(null==s[n])return 1;if(typeof o[n]!=typeof s[n])return"string"==typeof o[n]?1:-1;if(o[n]!==s[n])return o[n]>s[n]?1:-1}return s.length>o.length?-1:0},add_sort_arrow_mouseover:function(e,t,n,i){var r,o,s,a,_;for(a=$$(n),_=[],r=0,o=a.length;o>r;r++)s=a[r],_.push(function(n){var i;if(e!==n)return G.src(n.down("img"),"web","downtick-spacer"),n.removeClassName("bolded");if(n.addClassName("bolded"),!n.hasClassName("noarrow"))return i=t?"arrow-up-gray":"arrow-down-gray",G.src(n.down("img"),"web",i)}(s));return _},add_sort_arrow_mouseover_j:function(e,t,n,i){var r,o,s,a,_;for(a=pe(n),_=[],r=0,o=a.length;o>r;r++)s=a[r],_.push(function(n){var i;if(e.attr("data-sort")!==pe(n).attr("data-sort"))return G.src(pe(n).find("img")[0],"web","downtick-spacer"),pe(n).removeClass("bolded");if(pe(n).addClass("bolded"),!pe(n).hasClass("noarrow"))return i=t?"arrow-up-gray":"arrow-down-gray",G.src(pe(n).find("img")[0],"web",i)}(s));return _},one_line_fit:function(e){var t,n;return t=$$(e),t.length<2?void 0:(n=function(e){return function(){var e,i,r,o,s,a,_,l,u;if(r=t[0],a=t[t.length-1],o=r.cumulativeOffset().top,_=a.cumulativeOffset().top,o!==_){if(e=parseInt(r.getStyle("font-size"),10),u=e-1,8>u)return;for(s=0,l=t.length;l>s;s++)i=t[s],i.style.fontSize=u+"px";return n()}}}(this))()},nice_list:function(e){var t,n,i,r,o;return e?1===e.length?e[0]:2===e.length?At("%(x)s and %(y)s").format({x:e[0],y:e[1]}):(o=At("%(x)s, %(y)s, and %(z)s").split(/%\(x\)s|%\(y\)s|%\(z\)s/),bt(4===o.length,"bad item list format %(x)s, %(y)s, and %(z)s"),n=o[0],i=o[1],r=o[2],t=o[3],[n,e.slice(0,-1).join(i),r,e[e.length-1],t].join("")):""},list_em_snippet:function(e,t){var n,i,r,o,s,a;for(o="",t-=new l("...").length,i=r=0,s=e.length;(s>=0?s>r:r>s)&&(a=e[i],0!==i&&(a=", "+a),n=new l(a).length,!(n>t));i=s>=0?++r:--r)t-=n,o+=a;return{str:o,snipped:e.length-i}},start_of_day:function(e){var t;return t=new Date,t.setTime(e.getTime()),t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),t},to_iso8601_date:function(e,t,n){var i;return null==t&&(t=!1),null==n&&(n=!1),t?(i=e.getUTCFullYear().toString()+"-"+(e.getUTCMonth()+1).toString().lpad(2)+"-"+e.getUTCDate().toString().lpad(2),n&&(i+=" "+e.getUTCHours().toString().lpad(2)+":"+e.getUTCMinutes().toString().lpad(2)+":"+e.getUTCSeconds().toString().lpad(2))):(i=e.getFullYear().toString()+"-"+(e.getMonth()+1).toString().lpad(2)+"-"+e.getDate().toString().lpad(2),n&&(i+=" "+e.getHours().toString().lpad(2)+":"+e.getMinutes().toString().lpad(2)+":"+e.getSeconds().toString().lpad(2))),i},to_mysql_date:function(e,t,n){var i,r,o;return i=e.getFullYear().toString()+"-"+(e.getMonth()+1).toString().lpad(2)+"-"+e.getDate().toString().lpad(2),o=e.getHours().toString().lpad(2)+":"+e.getMinutes().toString().lpad(2)+":"+e.getSeconds().toString().lpad(2),r="."+e.getMilliseconds().toString().lpad(3),t?n?i+" "+o+r:i+" "+o:i},from_mysql_date:function(e){var t,n,i,r,o,s,a;return r=e.split(" "),t=r[0],s=r.length>1?r[1]:!1,n=t.split("-"),bt(3===n.length,"weird date format on "+this+", expected yyyy-mm-dd"),i=new Date(n[0],parseInt(n[1],10)-1,n[2]),s&&(a=s.split(":"),bt(3===a.length,"weird time format on "+this+", expected hh:mm:ss.ms"),i.setHours(a[0]),i.setMinutes(a[1]),o=a[2].split("."),i.setSeconds(o[0]),o.length>1&&i.setMilliseconds(o[1])),i},make_table:function(e,t){var n,i,r,o,s,a,_;r=new Element("table",t),o=new Element("tbody"),r.__sert(o);for(i in e)_=e[i],a=new Element("tr"),s=new Element("td").insert(i),n=new Element("td").insert(_),a.__sert(s),a.__sert(n),o.__sert(a);return r},validate_email:function(e){var t;return t=new RegExp("^['&A-Z0-9._%+-]+@[A-Z0-9-][A-Z0-9.-]*\\.[A-Z]{2,15}$","i"),t.test(e)},scrollTop:function(){return window.scrollY||document.documentElement.scrollTop||0},scrollLeft:function(){return window.scrollX||document.documentElement.scrollLeft||0},scried:{},scry:function(e){var t,n;return n=this.scried,t=n[e],t||(t=$(e),n[e]=t),t},urlquote:function(e){return e.split("/").map(encodeURIComponent).join("/")},ie8:Prototype.Browser.IE&&document.documentMode&&!0,ie:Prototype.Browser.IE,log:function(){var e,t;return he.IS_PROD?void 0:Prototype.Browser.IE?null!=(e=$("ieconsole"))?e.innerHTML+=$A(arguments).join(" ")+"<br>":void 0:"undefined"!=typeof console&&null!==console&&null!=(t=console.log)?t.apply(console,$A(arguments)):void 0},childElement:function(e,t){var n;return n=this.childElementWithIndex(e,t),n[0]},childElementWithIndex:function(e,t){var n,i,r,o,s,a;for(n=0,a=e.childNodes,r=o=0,s=a.length;s>o;r=++o)if(i=a[r],1===i.nodeType&&n++===t)return[i,r];return[!1,!1]},disableSelection:function(e){return e.onselectstart=function(){return!1},e.unselectable="on",e.style.MozUserSelect="none",e.style.cursor="default"},enableSelection:function(e){return e.onselectstart=function(){return!0},e.unselectable="off",e.style.MozUserSelect="",e.style.cursor=""},disable_ie_image_dragging:function(){return Prototype.Browser.IE&&Prototype.Browser.IEV<9?document.ondragstart=function(){return!1}:void 0},bsearch:function(e,t,n,i){var r,o,s,a;for(n||(n=function(e,t){return e-t}),r=e.length,o=0;r>o;)if(s=Math.floor(r/2+o/2),a=n(e[s],t),a>0)r=s;else{if(!(0>a))return s;o=s+1}return i?o:-1},nonce:function(){var e,t,n;return e=new Date,n=e.getTime().toString(),t=Math.floor(1e6*Math.random()).toString().lpad(6),n+t},focus:function(e){if(e){e=$(e);try{return e.focus()}catch(e){}}},sumStyles:function(e,t){var n,i,r,o;if(i=0,e)for(r=0,o=t.length;o>r;r++)n=t[r],i+=parseInt(e.getStyle(n),10)||0;return i},async_load_script:function(e){var t;return t=function(){var t,n;return n=document.createElement("script"),n.src=e,n.type="text/javascript",n.async=!0,t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(n,t)},"complete"===document.readyState?t():null!=window.attachEvent?window.attachEvent("onload",t):window.addEventListener("load",t,!1)},smart_window_load:function(e){return"complete"===document.readyState?e.defer():Event.observe(window,"load",e)},isNumber:function(e){return!isNaN(Number(e,10))},shorten_url:function(e,t){return new Ajax.DBRequest("/shorten_url",{parameters:{url:e},onSuccess:function(e){return t(e.responseText)}})},falsy_to_empty:function(e){return e||""},preloaded_images:{},preload_image:function(e,t,n){var i;if(!this.preloaded_images[e])return i=new Image,null!=t&&Element.extend(i).observe("error",t),null!=n&&Element.extend(i).observe("load",n),i.src=e,this.preloaded_images[e]=i},get_preloaded_image:function(e){return this.preloaded_images[e]?this.preloaded_images[e].clone():new Element("img",{src:e})},clear_selected:function(){var e;if(window.getSelection){if(e=window.getSelection(),e.removeAllRanges)return e.removeAllRanges()}else if(document.selection)return document.selection.empty()},is_mac:function(){return-1!==navigator.appVersion.indexOf("Mac")},is_windows:function(){return-1!==navigator.appVersion.indexOf("Windows")},in_scrollbar:function(e){var t,n;return t=20,n=Oe.viewport_dimensions(),e>n.width-t},freshbutton_overlay:function(e,t){var n,i;return i=e instanceof jQuery&&e||pe(e),n=t instanceof jQuery&&t||pe(t),i.on("mouseover",function(e){return function(){return n.addClass("hovered")}}(this)),i.on("mouseout",function(e){return function(){return n.removeClass("hovered"),n.removeClass("pressed")}}(this)),i.on("mousedown",function(e){return function(){return n.removeClass("hovered"),n.addClass("pressed")}}(this)),i.on("mouseup",function(e){return function(){return n.removeClass("pressed")}}(this))},isElm:function(e){return"object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&1===e.nodeType&&"string"==typeof e.nodeName},_track_twitter_chars_left:function(e,t){var n;return clearInterval(this.chars_left_interval),n=function(n){return function(){var n,i;return n=$("twitter-chars"),i=t-$F(e).trim().length,0>i?n.addClassName("too-long"):n.removeClassName("too-long"),n.__date(i)}}(this),this.chars_left_interval=setInterval(n,250)},session_storage_set:function(e,t){return window.sessionStorage&&window.JSON?window.sessionStorage.setItem(e,JSON.stringify(t)):void 0},session_storage_get:function(e){return window.sessionStorage&&window.JSON?JSON.parse(window.sessionStorage.getItem(e)):void 0},pdf_plugins:function(){var e,t,n;return n=/Chrome PDF|Adobe Reader|Adobe PDF|Acrobat/gi,e=function(){var e,i,r,o;for(r=window.navigator.plugins,o=[],e=0,i=r.length;i>e;e++)t=r[e],n.test(t.name)&&o.push(t);return o}()},get_window_location:function(){return window.location}},Rt.scrollLeft=Rt.scrollLeft.cached(50),Rt.scrollTop=Rt.scrollTop.cached(50),null==window.console&&(window.console={log:function(){},profile:function(){},profileEnd:function(){}}),document.observe("script:loaded",function(){var e,t,n,i,r;if(Rt.ie8){for(i=$$("#page-header a, #page-footer a"),r=[],e=0,t=i.length;t>e;e++)n=i[e],"_blank"===n.target?r.push(n.target=""):r.push(void 0);return r}}),Lt=Xe.URLUtil={absolutize:function(e){return e.startsWith("https://")||e.startsWith("http://")?e:"/"===e.charAt(0)?window.location.protocol+"//"+window.location.host+e:bt(0,"absolutize is confused by "+e)}},qt=Xe.Velocity={scroll_container:null,velocity:0,last_nonzero_velocity:0,old_y:0,max_delta_y:0,calculate_velocity:function(){return this.velocity=this.max_delta_y,0!==this.velocity&&(this.last_nonzero_velocity=this.velocity),this.max_delta_y=0},capture_new_y_pos:function(){var e,t;return null==this.old_y?void(this.old_y=null!=this.scroll_container?this.scroll_container.scrollTop:Oe.scroll_offsets().top):null==this.max_delta_y?void(this.max_delta_y=0):(t=null!=this.scroll_container?this.scroll_container.scrollTop:Oe.scroll_offsets().top,e=Math.abs(this.max_delta_y)<Math.abs(t-this.old_y),e?(this.max_delta_y=t-this.old_y,this.old_y=t):void 0)},start_capture:function(e){return this.scroll_container=e,this.velocity_calculator_interval=setInterval(this.calculate_velocity.bind(this,500)),null!=this.scroll_container?this.scroll_container.observe("scroll",this.capture_new_y_pos.bind(this)):Event.observe(window,"scroll",this.capture_new_y_pos.bind(this))},get:function(e){return null==e&&(e=!1),bt(null!=this.velocity_calculator_interval,"Haven't started capturing velocity"),e?this.last_nonzero_velocity:this.velocity}};var Mt;Mt=Xe.DomUtil={fromElm:function(e){return $(e).innerHTML},updateFromElm:function(e,t){return e=$(e),t=$(t),e.update(this.fromElm(t))},fillVal:function(e,t){var n,i,r,o,s,a;for(r=$$("."+t),s=[],n=0,i=r.length;i>n;n++)a=r[n],a=$(a),"INPUT"===a.tagName?(a.value=e,s.push(a.defaultValue=e)):(""!==a.innerHTML||"A"!==(o=a.tagName)&&"B"!==o&&"INPUT"!==o&&"I"!==o&&"LABEL"!==o&&"SELECT"!==o&&"SPAN"!==o&&"TEXTAREA"!==o||Rt.log("Filling an empty value; this may look broken in IE7",a),s.push(a.innerHTML=e));return s}};var Pt;Pt=Xe.RequestWatcher={reqs:[],working_msg:At("Still working...",{comment:"Comment about waiting for a process to complete"}),last_notification:null,TIMEOUT:10,watch:function(e,t){var n;return n=this.reqs,n.length||(this.int_id=setInterval(this.check_up.bind(this),500)),t&&(e.skip_message=!0),n.push([e,ie.time()])},check_up:function(){return this.scan(!1)},remove:function(e){return this.scan(e)},scan:function(e){var t,n,i,r,o,s,a,_,l;for(r=ie.time(),o=[],a=this.reqs,n=0,i=a.length;i>n;n++)s=a[n],_=s[0],l=s[1],t=r-l,4!==_.transport.readyState?(t>4e3&&!_.skip_message&&(_.skip_message=!0,b.isShown()&&b.current()===!X.undo_notification&&(this.last_notification=b.success(this.working_msg))),t>1e3*this.TIMEOUT&&_.job&&_.transport.abort(),_!==e?o.push([_,l]):_.transport.abort()):this.clearWorkingMessage();return this.reqs=o,o.length?void 0:clearInterval(this.int_id)},clearWorkingMessage:function(){return b.isShown()&&b.current()===this.last_notification?b.clear():void 0}},pe(function(){var e,t,n,i;n=Prototype.Browser,i=[];for(e in n)t=n[e],t===!0&&i.push(pe(document.body).addClass(e.toLowerCase()));return i});var Ft,Ut,jt=[].slice;Ft=Xe.HTML5_HISTORY=we.history,pe(function(e){return function(){return p.init()}}(this)),Ut=Xe.HashRouter={watch_timer:null,callback_map:{},last_hash:"",last_prefix:"",_get_location:function(){return window.location.href},_set_location:function(e){return window.location.href=e},_replace_location:function(e){return window.location.replace(e)},init:function(){return this.watch_timer=setInterval(this.check_hash.bind(this),300)},watch:function(e,t){return this.callback_map[e]=t,this.watch_timer?void 0:this.init()},check_hash:function(){var e,t,n,i,r,o;if(i=this._get_location().split("#")[1],null!=i&&(i=i.replace(/%27/g,"'")),this.last_hash!==i){if(this.last_hash=i,this.last_prefix&&""===i)i=this.last_prefix+":";else if(!i)return;return o=i.split(":"),r=o.first(),this.last_prefix=r,n=this.callback_map[r],null!=n&&(t=function(){var t,n,i,r;for(i=o.slice(1),r=[],t=0,n=i.length;n>t;t++)e=i[t],r.push(decodeURIComponent(e));return r}(),n.apply(null,t)),$(document).fire("db:hash_change",{hash:i})}},_prepare_hash:function(e){var t,n;return n=$A(e).map(Rt.falsy_to_empty),t=n.map(encodeURIComponent),t.join(":")},set_hash:function(){var e,t;return e=1<=arguments.length?jt.call(arguments,0):[],t=this._prepare_hash(e),this._set_hash(t)},replace_hash:function(){var e,t;return e=1<=arguments.length?jt.call(arguments,0):[],t=this._prepare_hash(e),this._set_hash(t,!0)},_set_hash:function(e,t){return""===e&&(e="/"),this.last_hash=e,t?this._replace_location("#"+e):this._set_location("#"+e)}};var Bt;Bt=Xe.SharingUtil=function(){function e(){}return e.success_string_for_recipients=function(e){var t;return t=1===e.length?-1===e[0].indexOf("@")?At("Sent to %(recipient)s.",{comment:"Recipient is a user's name"}).format({recipient:e[0]}):At("Sent to %(recipient)s.",{comment:"Recipient is an email address"}).format({recipient:e[0]}):2===e.length?-1===e[0].indexOf("@")?-1===e[1].indexOf("@")?At("Sent to %(recipient_first)s and %(recipient_second)s.",{comment:"Recipients are users' names."}).format({recipient_first:e[0],recipient_second:e[1]}):At("Sent to %(recipient_first)s and %(recipient_second)s.",{comment:"First recipient is a user's name, second is an email address"}).format({recipient_first:e[0],recipient_second:e[1]}):-1===e[1].indexOf("@")?At("Sent to %(recipient_first)s and %(recipient_second)s.",{comment:"First recipient is an email address, second is a user's name"}).format({recipient_first:e[0],recipient_second:e[1]}):At("Sent to %(recipient_first)s and %(recipient_second)s.",{comment:"Recipients are email addresses"}).format({recipient_first:e[0],recipient_second:e[1]}):-1===e[0].indexOf("@")?At("Sent to %(recipient)s and %(num_others)s others.",{comment:"num_others is 2 or more"}).format({recipient:e[0],num_others:e.length-1}):At("Sent to %(recipient)s and %(num_others)s others.",{comment:"num_others is 2 or more"}).format({recipient:e[0],num_others:e.length-1})},e.truncate_emails=function(e){var t;return e.length<=1500?e:(t=e.lastIndexOf(",",1500),-1===t?"":e.slice(0,t))},e}();var zt;zt=INLINE_JS.SharingModals=Xe.SharingModals=function(){function e(){}return e.logAndShowSharingModal=function(t,n){var i,r,o,a;if(a=Ce.chooseShareUIType(t,{allowLegacyPublicLinks:pr.public_folder_enabled,hasLegacyPublicAppToken:pr.public_app_token}),i=Ce.SHARE_UI_TYPE,a!==i.NO_SHARE&&it.get_for_user(pr.active_user).verified_or_show())switch(a){case i.PUBLIC:return o=pr.public_app_token?"/spa/"+pr.public_app_token+t.ns_path:"/u/"+pr.active_user.id+t.fq_path.substring(tr.PUBLIC_FOLDER_PATH_LENGTH),tr.showCopyPublicUrlModal(String(new s({scheme:"https",authority:he.PUBSERVER,path:o})));case i.LEGACY_TEAM_FOLDER:return e.show_share_existing_modal(t.fq_path,pr.active_user);case i.SHARED_FOLDER:return ze.ShmodelUILogger.log_with_target_file("sf_invite",n,t),ht(pr.active_user,{fqPath:t.fq_path,isFolder:!0,origin:"LEGACY_BROWSE",shouldFetchNsId:!0});case i.SHARED_FILE:return ht(pr.active_user,{fqPath:t.fq_path,isFolder:!1,origin:"LEGACY_BROWSE"});case i.SHARED_LINK:return ze.ShmodelUILogger.log_with_target_file("token_share",n,t),r=t.fq_path,bt(r,"token_share: expected non-root fq_path"),kn.shmodel(r,n+"_token_share")}},e.show_shared_folder_options_modal=function(e,t,n,i){return null==n&&(n=!0),null==i&&(i=!0),ot.push(new Yt(t,e,n,i))},e.show_shared_folder_wizard=function(e,t){return vt(e,t)?void 0:new gn(e,{element_id:"share-a-folder-wizard-modal"}).show()},e.get_select_role_modal=function(){return new Si({element_id:"select-role-modal"})},e.start_wizard_without_user=function(){return H.get_viewer().is_paired?(null==this.select_role_modal&&(this.select_role_modal=e.get_select_role_modal()),this.select_role_modal.show()):this.start_wizard_for_user(H.get_viewer().get_users()[0])},e.start_wizard_for_user=function(t){return it.get_for_user(t).verified_or_show(Me.SHARE_FOLDER)?e.show_shared_folder_wizard(t):void 0},e.show_share_existing_modal=function(e,t,n){var i;return null==n&&(n=!0),it.get_for_user(t).verified_or_show()?(i=new pn(t,{folder_name:e,element_id:"invite-to-new-sf-wizard-modal-"+t.id,can_change_options:n}),i.show()):void 0},e.show_shmodel_or_invite_modal=function(e,t,n,i){return it.get_for_user(n).verified_or_show()?new cn(n,{path:e,existing_sf:t,element_id:"create-link-or-invite-wizard-modal",target_item:i}).show():void 0},e.show_unshare_team_sf_modal=function(e,t,n){var i;return i=new an(e,{element_id:"unshare-confirm-modal",team_shared_folder:!0,nested_shared_folder:!1,ns_id:t,folder_path:n}),i.show()},e.show_ignore_modal=function(e,t,n){var i,r,o;return bt(n,"Share ignore did not get an ns_id"),o=At("Remove access to '%(folder_name)s'").format({folder_name:l.em_snippet(t,15)}),i={ns_id:n},r=new st(e,{element_id:"ignore-confirm",title:o}),r.on_confirm_button_click=function(t){var o,s,_;return t.preventDefault(),o=pe(t.target),s=o.closest("form"),_=function(t){return b.success(At("Successfully removed access to shared folder.")),document.fire(a.SF_IGNORE,{target_ns_id:n,user_id:e.id}),r.hide()},Hn.ajax_submit(s[0],!1,_,void 0,o[0],i)},r.show()},e.show_invites=function(){return ot.push(new J({element_id:"invitation-page-modal",endpoint_url:"/share_ajax/get_invitation_page"}))},e.show_shared_subfolder_modal=function(e,t){var n,i,r,o,s;return r=l.em_snippet(We.filename(e),14),i=At("Can't share folder"),o="'%(parent_shared_folder)s' ".format({parent_shared_folder:r}),Mt.fillVal(o.escapeHTML(),"parent_shared_folder_name"),n=At("Share '%(parent_shared_folder)s' folder"),s=n.format({parent_shared_folder:r}),$("share_parent_folder_button").value=s,Xn.show(At("Loading shared folder options..."),"<p style='margin: 3em 0; text-align: center;'> <img src='/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif' alt=''/></p>"),pe("#share_parent_folder_button").on("click",function(n){return function(i){return Xn.hide(),n.show_shared_folder_options_modal(e,t)}}(this)),Xn.show(i,$("share_subfolder"))},
e}();var Vt;Vt=Xe.InviteFormController=function(){function e(e,t,n,i,r,o){var s,a;this.user=e,this.$form=t,this.members=n,this.invitees=i,this.new_style_groups=r,this.team_only=this.$form.data("team-only"),a={tokens:[",",";"],include_fb:!0,members:this.members,invitees:this.invitees,new_style_groups:this.new_style_groups,contacts_only:!0},"work"===this.user.role?(s=Autocompleter.TeamTokenizer,a.team_only=this.team_only):(s=Autocompleter.ContactsTokenizer,a.include_team=!0),"work"===this.user.role&&"undefined"!=typeof ge&&null!==ge&&(a.include_new_style_groups=!0),this.sharing_options_auto_completer=new s(this.user,o+"-new-collab-input",o+"-new-whobulk",o+"-hidden-input",a),Qn._create(this.$form.find(".custom-message-container")[0]),"work"===this.user.role&&(this.team_shared_folder_controller=new Dn(this.$form))}return e.prototype.listen=function(){return this.sharing_options_auto_completer.listen()},e.prototype.reset_autocompleter=function(){return this.sharing_options_auto_completer.clearTokens()},e.prototype.tokenize=function(){return this.sharing_options_auto_completer.tokenize_emails_input(!0)},e.prototype.reset_options=function(){return pe(this.sharing_options_auto_completer.get_entry_container()).hide()},e.prototype.set_team_only=function(e){return this.team_only=e,this.sharing_options_auto_completer.setTeamOnly(e)},e.prototype.get_token_count=function(){return this.sharing_options_auto_completer.getTokenCount()},e.prototype.extract_invitees=function(){var e,t,n,i,r,o,s;for(r={},s=["emails","fb_ids","group_ids","new_style_group_ids"],n=0,o=s.length;o>n;n++)t=s[n],i=this.$form.find("input[name="+t+"]"),r[t]=function(){var t,n,r;for(r=[],t=0,n=i.length;n>t;t++)e=i[t],r.push(pe(e).val());return r}();return r},e.prototype.get_custom_message=function(){return this.$form.find("textarea[name='custom_message']").val()},e.prototype.get_access_type=function(){return this.$form.find(".can-edit-dropdown").data("selected-value")},e}();var Ht,Yt,Wt,Kt,Gt,Jt,Xt,Qt,Zt,en,tn,nn,rn,on,sn,an,_n=function(e,t){function n(){this.constructor=e}for(var i in t)ln.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},ln={}.hasOwnProperty,un=function(e,t){return function(){return e.apply(t,arguments)}},jt=[].slice;rn=Xe.SharedFolderBaseModal=function(e){function t(e,n){this.user=e,this.options=n,t.__super__.constructor.call(this,this.options),this.team_shared_folder=this.options.team_shared_folder,this.nested_shared_folder=this.options.nested_shared_folder,this.path=this.options.folder_path,this.ns_id=this.options.ns_id,this.sharing_api=new lt(this.user)}return _n(t,e),t.prototype.on_show=function(){return this.sharing_api.loading_elem=this.$modal_window},t}(rt),Yt=Xe.ExistingSharedFolderOptionsModal=function(e){function t(e,n,i,r,o){var a,_;this.user=e,null==i&&(i=!0),null==r&&(r=!0),this.restore_modal=o,this.__show_modal=un(this.__show_modal,this),this.__x_click_handler=un(this.__x_click_handler,this),bt(null!=n,"Missing folder path"),this.path=We.normalize(n),_=At("Shared folder options for '%(folder)s'"),_=_.format({folder:l.em_snippet(We.filename(n),13)}),a={},a[A.UID_PARAM_NAME]=this.user.id,a.max_results=20,a.show_invite_form=i,a.show_folder_settings=r,ot.register(Ht.MODAL_DONE_VIEWING_EVENT,function(e){return function(){return"function"==typeof e.restore_modal?e.restore_modal():void 0}}(this)),t.__super__.constructor.call(this,{element_id:"folder-share-show-modal",title:_,endpoint_url:s({path:"/share_options"+this.path}).toString(),parameters:a})}return _n(t,e),t.prototype.__x_click_handler=function(e){var n;return t.__super__.__x_click_handler.apply(this,arguments),n={path:this.path},ze.SharedFolderActivityLogger.log("web","invite_modal_x_button",this.user,n),"function"==typeof this.restore_modal?this.restore_modal():void 0},t.prototype.__show_modal=function(e){var n,i,r,o,s;return t.__super__.__show_modal.apply(this,arguments),n=pr.containing_fq_path(),s=n!==this.path&&0===n.indexOf(this.path),s&&0===this.$modal_window.find("#banner-msg-sf-setting").length&&(r=At("You’re viewing settings for the shared folder ‘<strong>%(sf_name)s</strong>’.").format({sf_name:We.filename(this.path).escapeHTML()}),o=pe("<div id='banner-msg-sf-setting'> <t> "+r+" </t> </div>"),o.addClass("db-modal__banner db-modal__banner--warning"),this.$modal_window.find(".db-modal-box").append(o)),i={path:this.path},ze.SharedFolderActivityLogger.log("web","invite_modal_displayed",this.user,i)},t}(J),Ht=Xe.ExistingSharedFolderOptionsContent=function(){function t(e,n,i,r,o,s){this.$root=e,this.options=r,this.show_invite_form=o,this.allows_editor_manage_membership=s,this.show_email_verification=un(this.show_email_verification,this),this.show_golden_gate_warning=un(this.show_golden_gate_warning,this),this.show_folder_settings=un(this.show_folder_settings,this),this.toggle_from_invite_mode=un(this.toggle_from_invite_mode,this),this.toggle_to_invite_mode=un(this.toggle_to_invite_mode,this),this.show_leave_folder_modal=un(this.show_leave_folder_modal,this),this.show_owner_leave_folder_warning=un(this.show_owner_leave_folder_warning,this),this.show_access_request_link_modal=un(this.show_access_request_link_modal,this),this.show_unshare_folder_modal=un(this.show_unshare_folder_modal,this),this.show_uninvite_modal=un(this.show_uninvite_modal,this),this.show_transfer_user_modal=un(this.show_transfer_user_modal,this),this.show_kick_group_modal=un(this.show_kick_group_modal,this),this.show_kick_user_modal=un(this.show_kick_user_modal,this),this.update_tf_access=un(this.update_tf_access,this),this.update_sf_perms=un(this.update_sf_perms,this),this.reinvite_user=un(this.reinvite_user,this),this.submit_invitations=un(this.submit_invitations,this),this.maybe_load_more=un(this.maybe_load_more,this),this.extract_user_data_and_call=un(this.extract_user_data_and_call,this),this.extract_invitee_data_and_call=un(this.extract_invitee_data_and_call,this),this._display_team_upsell_prompt=un(this._display_team_upsell_prompt,this),this.on_add_token=un(this.on_add_token,this),this._disable_token_for_sf=un(this._disable_token_for_sf,this),this.user=H.get_viewer().get_user_by_id(n),this.path=We.normalize(i),this.options&&(this.members=this.options.folder_members,this.invitees=this.options.folder_invitees,this.new_style_groups=this.options.new_style_groups,this.num_total=this.options.num_total),this.$root.find(".bubble-dropdown").click(function(e){return Y.get_controller(pe(e.target).closest(".sf-action-dropdown")).closeDropdown(),!0}),this.start=20,this.max_results=20,this.$root.find(".member-container").on("scroll",function(e){return function(t){var n,i;return n=pe(t.currentTarget),i=n.find("#sf-members"),n.scrollTop()+n.innerHeight()>=i.innerHeight()?e.maybe_load_more():void 0}}(this)),this.sharing_api=new lt(this.user),this.sharing_api.loading_elem=this.$root,Wn.register_all(),Zn.register_all(),this.ns_id=this.$root.data("ns-id"),this.$invite_form=this.$root.find(".invite-more-form"),this.sf_access_type=this.$invite_form.find(".sf-invite-can-edit"),this.team_shared_folder=this.$root.data("team-shared-folder"),this.nested_shared_folder=this.$root.data("nested-shared-folder"),this.$allow_members_table=this.$root.find(".allow-members-table"),this.$folder_management_buttons=this.$root.find(".folder-management-buttons"),this.has_show_invite_form=!1,this.can_show_team_upsell_prompt=1===this.$root.find(".team-upsell-prompt").length,this.log_extras={path:this.path,ns_id:this.ns_id},this.sf_access_type.hide(),this.listen(),ot.trigger(t.CONTENT_LOADED_EVENT)}return t.CONTENT_LOADED_EVENT="db:sharing_options:content_loaded",t.MODAL_DONE_VIEWING_EVENT="db:sharing_options:modal_done_viewing_event",t.prototype.listen=function(){var e,n,i,r,o;if(this.$root.find(".confirm-button").click(function(e){return function(t){return t.preventDefault(),e.submit_invitations()}}(this)),this.$root.find(".cancel-button").click(function(e){return function(t){return t.preventDefault(),e.toggle_from_invite_mode()}}(this)),this.show_invite_form){for(this.$invite_input=this.$root.find("#sharing-options-new-collab-input"),o=["focus","keypress","contextmenu"],i=0,r=o.length;r>i;i++)n=o[i],this.$invite_input.off(n),this.$invite_input.on(n,this.toggle_to_invite_mode);this.$invite_input[0]&&this.$invite_input[0].on("token:add",this.on_add_token),e=this.$root.find("#custom-message-wizard"),e.on("focus",this.toggle_to_invite_mode),this.$root.find(".invite-verify-email").on("click",this.show_email_verification),this.$root.find(".golden-gate-upgrade-link").on("click",this.show_golden_gate_warning),this.$invite_form.length&&!this.team_shared_folder&&(this.invite_form_controller=new Vt(this.user,this.$invite_form,this.members,this.invitees,this.new_style_groups,"sharing-options"),this.can_show_team_upsell_prompt&&(this.$root.on("click",".close-team-prompt-button",function(e){return function(t){return e.$root.find(".team-upsell-prompt-container").hide()}}(this)),this.$root.on("click",".team-prompt-link",function(e){return function(t){var n,i,r,o,a,_,l,u,d;return u=H.get_viewer().personal_email,d=e.invite_form_controller.sharing_options_auto_completer.getEmails(),n=function(){var e,t,n,r;for(n=jt.call(this.members).concat(jt.call(this.invitees)),r=[],e=0,t=n.length;t>e;e++)i=n[e],i!==u&&r.push(i);return r}.call(e).join(),o=d&&n?",":"",r=Bt.truncate_emails(d+o+n),a=e.$root.find(".team-prompt-link"),l=a.attr("href"),_=s.parse(l).updateQuery({invite_members:r}),a.attr("href",_)}}(this))))}return this.$root.find(".change-settings-link").on("click",this.show_folder_settings),this.$root.on("click","button.leave-folder",function(e){return function(t){return t.preventDefault(),ze.SharedFolderActivityLogger.log("web","invite_modal_leave_button",e.user,e.log_extras),e.show_leave_folder_modal()}}(this)),this.$root.on("click","button.owner-leave-folder",function(e){return function(t){return t.preventDefault(),ze.SharedFolderActivityLogger.log("web","invite_modal_owner_leave_button",e.user,e.log_extras),e.show_owner_leave_folder_warning()}}(this)),this.$root.on("click","button.kick-user",function(e){return function(t){return e.extract_user_data_and_call(t,e.show_kick_user_modal)}}(this)),this.$root.on("click","button.kick-group",function(e){return function(t){var n,i,r;return t.preventDefault(),n=pe(t.currentTarget),r=n.data("group-name"),i=n.data("group-gid"),e.show_kick_group_modal(r,i)}}(this)),this.$root.on("click","a.make-owner",function(e){return function(t){return e.extract_user_data_and_call(t,e.show_transfer_user_modal)}}(this)),this.$root.on("click","a.send-email",function(e){return function(e){var t,n;return e.preventDefault(),t=pe(e.currentTarget),n=t.data("email"),window.location=s({scheme:"mailto",path:n}).toString()}}(this)),this.$root.on("click","a.reinvite-user",function(e){return function(t){return e.extract_invitee_data_and_call(t,e.reinvite_user)}}(this)),this.$root.on("click","button.uninvite-user",function(e){return function(t){return e.extract_invitee_data_and_call(t,e.show_uninvite_modal)}}(this)),this.$root.on("click","input.sf-action-leave",function(e){return function(t){return t.preventDefault(),ze.SharedFolderActivityLogger.log("web","invite_modal_leave_button",e.user,e.log_extras),e.show_leave_folder_modal()}}(this)),this.$root.on("click","input.sf-action-unshare",function(e){return function(t){return t.preventDefault(),ze.SharedFolderActivityLogger.log("web","invite_modal_unshare_button",e.user,e.log_extras),e.show_unshare_folder_modal()}}(this)),this.$root.on("click","a.remove-link",function(e){return function(t){var n;return t.preventDefault(),n=function(){var t;return t=rt.get_containing_modal(e.$root),t&&t instanceof J?t.fetch():void 0},e._disable_token_for_sf(n)}}(this)),this.$root.on("click","input.sf-action-get-link",function(e){return function(t){return t.preventDefault(),e.show_access_request_link_modal()}}(this)),this.$root.on("click","input.sf-action-done",function(e){return function(n){return n.preventDefault(),ze.SharedFolderActivityLogger.log("web","invite_modal_done_button",e.user,e.log_extras),ot.trigger(t.MODAL_DONE_VIEWING_EVENT),ot.pop()}}(this)),this.$root.on("click","input#change-sf-perm-checkbox",function(e){return function(t){var n;return n=pe(t.currentTarget),e.update_sf_perms(n.prop("checked"))}}(this)),this.$root.on("click","input#change-tf-access-checkbox",function(e){return function(t){var n;return n=pe(t.currentTarget),e.update_tf_access(!n.prop("checked"))}}(this))},t.prototype._disable_token_for_sf=function(e){return g.WebRequest({url:s({path:"/sm/disable_token_at_path"+We.normalize(this.path)}),subject_user:this.user.id,type:"POST",success:function(t){return function(){return pe(document).trigger(ke.UPDATE),b.success(At("Link removed")),"function"==typeof e?e():void 0}}(this),error:function(e){return function(){return b.error(At("An error occurred when removing link"))}}(this)})},t.prototype.on_add_token=function(e){return this.can_show_team_upsell_prompt&&2===this.invite_form_controller.get_token_count()?(this._display_team_upsell_prompt(),this.can_show_team_upsell_prompt=!1):void 0},t.prototype._display_team_upsell_prompt=function(e){var t,n,i,r,s;return t=this.invite_form_controller.sharing_options_auto_completer,t.token_manager.tokens.length<2?void 0:(n=t.token_manager.tokens[0].info.value,i=t.token_manager.tokens[1].info.value,r={user_front:t.getContactInfoFromEmail(n),user_back:t.getContactInfoFromEmail(i),dimension:24},s=_e.createElement(o,r),_e.render(s,this.$root.find(".team-prompt-avatar-container")[0]),this.$root.find(".team-upsell-prompt-container").show())},t.prototype.extract_invitee_data_and_call=function(e,t){var n,i,r;return e.preventDefault(),n=pe(e.currentTarget),r=n.data("email-or-fbname"),i=n.data("invite-id"),t(r,this.ns_id,i)},t.prototype.extract_user_data_and_call=function(e,t){var n,i,r,o;return e.preventDefault(),n=pe(e.currentTarget),r=n.data("display-name"),i=n.data("email"),o=n.data("user-id"),t(r,i,o)},t.prototype.maybe_load_more=function(){var e,t,n;return(t=this.$root.closest("body").length)?null==this.num_total||this.start>=this.num_total?void pe("#more-members-spinner").hide():(pe("#more-members-spinner").show(),n={},n[A.UID_PARAM_NAME]=this.user.id,n.start=this.start,n.max_results=this.max_results,e=s({path:"/share_options"+this.path}).toString(),this.$root.removeClass("ajax-loading"),new h(this.$root,e,{data:n,success:function(e){return function(t,n,i){var r,o;return null!=(null!=(o=t.data)?o.options:void 0)&&(r=t.data.options,null!=e.members&&null!=r.folder_members&&Array.prototype.push.apply(e.members,r.folder_members),null!=e.invitees&&null!=r.folder_invitees&&Array.prototype.push.apply(e.invitees,r.folder_invitees),null!=e.new_style_groups&&null!=r.new_style_groups)?Array.prototype.push.apply(e.new_style_groups,r.new_style_groups):void 0}}(this),error:function(e){return function(e,t,n){return b.error(At("Unable to load all members of this folder."))}}(this)}),this.start=this.start+this.max_results):void 0},t.prototype.submit_invitations=function(){var t,n,i,r,o,s,_;return this.invite_form_controller.tokenize(),i=this.invite_form_controller.extract_invitees(),o=this.invite_form_controller.get_custom_message(),t=this.invite_form_controller.get_access_type(),_=H.get_viewer(),r=v.clone(this.log_extras),r.access_type=t,ze.SharedFolderActivityLogger.log("web","invite_modal_send_invites_button",this.user,r),s=function(t){return function(n){return e.showIfNeeded(i,{sharingType:"shared_folder",onCheckCompleted:function(e){var n;return e?ot.pop():(n=rt.get_containing_modal(t.$root),n&&n instanceof J?n.fetch():ot.pop())},onDidClose:function(){var e;return e=new Yt(t.user,t.path),e.show()}}),b.success(n.responseText),document.fire(a.SF_INVITE,{target_ns_id:t.ns_id,user_id:t.user.id})}}(this),n=function(e){return function(t){return fn.show_validation_error(t,e.$root.find(".tokenized_autocompleter_container"))}}(this),this.sharing_api.invite_more_to_folder(this.ns_id,i,o,t,s,n)},t.prototype.reinvite_user=function(e,t,n){return this.sharing_api.reinvite_user(t,n,function(t){return function(n){var i,r,o,s,a,_;return s=JSON.parse(n.responseText),a=s.status,"OK"===a?(_=At("%(email_or_fbname)s was reinvited successfully"),_=_.format({email_or_fbname:e}),b.success(_)):(o=s.reason,i=At("ACCEPTED"===o?"That invitation has already been accepted.":"DECLINED"===o?"That invitation has already been declined.":"You no longer have permission to perform this action."),b.error(i),s.reload&&(r=rt.get_containing_modal(t.$root),r&&r instanceof J)?r.fetch():void 0)}}(this))},t.prototype.update_sf_perms=function(e){var t,n,i;return this.$root.find("#change-sf-perm-saving").show(),t=e?1:0,i=function(t){return function(n){return e?b.success(At("Editors can now manage membership of this folder.")):b.success(At("Editors can no longer manage membership of this folder.")),t.$root.find("#change-sf-perm-saving").hide()}}(this),n=function(e){return function(t){return 0===t.responseText.indexOf("err:")?b.error(t.responseText.substr(4)):b.error(At("Error updating your preference! Please try again.")),e.$root.find("#change-sf-perm-saving").hide()}}(this),this.sharing_api.update_sf_permissions(this.ns_id,t,i,n)},t.prototype.update_tf_access=function(e){var t,n;return n=function(t){return function(t){return e?b.success(At("Team members can now change folder contents.")):b.success(At("Team members can no longer change folder contents."))}}(this),t=function(e){return function(e){return b.error(At("Error updating your preference! Please try again."))}}(this),this.sharing_api.update_team_folder_access_type(this.ns_id,e,n,t)},t.prototype.show_kick_user_modal=function(e,t,n){return ot.push(new en(this.user,{element_id:"kick-confirm-modal",ns_id:this.ns_id,user_name:e,folder_path:this.path,user_id:n}))},t.prototype.show_kick_group_modal=function(e,t){return ot.push(new Zt(this.user,{element_id:"kick-group-confirm-modal",ns_id:this.ns_id,group_name:e,folder_path:this.path,group_id:t}))},t.prototype.show_transfer_user_modal=function(e,t,n){return ot.push(new on(this.user,{element_id:"transfer-confirm-modal",user_id:n,user_name:e,ns_id:this.ns_id,folder_path:this.path}))},t.prototype.show_uninvite_modal=function(e,t,n){return ot.push(new sn(this.user,{element_id:"uninvite-confirm-modal",email_or_fbname:e,ns_id:t,invite_id:n,folder_path:this.path}))},t.prototype.show_unshare_folder_modal=function(){return ot.push(new an(this.user,{element_id:"unshare-confirm-modal",team_shared_folder:this.team_shared_folder,nested_shared_folder:this.nested_shared_folder,ns_id:this.ns_id,folder_path:this.path}))},t.prototype.show_access_request_link_modal=function(){return ot.push(new In(this.user.id,this.path,void 0,!0))},t.prototype.show_owner_leave_folder_warning=function(){return b.error(At("You can't leave this folder because you're the owner. You must transfer ownership to another member before you can leave."))},t.prototype.show_leave_folder_modal=function(){return ot.push(new tn(this.user,{element_id:"leave-confirm-modal",team_shared_folder:this.team_shared_folder,ns_id:this.ns_id,folder_path:this.path}))},t.prototype.toggle_to_invite_mode=function(){var e;return this.$allow_members_table.show(),this.$folder_management_buttons.hide(),this.$invite_form.removeClass("collapsed"),null!=(e=this.sf_access_type)&&e.show(),this.has_show_invite_form=!0},t.prototype.toggle_from_invite_mode=function(){var e,t;return this.$allow_members_table.hide(),this.$folder_management_buttons.show(),this.$invite_form.addClass("collapsed"),null!=(e=this.sf_access_type)&&e.hide(),null!=(t=this.invite_form_controller)?t.reset_autocompleter():void 0},t.prototype.show_folder_settings=function(e){return ze.SharedFolderActivityLogger.log("web","invite_modal_change_settings",this.user,this.log_extras),e.preventDefault(),ot.register(Kt.SAVED_PERMISSIONS,function(e){return function(t,n){return null!=n?e.set_team_only(n):void 0}}(this)),ot.push(new Kt(this.user,this.path,this.ns_id))},t.prototype.show_golden_gate_warning=function(e){return e.preventDefault(),ot.push(new Xt(this.user,this.ns_id,{element_id:"golden-gate-warning-modal",ns_id:this.ns_id}))},t.prototype.show_email_verification=function(e){return ot.pop(),it.get_for_user(this.user).show()},t.prototype.set_team_only=function(e){var t;if(null!=this.invite_form_controller)return this.invite_form_controller.set_team_only(e),t=this.$invite_form.add(this.$root.find(".external-invite-message,.member-info .folder-settings")),e?t.addClass("team-only"):t.removeClass("team-only")},t}(),tn=Xe.LeaveFolderModal=function(e){function t(){return this.before_show=un(this.before_show,this),this.on_show=un(this.on_show,this),this.on_confirm_button_click=un(this.on_confirm_button_click,this),t.__super__.constructor.apply(this,arguments)}return _n(t,e),t.prototype.on_confirm_button_click=function(e){var t;return e.preventDefault(),t=this.$modal_window.find("#keep_files").prop("checked"),this.sharing_api.leave_folder(this.ns_id,t,function(e){return function(){var n;return n=At("You removed yourself from '%(msg)s'.").format({msg:l.em_snippet(We.filename(e.path),25)}),b.success(n),document.fire(a.SF_LEAVE,{target_ns_id:e.ns_id,folder_deleted:!t,user_id:e.user.id}),ot.clear()}}(this))},t.prototype.on_show=function(){return t.__super__.on_show.apply(this,arguments),this.team_shared_folder?(this.$modal_window.find(".keep_files_option").hide(),this.$modal_window.find(".keep_files_option").find("input").prop("checked",!1)):(this.$modal_window.find(".keep_files_option").show(),this.$modal_window.find(".keep_files_option").find("input").prop("checked",!0))},t.prototype.before_show=function(){var e;return e=At("Leave the shared folder '%(folder_name)s'"),e=e.format({folder_name:l.em_snippet(We.filename(this.path),14)}),this.format({".db-modal-title-text":e})},t}(rn),an=Xe.UnshareFolderModal=function(e){function t(){return this.before_show=un(this.before_show,this),this.on_show=un(this.on_show,this),this.on_confirm_button_click=un(this.on_confirm_button_click,this),t.__super__.constructor.apply(this,arguments)}return _n(t,e),t.prototype.on_confirm_button_click=function(e){var t;return e.preventDefault(),t=this.$modal_window.find("#keep_files").prop("checked"),this.sharing_api.unshare_folder(this.ns_id,t,function(e){return function(){var t;return t=At("Unshared folder '%(folder_name)s'"),t=t.format({folder_name:l.em_snippet(We.filename(e.path),25)}),b.success(t),document.fire(a.SF_UNSHARE,{target_ns_id:e.ns_id,user_id:e.user.id}),ot.clear()}}(this))},t.prototype.on_show=function(){return t.__super__.on_show.apply(this,arguments),this.$modal_window.find(".tsf_unshare_desc").hide(),this.$modal_window.find(".nestedsf_unshare_desc").hide(),this.$modal_window.find(".regular_unshare_desc").hide(),this.team_shared_folder?this.$modal_window.find(".tsf_unshare_desc").show():this.nested_shared_folder?this.$modal_window.find(".nestedsf_unshare_desc").show():this.$modal_window.find(".regular_unshare_desc").show()},t.prototype.before_show=function(){var e;return e=At(this.nested_shared_folder?"Reset membership for '%(folder_name)s'":"Unshare '%(folder_name)s'"),e=e.format({folder_name:l.em_snippet(We.filename(this.path),21)}),this.format({".db-modal-title-text":e})},t}(rn),sn=Xe.UninviteModal=function(e){function t(e,n){this.before_show=un(this.before_show,this),this.on_confirm_button_click=un(this.on_confirm_button_click,this),this.email_or_fbname=n.email_or_fbname,this.ns_id=n.ns_id,this.invite_id=n.invite_id,t.__super__.constructor.call(this,e,n)}return _n(t,e),t.prototype.on_confirm_button_click=function(e){return e.preventDefault(),this.sharing_api.cancel_invite(this.ns_id,this.invite_id,function(e){return function(t){var n,i,r,o,s;return r=JSON.parse(t.responseText),o=r.status,"OK"===o?(s=At("%(email_or_fbname)s has been uninvited.").format({email_or_fbname:e.email_or_fbname}),b.success(s)):(i=r.reason,"ACCEPTED"===i?n=At("That invitation has already been accepted."):"DECLINED"===i&&(n=At("That invitation has already been declined.")),b.error(n)),ot.pop()}}(this))},t.prototype.before_show=function(e){var t;return t=At("Uninvite %(email_or_fbname)s?").format({email_or_fbname:l.em_snippet(this.email_or_fbname,20)}),this.format({".uninvite-confirm-nickname":this.email_or_fbname,".uninvite-confirm-folder-name":We.filename(this.path),".db-modal-title-text":t})},t}(rn),en=Xe.KickUserModal=function(e){function t(e,n){this.user=e,this.options=n,this.before_show=un(this.before_show,this),this.on_confirm_button_click=un(this.on_confirm_button_click,this),this.user_id=this.options.user_id,this.user_name=this.options.user_name,t.__super__.constructor.call(this,this.user,this.options)}return _n(t,e),t.prototype.on_confirm_button_click=function(e){var t,n;return e.preventDefault(),t=this.$modal_window.find("#keep-files-check").prop("checked"),this.sharing_api.kick(this.ns_id,this.user_id,t,function(e){return function(){return b.success(At("User removed successfully.")),En.reload_folder_info_if_two_account(),ot.pop()}}(this)),n={ns_id:this.ns_id,kick_user_id:this.user_id,keep_files:t},ze.SharedFolderActivityLogger.log("web","invite_modal_kick_collaborator",this.user,n)},t.prototype.before_show=function(e){var t;return t=At("Remove %(person_name)s from this folder?"),t=t.format({person_name:this.user_name}),this.format({".kick-confirm-nickname":this.user_name,".db-modal-title-text":t})},t}(rn),Zt=Xe.KickGroupModal=function(e){function t(e,n){this.user=e,this.options=n,this.before_show=un(this.before_show,this),this.on_confirm_button_click=un(this.on_confirm_button_click,this),this.group_id=this.options.group_id,this.group_name=this.options.group_name,t.__super__.constructor.call(this,this.user,this.options)}return _n(t,e),t.prototype.on_confirm_button_click=function(e){return e.preventDefault(),ge.remove_namespace_from_group({group_id:this.group_id,ns_id:this.ns_id},function(){return b.success(At("Group removed successfully.")),En.reload_folder_info_if_two_account(),ot.pop()})},t.prototype.before_show=function(){var e;return e=At("Remove %(group_name)s from this folder?"),e=e.format({group_name:this.group_name}),this.format({".kick-confirm-nickname":this.group_name,".db-modal-title-text":e})},t}(rn),nn=Xe.MakeOwnerModal=function(e){function t(e,n){this.user=e,this.options=n,this.before_show=un(this.before_show,this),this.on_confirm_button_click=un(this.on_confirm_button_click,this),this.member_uid=this.options.member_uid,this.member_name=this.options.member_name,this.ns_id=this.options.ns_id,this.access_type=this.options.access_type,t.__super__.constructor.call(this,this.user,this.options)}return _n(t,e),t.prototype.on_confirm_button_click=function(e){return e.preventDefault(),this.sharing_api.update_member_access_type(this.ns_id,this.member_uid,this.access_type,function(e){return function(){return b.success(At("%(name)s now is the owner.").format({name:e.member_name})),ot.pop()}}(this))},t.prototype.before_show=function(){var e;return e=At("Make %(name)s the owner of this folder?"),e=e.format({name:l.em_snippet(this.member_name,14)}),this.format({".make-owner-confirm-nickname":this.member_name,".db-modal-title-text":e})},t}(rn),on=Xe.TransferOwnershipModal=function(e){function t(e,n){this.user=e,this.options=n,this.before_show=un(this.before_show,this),this.on_confirm_button_click=un(this.on_confirm_button_click,this),this.user_id=this.options.user_id,this.user_name=this.options.user_name,t.__super__.constructor.call(this,this.user,this.options)}return _n(t,e),t.prototype.on_confirm_button_click=function(e){return e.preventDefault(),this.sharing_api.transfer_ownership(this.ns_id,this.user_id,function(e){return function(e){return b.success(At("Ownership changed successfully")),ot.pop()}}(this))},t.prototype.before_show=function(){var e;return e=At("Make %(person_name)s the owner of this folder?"),e=e.format({person_name:l.em_snippet(this.user_name,14)}),this.format({".change_sf_owner-confirm-nickname":this.user_name,".db-modal-title-text":e})},t}(rn),Kt=Xe.ExistingSharedFolderPermissionsModal=function(e){function t(e,n,i,r){var o,s;this.user=e,this.path=n,this.ns_id=i,this.on_hide=r,o={ns_id:this.ns_id,folder_name:this.path},o[A.UID_PARAM_NAME]=this.user.id,s=At("'%(folder_name)s' settings"),s=s.format({folder_name:l.em_snippet(We.filename(this.path),13)}),t.__super__.constructor.call(this,{element_id:"folder-permissions-modal",title:s,endpoint_url:"/share_ajax/folder_settings",parameters:o})}return _n(t,e),t.SAVED_PERMISSIONS="existing_sf_permissions:saved",t}(J),Xt=Xt=function(e){function t(e,n){var i,r;this.user=e,this.ns_id=n,i={ns_id:this.ns_id},i[A.UID_PARAM_NAME]=this.user.id,r=At("Confirm converting to Golden Gate folder"),t.__super__.constructor.call(this,{element_id:"golden-gate-warning-modal",title:r,endpoint_url:"/share_ajax/golden_gate_warning",parameters:i})}return _n(t,e),t}(J),Qt=Xe.GoldenGateWarningModalContents=function(){function e(e,t,n){this.$form=e,this.ns_id=n,this._submit=un(this._submit,this),this.user=H.get_viewer().get_user_by_id(t),this._listen()}return e.prototype._listen=function(){return this.$form.find(".confirm-button").click(this._submit),this.$form.find(".cancel-button").click(this._cancel)},e.prototype._submit=function(e){return ot.push(new Gt(this.user,this.ns_id,{element_id:"golden-gate-warning-modal",ns_id:this.ns_id}))},e.prototype._cancel=function(e){return ot.pop()},e}(),Gt=Gt=function(e){function t(e,n){var i,r;this.user=e,this.ns_id=n,i={ns_id:this.ns_id},i[A.UID_PARAM_NAME]=this.user.id,r=At("Confirm converting to Golden Gate folder"),t.__super__.constructor.call(this,{element_id:"golden-gate-warning-modal",title:r,endpoint_url:"/share_ajax/golden_gate_confirm",parameters:i})}return _n(t,e),t}(J),Jt=Xe.GoldenGateConfirmModalContents=function(e){function t(e,t,n){this.$form=e,this.ns_id=n,this.user=H.get_viewer().get_user_by_id(t),new ye(this.$form,null,{should_submit_once:!0}),this.$form.on(ye.SUCCESS_EVENT,function(e){return function(){return g.WebRequest({url:"/share_ajax/enable_golden_gate_step_two",subject_user:e.user,data:{ns_id:e.ns_id},success:function(){return b.success("Golden Gate enabled for this folder"),location.reload()}})}}(this)),this._listen()}return _n(t,e),t.prototype._listen=function(){return this.$form.find(".cancel-button").click(this._cancel)},t.prototype._cancel=function(e){return ot.pop()},t}(J),Wt=Xe.ExistingSharedFolderPermissionsContent=function(){function e(e,t,n){this.$form=e,this.ns_id=n,this._submit=un(this._submit,this),this.user=H.get_viewer().get_user_by_id(t),this.sharing_api=new lt(this.user),this.sharing_api.loading_elem=this.$form,this._listen()}return e.prototype._listen=function(){return this.$form.find(".confirm-button").click(this._submit),this.$form.find(".cancel-button").click(this._cancel)},e.prototype._cancel=function(){return ot.pop()},e.prototype._submit=function(e){var t,n,i,r,o,s;return e.preventDefault(),n=this.$form.find("input[name=audience]:checked").val(),i=this.$form.find("input[name=inviter]:checked").val(),s=this.$form.find("input[name=shared_link_policy]:checked").val(),t=null!=(o=this.$form.find("input[name=activity_feed_enabled]:checked"))?o.val():void 0,this.sharing_api.update_sf_team_permissions(this.ns_id,n,i,s,t,function(e){return function(e){var t,n;return t=JSON.parse(e.responseText),n=t.team_only_invite,b.success(t.message),ot.trigger(Kt.SAVED_PERMISSIONS,n),ot.pop()}}(this)),r={ns_id:this.ns_id,audience:n,inviter:i},ze.SharedFolderActivityLogger.log("web","settings_modal_save",this.user,r)},e}();var dn,cn,hn,fn,pn,mn,vn,gn,wn,bn,yn,_n=function(e,t){function n(){this.constructor=e}for(var i in t)ln.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},ln={}.hasOwnProperty,un=function(e,t){return function(){return e.apply(t,arguments)}};dn=Xe.BaseShareAFolderWizardModal=function(e){function t(e,n){this.user=e,this.options=n,t.__super__.constructor.call(this,this.options),this.sharing_api=new lt(this.user)}return _n(t,e),
t.prototype.base_title=null,t.prototype.personal_title=null,t.prototype.work_title=null,t.prototype.before_show=function(){var e;return this.sharing_api.loading_elem=this.$modal_window,e=this.base_title,H.get_viewer().is_paired&&(e="personal"===this.user.role?this.personal_title:this.work_title.format({team_name:H.get_viewer().team_name})),this.format({".db-modal-title-text":e})},t}(rt),gn=Xe.ShareAFolderWizardModal=function(e){function t(e,n){this.user=e,this.options=n,t.__super__.constructor.call(this,this.user,this.options),this.base_title=At("Share a folder"),this.personal_title=At("Share a folder from your personal Dropbox"),this.work_title=At("Share a folder from your %(team_name)s Dropbox")}return _n(t,e),t.prototype.on_show=function(){return this.$modal_window.find("input#create-new-sf").prop("checked",!0),this.$modal_window.find("a.back").on("click",function(e){return function(t){return t.preventDefault(),zt.start_wizard_without_user(),e.hide()}}(this)),this.$modal_window.find("#new-or-existing-sf li").on("click",function(e){return function(t){return pe(t.currentTarget).find('input[name="sf_type"]').prop("checked",!0),e.$modal_window.find("input#create-new-sf").is(":checked")?ze.SharedFolderActivityLogger.log("web","new_or_existing_modal_new_folder",e.user):ze.SharedFolderActivityLogger.log("web","new_or_existing_modal_existing_folder",e.user)}}(this))},t.prototype.on_confirm_button_click=function(e){var t,n,i,r,o,s;if(e.preventDefault(),n=this.$modal_window.find("input#create-new-sf").is(":checked")){if(r=null,this.hide(),"work"===this.user.role&&(o="shared-folder-type-wizard-modal",s=rt.get_template(o),s.length&&(r=new yn(this.user,{element_id:o}))),null===r){if(pt(this.user,this))return;r=new bn(this.user,{element_id:"share-new-folder-wizard-modal"})}return i={selection:"new_folder"},ze.SharedFolderActivityLogger.log("web","new_or_existing_modal_next_button",this.user,i),r.show()}return t=this.$modal_window.find(".ajax-loading-indicator").show(),g.AuthenticatedRequest({url:"/share_ajax/account_has_existing_folders",subject_user:this.user,success:function(e){return function(t){var n;if(t=JSON.parse(t),e.hide(),t===!0){if(mt(e.user,e))return;r=new wn(e.user,{element_id:"share-existing-folder-wizard-modal"}),i.has_existing_folder=!0}else{if(n=At("You don't have any existing folders. Please create and share a new folder."),pt(e.user,e))return;r=new bn(e.user,{element_id:"share-new-folder-wizard-modal",error_msg:n}),i.has_existing_folder=!1}return r.show()}}(this),error:function(e){return function(){return b.error()}}(this),complete:function(e){return function(){return t.hide()}}(this)},i={selection:"existing_folder"},ze.SharedFolderActivityLogger.log("web","new_or_existing_modal_next_button",this.user,i))},t}(dn),yn=Xe.SharedFolderTypeWizardModal=function(e){function t(e,n){this.user=e,this.options=n,t.__super__.constructor.call(this,this.user,this.options),this.work_title=At("Share a folder from your %(team_name)s Dropbox")}return _n(t,e),t.prototype.on_show=function(){return this.$modal_window.find("input#team-folder-option").prop("checked",!0),this.$modal_window.find("a.back").on("click",function(e){return function(t){return t.preventDefault(),zt.start_wizard_for_user(e.user),e.hide()}}(this)),this.$modal_window.find("#shared-folder-type li").on("click",function(e){return function(t){return pe(t.currentTarget).find('input[name="shared_folder_type"]').prop("checked",!0),e.$modal_window.find("input#team-folder-option").is(":checked")?ze.SharedFolderActivityLogger.log("web","shared_folder_type_team_folder",e.user):ze.SharedFolderActivityLogger.log("web","shared_folder_type_shared_folder",e.user)}}(this))},t.prototype.on_confirm_button_click=function(e){var t,n,i,r;return e.preventDefault(),t=function(e){return function(t,n){var i;return t.preventDefault(),n.hide(),i=new e.constructor(e.user,e.options),i.show()}}(this),n=this.$modal_window.find("input#team-folder-option").is(":checked"),n?(i=new I({element_id:"new-team-folder-modal",open_created_folder:!0,back_fn:t}),r="team_folder"):(i=new bn(this.user,{element_id:"share-new-folder-wizard-modal",back_fn:t}),r="shared_folder"),ze.SharedFolderActivityLogger.log("web","shared_folder_type_next_button",this.user,{selection:r}),this.hide(),i.show()},t}(dn),fn=Xe.InlineModalValidationError=function(){function e(){}return e.show_validation_error=function(e,t){var n,i,r,o,s,a;if(0===e.responseText.indexOf("err:{")){a=e.responseText.substr(4),s=JSON.parse(a);for(i in s)if(n=s[i],"message_text"in n)return o=t.find("span.error-message"),0===o.length&&(o=pe("<span/>").addClass("error-message"),t.prepend(o)),void o.text(n.message_text);return t.find("span.error-message").remove(),b.error()}return t.find("span.error-message").remove(),0===e.responseText.indexOf("err:")?(r=e.responseText.substr(4),b.error(r)):b.error()},e}(),bn=Xe.ShareNewFolderWizardModal=function(e){function t(e,n){this.user=e,this.options=n,this.options.focus="#new-shared-folder-wizard input[type=text]",t.__super__.constructor.call(this,this.user,this.options),this.base_title=At("Create a new shared folder"),this.personal_title=At("Create a shared folder in your personal Dropbox"),this.work_title=At("Create a shared folder in your %(team_name)s Dropbox")}return _n(t,e),t.prototype.on_show=function(){var e,t,n,i;for(i=this.$modal_window.find(".suggestion-input"),t=0,n=i.length;n>t;t++)e=i[t],Zn.register($(e));return this.$modal_window.find("#validate-folder-name").submit(function(e){return function(t){return t.preventDefault(),e.on_confirm_button_click(t)}}(this)),this.options.error_msg&&b.error(this.options.error_msg),this.$modal_window.find("a.back").on("click",function(e){return function(t){return e.options.back_fn?e.options.back_fn(t,e):(t.preventDefault(),e.hide(),zt.start_wizard_for_user(e.user))}}(this))},t.prototype.on_confirm_button_click=function(e){var t,n,i,r;return e.preventDefault(),n=this.$modal_window.find("#new-shared-folder-name-input").val(),i={folder_name:n},ze.SharedFolderActivityLogger.log("web","name_new_folder_modal_next_button",this.user,i),r=function(e){return function(){var t;return e.hide(),ht(e.user,{fqPath:"/"+n,isFolder:!0,exists:!1,origin:"WIZARD"})?void 0:(t=new pn(e.user,{folder_name:n,element_id:"invite-to-new-sf-wizard-modal-"+e.user.id}),t.new_folder=!0,t.show(),ze.SharedFolderActivityLogger.log("web","name_new_folder_modal_success",e.user,i))}}(this),t=function(e){return function(t){var n;return n=ye.extract_errors(t.responseText),ze.SharedFolderActivityLogger.log("web","name_new_folder_modal_fail",e.user,i),n!==!1?"string"==typeof n?b.error(n):(pe("#new-shared-folder-name-input .error-message").remove(),ye.fill_errors(pe("#validate-folder-name"),n)):void 0}}(this),this.sharing_api.validate_new_sf_path(n,r,t)},t}(dn),wn=Xe.ShareExistingFolderWizardModal=function(e){function t(e,n){var i;this.user=e,this.options=n,this._hide=un(this._hide,this),this.on_show=un(this.on_show,this),t.__super__.constructor.call(this,this.user,this.options),this.base_title=At("Choose folder to share"),this.personal_title=At("Choose a folder from your personal Dropbox"),this.work_title=At("Choose a folder from your %(team_name)s Dropbox"),ni.init(Vn.dir_handler,i=!1,"copy-move-treeview")}return _n(t,e),t.prototype.on_show=function(){return this.treeview_id="copy-move-treeview",this.treeview_parent_id=pe("#"+this.treeview_id).parent().attr("id"),ni.schedule_reset(),ni.move(this.treeview_id,"share-existing-treeview",{onSuccess:function(e){return function(){var t;return pe(document).on("db:treeview_selected",function(t,n){return e.folder_name=n}),t=pe(".first-treeview-link"),Rt.ie?void 0:t.click()}}(this),user:this.user}),this.$modal_window.find("a.back").on("click",function(e){return function(t){return t.preventDefault(),e.hide(),zt.start_wizard_for_user(e.user)}}(this))},t.prototype._hide=function(){return ni.move(this.treeview_id,this.treeview_parent_id,{user:this.user}),t.__super__._hide.apply(this,arguments)},t.prototype.on_hide=function(){return pe(document).off("db:treeview_selected")},t.prototype.on_confirm_button_click=function(e){var t,n,i;if(n={folder_name:this.folder_name},e.preventDefault(),this.folder_name&&this.$modal_window.find("#copy-move-treeview .highlight .s_web_folder_user").length){if(this.hide(),ht(this.user,{fqPath:this.folder_name,isFolder:!0,origin:"WIZARD",shouldFetchNsId:!0}))return;return ze.SharedFolderActivityLogger.log("web","choose_folder_modal_shared_next",this.user,n),zt.show_shared_folder_options_modal(this.folder_name,this.user)}return i=function(e){return function(){var t;return e.hide(),ht(e.user,{fqPath:e.folder_name,isFolder:!0,origin:"WIZARD"})?void 0:(t=new pn(e.user,{folder_name:e.folder_name,element_id:"invite-to-new-sf-wizard-modal-"+e.user.id}),ze.SharedFolderActivityLogger.log("web","choose_folder_modal_not_shared_next",e.user,n),t.new_folder=!1,t.show())}}(this),t=function(e){return function(t){return fn.show_validation_error(t,e.$modal_window.find("#choose-existing-folder"))}}(this),this.sharing_api.validate_existing_sf_path(this.folder_name,i,t)},t}(dn),hn=Xe.CreateOrShareNewFolderWizardModal=function(t){function n(e,t){this.user=e,this.options=t,this.on_confirm_button_click=un(this.on_confirm_button_click,this),this._extract_invitees=un(this._extract_invitees,this),this._toggle_send_button_state=un(this._toggle_send_button_state,this),n.__super__.constructor.call(this,this.options),this.destination_dir=this.options.destination_dir,this.sharing_api=new lt(this.user),this.state="Create"}return _n(n,t),n.prototype.on_show=function(){var e,t,n,i,r;return this.$send_button=this.$modal_window.find(".confirm-button"),this.$cancel_button=this.$modal_window.find(".cancel-button"),n="create-and-share-new-folder-invite-wizard-"+this.user.id,this.file_name_input=this.$modal_window.find("#create-and-share-new-folder-name-input"),this.file_name_input.focus(),t=n+"-new-collab-input",this.collab_input=this.$modal_window.find("#"+t),e={tokens:[",",";"],include_fb:!0,include_team:!0,team_only:!1,user_id:this.user.id,max_textbox_height:30},this.autocompleter=new Autocompleter.ContactsTokenizer(this.user,t,n+"-new-whobulk",n+"-hidden-input",e),null!=(i=this.file_name_input)&&i.keyup(this._toggle_send_button_state),null!=(r=this.collab_input)&&r.keyup(this._toggle_send_button_state),this.collab_input[0]&&(this.collab_input[0].on("token:remove",this._toggle_send_button_state),this.collab_input[0].on("token:add",this._toggle_send_button_state)),this._toggle_send_button_state()},n.prototype._toggle_send_button_state=function(){var e,t,n,i;return i=0===(null!=(t=this.autocompleter)?t.token_manager.tokens.length:void 0),i=i&&""===this.collab_input.val(),e=this.file_name_input.val(),n=""===e,this.$send_button.prop("disabled",n),i?(this.$send_button.text(At("Create folder")),this.state="Create"):(this.$send_button.text(At("Share folder")),this.state="Share")},n.prototype._extract_invitees=function(){var e,t,n,i,r,o,s,a;for(n=this.$modal_window.find(".tokenized_autocompleter_container"),o={},a=["emails","fb_ids","group_ids","new_style_group_ids"],i=0,s=a.length;s>i;i++)t=a[i],r=n.find("input[name="+t+"]"),o[t]=function(){var t,n,i;for(i=[],t=0,n=r.length;n>t;t++)e=r[t],i.push(pe(e).val());return i}();return o},n.prototype.on_confirm_button_click=function(t){var n,i,r,o,s,a,_,l,u,d,c,h,f;return t.preventDefault(),u=this.file_name_input.val(),o=At("We can’t create folder '%(folder_name)s'"),o=o.format({folder_name:u}),r=function(){return b.error(o)},"Create"===this.state?(f="/cmd/new"+Rt.urlquote(this.destination_dir),d={to_path:u},d[A.UID_PARAM_NAME]=this.user.id,h=function(){var e;return e=At("Created new folder '%(folder_name)s'"),e=e.format({folder_name:u}),b.success(e)},new g.WebRequest({url:f,data:d,success:h,error:r})):(this.autocompleter.tokenize_emails_input(!0),a=this._extract_invitees(),h=function(){var e;return e=At("Shared new folder '%(folder_name)s'"),e=e.format({folder_name:u}),b.success(e)},l="",i="all",_="editors",c="0",n=null,s=this.destination_dir+"/"+u,this.sharing_api.share_path(s,a,l,i,_,c,n,!1,h,r),e.showIfNeeded(a,{sharingType:"shared_folder"})),this.hide()},n}(rt),cn=Xe.CreateLinkOrInviteToFolderWizardModal=function(e){function t(e,n){this.user=e,this.options=n,t.__super__.constructor.call(this,this.options),this.sharing_api=new lt(this.user)}return _n(t,e),t.prototype.before_show=function(){var e;return this.sharing_api.loading_elem=this.$modal_window,e=At("Share '%(folder_name)s' with others"),e=e.format({folder_name:l.em_snippet(We.filename(this.options.path),16)}),this.format({".db-modal-title-text":e})},t.prototype.on_show=function(){var e,t,n;return e="edu_modal",n=null!=(t=this.options.target_item)?t:null,ze.ShmodelUILogger.log("view",e,n),this.$modal_window.find(".option-to-share-folder").on("click",function(t){return function(i){var r;return t.options.existing_sf?(ze.ShmodelUILogger.log("sf_options",e,n),r=new Yt(pr.active_user,t.options.path)):(ze.ShmodelUILogger.log("sf_invite",e,n),r=new pn(t.user,{folder_name:t.options.path,element_id:"invite-to-new-sf-wizard-modal-"+t.user.id})),t.hide(),r.show()}}(this)),this.$modal_window.find(".option-to-share-link").on("click",function(t){return function(i){return ze.ShmodelUILogger.log("token_share",e,n),kn.shmodel(t.options.path,"create_link_or_invite_to_folder_modal"),t.hide()}}(this)),this.$modal_window.find(".learn-more").on("click",function(t){return function(t){return t.preventDefault(),ze.ShmodelUILogger.log("clicked_learn_more",e,n),window.open("/help/274","_blank")}}(this))},t}(rt),pn=Xe.InviteToNewSharedFolderWizardModal=function(t){function n(e,t){this.user=e,this.options=t,this.insert_folder_settings=un(this.insert_folder_settings,this),this.share_folder=un(this.share_folder,this),this.on_confirm_button_click=un(this.on_confirm_button_click,this),this.show_settings_modal=un(this.show_settings_modal,this),this._toggle_get_link_button_visibility=un(this._toggle_get_link_button_visibility,this),this._close_team_prompt=un(this._close_team_prompt,this),this._update_team_prompt_link=un(this._update_team_prompt_link,this),this._display_team_upsell_prompt=un(this._display_team_upsell_prompt,this),this._on_add_token=un(this._on_add_token,this),this.options.focus=".new-collab-input",n.__super__.constructor.call(this,this.options),this.sharing_api=new lt(this.user),this.folder_name=this.options.folder_name,null!=this.options.can_change_options?this.can_change_options=this.options.can_change_options:this.can_change_options=!0,this.has_inviter_restriction=this.options.has_inviter_restriction}return _n(n,t),n.prototype.before_show=function(){var e;return this.sharing_api.loading_elem=this.$modal_window,e=At("Share '%(folder_name)s' with others"),e=e.format({folder_name:l.em_snippet(We.filename(this.folder_name),16)}),this.format({".db-modal-title-text":e}),this.$modal_window.find(".change-new-folder-settings").toggle(this.can_change_options)},n.prototype.on_show=function(){var e,t,n,i,r,o;for(o=this.$modal_window.find(".suggestion-input"),n=0,i=o.length;i>n;n++)t=o[n],Zn.register($(t));return e=this.$modal_window.find(".invite-more-form"),this.invite_form_controller?this.invite_form_controller.listen():(r="invite-wizard-"+this.user.id,this.invite_form_controller=new Vt(this.user,e,[],[],[],r),this.insert_folder_settings(this.invite_form_controller.team_only?"team":"")),this.collab_input=this.$modal_window.find(".new-collab-input"),this.collab_input.focus(),this.collab_input.keyup(this._toggle_get_link_button_visibility),this.collab_input[0]&&(this.collab_input[0].on("token:remove",this._toggle_get_link_button_visibility),this.collab_input[0].on("token:add",this._on_add_token),this.can_show_team_upsell_prompt=1===this.$modal_window.find(".team-upsell-prompt").length,this.can_show_team_upsell_prompt&&(this.$modal_window.find(".close-team-prompt-button").on("click",this._close_team_prompt),this.$modal_window.find(".team-prompt-link").on("click",this._update_team_prompt_link))),this.$modal_window.find(".change-new-folder-settings").on("click",function(e){return function(t){return t.preventDefault(),e.show_settings_modal()}}(this)),this.log_extras={path:this.folder_name},ze.SharedFolderActivityLogger.log("web","share_folder_modal_displayed",this.user,this.log_extras)},n.prototype._on_add_token=function(){return this.can_show_team_upsell_prompt&&2===this.invite_form_controller.get_token_count()&&(this._display_team_upsell_prompt(),this.can_show_team_upsell_prompt=!1),this._toggle_get_link_button_visibility},n.prototype._display_team_upsell_prompt=function(){var e,t,n,i,r;return e=this.invite_form_controller.sharing_options_auto_completer,e.token_manager.tokens.length<2?void 0:(t=e.token_manager.tokens[0].info.value,n=e.token_manager.tokens[1].info.value,i={user_front:e.getContactInfoFromEmail(t),user_back:e.getContactInfoFromEmail(n),dimension:24},r=_e.createElement(o,i),_e.render(r,this.$modal_window.find(".team-prompt-avatar-container")[0]),this.$modal_window.find(".team-upsell-prompt-container").show())},n.prototype._update_team_prompt_link=function(){var e,t,n,i;return e=Bt.truncate_emails(this.invite_form_controller.sharing_options_auto_completer.getEmails()),t=this.$modal_window.find(".team-prompt-link"),i=t.attr("href"),n=s.parse(i).updateQuery({invite_members:e}),t.attr("href",n)},n.prototype._close_team_prompt=function(){return this.$modal_window.find(".team-upsell-prompt-container").hide()},n.prototype._toggle_get_link_button_visibility=function(){var e,t,n,i,r;return"1"===this.shared_link_policy_restriction?void(null!=(n=this.get_link_button)&&n.hide()):(t=0===this.invite_form_controller.get_token_count(),e=this.collab_input&&""===this.collab_input.val(),t&&e?null!=(i=this.get_link_button)?i.show():void 0:null!=(r=this.get_link_button)?r.hide():void 0)},n.prototype.show_settings_modal=function(){var e,t;return t=At("'%(folder_name)s' settings"),t=t.format({folder_name:l.em_snippet(We.filename(this.folder_name),13)}),e={folder_name:this.folder_name},this.audience_restriction&&(e.audience=this.audience_restriction),this.inviter_restriction&&(e.inviter=this.inviter_restriction),this.shared_link_policy_restriction&&(e.shared_link_policy=this.shared_link_policy_restriction),e[A.UID_PARAM_NAME]=this.user.id,ot.register(mn.SAVED_PERMISSIONS,function(e){return function(t,n){return e.insert_folder_settings(n.audience,n.inviter,n.shared_link_policy),e.invite_form_controller.reset_options()}}(this)),ot.push(new J({element_id:"folder-permissions-modal",title:t,endpoint_url:"/share_ajax/default_folder_settings",parameters:e}))},n.prototype.on_confirm_button_click=function(e){var t,n,i,r;return e.preventDefault(),this.invite_form_controller.tokenize(),n=this.invite_form_controller.extract_invitees(),r=this.invite_form_controller.get_custom_message(),t=this.invite_form_controller.get_access_type(),i=this.$modal_window.find("input#allow_other_members_to_share"),i.length>0&&(this.inviter_restriction=i.is(":checked")?"all":"me"),this.share_folder(n,r,t)},n.prototype.share_folder=function(t,n,i){var r,o,s,_;return r=function(e){return function(t){return e.$modal_window.find(".confirm-button").prop("disabled",!1),fn.show_validation_error(t,e.$modal_window.find(".tokenized_autocompleter_container"))}}(this),_=function(n){return function(i){var r;return n.$modal_window.find(".confirm-button").prop("disabled",!1),r=JSON.parse(i.responseText),b.success(r.success_msg),document.fire(a.SF_NEW,{sf_info:En.decode_sort_key(r.sf_info)}),e.showIfNeeded(t,{sharingType:"shared_folder",onCheckCompleted:function(e){return n.hide()}})}}(this),this.$modal_window.find(".confirm-button").prop("disabled",!0),o=!1,this.sharing_api.share_folder(this.new_folder,this.folder_name,t,n,this.audience_restriction,this.inviter_restriction,this.shared_link_policy_restriction,i,o,_,r),s={path:this.folder_name,access_type:i},ze.SharedFolderActivityLogger.log("web","invite_modal_share_folder_button",this.user,s)},n.prototype.insert_folder_settings=function(e,t,n){var i;return this.audience_restriction=e,this.inviter_restriction=t,this.shared_link_policy_restriction=n,i=this.$modal_window.find(".invite-more-form, .external-invite-message,.folder-settings"),pr.inside_team_folder?(i.addClass("in-team-folder"),i.removeClass("team-only")):(i.removeClass("in-team-folder"),"team"===this.audience_restriction?i.addClass("team-only"):i.removeClass("team-only"),"work"===this.user.role&&this.invite_form_controller.set_team_only("team"===this.audience_restriction)),this._toggle_get_link_button_visibility()},n}(rt),vn=Xe.NewSharedFolderPermissionsModal=function(e){function t(e,n,i,r){var o,s;this.user=e,this.path=n,this.saved_state=i,this.done_callback=r,o={folder_name:this.path,audience:this.saved_state.audience?this.saved_state.audience:void 0,inviter:this.saved_state.inviter?this.saved_state.inviter:void 0,shared_link_policy:this.saved_state.shared_link_policy?this.saved_state.shared_link_policy:void 0,is_file:!1},o[A.UID_PARAM_NAME]=this.user.id,s=At("‘%(folder_name)s’ settings"),s=s.format({folder_name:l.em_snippet(We.filename(this.path),13)}),ot.register(mn.SAVED_PERMISSIONS,function(e){return function(t,n){return e.done_callback.bind(null,n.audience,n.inviter,n.shared_link_policy)()}}(this)),t.__super__.constructor.call(this,{element_id:"folder-permissions-modal",title:s,endpoint_url:"/share_ajax/default_folder_settings",parameters:o})}return _n(t,e),t}(J),mn=Xe.NewSharedFolderPermissionsContent=function(){function e(e){this.$form=e,this._submit=un(this._submit,this),this._listen()}return e.SAVED_PERMISSIONS="new_sf_permissions:saved",e.prototype._listen=function(){return this.$form.find(".confirm-button").click(this._submit),this.$form.find(".cancel-button").click(this._cancel)},e.prototype._cancel=function(){return ot.pop()},e.prototype._submit=function(t){var n,i,r;return t.preventDefault(),n=this.$form.find("input[name=audience]:checked").val(),i=this.$form.find("input[name=inviter]:checked").val(),r=this.$form.find("input[name=shared_link_policy]:checked").val(),ot.trigger(e.SAVED_PERMISSIONS,{audience:n,inviter:i,shared_link_policy:r}),ot.pop()},e}();var kn;kn=Xe.SharingShmodel=function(){function e(){}return e.shmodel=function(e,t){return new In(pr.active_user.id,e,t).show()},e}();var En;En=INLINE_JS.Sharing=Xe.Sharing={init:function(e,t,n){return this.show_inbox=n,this._decode_sort_keys(e),this._state={sf_info:{current:e.current,past:e.past},cmp:{"#sf-current":this._modified_cmp,"#sf-past":this._modified_cmp},is_ascending:{"#sf-current":!1,"#sf-past":!1},inbox_counts:{},sf_loading:e.more,delay_reload_folder:!1},H.get_viewer().is_paired&&(this.role_picker=Y.get_controller(pe("#role-selector")),q.addListener(this._render.bind(this)),te.set_during_login_callback(function(e){return function(t,n){return e._reload_folder_info(function(){return n()},function(e){return n(At("Error displaying shared folders")),window.location.reload()})}}(this))),this._listen(),this._tmpl=Ke.tmpl("sf_list_item_tmpl"),this._render(),e.more&&this._display_spinner(),e.more&&g.WebRequest({url:"/share_ajax/list_folders",dataType:"json",data:{start:e.next},success:function(e){return function(t){return e._load_and_render_sf_list(t)}}(this),error:function(e){return function(t){return e._sf_list_error()}}(this)}),this._update_inbox_counts(t,!0),this._display_view(),$e.mark_time_to_view(),$e.mark_time_to_interactive(),pe(document).on(lt.REQUEST_SUCCEEDED_EVENT,function(e){return function(t,n){return"/share_ajax/cancel_invite"===n.request_url||"/share_ajax/invite_more"===n.request_url||"/share_ajax/kick_user"===n.request_url?e._reload_folder_info():void 0}}(this))},_load_and_render_sf_list:function(e){return this._decode_sort_keys(e),this._state.sf_loading&&(this._state.sf_info.current.push.apply(this._state.sf_info.current,e.current),this._state.sf_info.past.push.apply(this._state.sf_info.past,e.past),this._state.sf_loading=!1),this._hide_spinner(),this._render(),this._state.delay_reload_folder?(this._state.delay_reload_folder=!1,this._reload_folder_info()):void 0},_sf_list_error:function(){return this._hide_spinner(),b.error(At("We weren’t able to load the list of shared folders. Please refresh the page to try again."))},is_share_page:function(){return null!=this._state},_decode_sort_keys:function(e){return[e.current,e.past].each(function(e){return function(t){return t.each(function(t){return e.decode_sort_key(t)})}}(this))},decode_sort_key:function(e){return bt(null!=e.encoded_sort_key&&null==e.sort_key,"expected encoded sort keys on each elm"),e.sort_key=Rt.decode_sort_key(e.encoded_sort_key),delete e.encoded_sort_key,e},reload_folder_info_if_two_account:function(){return this._showing_two_accounts()?this._reload_folder_info():void 0},_reload_folder_info:function(e,t){var n;if(this.is_share_page())return n=function(t){return function(n){var i;return i=JSON.parse(n.responseText),t._decode_sort_keys(i),t._state.sf_info=i,t._render(),"function"==typeof e?e():void 0}}(this),this._state.sf_loading?this._state.delay_reload_folder=!0:(new ut).get_folder_info(n,t)},refresh_inbox_counts:function(e){return(new ut).get_inbox_counts(function(t){return function(n){return t._update_inbox_counts(n,e)}}(this))},_update_inbox_counts:function(e,t){var n,i,r,o,s,a;a=0;for(o in e)n=e[o],a+=n;return pe("#inbox-count").text(a),pe("#inbox-count").toggleClass("show",a>0),this.is_share_page()&&(i=function(e,t){var n;for(o in e)if(n=e[o],t[o]!==e[o])return!1;return!0},t||!this._state||!i(this._state.inbox_counts,e))?(this._state.inbox_counts=e,a?(r=new Element("a",{id:"new-invites-link",href:"#"}),r.__sert(G.make("web","email_32",{class:"link-img"})),s=Tt("%(total_count)d new shared folder invitation","%(total_count)d new shared folder invitations",a),s+=" \n",s=s.format({total_count:a}),r.__sert(s),r.observe("click",function(e){return function(t){return Event.stop(t),e.show_invites()}}(this)),$("invites-box").show(),$("invites-box").__date(r)):$("invites-box").hide(),a>0&&this.show_inbox?(this.show_inbox=!1,this.show_invites()):void 0):void 0},register_accept:function(e){return pe(e).closest(".sf-invite-action").addClass("loading"),new h(pe(e),e.action,{data:Hn.collect_form_vars(e),complete:function(t){return function(n,i){return pe(e).closest(".sf-invite-action").removeClass("loading"),t.refresh_inbox_counts(),t._reload_folder_info()}}(this),success:function(t){return function(n,i,r){var o,s,a,_;return n=null!=(_=JSON.parse(r.responseText))?_.data:void 0,o=pe(e).closest(".sf-invite-action"),o.addClass("sf-accepted"),(null!=n?n.redirect:void 0)?t._state&&t._state.current_total_count>1?(s=o.find(".view-folder-button"),s.click(function(){return window.location.href=null!=n?n.redirect:void 0})):window.location.href=null!=n?n.redirect:void 0:(a=pe(e).closest(".invitation-row").attr("data-invite-id"),t._remove_invite_row(a))}}(this)}),!1},upgrade_to_accept:function(e){return new h(pe(e),e.action,{data:Hn.collect_form_vars(e)}),!1},register_decline:function(e,t,n){var i,r;return i=pe(e).closest("form"),null!=(r=i.closest(".sf-invite-action"))&&r.addClass("loading"),i.length&&new h(i,i[0].action,{data:Hn.collect_form_vars(i[0]),complete:function(e){return function(r,o){var s;return null!=(s=i.closest(".sf-invite-action"))&&s.removeClass("loading"),e._remove_invite_row(t),e.refresh_inbox_counts(),e._reload_folder_info(),n?n():void 0}}(this)}),!1},_remove_invite_row:function(e){var t,n,i,r;return t=pe("#invites-container"),n=t.find('[data-invite-id="'+e+'"]'),n&&(r=n.parent("tbody"),n.remove(),0===r.children().length&&(t.find(".invitation-table-container").hide(),t.find(".message-bottom").removeClass("message-bottom"),t.find(".message-top").removeClass("message-top"),0===t.find(".invites-message").length))?(i=rt.get_containing_modal(t),null!=i?i.hide():void 0):void 0},_listen:function(){var e,t,n;return this.listen_modals(),e=function(e){return function(t,n,i){var r,o,s,a,_,l,u,d,c;for(u=e._get_current_sf_list_info(i),l=u[0],s=u[1],bt(n,"SF _transfer w/o target_ns_id"),r=a=0,_=l.length;_>a;r=++a)if(o=l[r],String(o.target_ns_id)===String(n)&&String(o.user_id)===String(t)){d=o,c=r;break}return bt(null!=c,"SF _transfer w/o js obj"),[d,c]}}(this),n=function(t){return function(n,i,r){var o,s,a,_,l,u,d,c,h;return s=t._get_current_sf_list_info(i),o=s[0],h=s[1],a=t._get_current_sf_list_info(r),d=a[0],c=a[1],_=e(n.memo.user_id,n.memo.target_ns_id,i),l=_[0],u=_[1],o.splice(u,1),t._empty_check(i),null!=n.memo.filename&&(l.filename=n.memo.filename),null!=n.memo.mount_point&&(l.mount_point=n.memo.mount_point),d.push(l),t._render()}}(this),t=function(t){return function(n,i){var r,o,s,a,_,l;return o=t._get_current_sf_list_info(i),r=o[0],l=o[1],s=e(n.memo.user_id,n.memo.target_ns_id,i),a=s[0],_=s[1],r.splice(_,1),t._render()}}(this),document.observe(a.SF_UNSHARE,function(e){return function(e){return t(e,"#sf-current")}}(this)),document.observe(a.SF_LEAVE,function(e){return function(e){return n(e,"#sf-current","#sf-past")}}(this)),document.observe(a.SF_ADD_TO_DROPBOX,function(e){return function(t){return n(t,"#sf-past","#sf-current"),e._reload_folder_info()}}(this)),document.observe(a.SF_IGNORE,function(e){return function(e){return t(e,"#sf-past")}}(this)),document.observe(a.SF_NEW,function(e){return function(t){var n;return n=t.memo.sf_info,bt(n,"SF_NEW without info"),e._state.sf_loading?e._reload_folder_info():(e._state.sf_info.current.push(n),e._render())}}(this)),$("create-share").observe("click",function(e){return function(e){return ze.SharedFolderActivityLogger.log("web","sharing_view_share_new",null,{},!0),$("create-share").hasClassName("disabled")?void 0:(Event.stop(e),zt.start_wizard_without_user())}}(this)),pe("#learn-more-link").click(function(e){return function(e){return ze.SharedFolderActivityLogger.log("web","sharing_view_learn_more",null,{},!0)}}(this)),$("new-invites-link")&&$("new-invites-link").observe("click",function(e){return function(t){return Event.stop(t),e.show_invites()}}(this)),pe("#sf-current, #sf-past").each(function(e){return function(t,n){var i;return pe(".sf-list",n).on("click","a.options-link",function(t){var n,i,r,o,s,a,_,l,u,d,c;return t.preventDefault(),o=pe(t.target).closest("a.options-link"),_=o.attr("data-type"),i=o.attr("data-filename"),a=o.attr("data-mount"),d=parseInt(o.attr("data-nsid"),10),c=H.get_viewer().get_user_by_id(o.attr("data-user_id")),u=pe(t.target).closest("li.sf-folder").data("role"),l=o.attr("data-sf-perm-role"),"normal"===_?(r=v(e._state.sf_info.current).find(function(e){return e.target_ns_id===d}),n=ht(c,{fqPath:a,isFolder:!0,isTeamSharedFolder:r.is_team_shared_folder,origin:"SHARE",targetNsId:d}),n||zt.show_shared_folder_options_modal(a,c)):"remove"===_?zt.show_ignore_modal(c,i,d):"add"===_&&On.sync_shared_folder(d,c.role,"SHARE",!1,!0),s={option_type:_},d&&(s.ns_id=d),a&&(s.path=a),ze.SharedFolderActivityLogger.log("web","sharing_view_share_existing",c.id,s,!0)}),pe(".sf-sort",n).on("click","a.sort-option",function(t){var n,i,r,o;return t.preventDefault(),n=pe(t.target).closest("a.sort-option"),i="#"+n.parent().parent().attr("id"),o={SF_BY_NAME:e._name_cmp,SF_BY_MODIFIED:e._modified_cmp},r=o[n.attr("data-sort")],e._state.cmp[i]===r?e._state.is_ascending[i]=!e._state.is_ascending[i]:(e._state.cmp[i]=r,e._state.is_ascending[i]=!0),Rt.add_sort_arrow_mouseover_j(n,e._state.is_ascending[i],i+" .sf-sort a.sort-option",!0),e._render_list_id(i)}),i=["#sf-current","#sf-past"][t],Rt.add_sort_arrow_mouseover_j(pe(".modified-sorter",n),e._state.is_ascending[i],i+" .sf-sort a.sort-option",!1)}}(this)),pe(".empty-share-button").click(function(e){return function(e){return e.preventDefault(),ze.SharedFolderActivityLogger.log("web","sharing_view_share_new",null,{},!0),zt.start_wizard_without_user()}}(this))},listen_modals:function(){return pe("#new-or-existing-sf li").click(function(e){return function(e){var t;return pe("#new-or-existing-sf li").removeClass("active"),t=pe(e.target).closest("li"),t.find("input").prop("checked",!0),t.addClass("active");
}}(this))},_showing_two_accounts:function(){var e;return H.get_viewer().is_paired&&(null!=(e=this.role_picker)?e.get_state():void 0)===dt.ALL},_render:function(){var e;return this._render_list_id("#sf-current"),e=this._render_list_id("#sf-past"),e>3&&(pe("#sf-past").addClass("share-page__collapsed-shares-list"),pe("#sf-past a.share-page__show-hidden-sfs").on("click",function(){return pe("#sf-past").removeClass("share-page__collapsed-shares-list")})),pe("#sf-current").hasClass("empty-list")&&pe("#sf-past").hasClass("empty-list")?(pe("#page-content").addClass("no-shares"),pe("#empty-content").show()):(pe("#page-content").removeClass("no-shares"),pe("#empty-content").hide())},_render_list_id:function(e){var t,n,i,r,o,s,a,_,u,d,c;for(_=this._get_current_sf_list_info(e),s=_[0],i=_[1],c=this._showing_two_accounts(),t=function(t){return function(n,i){var r;return r=t._state.is_ascending[e]?1:-1,r*t._state.cmp[e](n,i,c)}}(this),s.sort(t),a=pe(".sf-list",e),a.empty(),u=0,r=0,o=s.length;o>r;r++)d=s[r],this._should_render(d)&&(u+=1,n=this._tmpl({options_str:At("Share",{comment:'As in "Share this folder"'}),remove_str:At("Remove my access"),add_str:At("Add",{comment:'As in "Add to Dropbox"'}),is_past:i,row_count:u,sf:d,Sprite:G,Emstring:l,Util:Rt,_:At}),a.append(n.toHTML()));return this._empty_check(e),u},_should_render:function(e){return null!=this.role_picker?this.role_picker.is_role_visible(e.role):!0},_empty_check:function(e){var t,n,i;return n=this._get_current_sf_list_info(e),t=n[0],i=n[1],pe(".sf-list",e).children().length?pe(e).removeClass("empty-list"):pe(e).addClass("empty-list")},_get_current_sf_list_info:function(e){switch(e){case"#sf-current":return[this._state.sf_info.current,!1];case"#sf-past":return[this._state.sf_info.past,!0];default:return bt(!1,"invalid sf list id")}},_name_cmp:function(e,t,n){return n?Rt.sort_by_key(e,t):Rt.sort_by_rank_or_key(e,t)},_modified_cmp:function(e,t,n){return e.modified_ts-t.modified_ts},include_fb:!1,use_fb_profile_pics:!0,show_invites:function(){var e,t,n;this._state.current_total_count=0,t=this._state.inbox_counts;for(n in t)e=t[n],this._state.current_total_count+=e;return this._state.current_total_count>0?zt.show_invites():void 0},_display_view:function(e){return function(){return pe("#sf-view").show()}}(this),_hide_view:function(e){return function(){return pe("#sf-view").hide()}}(this),_display_spinner:function(){return pe(".sf-spinner").show()},_hide_spinner:function(){return pe(".sf-spinner").hide()}};var xn;Autocompleter.Contacts=Class.create(Autocompleter.Base,{initialize:function(e,t,n,i){var r,o,s,a,_;return this.user=e,this.baseInitialize(t,n,i),this.options.array=!1,this.options.larray=!1,this.options.frequency=.1,this._num_contacts_shown=0,this._num_query_results=0,o=this.options.include_fb===!0,null==this.options.include_team&&(this.options.include_team=!0),_=this.options.include_team===!0,a=this.options.include_new_style_groups===!0,s=this.options.include_me===!0,this.profile_services=Ct.get_linked_profile_services_for_user(this.user.id,this.update_import_contacts_link),this.link_handler=new St,this._autocompleter_profile_services_item_tmpl=Ke.tmpl("autocompleter_item_tmpl"),this.listen(),this.possible_email_pattern=/[.@_-]/,r=function(e){return function(t){return t=e.options.include_from_linked_accounts&&e.options.viewer?t.includeForViewer(e.options.viewer):t.includeForUser(e.user.id),e.options.contact_filter?t=e.options.contact_filter(t):(o||(t=t.excludeFacebook()),a||(t=t.excludeNewStyleGroups()),_||(t=t.excludeTeamMembers()),s||(t=t.excludeMe())),e.setContacts(t)}}(this),function(){var e;return It.load_contacts(e=!1,function(e){return r(e),It.register_for_updates("autocompleter_contacts",r)})}.defer(),this.options.onShow=function(e,t){return t.style.position&&"absolute"!==t.style.position||(t.style.position="absolute",Oe.clone_position(pe(t),pe(e),{setHeight:!1,setTop:!1,setLeft:!1})),pe(t).fadeTo(150,1)}},link_callback:function(e){return St.show_import_notifications(e)},getToken:function(){var e;return e=this.getTokenBounds(),this.element.value.substring(e[0],e[1])},listen:function(){var e;return this.install_profile_services_link_listener(),e=function(e){return function(t){return e.profile_services.has_connected_services()||pe(e.element).val()?void 0:(e.activate(),setTimeout(function(){var t;return null!=(t=e.get_entry_container())?t.show():void 0},300),!0)}}(this),pe(this.element).click(e)},install_profile_services_link_listener:function(){var e;return Event.stopObserving(this.element,"blur"),e=function(e){return function(t){var n;return pe(t.target).closest("li").hasClass("profile-services-link-handler")?void 0:null!=(n=e.get_entry_container())?n.hide():void 0}}(this),pe(this.element).closest(".db-modal-box").click(e),pe(this.element).closest("#modal-box").click(e)},get_entry_container:function(){var e;return null!=(e=this.element.up(".tokenized_autocompleter_container"))?e.down(".autocomplete"):void 0},profile_services_show:function(){var e,t,n,i;return e=this.get_entry_container(),(null!=(t=e.firstChild)&&null!=(n=t.firstChild)?n.value:void 0)>0?this.old_display=e.style.display:(this.old_contents="<ul></ul>",this.old_display="none"),this.profile_services_render_buttons(),null!=(i=$("flash_copy_container"))&&i.hide(),this.element.focus()},profile_services_render_buttons:function(){var e;return e=this.get_profile_services_button_list(),this.hasFocus=!0,this.updateChoices("<ul>"+e.join("")+"</ul>")},get_profile_services_button_list:function(){var e,t,n,i,r,o;for(o=[],r=le.contact_services(),t=0,n=r.length;n>t;t++)i=r[t],bt(this.profile_services.is_updated,"profile_services has not been updated"),e="",this.profile_services.service_is_connected(i)?e=At("Connected"):this.profile_services.service_was_connected(i)&&(e=At("Reconnect")),o.push(this._autocompleter_profile_services_item_tmpl({email_provider_num:i,email_provider_img:le.to_img(i)[0],email_provider_name:le.to_name(i),bottom_text:e}).toHTML());return o},update_import_contacts_link:function(e){return function(t){return e.profile_services=t,e.profile_services.has_unconnected_services(!0)?pe(e.element).closest("form").find(".import-contacts-link").show():pe(e.element).closest("form").find(".import-contacts-link").hide()}}(this),hide_containing_modal:function(){return this.$hidden_modals=pe(".db-modal-wrapper:visible").first(),this.$hidden_modals.length?this.$hidden_modals.css("display","none"):(this.$hidden_modals=pe("#modal:visible, #modal-overlay:visible"),this.$hidden_modals.hide())},show_containing_modal:function(){return this.$hidden_modals.show(),this.$hidden_modals=null},setContacts:function(e){return this.options.array=e.contacts,this.options.larray=e.lcontacts,this.active||this.getToken()?this.getUpdatedChoices():void 0},loadContacts:function(){var e;return e=function(e){return function(t){var n,i,r,o;return n=e.options.include_fb===!0,null==e.options.include_team&&(e.options.include_team=!0),o=e.options.include_team===!0,r=e.options.include_new_style_groups===!0,i=e.options.include_me===!0,t=e.options.include_from_linked_accounts&&e.options.viewer?t.includeForViewer(e.options.viewer):t.includeForUser(e.user.id),e.options.contact_filter?t=e.options.contact_filter(t):(n||(t=t.excludeFacebook()),r||(t=t.excludeNewStyleGroups()),o||(t=t.excludeTeamMembers()),i||(t=t.excludeMe())),e.setContacts(t)}}(this),function(){var t;return Nt.load_contacts(t=!1,function(t){return e(t),Nt.register_for_updates("autocompleter_contacts",e)})}.defer()},getUpdatedChoices:function(){return this.updateChoices(this.options.selector())},selectEntry:function(){var e,t,n;return t=this.getCurrentEntry(),e=this.options.array[t.value],e.type===ae.FB||e.type===ae.NEW_STYLE_GROUP?t.innerHTML=e.name:t.innerHTML=e.email,n=this.options.tokens.length>1?this.options.tokens[0]+" ":"",t.innerHTML+=n,this.active=!1,this.updateElement(t),pe(this.element).trigger("db:autocompleted")}},xn=function(e,t){var n;return n=pe("<div>"),n.addClass(e),"string"==typeof t||t instanceof String?n.text(t):n.append(t),n},{getNumContactsShown:function(){return this._num_contacts_shown},getNumQueryResults:function(){return this._num_query_results},getContactInfoFromEmail:function(e){var t,n,i,r;for(r=this.options.array,n=0,i=r.length;i>n;n++)if(t=r[n],t.email===e)return{display_name:t.name,email:e,avatar_url:t.photo_url};return{display_name:"",email:e,avatar_url:null}},setOptions:function(e){var t;return null==e&&(e={}),t={choices:5,selector:function(e){return function(){var t,n,i,r,o,s,a,_,l,u,d,c,h,f,p,m,v,g,w,b,y,k,E,x,C,S,T,A,D,O,$,N,I,L,R,q,M,P,F,U,j,B,z,V,H,Y;for(j=[],d=e.getToken().toLowerCase(),k=e.options.array.length,o=e.options.array,O=e.options.larray,U=[],-1===d.indexOf(" ")&&U.push("\\s+"),-1===d.indexOf("+")&&U.push("\\+"),-1===d.indexOf("@")&&U.push("@"),-1===d.indexOf(".")&&U.push("\\."),-1===d.indexOf("&lt;")&&U.push("&lt;"),F=RegExp("("+U.join("|")+")"),v=0;d.length>0&&k>v;){switch(r=o[v],D=O[v],c=-1,u=[],N=[],m="",r.type){case ae.EMAIL:u.push(r.name,r.email_snippet),N.push(D.name,D.email),m="/static/images/icons/mail28-vflHfHPJ0.png";break;case ae.FB:u.push(r.name),N.push(D.name),m=En.use_fb_profile_pics?"https://graph.facebook.com/"+D.fb_id+"/picture":"/static/images/icons/fb24-vflGnjfAv.png";break;case ae.NEW_STYLE_GROUP:u.push(r.name,r.members),N.push(D.name,""),m="",null!=__CIRCULAR_DEPENDENCY__.GroupsListController&&(n=__CIRCULAR_DEPENDENCY__.GroupsListController.string_to_color(r.name),i=__CIRCULAR_DEPENDENCY__.GroupsListController.get_initials(r.name),h=pe("<span class='group-icon'>").css("border-color",n).css("color",n).text(i));break;default:bt(!1,"should never get here due to type: "+(r.type+", "+r.name+", "+r.email+", "+r))}for(b=f=0,C=N.length;C>f;b=++f){for($=N[b],R=U.length?$.split(F):[$],a=0,w=0,S=R.length;S>w;w++)if(L=R[w]){if(0===L.indexOf(d)){c=a;break}a+=L.length}if(-1!==c){P=(d.length/L.length*9.4).toFixed(0),null!=r.sort_key&&(P+=r.sort_key),E=document.createTextNode(u[b].substr(0,c)),I=pe("<strong>").text(u[b].substr(c,d.length)),z=document.createTextNode(u[b].substr(c+d.length)),u[b]=[E,I,z];break}}r.type===ae.FB&&u.push(At("Facebook message")),-1!==c&&(m?p=pe('<img width="28px" height="28px">').attr("src",m):h&&(p=h),q=xn("autocomplete-line",u[0]),Y=xn("autocomplete-line autocomplete-secondary",u[1]),x=xn("autocomplete-left",p),V=xn(null,[q,Y]),A=pe("<li>").attr("value",v).append(x,V),j.push([P,A])),v++}for(j.sort(function(e,t){return e[0]<t[0]?1:e[0]>t[0]?-1:0}),e._num_query_results=j.length,j=j.slice(0,e.options.choices),B=pe("<ul>"),y=0,T=j.length;T>y;y++)H=j[y],B.append(H[1]);return e._num_contacts_shown=j.length,pe(e.element).hasClass("no-profile-services-link-handler")||e.profile_services.has_unconnected_services(!0)&&(s=pe(e.element).closest(".tokenized_autocompleter_container"),M=s.attr("data-provider"),g=At(M===le.GOOGLE?"Select from your Gmail contacts":M===le.YAHOO?"Select from your Yahoo contacts":"Select from your contacts"),_=!1,M!==le.GOOGLE&&M!==le.YAHOO||e.profile_services.service_is_connected(M)?e.profile_services.has_connected_services()&&(_=!1,g=At("Import Contacts")):_=!0,_?(l=e._autocompleter_profile_services_item_tmpl({email_provider_num:M,email_provider_img:le.to_img(M)[0],email_provider_name:g,bottom_text:""}).toHTML(),B.append(l)):(p=G.make("web","user_add"),q=xn("autocomplete-line autocomplete-line-center",g),x=xn("autocomplete-left",p),V=xn(null,[q]),A=pe("<li>").addClass("profile-services-link-handler").append(x,V),B.append(A))),t=B.wrap("<span>").parent().html(),e.old_contents=t,t}}(this)},this.options=Object.extend(t,e)}});var Cn;Cn=Xe.Token=Class.create({initialize:function(e,t,n,i){return this.element=$(e),this.token_manager=n,this.hidden_input=t,this.element.token=this,this.selected=!1,this.info=i,pe(this.element).closest(".tokenized_autocompleter_container").click(this.onclick.bindAsEventListener(this))},select:function(){var e;return this.token_manager.token=this,null!=(e=this.hidden_input)&&e.element.activate(),this.selected=!0,this.element.addClassName("token_selected")},deselect:function(){return this.token_manager.token===this&&(this.token_manager.token=null),this.selected=!1,this.element.removeClassName("token_selected")},onclick:function(e){return e&&e.preventDefault&&e.preventDefault(),this.detect(e)&&!this.selected?this.select():this.deselect()},remove:function(e){return this.token_manager.remove(this)},detect:function(e){var t,n,i;for(n=e.target?e.target:e.srcElement,i=n.token,t=n;null==i&&t.parentNode;)t=t.parentNode,i=t.token;return null!=i&&i.element===this.element}});var Sn;Sn=Xe.TokenManager=Class.create({initialize:function(e,t,n,i){return this.contact_search_logger=i,this.shift_boundary_right_func=t,this.shift_boundary_left_func=n,this.element=e,this.tokens=[],this.token=null},add:function(e){return this.tokens.push(e),this.element.fire("token:add",e.info)},populate:function(){var e,t,n,i,r,o,s;for(s=this.element.select(".token"),i=[],t=0,n=s.length;n>t;t++)o=s[t],e=o.hasClassName("token-warn"),r=new Cn(o,null,this,{external:e}),i.push(this.add(r));return i},remove:function(e){var t;return null==e&&(e=this.token),null!=e?(this.contact_search_logger.flag_record_as_removed(e.info.value),t=this.tokens.indexOf(e),this.tokens.splice(t,1),e.element.remove(),this.token===e&&t<this.tokens.length?this.tokens[t].select():(this.token=null,null!=this.shift_boundary_right_func&&this.shift_boundary_right_func()),this.element.fire("token:remove",e.info)):void 0},removeAll:function(){var e,t,n,i,r;for(r=this.tokens.slice(0),this.tokens.clear(),n=[],e=0,t=r.length;t>e;e++)i=r[e],i.element.remove(),n.push(this.element.fire("token:remove",i.info));return n},shift_left:function(){var e;return e=this.token?this.tokens.indexOf(this.token):this.tokens.length,e>0?(this.token&&this.token.deselect(),this.tokens[e-1].select()):null!=this.shift_boundary_left_func?this.shift_boundary_left_func():void 0},shift_right:function(){var e;return e=this.tokens.indexOf(this.token),this.token&&this.token.deselect(),e+1<this.tokens.length?this.tokens[e+1].select():null!=this.shift_boundary_right_func?this.shift_boundary_right_func():void 0}});var Tn;Tn=Xe.HiddenInput=Class.create({initialize:function(e,t,n){return this.element=$(e),this.auto_complete_element=t,this.token_manager=n,Event.observe(this.element,"keydown",this.onKeyPress.bindAsEventListener(this))},onKeyPress:function(e){switch(e.keyCode){case Event.KEY_LEFT:e.preventDefault(),this.token_manager.shift_left();break;case Event.KEY_TAB:e.preventDefault(),this.token_manager.shift_right();break;case Event.KEY_RIGHT:e.preventDefault(),this.token_manager.shift_right();break;case Event.KEY_BACKSPACE:case Event.KEY_DELETE:this.token_manager.remove()}return!1}});var An=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};Autocompleter.ContactsTokenizer=Class.create(Autocompleter.Contacts,{initialize:function($super,e,t,n,i,r){var o;return this.user=e,$super(this.user,t,n,r),this.contact_search_logger=new ze.ContactSearchLogger,this.token_manager=new Sn(this.element,this.generate_shift_boundary_right_func(),null,this.contact_search_logger),this.hidden_input=new Tn(i,this.element,this.token_manager),this.textbox_height=0,this.element.hacks||(this.element.should_use_borderless_hack=Prototype.Browser.WebKit,this.element.should_use_shadow_hack=Prototype.Browser.IE||Prototype.Browser.Opera,this.element.hacks=!0),(this.element.should_use_borderless_hack||this.element.should_use_shadow_hack)&&pe(this.element).parent().addClass("tokenizer_input_borderless"),this.options.onShow=function(e,t){return Oe.clone_position(pe(t),pe(e.parentNode.parentNode),{setHeight:!1,setTop:!1,setLeft:!1}),t.show()},this.options.onHide=function(e,t){return t.hide()},this.max_textbox_height=270,null!=r.max_textbox_height&&(this.max_textbox_height=r.max_textbox_height),this.members=[],null!=r.members&&(this.members=r.members),this.invitees=[],null!=r.invitees&&(this.invitees=r.invitees),this.new_style_groups=[],null!=r.new_style_groups&&(this.new_style_groups=r.new_style_groups),this.contacts_only=!1,null!=r.contacts_only&&(this.contacts_only=r.contacts_only),o=-1!==p.get_url().indexOf("/referrals")?pe("#retrieve-contacts-button"):pe(this.element).closest("form").find(".tokenizer-submit-button")[0],pe(o).on("mousedown",this.beforeSubmit.bindAsEventListener(this)),pe(this.element).on("focus",this.onFocus.bindAsEventListener(this)),this.import_links=[],r.hide_import_contacts||(this.import_links=pe(".import-contacts-link")),this.calculate_input_size(),this.dynamically_resize_input(),this.check_populated(),setInterval(this.check_populated.bind(this),100)},onClick:function(e){var t,n;return t=e.findElement("li"),this.index=t.autocompleteIndex,n=this.selectEntry(),n?void 0:this.hide()},onBlur:function($super,e){return $(this.element.parentNode).removeClassName("focused"),this.element.up(".tokenizer").removeClassName("focused"),$super(e)},onFocus:function(e){return $(this.element.parentNode).addClassName("focused"),this.element.up(".tokenizer").addClassName("focused")},beforeSubmit:function(e){return this.tokenize_emails_input(!0)},clearTokens:function(e){return this.token_manager.removeAll(),this.calculate_input_size(),this.dynamically_resize_input()},getTokenCount:function(){return this.token_manager.tokens.length},getEmails:function(){var e,t;return e=pe(this.element).closest(".tokenized_autocompleter_container").find(".token-valid").find('[name="emails"]'),function(){var n,i,r;for(r=[],n=0,i=e.length;i>n;n++)t=e[n],r.push(pe(t).val());return r}().join(", ")},check_populated:function(){var e,t;return e=$(this.element.parentNode),t=""===this.element.value&&0===this.token_manager.tokens.length,e.hasClassName("populated")&&t?e.removeClassName("populated"):e.hasClassName("populated")||t?void 0:e.addClassName("populated")},clean_email_addr:function(e,t){var n,i,r;for(i=0,r=e.length;r>i;i++)n=e[i],t=t.sub(n,"");return t.trim()},get_regexp_from_delimiters:function(e){var t,n,i,r;for(n="",i=0,r=e.length;r>i;i++)t=e[i],n+=t+"|";return new RegExp("["+n+"\\r\\n|\\r|\\n|\\t]+")},createTokenInfo:function(e,t,n){var i,r;return r=!0,i=t,n===ae.FB&&(i=e),n!==ae.EMAIL||Rt.validate_email(t)?An.call(this.members,t)>=0?(r=!1,i=At("Already member")):An.call(this.invitees,t)>=0?(r=!1,i=At("Already invited")):n===ae.NEW_STYLE_GROUP&&(An.call(this.new_style_groups,t)>=0?(r=!1,i=At("Already member group")):(r=!0,i=At("Group"))):r=!1,t!==this.user.email&&t!==this.user.id||(i=At("You"),r=!this.contacts_only),!e&&t&&(e=t.toString()),{display:e,value:t,type:n,valid:r,bubble_title:i}},COMPOUND_EMAIL_REGEX:/([^<>]+)<([^@>]+@[^@>]+)>/,parse_compound_email:function(e){var t,n;return t=e.match(this.COMPOUND_EMAIL_REGEX),t?n=this.createTokenInfo(t[0],t[2],ae.EMAIL):null},tokenize_emails_input:function(e,t){var n,i,r,o,s,a,_,l,u,d,c,h,f,p,m,v,g,w,b;if(i=this.options.tokens,v=this.get_regexp_from_delimiters(i),o=this.options.single_token?[this.element.value]:this.element.value.split(v),w="",e||(w=o[o.length-1],m=this.clean_email_addr(i,w),o=o.slice(0,o.length-1)," "!==(p=w[w.length-1])&&">"!==p||(m.match(this.COMPOUND_EMAIL_REGEX)||Rt.validate_email(m))&&(o.push(m),w="")),n=!1,b=[],o.length>0)for(a=0,u=o.length;u>a;a++)r=o[a],g=this.parse_compound_email(r),(null!=g?g.valid:void 0)?(n=!0,this.set_input_size(1),this.addContact(g)&&(h={sort_variant:null,context:"legacy_tokenizer",contact_type:ae.EMAIL,contact_id:g.value,contact_name:g.display,did_select_suggestion:!1},this.contact_search_logger.add_record(h))):b.push(r);if(o=b,!this.options.single_token){for(f=[],_=0,d=o.length;d>_;_++)r=o[_],f.push.apply(f,r.split(" "));o=f}if(o.length>0)for(l=0,c=o.length;c>l;l++)if(r=o[l],r=this.clean_email_addr(i,r)){if(g=this.createTokenInfo(r,r,ae.EMAIL),g.valid)n=!0;else if(t)continue;this.set_input_size(1),this.addContact(g)&&(h={sort_variant:null,context:"legacy_tokenizer",contact_type:ae.EMAIL,contact_id:r,did_select_suggestion:!1},this.contact_search_logger.add_record(h))}return this.element.value!==w&&(this.element.value=w),s=this.element.up("form"),n&&Hn.clear_errors(s),this.dynamically_resize_input()},generate_shift_boundary_right_func:function(){var e,t;return e=this.element,t=function(){return e.focus()}},set_input_size:function(e){return(null==e||0>e)&&(e=20),this.element.setStyle({width:e+"px"})},calculate_input_size:function(){return this.import_links.length?(this.import_links_width=this.import_links.width(),this.import_links_visible=this.import_links.is(":visible")):void 0},dynamically_resize_input:function(){var e,t,n,i,r,o,s,a,_,l,u,d,c,h,f,p,m,v,g,w;for(f=$(this.element.parentNode.parentNode),m=parseInt(f.getStyle("width"),10)-15,p=parseInt(f.getStyle("height"),10),p!==this.textbox_height&&(this.textbox_height=p,p>=this.max_textbox_height?f.setStyle({"overflow-y":"auto"}):f.setStyle({"overflow-y":"hidden"})),s=m,e=pe(".tokenizer-link",f.parentNode),e.length>0&&(s-=e.width()),g=this.token_manager.tokens,l=!1,w=0,r=0,a=g.length;a>r;r++)v=g[r],i=v.element,n=parseInt(i.getStyle("width"),10)+parseInt(i.getStyle("margin-right"),10),d=w+n,d>m?(w=n,l=!0):n>m?(w=0,l=!0):w=d;if(u=s-w,t=7*this.element.value.length,t>u&&(u=m),this.set_input_size(u),this.import_links.length&&this.import_links_visible&&(l||m-w-t<1.25*this.import_links_width)){for(this.import_links_visible=!1,c=this.import_links,h=[],o=0,_=c.length;_>o;o++)i=c[o],h.push(pe(i).fadeOut(100));return h}},onKeyPress:function(e){var t,n;if(this.dynamically_resize_input(),this.active)switch(e.keyCode){case 44:case 188:case 59:case 186:return e.shiftKey||(this.has_selected_profile_services_entry()||this.has_selected_profile_services())&&this.tokenize_emails_input(!0),void this.reset_observer();case Event.KEY_TAB:case Event.KEY_RETURN:return this.has_selected_profile_services_entry()||this.has_selected_profile_services()?(this.tokenize_emails_input(!0),this.hide(),void Event.stop(e)):(this.selectEntry(),this.hide(),this.active=!1,void Event.stop(e));case Event.KEY_ESC:return this.hide(),this.active=!1,void Event.stop(e);case Event.KEY_LEFT:case Event.KEY_RIGHT:return;case Event.KEY_UP:return this.markPrevious(),this.render(),void Event.stop(e);case Event.KEY_DOWN:return this.markNext(),this.render(),void Event.stop(e)}else{if(this.tokenize_emails_input(!1),e.keyCode===Event.KEY_TAB||e.keyCode===Event.KEY_RETURN)return this.element.value&&e.preventDefault&&e.preventDefault(),void this.tokenize_emails_input(!0);if(""===this.element.value)(t=e.keyCode)!==Event.KEY_LEFT&&t!==Event.KEY_BACKSPACE||this.token_manager.shift_left();else if((n=e.keyCode)===Event.KEY_LEFT||n===Event.KEY_RIGHT||n===Event.KEY_UP||n===Event.KEY_DOWN)return}return this.update_typeahead(),this.reset_observer()},update_typeahead:function(){return this.changed=!0,this.hasFocus=!0},reset_observer:function(){return this.observer&&clearTimeout(this.observer),this.observer=setTimeout(this.onObserverEvent.bind(this),1e3*this.options.frequency)},onObserverEvent:function($super){var e,t,n,i,r,o;if(this.active){for(o=this.element.value,r=this.options.tokens,n=0,i=r.length;i>n;n++)if(e=r[n],t=o.indexOf(e),-1!==t){if(this.has_selected_profile_services_entry())return this.tokenize_emails_input(!0),void this.hide();this.element.value=o.substr(0,t),this.selectEntry(),this.hide(),this.active=!1,this.element.value=o.substr(t+1);break}this.update_typeahead()}return this.tokenize_emails_input(!1),$super()},has_selected_profile_services:function(e){return null==e&&(e=this.getCurrentEntry()),pe(e).hasClass("profile-services-link-handler")},has_selected_profile_services_entry:function(e){var t;return null==e&&(e=this.getCurrentEntry()),0===e.value&&0!==(null!=(t=e.id)?t.length:void 0)},selectEntry:function(){var e,t,n,i,r,o,s,a,_;return t=this.getCurrentEntry(),this.has_selected_profile_services(t)?(ze.SharedFolderActivityLogger.log("web","import_contacts_button_clicked",this.user),this.profile_services_show(),!0):this.has_selected_profile_services_entry(t)?(o="suggestion",n=t.id.split("_")[0],bt(An.call(le.contact_services(),n)>=0,"The 'id-value' of an autocompleter-entry is not a valid Third Party contact import service"),a=le.to_name(n),this.profile_services.service_is_connected(n)?void b.success(At("You're already connected to %(service_name)s").format({service_name:a})):An.call(le.contact_services(),n)>=0?this.link_handler.auth_service_with_user(n,this.user.id,function(e){return function(t){return e.link_callback(t)}}(this),o):bt(!1,"Should never get here. entry_value: "+n)):(e=this.options.array[t.value],i=e.type===ae.FB?e.fb_id:e.type===ae.NEW_STYLE_GROUP?e.group_id:e.email,this.set_input_size(1),s=this.element.value,_=this.createTokenInfo(e.name.trim(),i,e.type),this.addContact(_)&&(r={sort_variant:null,context:"legacy_tokenizer",search_expr:s,selected_pos:this.index,num_query_results:this.getNumQueryResults(),contact_type:e.type,contact_id:i,contact_name:e.name.trim(),did_select_suggestion:!0},this.contact_search_logger.add_record(r)),Hn.clear_errors(this.element.up("form")),this.dynamically_resize_input(),this.index=0,this.element.focus())},addContact:function(e){var t,n,i,r,o,s,a,_,l,u,d,c,h,f,p,m,v,g,w;for(w=this.token_manager.tokens,i=0,_=w.length;_>i;i++)if(c=w[i],e.value===c.info.value)return!1;switch(this.element.value="",e.type){case ae.FB:s="fb_ids",r=new Element("img",{src:"/static/images/icons/fb_16-vflbiYTkC.png"});break;case ae.EMAIL:s="emails",r=new Element("img",{src:"/static/images/icons/email_16-vflcFyDTl.png"});break;case ae.NEW_STYLE_GROUP:s="new_style_group_ids",r=new Element("img",{src:"/static/images/icons/icon_spacer-vflN3BYt2.gif",class:"sprite sprite_groups s_groups_group"});break;case ae.INVALID:s="invalids",r=new Element("span",{class:"hidden"});break;default:bt(!1,"should never get here due to type: "+e.type)}for(h=this.getTokenClass(e),g=pe("<span class='x'>").addClass(h),g.on("click",function(e){return this.parentNode.parentNode.parentNode.parentNode.parentNode.token.remove(e),!1}),p=new Element("input",{type:"hidden",name:s,value:e.value.toString()}),c=new Element("a",{class:"title_bubble token "+h,href:"#",tabindex:"-1",title:e.bubble_title}),o=new Element("span"),this.options.wrap_name?(m=new Element("div",{class:"token-display-text"}),m.__sert(e.display),f=m,t=1):(f=e.display,t=0),u=[p,r,f],a=0,l=u.length;l>a;a++)n=u[a],o.__sert(n);return pe(o).append(g),c.__date(new Element("span").__date(new Element("span").__date(new Element("span").__date(o)))),null!=(d=$(c).down(5).next(t))&&(d.innerHTML="&nbsp;"),v=new Cn(c,this.hidden_input,this.token_manager,e),this.token_manager.add(v),this.element.up().__sert({before:c}),!0},getTokenClass:function(e){return e.valid?"token-valid":"token-error"},isTeamOnly:function(){return!1}});var An=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};Autocompleter.TeamTokenizer=Class.create(Autocompleter.ContactsTokenizer,{initialize:function($super,e,t,n,i,r){return $super(e,t,n,i,r),this.warn_only=!r.team_only,this.element.observe("token:remove",this.notifyExternal.bind(this)),this.element.observe("token:add",this.notifyExternal.bind(this)),this.team_contacts={},this.suspended_contacts={},this.pending_contacts={},this.reloadContacts(!0)},isTeamOnly:function(){return!this.warn_only},setTeamOnly:function(e){return this.warn_only=!e,this.reloadContacts()},reloadContacts:function(e){return null==e&&(e=!1),It.load_contacts(e=e,function(e){return function(t){return e.setContacts(t)}}(this))},setContacts:function($super,e){var t,n,i,r;for(this.team_contacts={},this.team_contacts[H.get_viewer().work_email]=1,pe(this.element).hasClass("team-admin")||(e=e.excludeSuspended()),e=e.sortByTeamFirst(),r=e.contacts,n=0,i=r.length;i>n;n++)t=r[n],t.team&&"active"===t.join_state&&(this.team_contacts[t.email]=1),t.team&&"suspended"===t.join_state&&(this.suspended_contacts[t.email]=1),t.team&&"pending"===t.join_state&&(this.pending_contacts[t.email]=1);return $super(this.options.contact_filter?this.options.contact_filter(e):e)},createTokenInfo:function(e,t,n){var i,r,o,s,a;return a=!0,r=!1,i=t,s=!1,n===ae.FB&&(i=e),n!==ae.EMAIL||Rt.validate_email(t)?An.call(this.members,t)>=0?(a=!1,i=At("Already member")):An.call(this.invitees,t)>=0?(a=!1,i=At("Already invited")):n!==ae.EMAIL||this.team_contacts[t]||this.pending_contacts[t]?n===ae.FB?(a=this.warn_only,r=!0):n===ae.NEW_STYLE_GROUP&&(An.call(this.new_style_groups,t)>=0?(a=!1,i=At("Already member group")):(a=!0,i=At("Group"))):(a=this.warn_only,r=!0):a=!1,t!==this.user.email&&t!==this.user.id||(i=At("You"),a=!this.contacts_only),this.suspended_contacts[t]&&(i=At("Suspended user"),s=!0),!e&&t&&(e=t.toString()),o={display:e,value:t,type:n,valid:a,external:r,bubble_title:i,suspended:s}},getTokenClass:function(e){return e.valid?e.suspended?"token-warn token-suspended":e.external?"token-warn":"token-valid":"token-error"},notifyExternal:function(e){var t,n,i;return i=e.memo,i.external?(n=this.token_manager.tokens.filter(function(e){return e.info.external}),t=n?n.length:0,this.element.fire("sf:token:external",{count:t})):void 0}});var Dn;Dn=Xe.TeamSharedFolderInviteController=function(){function e(e){var t;this.element=$(e[0]),t=this.element.down(".new-collab-input"),t.observe("sf:token:external",this.handle_external.bind(this))}return e.prototype.handle_external=function(e){var t,n;return t=e.memo.count,n=this.element.down(".external-invite-message"),t>1?(Mt.fillVal(t,"external-invite-num"),null!=n&&n.removeClassName("single"),null!=n?n.show():void 0):1===t?(null!=n&&n.addClassName("single"),null!=n?n.show():void 0):null!=n?n.hide():void 0},e}();var On;On=INLINE_JS.SharingModel=Xe.SharingModel={ALBUM_THUMB_SIZE:260,ALBUM_PADDING:40,THUMBS_BATCH_SIZE:12,filename:null,c2d_vars:{},is_folder:!1,is_album:!1,gallery_enabled:!1,gallery_showing:!1,file_viewer_files:[],send_link_autocompleter:null,team_only_shmodel:!1,owner_name:null,sync_vars:{},init:function(e,t){return this.filename=e,this.c2d_url=null!=t?t:"/sm/c2d",this.init_logger(),pe(".nav-close").on("click",this.close_embedded_fileviewer.bind(this)),pe(function(e){return function(){var t,n,i;return n=$("login-create-an-account"),n&&n.writeAttribute("href","/register?signup_tag=shmodel"),scrollTo(1,0),scrollTo(0,0),pe("#download_button_link[data-dl-link]").on("click",e.download_zip),e.set_viewport_size(),t=function(t,n){return e.do_c2d(n.id)},pe("#c2d-modal .login-form").on("db:login:success",t),pe("#c2d-modal .register-form").on("db:register:success",t),i=s.parse(window.location.href),i.getQuery().force_dl?(i.updateQuery({force_dl:0,dl:1}),se.get({url:i.toString(),expected_domain:he.PUBSERVER})):void 0}}(this))},init_folder:function(e,t,n,i,r,o,s,_,l,u,d,c){return this.c2d_vars=e,this.sync_vars=t,null==_&&(_=!1),this.shared_link_infos=null!=l?l:null,this.share_tokens=null!=u?u:null,this.share_permissions=null!=d?d:null,this.use_react=null!=c?c:!1,this.is_folder=!0,this.gallery_enabled=n,this.gallery_showing=i,this.file_viewer_files=r,this.file_view_target=o,this.file_view_target===K.FileViewTargetType.SHARED_CONTENT_LINK?this.file_view_origin=K.FileViewOriginType.SHARED_CONTENT_LINK_PAGE:this.file_view_origin=K.FileViewOriginType.SHARED_LINK_PAGE,pe(function(e){return function(){return e._open_file_viewer(s),e.load_thumbs(),pe("#gallery-toggle").click(function(){return e.switch_mode("gallery")}),pe("#list-toggle").click(function(){return e.switch_mode("list")}),pe(".file-link").click(function(t){return e._open_file_viewer(pe(t.currentTarget).data("mediaIndex"))})}}(this)),pe(document).on(a.FILE_ACTIVITY_UPDATE,function(e,t,n){return pe("[data-file-activity-key='"+n.activity_key+"']").find(".comment-count-bubble-wrapper").each(function(){var e;return null!=(e=this.reactComponent)?e.setProps({unresolvedCommentCount:n.unresolvedCommentCount(),unseenCommentCount:n.unseenCommentCount()}):void 0})}),_&&(p.remove_query_param("from_sync_modal"),Ce.showZendeskFlyoutIfAllowed("tiburon_receive",At("You just received a folder with Dropbox"))),o===K.FileViewTargetType.SHARED_CONTENT_LINK?this._log_scl_ttv():void 0;
},_open_file_viewer:function(e){var t,n;if(v.isNumber(e)&&!(0>e))return this.use_react?(t=H.get_viewer().get_users()[0],n="react-file-viewer",ce.open(this.file_viewer_files,e,t,n,{fileViewTarget:this.file_view_target,fileViewOrigin:this.file_view_origin,fileViewAction:K.FileViewActionType.CLICK,sharedLinkInfos:this.shared_link_infos,shareTokens:this.share_tokens,sharePermissions:this.share_permissions})):(t=H.get_viewer().get_users().length>0?H.get_viewer().get_users()[0]:{},jr.show(this.file_viewer_files[e],t,{files:this.file_viewer_files,file_view_target:this.file_view_target}),jr.set_preview_url()),!1},init_album:function(){return this.is_album=!0,this._resize_album_view(),Event.observe(window,"resize",this._resize_album_view.bind(this))},init_file:function(e,t,n){return this.c2d_vars=t,null==n&&(n=!1),this.is_folder=!1,n||this.c2d_vars.subpath||this.c2d_vars.is_package?void 0:this.c2d_vars.subpath="/"+e},init_logger:function(){return pe(function(e){return function(){var e;return e=pe("#login-hover-link")[0],e&&(e.observe("click",function(){return Pr.log(Pr.CLICK_SIGN_IN)}),e.observe("click",function(){return Mr.log("click_sign_in")})),$("download_button_link")&&Pr.attachLogListener(Pr.CLICK_DOWNLOAD,$("download_button_link")),e=$("add_to_my_dropbox_link"),e&&(Pr.attachLogListener(Pr.CLICK_ADD_TO_MY_DROPBOX,e),Mr.attachLogListener("click_add_to_my_dropbox",e)),$$(".remove-link").length&&Pr.attachLogListener(Pr.REMOVE_LINK,$$(".remove-link")[0]),$$(".shmodel-filename").length&&Pr.attachLogListener(Pr.CLICK_FILENAME,$$(".shmodel-filename")[0]),e=$("default_content_download_button"),e&&Pr.attachLogListener(Pr.CLICK_DOWNLOAD,e),e=$("default_content_a2md"),e&&Pr.attachLogListener(Pr.CLICK_ADD_TO_MY_DROPBOX,e),e=pe("#login-create-an-account")[0],Pr.attachLogListener(Pr.CLICK_SIGNUP_THRU_DEFAULT_DROPDOWN,e),e=pe("#login-hover-cont .login-form")[0],Pr.attachLogListener(Pr.LOGIN_THRU_DEFAULT_DROPDOWN,e),pe("#share-button").click(function(e){return Pr.log(Pr.CLICK_SHARE)})}}(this))},_log_scl_ttv:function(){var e,t,n,i,r,o;return e=(new Date).getTime(),r=$e.start_time(),t={ns_id:null!=(i=this.sync_vars)?i.sf_id:void 0,timing:e-r},o=H.get_viewer().get_users()[0].id,n="PREVIEW_PAGE",ze.ShareTibEventLogger.log(o,"PREVIEW_RENDER",n,t)},set_team_only_shmodel:function(e,t){return this.team_only_shmodel=e,this.owner_name=t},_resize_album_view:function(){var e;return e=Math.floor((Oe.viewport_dimensions().width-2*this.ALBUM_PADDING)/this.ALBUM_THUMB_SIZE)*this.ALBUM_THUMB_SIZE,$("content-wrapper").setStyle({display:"block",width:e+"px"})},load_thumbs:function(){var e,t,n;return n=this.gallery_showing?$$(".gallery-icon-view img"):$$(".browse-files .icon"),t=function(e){return e.src.endsWith(G.SPACER)||e.addClassName("thumbnail"),$e.mark_time_to_view(),$e.mark_time_to_interactive()},e=Ve.batch_load_thumbs(n,this.THUMBS_BATCH_SIZE,t),0===e?$e.mark_time_to_interactive():void 0},switch_mode:function(e){var t,n,i,r,o,s,a;for(a=$A(["gallery","list"]),i=0,r=a.length;r>i;i++)s=a[i],n=$(s+"-view-container"),t=$(s+"-toggle"),e===s?(n.show(),t.addClassName("selected")):(n.hide(),t.removeClassName("selected"));return history.replaceState&&(o=window.location.pathname,"list"===e&&(o+="?lst"),history.replaceState({},"",o)),this.gallery_showing=!this.gallery_showing,this.load_thumbs()},set_viewport_size:function(){var e;return $(document.body).hasClassName("mobile")?(e=new Element("meta",{name:"viewport",content:"width = 480"}),document.head.appendChild(e)):void 0},toggle_dropdown:function(e,t,n){var i,r;return e&&Event.extend(e).preventDefault(),t.visible()?void 0:this.is_album?Gn.show(t,n,null,!0):(r=$$(".nav-header").first().getHeight(),i=$$(".nav-header .buttons").first().cumulativeOffset().top-4,0>i&&Rt.ie8&&(i=4),Gn.show(t,n,r-i,!0))},prepare_confirm_remove_modal:function(e,t,n,i,r,o,s,a){var _,u,d;return n?(d=At(i?"Unshare?":"Unshare album?"),_=pe("#album-disable-token-modal")[0],Mt.fillVal(e.escapeHTML(),"album_unshare_name")):(o?(d=At("Remove link created by %(name)s").format({name:s}),u=At("You are removing the link to “%(fname)s” created by <b>%(owner)s</b>.  This link will no longer work for anyone who has it.<br/><br/>We'll notify <b>%(owner_email)s</b>.  Do you want to continue?"),u=u.format({fname:l.em_snippet(e,17),owner:s,owner_email:a})):(d=At("Delete link to “%(name)s”?").format({name:l.em_snippet(e,17)}),u=At("This link will no longer work for anyone who has it.")),_=pe("#disable-token-modal")[0],Mt.fillVal(u,"disable-token-desc")),{title:d,contents:_}},confirm_remove:function(e,t,n,i,r,o,s,a,_,l){var u;return null==n&&(n=!1),null==i&&(i=!1),null==r&&(r=!1),null==o&&(o=null),null==s&&(s=!1),null==a&&(a=null),null==_&&(_=null),null==l&&(l=null),bt(t,"confirm_remove missing tkey"),bt(e,"confirm_remove missing name"),bt(o,"confirm_remove missing user_id"),bt(!s||!i,"admin removal of collections not supported"),bt(!s||a,"missing link owner name for admin removal"),bt(!s||_,"missing link owner email for admin removal"),H.get_viewer().is_uid_signed_in(o)?(u=On.prepare_confirm_remove_modal(e,n,i,r,o,s,a,_),Xn.show(u.title,u.contents,{token:t,name:e,is_album:i,user_id:o,success_callback:l})):void te.show_modal({user_id:o,on_success:function(l){return function(){return l.confirm_remove(e,t,n,i,r,o,s,a,_)}}(this)})},confirm_remove_from_event_gid:function(e,t,n,i,r,o,s,a){var _;return null==r&&(r=!1),null==o&&(o=null),null==s&&(s=null),null==a&&(a=null),bt(t,"confirm_remove missing event gid"),bt(e,"confirm_remove missing name"),bt(i,"confirm_remove missing user_id"),bt(H.get_viewer().is_uid_signed_in(i),"user not logged in"),bt(!r||o,"missing link owner name for admin removal"),bt(!r||s,"missing link owner email for admin removal"),_=On.prepare_confirm_remove_modal(e,n,!1,!1,i,r,o,s),Xn.show(_.title,_.contents,{name:e,user_id:i,activity_log_event_gid_dbase64:t,redirect_to_member_id:a})},do_remove:function(e){var t,n,i;return bt(e.token||e.activity_log_event_gid_dbase64,"missing token or event gid_dbase64"),t=pe("#modal-content input").first(),t.attr("disabled",!0),pe("#modal-content").addClass("ajax-loading"),i=window.location.pathname,"/links"===i||"/links/your_links"===i||"/recents"===i||i.match("^/home|^/work|^/personal")?new Ajax.DBRequest("/sm/disable/"+e.token,{subject_user:e.user_id,onSuccess:function(t){return function(){var t;return Xn.hide(),"function"==typeof e.success_callback&&e.success_callback(),t=At(e.is_album?"Unshared '%(name)s'":"Deleted link to “%(name)s”"),t=t.format({name:e.name}),b.success(t),document.fire(a.LINKS_REMOVE,{token:e.token})}}(this),onComplete:function(e){return function(){return t.attr("disabled",!1),pe("#modal-content").removeClass("ajax-loading")}}(this)}):(e.token?n=s({path:"/sm/disable/"+e.token}):(n=s({path:"/sm/disable_by_event_gid/"+e.activity_log_event_gid_dbase64}),n.updateQuery("redirect_to_member_id",e.redirect_to_member_id).toString()),Hn.postRequest(n.updateQuery(A.UID_PARAM_NAME,e.user_id).toString()))},show_shmodal_onload:function(e,t,n,i){return null==i&&(i=null),pe(function(r){return function(){return p.remove_query_param("m"),H.get_viewer().is_uid_signed_in(i)?null!=i&&it.get_for_user(H.get_viewer().get_user_by_id(i)).verified_or_show()?r.show_shmodal(e,t,n,i):null==i?(bt(H.get_viewer().is_paired,"Expected viewer to be paired."),r.show_share_shmodel_role_chooser(e,t,n)):void 0:void te.show_modal({user_id:i,on_success:function(){return r.show_shmodal_onload(e,t,n,i)}})}}(this))},show_shmodal:function(e,t,n,i){var r,o,s,a,_,l,u,d,c,h;if(this.url=e,this.short_url=t,!H.get_viewer().is_uid_signed_in(i))return void te.show_modal({user_id:i,on_success:function(e){return function(){return e.show_shmodal(e.url,e.short_url,n,i)}}(this)});if(h=H.get_viewer().get_user_by_id(i),it.get_for_user(h).verified_or_show()){if(d="shmodal-user-"+i,Xn.show(this._get_shmodal_title(h.is_team),Mt.fromElm($(d))),_={},_[A.UID_PARAM_NAME]=i,Hn.add_vars("shmodal-send-form",_),this._get_thumbnail_type())for(c=$$(".shmodal-image"),l=0,u=c.length;u>l;l++)a=c[l],a.addClassName("thumbnail");return s="contacts"===n?Autocompleter.ContactsTokenizer:Autocompleter.TeamTokenizer,this.send_link_autocompleter=new s(h,d+"-new-collab-input",d+"-new-whobulk",d+"-hidden-input",{tokens:[",",";"],include_fb:!0,include_team:!0,team_only:"team_only"===n,user_id:i}),this.configure_dropdown(),this.disabled||(ue.installed?(r=Le.clipboard_overlay(this.url,pe("#"+d+"-copy-link"),On.copied_to_clipboard),r.css({position:"fixed",zIndex:1001}),r.children().height(r.height()),clearInterval(this.follow_freshbutton),o=function(e){return function(){return Oe.clone_position(r,pe("#"+d+"-copy-link"),{offsetHeight:6,offsetWidth:6})}}(this),this.follow_freshbutton=setInterval(o,500)):$(d+"-copy-link").hide()),Qn._create($("modal").down(".custom-message-container")),Qn._create($("modal").down(".fb-post-sickinput")),Qn._create($("modal").down(".twitter-post-sickinput")),this._populate_twitter_info(this.short_url,i),$(d+"-new-collab-input").focus(),Pr.log("shmodal_show")}},configure_dropdown:function(){var e,t,n,i,r;for(i=$$(".dropdown-menu-container"),t=0,n=i.length;n>t;t++)e=i[t],r=e.down(".dropdown-menu-trigger"),null!=r&&r.observe("click",function(e){return function(e){var t;return t=e.target.up(".dropdown-menu-container"),t.toggleClassName("dropdown-shown")}}(this));return document.on("click",function(e){return function(e){var t,n,i,r,o;if(!e.target.hasClassName("dropdown-menu-trigger")&&!e.target.up(".dropdown-menu-trigger")){for(r=$$(".dropdown-shown"),o=[],n=0,i=r.length;i>n;n++)t=r[n],o.push(t.removeClassName("dropdown-shown"));return o}}}(this))},copied_to_clipboard:function(){return b.success(At("Link copied to clipboard")),Xn.hide(),Pr.log("shmodal_copy_link"),ze.ViralLogger.log(H.get_viewer().get_user_ids(),"shmodel","send",{src:"shmodel_copy_link",file_type:On.is_album?"collection":On.is_folder?"folder":-1===On.filename.indexOf(".")?"file":er.EXTENSION_TO_CATEGORY[We.file_extension(On.filename).toLowerCase()]||"file"})},get_shmodel_send_recipients:function(e){var t,n,i,r,o,s,a,_,l,u,d,c,h;for(bt(e,"Must pass the shmodal send form into get_shmodel_send_recipients"),t=e.select('input[name="emails"]'),n=e.select('input[name="fb_ids"]'),i=e.select('input[name="group_ids"]'),u=e.select('input[name="new_style_group_ids"]'),c=[],h=[t,n,i,u],r=0,_=h.length;_>r;r++)for(s=h[r],a=0,l=s.length;l>a;a++)o=s[a],d=o.up().innerHTML.stripTags().escapeHTML(),c.push(d.substring(0,d.indexOf("&")));return c},close_embedded_fileviewer:function(e){var t;return e.preventDefault(),t=new Be,t.configureParentMessaging(function(){},["parent-ready"]),t.startListening(),t.postMessageToParent("close-fileviewer")},send_shmodel_link:function(e){var t,n,i,r;return t=$("shmodal-send-form"),bt(t,"Couldn't find the shmodal send form."),r=this.get_shmodel_send_recipients(t),i=function(e){return function(e){var t;return t=Bt.success_string_for_recipients(r),b.success(t),Xn.hide(),Pr.log("shmodal_send")}}(this),n=function(e){return function(e){return Hn.remove_loading()}}(this),Hn.ajax_submit(t,"/sm/share",i,n,t.down(".tokenizer-submit-button"))},show_content:function(e){var t,n,i,r;for($("shmodal-title-text").__date($n.to_title_str(e)),i=$n.list,t=0,n=i.length;n>t;t++)r=i[t],r!==e&&($($n.to_toggle_str(r)).removeClassName("toggled"),$($n.to_content_str(r)).hide());return $($n.to_content_str(e)).show(),$($n.to_toggle_str(e)).addClassName("toggled"),pe("#modal .focusarea").focus()},show_send_content:function(){return this.show_content($n.SEND)},show_fb_content:function(){return this.show_content($n.FB)},show_twitter_content:function(){return this.show_content($n.TWITTER)},start_fb_post:function(e,t){var n,i,r,o;return i=function(n){return function(){return U.do_auth(n.do_fb_post.curry(e,t),t)}}(this),n=pe("#modal:visible, #modal-overlay:visible"),r=function(){return n.show()},U.authed_user_id===t?this.do_fb_post(e,t):H.get_viewer().is_uid_associated(U.authed_user_id)?(n.hide(),o=new F(H.get_viewer().get_user_by_id(t),r,i.bind(this)),o.show()):i()},start_twitter_post:function(e){return Dr.is_authed(e)?this.do_twitter_post(e):Dr.do_auth(this.do_twitter_post,e)},do_fb_post:function(e,t){return U.custom_show_posting=function(){return Hn.add_loading($("shmodal-fb-post-submit"))},U.custom_show_complete=function(){return Xn.hide(),b.success(At("Successfully posted to Facebook")),Pr.log("shmodal_fb_post"),ze.ViralLogger.log(H.get_viewer().get_user_ids(),"shmodel","send",{src:"shmodel_fb_post",file_type:On.is_album?"collection":On.is_folder?"folder":-1===On.filename.indexOf(".")?"file":er.EXTENSION_TO_CATEGORY[We.file_extension(On.filename).toLowerCase()]||"file"})},U.post($F("shmodal-fb-post-input"),e,null,null,null,function(){return Xn.hide()},t)},do_twitter_post:function(e){var t;return(t=$F("shmodal-twitter-post-input"))?t.length>140?void b.error(At("Your post must be 140 characters or less")):(Dr.custom_show_posting=function(){return $("twitter-chars").hide(),Hn.add_loading($("shmodal-twitter-post-submit"))},Dr.custom_post(t,function(e){return function(){return Xn.hide(),b.success(At("Successfully posted to Twitter")),Pr.log("shmodal_tweet"),ze.ViralLogger.log(H.get_viewer().get_user_ids(),"shmodel","send",{src:"shmodel_twitter",file_type:On.is_album?"collection":On.is_folder?"folder":-1===On.filename.indexOf(".")?"file":er.EXTENSION_TO_CATEGORY[We.file_extension(On.filename).toLowerCase()]||"file"})}}(this),e)):void b.error(At("Please enter a Twitter post"))},_get_shmodal_title:function(e){return null==e&&(e=!1),this.generate_title_content(this._get_shmodal_title_text(),function(e){return function(){return e.show_send_content()}}(this),function(e){return function(){return e.show_fb_content()}}(this),function(e){return function(){return e.show_twitter_content()}}(this),e)},generate_title_content:function(e,t,n,i,r){var o,s,a,_,l,u;return null==r&&(r=!1),_=pe("<div/>",{id:"shmodal-title"}),l=pe("<div/>",{id:"shmodal-title-text",text:e}),_.append(l),r||(a=pe("<a/>",{id:"shmodal-send-toggle",class:"freshtoggle ft-left toggled"}),a.html(G.make("web","email_20")),a.on("click",t),s=pe("<a/>",{id:"shmodal-fb-toggle",class:"freshtoggle ft-middle"}),s.html(G.make("web","fb_20")),s.on("click",n),u=pe("<a/>",{id:"shmodal-twitter-toggle",class:"freshtoggle ft-right"}),u.html(G.make("web","twitter_20")),u.on("click",i),_.append([a,s,u])),o=pe("<div/>",{class:"clear"}),_.append(o),_[0]},_get_shmodal_title_text:function(){var e,t;return this.is_folder?(e=At("Share link to ‘%(folder_name)s’"),e=e.format({folder_name:l.em_snippet(this.filename,15)})):(t=this._get_thumbnail_type(),t===er.CATEGORY_TO_TRANSLATION.IMAGE?At("Share this image"):t===er.CATEGORY_TO_TRANSLATION.VIDEO?At("Share this video"):At("Share '%(filename)s'").format({filename:l.em_snippet(this.filename,18)}))},_get_thumbnail_type:function(){var e,t;return-1===this.filename.indexOf(".")?!1:(t=We.file_extension(this.filename).toLowerCase(),e=er.EXTENSION_TO_CATEGORY[t],!e||"IMAGE"!==e&&"VIDEO"!==e?!1:er.CATEGORY_TO_TRANSLATION[e])},_populate_twitter_info:function(e,t){var n,i;return n=this.is_folder?At("Just shared some files using @Dropbox"):(i=this._get_thumbnail_type(),At(i&&i===er.CATEGORY_TO_TRANSLATION.IMAGE?"Just shared an image using @Dropbox":"Just shared a file using @Dropbox")),$("shmodal-twitter-post-input").setValue(n+" "+e),Rt._track_twitter_chars_left("shmodal-twitter-post-input",140),Dr.is_authed(t)?Dr.get_user_info(function(e){return $("shmodal-twitter-profile").down(".profile-pic").__date(new Element("img",{src:e.profile_image_url_https})),$("shmodal-twitter-profile").down(".name").__date(e.name),$("shmodal-twitter-profile").down(".username").__date("@"+e.screen_name),$("modal").down(".twitter-post-sickinput").addClassName("shrank"),$("shmodal-twitter-profile").show()},t):void 0},download_zip:function(e){var t,n,i,r,o;return t=pe("#download_button_link").attr("data-dl-link"),o=pe("#download_button_link").attr("data-test-link"),r="true"===pe("#download_button_link").attr("data-owner"),i=function(e){return function(e){var n;return"OK"===e?window.location=t:0===e.indexOf("err:")?(n=At(r?"The zip file is too large.":"The zip file is too large. Please add it to your Dropbox."),b.error(n)):b.error(At("Failed to download zip file.")),!1}}(this),n=function(e){return function(e){return b.error(At("Failed to download zip file.")),!1}}(this),o&&pe.support.cors===!0?g.AuthenticatedRequest({url:o,success:i,error:n}):window.location=t,!1},show_share_shmodel_role_chooser:function(e,t,n){return null==this.shmodel_select_role_modal&&(this.shmodel_select_role_modal=new Ci({element_id:"share-shmodel-select-role-modal",link_url:e,short_url:t,tokenizer_type:n})),this.shmodel_select_role_modal.show().set_title(this._get_shmodal_title_text())},prompt_login_then_share:function(e,t,n,i){var r;return r=function(r){return function(){var r;return Xn.hide(),pe("#role-selector option").removeClass("disabled"),r=H.get_viewer().get_uid_by_role(i),H.get_viewer().sign_in_user_by_id(r),ze.ShmodelUILogger.log("via-shmodel-viewer"),On.show_shmodal(e,t,n,r)}}(this),H.get_viewer().is_role_signed_in(i)?r():te.show_modal({role:i,on_success:r})},show_c2d_modal:function(e,t){var n,i,r,o,s;if(null==e&&(e=""),null==t&&(t=!1),e){if(e===A.ROLE_PERSONAL&&bt("forbid"!==this.team_only_shmodel,"Can't copy to personal Dropbox if restricted"),!H.get_viewer().is_role_signed_in(e))return void te.show_modal({role:e,on_success:function(t){return function(){return t.show_c2d_modal(e)}}(this)})}else if(H.get_viewer().is_paired)return void new Ti({element_id:"select-role-modal"}).show();return ze.WebMiscActivityLogger.log("show-c2d-modal",{filename:this.filename,auth_google:null!=pe.find(".auth-google")}),o=e?"#c2d-modal-"+e:"#c2d-modal",s=this._c2d_modal_msg(e,H.get_viewer().team_name),n=this._c2d_modal_button_msg(e,H.get_viewer().team_name),i=this._c2d_modal_desc(e,H.get_viewer().team_name),t&&(i=this._c2d_modal_team_only_desc(H.get_viewer().team_name)+"<br/><br/>"+i),r=this._c2d_modal_login_desc(e,H.get_viewer().team_name),Mt.fillVal(i,"c2d-desc"),Mt.fillVal(r,"c2d-login-desc"),pe(".c2d-submit-button").val(n),pe(".c2d-login-register-desc").hide(),this.is_album?pe(".c2d-login-register-album-desc").show():this.is_folder?pe(".c2d-login-register-folder-desc").show():pe(".c2d-login-register-file-desc").show(),Xn.show(s,pe(o)[0],!1,!1,!1,!1)},_c2d_modal_msg:function(e,t){var n,i;return null==e&&(e=""),null==t&&(t=""),this.c2d_vars.title?i=this.c2d_vars.title:e===A.ROLE_PERSONAL?(i=At("Save '%(filename)s' to my personal Dropbox"),i.format({filename:l.em_snippet(this.filename,10)})):e===A.ROLE_WORK?(i=At("Save '%(filename)s' to my %(team_name)s Dropbox"),n=Math.max(10,15-new l(t).length),i.format({filename:l.em_snippet(this.filename,n),team_name:t})):(i=At("Save '%(filename)s' to my Dropbox"),i.format({filename:l.em_snippet(this.filename,15)}))},_c2d_modal_button_msg:function(e,t){var n;return null==e&&(e=""),null==t&&(t=""),e===A.ROLE_PERSONAL?n=At("Save to my personal Dropbox"):e===A.ROLE_WORK?(n=At("Save to my %(team_name)s Dropbox"),n.format({team_name:t})):At("Save to my Dropbox")},_c2d_modal_team_only_desc:function(e){var t;return t=At(this.is_album?"You can only add this album to your <b>%(team_name)s Dropbox</b> because <b>%(owner_name)s</b> has restricted the album to members of <b>%(team_name)s</b>.":this.is_folder?"You can only add this folder to your <b>%(team_name)s Dropbox</b> because <b>%(owner_name)s</b> has restricted the folder to members of <b>%(team_name)s</b>.":"You can only add this file to your <b>%(team_name)s Dropbox</b> because <b>%(owner_name)s</b> has restricted the file to members of <b>%(team_name)s</b>."),t.format({owner_name:this.owner_name,team_name:e})},_c2d_modal_desc:function(e,t){var n;return null==e&&(e=""),null==t&&(t=""),e===A.ROLE_PERSONAL?this.is_album?"warn"===this.team_only_shmodel?(n=At("The photos and videos in this album were sent from <b>%(owner_name)s</b> on your <b>%(team_name)s</b> team.  Are you sure you want to copy them to your personal Dropbox?"),n.format({owner_name:this.owner_name,team_name:t})):n=At("The photos and videos in this album will be instantly saved to your personal Dropbox and downloaded to all the computers linked to your personal account."):this.is_folder?"warn"===this.team_only_shmodel?(n=At("This folder was sent from <b>%(owner_name)s</b> on your <b>%(team_name)s</b> team.  Are you sure you want to copy it to your personal Dropbox?"),n.format({owner_name:this.owner_name,team_name:t})):n=At("This folder will be instantly saved to your personal Dropbox and downloaded to all the computers linked to your personal account."):"warn"===this.team_only_shmodel?(n=At("This file was sent from <b>%(owner_name)s</b> on your <b>%(team_name)s</b> team.  Are you sure you want to copy it to your personal Dropbox?"),n.format({owner_name:this.owner_name,team_name:t})):n=At("This file will be instantly saved to your personal Dropbox and downloaded to all the computers linked to your personal account."):e===A.ROLE_WORK?(n=At(this.is_album?"The photos and videos in this album will be instantly saved to your %(team_name)s Dropbox and downloaded to all the computers linked to your %(team_name)s account.":this.is_folder?"This folder will be instantly saved to your %(team_name)s Dropbox and downloaded to all the computers linked to your %(team_name)s account.":"This file will be instantly saved to your %(team_name)s Dropbox and downloaded to all the computers linked to your %(team_name)s account."),n.format({team_name:t})):At(this.is_album?"The photos and videos in this album will be instantly saved to your Dropbox and downloaded to all the computers linked to your account.":this.is_folder?"This folder will be instantly saved to your Dropbox and downloaded to all the computers linked to your account.":"This file will be instantly saved to your Dropbox and downloaded to all the computers linked to your account.")},_c2d_modal_login_desc:function(e,t){var n;return null==e&&(e=""),null==t&&(t=""),e===A.ROLE_PERSONAL?n=At(this.is_album?"Once you sign in to your personal Dropbox, the photos and videos in this album will be instantly saved to your personal Dropbox and downloaded to all the computers linked to your personal account.":this.is_folder?"Once you sign in to your personal Dropbox, this folder will be instantly saved to your personal Dropbox and downloaded to all the computers linked to your personal account.":"Once you sign in to your personal Dropbox, this file will be instantly saved to your personal Dropbox and downloaded to all the computers linked to your personal account."):e===A.ROLE_WORK?(n=At(this.is_album?"Once you sign in to your %(team_name)s Dropbox, the photos and videos in this album will be instantly saved to your %(team_name)s Dropbox and downloaded to all the computers linked to your %(team_name)s account.":this.is_folder?"Once you sign in to your %(team_name)s Dropbox, this folder will be instantly saved to your %(team_name)s Dropbox and downloaded to all the computers linked to your %(team_name)s account.":"Once you sign in to your %(team_name)s Dropbox, this file will be instantly saved to your %(team_name)s Dropbox and downloaded to all the computers linked to your %(team_name)s account."),n.format({team_name:t})):void 0},do_c2d:function(e){var t;return bt(e,"Must specify a user_id for saving to Dropbox."),t=At("Saving to your Dropbox..."),H.get_viewer().is_paired&&(H.get_viewer().get_user_by_id(e).is_team?(t=At("Saving to your %(team_name)s Dropbox..."),t=t.format({team_name:H.get_viewer().team_name})):t=At("Saving to your personal Dropbox...")),b.success(t),Xn.hide(),new Ajax.DBRequest(this.c2d_url,{parameters:this.c2d_vars,job:this.is_folder,progress_text:t,subject_user:e,onSuccess:function(e){return function(e){return e.responseText?He.redirect(e.responseText):void 0}}(this)})},show_shared_content_sync_modal:function(e){var t;return(null!=e?e.sync_ns_id:void 0)?(t="SYNC_MODAL",W.showInstance(_e.createElement(W,{accessLevel:e.access_level,folderName:e.sync_folder_name,folderSize:e.sync_folder_size,outOfQuotaQP:e.sync_out_of_quota_qp,usageRemaining:e.sync_usage_remaining,usageShortage:e.sync_usage_shortage,senderName:e.sync_sender_name,syncSharedFolderCallback:On.sync_shared_folder.bind(On,e.sync_ns_id,e.sync_role,t,!0),syncNSId:e.sync_ns_id}))):void 0},request_shared_folder_sync:function(e){var t;return null==e&&(e=""),t="PREVIEW_PAGE",On.sync_shared_folder(this.sync_vars.sf_id,e,t)},sync_shared_folder:function(e,t,n,i,r){var o,s,_,l,u;if(null==i&&(i=!1),null==r&&(r=!1),t){if(!H.get_viewer().is_role_signed_in(t))return void te.show_modal({role:t,on_success:function(i){return function(){return On.sync_shared_folder(e,t,n)}}(this)})}else if(H.get_viewer().is_paired)return void new Ai({element_id:"select-role-modal-sync"}).show();return u=H.get_viewer(),t?l=u.get_uid_by_role(t):(bt(!u.is_paired,"role can not be unspecified for paired viewer"),l=u.get_user_ids()[0]),s=At("Adding to your Dropbox..."),u.is_paired&&(u.get_user_by_id(l).is_team?(s=At("Adding to your %(team_name)s Dropbox..."),s=s.format({team_name:u.team_name})):s=At("Adding to your personal Dropbox...")),b.success(s),_=function(t){var n,r;return n=H.get_viewer().get_user_by_id(l),r=Zi.make_browse_url_from_fq_path(n,t,{from_scl_sync_modal:i}),document.fire(a.SF_ADD_TO_DROPBOX,{target_ns_id:e,user_id:l,filename:t.split("/").pop(),mount_point:t}),He.redirect(r)},r?g.WebRequest({url:"/share_action/rejoin",subject_user:l,data:{ns_id:e},success:_,error:function(){return b.error(At("We were unable to complete your request."))}}):(o=new Ze({userId:l}),o.mount({contentId:e,origin:n}).then(function(e){return _(e.path_lower)}).catch(function(e){return b.error(At("We were unable to complete your request."))}))}};var $n;$n=Xe.ShmodalPanes={SEND:0,FB:1,TWITTER:2,list:[0,1,2],_content_str:["shmodal-send-content","shmodal-fb-content","shmodal-twitter-content"],_toggle_str:["shmodal-send-toggle","shmodal-fb-toggle","shmodal-twitter-toggle"],_title_str:["Share by Email",At("Share on Facebook"),At("Share on Twitter")],to_content_str:function(e){return this._content_str[e]},to_toggle_str:function(e){return this._toggle_str[e]},to_title_str:function(e){return 0===e?On._get_shmodal_title_text():this._title_str[e]},to_focus_str:function(e){return this._focus_str[e]}};var Nn,In,Ln,un=function(e,t){return function(){return e.apply(t,arguments)}},_n=function(e,t){function n(){this.constructor=e}for(var i in t)ln.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},ln={}.hasOwnProperty;In=INLINE_JS.ShareLinkModal=Xe.ShareLinkModal=function(e){function t(e,n,i,r,o){var a,_;this.user_id=e,null==r&&(r=!1),null==o&&(o=void 0),this.before_show=un(this.before_show,this),this.show=un(this.show,this),this.prompt_login_then_show=un(this.prompt_login_then_show,this),_={origin:i},_[A.UID_PARAM_NAME]=this.user_id,a=o?s({path:"/sm/get_link_modal_content/"+o}).toString():s({path:"/sm/share_link"+n}).toString(),t.__super__.constructor.call(this,{element_id:"share-link-modal",endpoint_url:a,parameters:_})}return _n(t,e),t.prototype.prompt_login_then_show=function(){var e;return e=function(e){return function(){return Xn.hide(),pe("#role-selector option").removeClass("disabled"),H.get_viewer().sign_in_user_by_id(e.user_id),ze.ShmodelUILogger.log("via-shmodel-viewer"),e.show()}}(this),H.get_viewer().is_uid_signed_in(this.user_id)?e():te.show_modal({user_id:this.user_id,on_success:e})},t.prototype.show=function(){var e;return e=H.get_viewer().get_user_by_id(this.user_id),it.get_for_user(e).verified_or_show(Me.SHMODAL)?t.__super__.show.call(this):void 0},t.prototype.before_show=function(){var e,t,n,i;return i=this.$modal_window.find(".share-link-modal-content").length,i?(e={class:"ajax-loading-indicator",src:"/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"},n=pe("<img />",e),t=pe("<div />",{class:"loading-spinner"}).append(n),this.$modal_window.find(".dynamic-content").html(t)):void 0},t}(J),Ln=Xe.ShareLinkModalContent=function(){function e(e,t,n,i,r,o,s,_,u,d,c,h){var f,p;this.owner_id=e,this.tkey=t,this.fq_path=n,this.link=i,this.filename=r,this.is_dir=o,this.tokenizer_type=s,this.tokenizer_ctx_str=_,this.is_restricted_to_members=u,this.fq_path_of_restricting_sf=c,this.trademark_pro=h,this._handleShareLinkRemind=un(this._handleShareLinkRemind,this),this._handleShareLinkDismiss=un(this._handleShareLinkDismiss,this),this._handleShareLinkUpsellBanner=un(this._handleShareLinkUpsellBanner,this),this._send_link=un(this._send_link,this),this._show_shared_link_remove_confirm_modal=un(this._show_shared_link_remove_confirm_modal,this),this._show_shared_link_settings_modal=un(this._show_shared_link_settings_modal,this),this._show_shared_folder_settings_modal=un(this._show_shared_folder_settings_modal,this),this._select_all_text=un(this._select_all_text,this),this._toggle_send_link_button=un(this._toggle_send_link_button,this),this._toggle_recipients_outside_team_warning=un(this._toggle_recipients_outside_team_warning,this),this._toggle_close_button_text=un(this._toggle_close_button_text,this),this._close_team_prompt=un(this._close_team_prompt,this),this._update_team_prompt_link=un(this._update_team_prompt_link,this),this._display_team_upsell_prompt=un(this._display_team_upsell_prompt,this),this._on_add_token=un(this._on_add_token,this),this._mark_onboarding_as_seen=un(this._mark_onboarding_as_seen,this),this._add_message_checkbox_changed=un(this._add_message_checkbox_changed,this),this._toggle_comment_option=un(this._toggle_comment_option,this),this._listen=un(this._listen,this),this._init_autocompleter=un(this._init_autocompleter,this),this.$content=pe(".share-link-modal-content"),this.modal=rt.get_containing_modal(this.$content),this.modal&&("shared_folder"===this.tokenizer_type&&(this.shared_folder_members=xe.create_contacts_list(d)),p={filename:this.filename,fq_path:this.fq_path,tkey:this.tkey,user_id:this.owner_id},document.fire(a.LINKS_ADD,p),pe(document).trigger(a.LINKS_ADD,p),this.modal.set_title(At("Share link to ‘%(filename)s’").format({filename:l.em_snippet(this.filename,15)})),this.can_show_team_upsell_prompt=1===this.$content.find(".team-upsell-prompt").length,this.collab_input_id=this.tokenizer_ctx_str+"-new-collab-input",this.$collab_input=this.$content.find("#"+this.collab_input_id),this.$send_link_button=this.$content.find(".confirm-button"),this.$share_link_url_input=this.$content.find(".copy-link-input-container input[type='text']"),this.$cancel_button=this.$content.find(".cancel-button"),this.$custom_message_textarea=this.$content.find("#share-link-modal-custom-message"),this.$comment_option_container=this.$content.find(".add-message-as-comment-container"),this.$share_link_upsell_banner_dismiss=this.$content.find(".share-link-upsell-banner__dismiss"),this.$share_link_upsell_banner_remind=this.$content.find(".share-link-upsell-banner__remind"),this.$share_link_upsell_banner=this.$content.find(".share-link-upsell-banner"),this.SHOW_BANNER_DELAY_IN_DAYS=7,this._init_autocompleter(),this._listen(),null!=(f=this.$share_link_url_input[0])&&f.select())}return e.prototype._init_autocompleter=function(){var e,t;return e={tokens:[",",";"],include_fb:!0,include_team:!0,team_only:"team_only"===this.tokenizer_type,user_id:this.owner_id},"shared_folder"===this.tokenizer_type?this.autocompleter=new Autocompleter.SharedFolderTokenizer(H.get_viewer().get_user_by_id(this.owner_id),this.collab_input_id,this.tokenizer_ctx_str+"-new-whobulk",this.tokenizer_ctx_str+"-hidden-input",e,this.shared_folder_members):"contacts"===this.tokenizer_type?this.autocompleter=new Autocompleter.ContactsTokenizer(H.get_viewer().get_user_by_id(this.owner_id),this.collab_input_id,this.tokenizer_ctx_str+"-new-whobulk",this.tokenizer_ctx_str+"-hidden-input",e):this.autocompleter=new Autocompleter.TeamTokenizer(H.get_viewer().get_user_by_id(this.owner_id),this.collab_input_id,this.tokenizer_ctx_str+"-new-whobulk",this.tokenizer_ctx_str+"-hidden-input",e),
t=function(e){return function(t){return function(){return e.autocompleter.contact_search_logger.log_records(e.owner_id,t)}}}(this),this.modal.logger_keydown_close_handler=t(!0),this.modal.$overlay.on("click",t(!0)),this.modal.$db_modal_x.on("click",t(!0)),this.$send_link_button.on("click",t(!1)),this.$cancel_button.on("click",t(!0)),Qn.init(),this.$collab_input.focus()},e.prototype._listen=function(){var e,t,n,i,r,o,s;return this.$send_link_button.on("click",this._send_link),this.$share_link_url_input.on("click",this._select_all_text),this.$cancel_button.on("click",function(e){return function(e){return ot.pop()}}(this)),this.$content.find("#shared-link-permissions-link").on("click",this._show_shared_link_settings_modal),this.$content.find("#shared-folder-options-link").on("click",this._show_shared_folder_settings_modal),this.$content.find("#shared-link-delete-link").on("click",this._show_shared_link_remove_confirm_modal),this.$comment_option_container.length>0&&(this.$custom_message_textarea.on("input",this._toggle_comment_option),this.$comment_option_container.find("#add-message-as-comment").on("change",this._add_message_checkbox_changed),e=this.$comment_option_container.find(".bubble-dropdown-x"),e.length>0&&e.on("click",this._mark_onboarding_as_seen)),null!=(t=this.$collab_input)&&t.keyup(this._toggle_send_link_button),null!=(n=this.$collab_input)&&n.on("input",this._toggle_send_link_button),null!=(i=this.$collab_input[0])&&i.observe("token:remove",this._toggle_send_link_button),null!=(r=this.$collab_input[0])&&r.observe("token:add",this._on_add_token),null!=(o=this.$collab_input[0])&&o.observe("token:remove",this._toggle_close_button_text),null!=(s=this.$collab_input[0])&&s.observe("sf:token:external",this._toggle_recipients_outside_team_warning),this.$share_link_upsell_banner_dismiss.length&&this.$share_link_upsell_banner_dismiss.on("click",this._handleShareLinkDismiss),this.$share_link_upsell_banner_remind.length&&this.$share_link_upsell_banner_remind.on("click",this._handleShareLinkRemind),this.$share_link_upsell_banner.length&&this._handleShareLinkUpsellBanner(),this.can_show_team_upsell_prompt?(this.$content.find(".close-team-prompt-button").on("click",this._close_team_prompt),this.$content.find(".team-prompt-link").on("click",this._update_team_prompt_link)):void 0},e.prototype._toggle_comment_option=function(e){var t;return t=this.$custom_message_textarea.val().length,t>0?this.$comment_option_container.css("visibility","visible"):this.$comment_option_container.css("visibility","hidden")},e.prototype._add_message_checkbox_changed=function(e){return g.SilentBackgroundRequest({url:"/file_activity/set_share_modal_checkbox_preference",data:{fq_path:this.fq_path,checked:e.currentTarget.checked},subject_user:this.owner_id})},e.prototype._mark_onboarding_as_seen=function(e){return g.SilentBackgroundRequest({url:"/file_activity/has_seen_add_message_as_comment_onboarding",data:{fq_path:this.fq_path},subject_user:this.owner_id})},e.prototype._on_add_token=function(e){var t;return this.can_show_team_upsell_prompt&&2===(null!=(t=this.autocompleter)?t.getTokenCount():void 0)&&(this._display_team_upsell_prompt(),this.can_show_team_upsell_prompt=!1),this._toggle_close_button_text()},e.prototype._display_team_upsell_prompt=function(){var e,t,n,i;if(!(this.autocompleter.token_manager.tokens.length<2))return e=this.autocompleter.token_manager.tokens[0].info.value,t=this.autocompleter.token_manager.tokens[1].info.value,n={user_front:this.autocompleter.getContactInfoFromEmail(e),user_back:this.autocompleter.getContactInfoFromEmail(t),dimension:24},i=_e.createElement(o,n),_e.render(i,this.$content.find(".team-prompt-avatar-container")[0]),this.$content.find(".team-upsell-prompt-container").show()},e.prototype._update_team_prompt_link=function(e){var t,n,i,r;return t=Bt.truncate_emails(this.autocompleter.getEmails()),n=this.$content.find(".team-prompt-link"),r=n.attr("href"),i=s.parse(r).updateQuery({invite_members:t}),n.attr("href",i)},e.prototype._close_team_prompt=function(e){return this.$content.find(".team-upsell-prompt-container").hide()},e.prototype._toggle_close_button_text=function(e){var t,n;return n=0===(null!=(t=this.autocompleter)?t.token_manager.tokens.length:void 0),n?this.$cancel_button.text(At("Close")):this.$cancel_button.text(At("Cancel"))},e.prototype._toggle_recipients_outside_team_warning=function(e){var t,n;return t=pe(".external-recipient-warning-message"),t.length?(n=e.memo.count,e.memo.shared_folder_warning?n>0?t.show():t.hide():n>1?(t.find(".external-recpient-num").text(n),t.removeClass("single").show()):1===n?t.addClass("single").show():t.hide()):void 0},e.prototype._toggle_send_link_button=function(e){var t,n;return n=0===(null!=(t=this.autocompleter)?t.token_manager.tokens.length:void 0),n=n&&""===pe.trim(this.$collab_input.val()),this.$send_link_button.prop("disabled",n)},e.prototype._select_all_text=function(e){return pe(e.currentTarget)[0].select()},e.prototype._show_shared_folder_settings_modal=function(e){var t;return e.preventDefault(),t=H.get_viewer().get_user_by_id(this.owner_id),ht(t,{fqPath:this.fq_path_of_restricting_sf,isFolder:!0,origin:"SHARE_LINK_MODAL",shouldFetchNsId:!0})?void ot.pop():zt.show_shared_folder_options_modal(this.fq_path_of_restricting_sf,t)},e.prototype._show_shared_link_settings_modal=function(e){var t;return e.preventDefault(),t=new Rn(this.owner_id,this.tkey),ot.push(t)},e.prototype._show_shared_link_remove_confirm_modal=function(e){var t;return e.preventDefault(),t=function(e){return function(){return ot.pop(),pe(document).trigger(a.LINKS_REMOVE,{fq_path:e.fq_path})}}(this),On.confirm_remove(this.filename,this.tkey,this.is_dir,!1,!1,this.owner_id,!1,null,null,t)},e.prototype._send_link=function(e){var t,n,i,r,o;return i=this.$content.find(".share-link-modal-send-form")[0],r=this.get_shmodel_send_recipients(i),o=function(e){return function(e){var t;return t=Bt.success_string_for_recipients(r),b.success(t),ot.pop(),Pr.log("shmodal_send")}}(this),n=function(e){return function(e){return Hn.remove_loading()}}(this),t=this.$content.find(".tokenizer-submit-button")[0],Hn.ajax_submit(i,"/sm/share",o,n,t)},e.prototype.get_shmodel_send_recipients=function(e){var t,n,i,r,o,s,a,_,l,u,d,c,h;for(bt(e,"Must pass the shmodal send form into get_shmodel_send_recipients"),t=e.select('input[name="emails"]'),n=e.select('input[name="fb_ids"]'),i=e.select('input[name="group_ids"]'),u=e.select('input[name="new_style_group_ids"]'),c=[],h=[t,n,i,u],r=0,_=h.length;_>r;r++)for(s=h[r],a=0,l=s.length;l>a;a++)o=s[a],d=o.up().innerHTML.stripTags().escapeHTML(),c.push(d.substring(0,d.indexOf("&")));return c},e.prototype._isLocalStorageAvailable=function(){var e,t,n;n="uxa_"+(Math.floor(1e4*Math.random())+1e4);try{return window.localStorage.setItem(n,n),window.localStorage.removeItem(n),!0}catch(t){return e=t,!1}},e.prototype._handleShareLinkUpsellBanner=function(){return Ie.read("upsell-banner-remind-me-later")?this.$share_link_upsell_banner.remove():this.$share_link_upsell_banner.show(),this.$share_link_upsell_banner_remind.length&&this._isLocalStorageAvailable()?localStorage.getItem("seen_remind_me_banner")?(this.$share_link_upsell_banner_remind.remove(),this.$content.find(".share-link-upsell-banner__upgrade").removeClass("share-link-upsell-banner__upgrade--remind")):localStorage.setItem("seen_remind_me_banner",!0):void 0},e.prototype._handleShareLinkDismiss=function(e){return e.preventDefault(),this.$share_link_upsell_banner.remove(),g.WebRequest({url:s({path:"/ajax_shared_link_dismiss_banner"}),type:"POST",error:function(){return b.error()}})},e.prototype._handleShareLinkRemind=function(e){return e.preventDefault(),this.$share_link_upsell_banner.remove(),Ie.create("upsell-banner-remind-me-later","true",this.SHOW_BANNER_DELAY_IN_DAYS),b.success(At("No problem! We’ll remind you about %(trademark_pro)s later").format({trademark_pro:this.trademark_pro}))},e}(),Nn=INLINE_JS.QuickSend=Xe.QuickSend={_files:{},_uploading_fileids:{},init:function(e,t,n){var i;return this.owner_id=e,this.tokenizer_ctx_str=t,this.keep_visible=n,this.$content=pe("#browse-root-quick-send"),this.$content[0].writeAttribute("dropzone","copy move"),this.$content[0].writeAttribute("quicksend","true"),this.collab_input_id=this.tokenizer_ctx_str+"-new-collab-input",this.$collab_input=this.$content.find("#"+this.collab_input_id),null!=(i=this.$collab_input)&&i.keyup(this._toggle_send_button_state),this.$collab_input[0]&&(this.$collab_input[0].on("token:remove",this._toggle_send_button_state),this.$collab_input[0].on("token:add",this._toggle_send_button_state)),this.$send_button=this.$content.find("#quick-send-submit"),this.$send_button.on("click",this._send_link),this.$cancel_button=this.$content.find("#quick-send-cancel"),this.$cancel_button.on("click",this._cancel_button_clicked),this.$import_services=this.$content.find(".autocomplete"),pe("#browse-files").addClass("quicksend-collapsed"),Nn._update_location(),this.has_autocompleter_inited=!1,ze.SharedFolderActivityLogger.log("web","quick_send_displayed",pr.active_user,{}),this.$collab_input.on("blur",function(){return setTimeout(function(){var e;return null!=(e=Nn.$import_services)?e.hide():void 0},100)}),pe("#quick-send-top-choose-button-send").click(function(){return pe("#quick-send-file-box").click()}),pe("#quick-send-choose-button").click(function(){return pe("#quick-send-file-box").click()}),pe(".quick-send-choose-file-link").click(function(){return pe("#quick-send-file-box").click()}),pe("#quick-send-file-box").on("change",function(){var e,t;return t=pe("#quick-send-file-box")[0].files,e=function(){return pr.active_user||(pr.active_user=H.get_viewer().get_user_by_id(Nn.owner_id)),zn.upload(Nn.DEST_FOLDER+"/",t)},Nn.get_folder_name(e)}),document.on(jn.COMPLETE_EVT,Nn._file_upload_completed),document.on(jn.ERROR_EVT,Nn._file_upload_errored),document.on(ke.UPDATE,Nn._update_location)},_cancel_button_clicked:function(e){return ze.SharedFolderActivityLogger.log("web","quick_send_cancel_button_clicked",pr.active_user,{}),Nn._reset()},_init_autocompleter:function(){var e;if(!Nn.has_autocompleter_inited)return Nn.has_autocompleter_inited=!0,e={tokens:[",",";"],include_fb:!0,include_team:!0,team_only:!1,user_id:Nn.owner_id,max_textbox_height:30,viewer:H.get_viewer(),include_from_linked_accounts:!0},Nn.autocompleter=new Autocompleter.ContactsTokenizer(H.get_viewer().get_user_by_id(Nn.owner_id),Nn.collab_input_id,Nn.tokenizer_ctx_str+"-new-whobulk",Nn.tokenizer_ctx_str+"-hidden-input",e)},_send_link:function(e){var t,n,i,r,o,s,a,_,l;ze.SharedFolderActivityLogger.log("web","quick_send_send_button_clicked",pr.active_user,{}),Nn.autocompleter.tokenize_emails_input(!0),_=Nn.autocompleter.getTokenCount(),r=pe(".quick-send-left-form")[0],o=[],a=0;for(i in Nn._files)a+=1,n=Nn._files[i],o.push(n.fq_path);return s={num_recipients:_,num_files:a},ze.SharedFolderActivityLogger.log("web","quick_send_send_attempted",pr.active_user,s),l=function(e){return function(e){return Nn._reset(),Nn._toggle_top_area_view(),ze.SharedFolderActivityLogger.log("web","quick_send_send_succeeded",pr.active_user,{})}}(this),t=function(e){return function(e){return ze.SharedFolderActivityLogger.log("web","quick_send_send_failed",pr.active_user,{})}}(this),Hn.ajax_submit(r,"/sm/quick_send",l,t,null,{fq_paths:o.join(",")})},_update_file_area_view:function(){return Object.keys(Nn._files).length?(pe("#quick-send-drop-area").hide(),pe("#quick-send-files-area").show()):(pe("#quick-send-drop-area").show(),pe("#quick-send-files-area").hide()),Nn._toggle_send_button_state()},_toggle_top_area_view:function(){return pe("#quick-send-top-part-send").hide(),pe("#quick-send-top-part-confirm").show(),setTimeout(function(){return pe("#quick-send-top-part-send").show(),pe("#quick-send-top-part-confirm").hide()},3e3)},_update_location:function(){var e;return e=Nn.keep_visible||!!pr.inside_root_folder,Nn._toggle_quick_send_module(e)},_toggle_quick_send_module:function(e){var t,n;if(Nn._visible!==e)return n=Nn.$content,e?(Nn._visible=!0,n.show(),Nn._update_collapsed_state()):(Nn._visible=!1,n.hide(),n.removeClass("collapsed expanded"),t=pe("#browse-files"),t.removeClass("quicksend-collapsed quicksend-expanded"))},_update_collapsed_view:function(e){var t,n,i,r;return n=Nn.$content,r=e?"collapsed":"expanded",n.hasClass(r)?void 0:(i=e?"expanded":"collapsed",n.removeClass(i),n.addClass(r),t=pe("#browse-files"),r=e?"quicksend-collapsed":"quicksend-expanded",i=e?"quicksend-expanded":"quicksend-collpased",t.removeClass(i),t.addClass(r),e?void 0:Nn._init_autocompleter())},_update_collapsed_state:function(){var e;return e=Object.keys(Nn._files).length,Nn._update_collapsed_view(0===e)},_remove_file:function(e,t){var n;return n=!1,e in Nn._uploading_fileids&&(n=!0,document.fire(jn.CANCEL_EVT,{file:t}),pe(document).trigger(jn.CANCEL_EVT,{file:t}),delete Nn._uploading_fileids[e]),e in Nn._files?($(e).remove(),delete Nn._files[e],Nn._update_upload_list_scroll(),Nn._update_file_area_view(),Nn._update_collapsed_state()):void 0},_reset:function(){var e,t,n,i;Nn.autocompleter.clearTokens(),n=pe(".quick-send-left-form")[0],n.reset(),i=[];for(t in Nn._files)e=Nn._files[t],i.push(Nn._remove_file(t,e.file_obj));return i},_has_added_fq_path:function(e){var t,n;for(n in Nn._files)if(t=Nn._files[n],t.fq_path===e)return!0;return!1},_update_upload_list_scroll:function(){var e,t;return e=Object.keys(Nn._files).length,t=pe("#quick-send-upload-files-list"),3>e?t.removeClass("scroll"):(t.addClass("scroll"),t.scrollTop=t.scrollHeight)},_add_file:function(e,t){var n,i,r,o,s,a,_,u,d,c;return a={size:e.bytes,source:t},ze.SharedFolderActivityLogger.log("web","quick_send_file_added",pr.active_user,a),i=e.dest||Nn.DEST_FOLDER,d=y.format_bytes(e.bytes||0),n=Ke.tmpl("upload_list_item_tmpl"),r=n({file:e,icon:We.file_icon(e.name),filename_snippet:l.em_snippet(e.name,Bn.FILENAME_SNIPPET_LENGTH),size:d,dest:i,dest_snippet:l.em_snippet(At("Dropbox")+i,Bn.DEST_SNIPPET_LENGTH,0),Sprite:G}),u=de.sanitize(r.toHTML()),pe("#quick-send-upload-files-list").append(u),o=pe("#"+e.id),Nn._update_upload_list_scroll(),o.find(".dest-col").hide(),o.find(".time-col").hide(),c=o.find(".status-col").find("a.small-x-button"),s=e.id,c.on("click",function(t){return Nn._remove_file(s,e)}),_=o.find(".remove-link"),_.on("click",function(t){return Nn._remove_file(s,e)}),o.on("mouseenter",function(e){return function(e){return o.find(".status-col").hide(),_.show()}}(this)),o.on("mouseleave",function(e){return function(e){return o.find(".status-col").show(),_.hide()}}(this)),Nn._files[e.id]={file_div:r,fq_path:e.fq_path,bytes:e.size,file_obj:e},Nn._update_file_area_view(),Nn._update_collapsed_state()},_toggle_send_button_state:function(){var e,t,n;return n=0===(null!=(e=Nn.autocompleter)?e.token_manager.tokens.length:void 0),n=n&&""===Nn.$collab_input.val(),t=0===Object.keys(Nn._files).length||Object.keys(Nn._uploading_fileids).length>0,Nn.$send_button.prop("disabled",n||t)},_file_upload_errored:function(e){var t,n;return t=e.memo.file,t.id in Nn._uploading_fileids?(n={message:e.memo.message},ze.SharedFolderActivityLogger.log("web","quick_send_file_errored",pr.active_user,n),delete Nn._uploading_fileids[t.id]):void 0},_file_upload_completed:function(e){var t;return t=e.memo.file,t.id in Nn._uploading_fileids?(ze.SharedFolderActivityLogger.log("web","quick_send_file_uploaded",pr.active_user,{}),delete Nn._uploading_fileids[t.id],Nn._toggle_send_button_state()):void 0},get_folder_name:function(e){var t,n;return Nn.DEST_FOLDER?void e():(n=function(t){var n;return n=JSON.parse(t),Nn.DEST_FOLDER=n.folder_name,e()},t=function(){return b.error(At("We couldn’t upload your file. Please try again."))},g.WebRequest({url:"/share/quick_send_folder_name",data:{},subject_user:Nn.owner_id,success:n,error:t}))},is_quicksend_dest:function(e){var t;return t=We.normalize(e),t===Nn.DEST_FOLDER},add_external_file:function(e){var t,n;return n=e.dest+e.name,Nn._has_added_fq_path(n)?(b.success(At("You’ve already added this file.")),document.fire(jn.CANCEL_EVT,{file:e}),void pe(document).trigger(jn.CANCEL_EVT,{file:e})):(e.fq_path=n,e.bytes=e.size,Nn._uploading_fileids[e.id]=!0,Nn._add_file(e,"external"),t=pe("#"+e.id),t.find(".upload-progress-bar").css({width:"0"}))},add_dropbox_file:function(e){var t;return e.dir?void b.error(At("Please select files instead of folders.")):Nn._has_added_fq_path(e.fq_path)?void b.success(At("You’ve already added this file.")):(e.name=e.filename,Nn._add_file(e,"dropbox"),t=pe("#"+e.id),t.find(".upload-progress-bar").css({width:"100%"}),t.addClass("complete"),setTimeout(function(){var e;return e=t.find(".status-col"),e.empty(),e.append(G.make("web","s_check"))},0))}};var Rn,qn,_n=function(e,t){function n(){this.constructor=e}for(var i in t)ln.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},ln={}.hasOwnProperty,un=function(e,t){return function(){return e.apply(t,arguments)}};Rn=Xe.SharedLinkSettingsModal=function(e){function t(e,n,i,r,o){var s,a,_;this.owner_id=e,this.tkey=n,this.dismiss_callback=i,this.url=r,this.show_delete_link=o,s={tkey:null!=(a=this.tkey)?a:"",url:null!=(_=this.url)?_:"",show_delete_link:this.show_delete_link},s[A.UID_PARAM_NAME]=this.owner_id,t.__super__.constructor.call(this,{element_id:"shared-link-settings-modal",endpoint_url:"/sm/shared_link_settings",parameters:s}),this.dismiss_callback&&(this.on_hide=this.dismiss_callback)}return _n(t,e),t}(J),qn=Xe.SharedLinkSettingsModalContent=function(){function e(e,t,n,i,r,o){var s,a,_;this.owner_id=e,this.tkey=t,this.filename=n,this.saved_password_placeholder_value=i,this.fq_path_of_restricting_sf=r,this.fq_path=o,this._save_settings=un(this._save_settings,this),this._toggle_password_input=un(this._toggle_password_input,this),this._enable_password_input_for_editing=un(this._enable_password_input_for_editing,this),this._date_change_callback=un(this._date_change_callback,this),this._show_calendar=un(this._show_calendar,this),this._hide_calendar=un(this._hide_calendar,this),this._future_date=un(this._future_date,this),this._enable_save_button=un(this._enable_save_button,this),this._custom_expiry_click_handler=un(this._custom_expiry_click_handler,this),this._hide_custom_expiry_label=un(this._hide_custom_expiry_label,this),this._show_custom_expiry_label=un(this._show_custom_expiry_label,this),this._toggle_expiration=un(this._toggle_expiration,this),this._expiry_picker_callback=un(this._expiry_picker_callback,this),this._show_confirm_delete_link=un(this._show_confirm_delete_link,this),this._show_shared_folder_settings_modal=un(this._show_shared_folder_settings_modal,this),this._listen=un(this._listen,this),this._detect_and_handle_blur_when_password_empty=un(this._detect_and_handle_blur_when_password_empty,this),this._is_clicked=un(this._is_clicked,this),this._change_password_click=un(this._change_password_click,this),this._init_expiration_section=un(this._init_expiration_section,this),this._toggle_comment_section=un(this._toggle_comment_section,this),this._init_comment_section=un(this._init_comment_section,this),this.MS_PER_DAY=864e5,this.$content=pe(".sharing-settings-modal-content"),this.modal=rt.get_containing_modal(this.$content),this.modal&&(a=l.em_snippet(this.filename,18),At("Link settings for “%(filename)s”"),_=At("Link permissions for '%(filename)s'").format({filename:a}),this.modal.set_title(_),this.$form=this.$content.find(".shared-link-settings-modal-form"),this.$save_button=this.$form.find(".confirm-button"),this.$password_field_container=this.$form.find(".password-field-container"),this.$password=this.$form.find(".link-password-container"),this.$password_input=this.$password.find("input[name='password']"),this.$password_label=this.$password.find("label"),this.$change_password=this.$form.find(".change-link-password-container"),this.$selected_expiry=this.$form.find(".selected-expiration"),this.$unselected_expiry=this.$form.find(".unselected-expiration"),this.$custom_expiry=this.$form.find(".custom-expiration"),this.$selected_date_box=this.$form.find(".selected-date"),this.$selected_date=this.$form.find(".selected-date-text"),this.$calendar=this.$form.find("#expiration-calendar-container"),this.$expiry_posix=this.$form.find("#expiration-posix"),this.$static_expiry=this.$form.find(".static-expiration"),this.loaded_with_saved_password="yes"===this.$password_input.data("is-saved-password"),this.loaded_with_saved_password&&this._show_password_input(s=!0),this._init_expiration_section(),this.$form.find(".comment-permissions").length&&this._init_comment_section(),this._listen())}return e.prototype._init_comment_section=function(){var e;return e=this.$form.find(".comment-permission-disabled"),e.length?e.show():(this._toggle_comment_section(),this.$content.find(".audience-selection input[type=radio]").on("change",this._toggle_comment_section))},e.prototype._toggle_comment_section=function(){var e;switch(this.$form.find(".comment-permission").hide(),e=parseInt(this.$form.find("input[name=audience]:checked").val())){case K.TOKEN_VISIBILITY.PUBLIC:return this.$form.find(".comment-permission-anyone").show();case K.TOKEN_VISIBILITY.TEAM_ONLY:return this.$form.find(".comment-permission-team").show();case K.TOKEN_VISIBILITY.PASSWORD:return this.$form.find(".comment-permission-password").show()}},e.prototype._init_expiration_section=function(){var e;return this.$form.find(".expiration-selection").show(),this.$expiry_posix.val()?(pe("#expiration-yes").prop("checked",!0),e=this._posix_time_to_date(parseInt(this.$expiry_posix.val())),this._set_selected_date_text(e),this._show_custom_expiry_label()):(this.$selected_expiry.hide(),this._hide_custom_expiry_label(),this.$unselected_expiry.show())},e.prototype._change_password_click=function(e){return e.preventDefault(),this._enable_password_input_for_editing()},e.prototype._is_clicked=function(e,t){return e.is(t.target)||e.has(t.target).length},e.prototype._detect_and_handle_blur_when_password_empty=function(e){return!this.$password.is(":visible")||this.$password_input.val()||this._is_clicked(this.$password_field_container,e)?void 0:this._show_password_input(!0)},e.prototype._listen=function(){return this.loaded_with_saved_password&&(pe(window).on("click",this._detect_and_handle_blur_when_password_empty),this.$change_password.find(".change-link-password").on("click",this._change_password_click)),this.$form.on("change",this._enable_save_button),this.$form.on("submit",this._save_settings),this.$save_button.on("click",this._save_settings),this.$content.find(".cancel-button").on("click",function(e){return function(e){return ot.pop()}}(this)),this.$content.find(".audience-selection input[type=radio]").on("change",this._toggle_password_input),this.$content.find(".expiration-selection input[type=radio]").on("change",this._toggle_expiration),this.$content.find(".delete-link").on("click",this._show_confirm_delete_link),this.$content.find("#shared-folder-options-link").on("click",this._show_shared_folder_settings_modal),pe(window).on(ve.CHANGED,this._expiry_picker_callback)},e.prototype._show_shared_folder_settings_modal=function(e){var t;return e.preventDefault(),this.modal.on_hide=null,ot.pop(),t=H.get_viewer().get_user_by_id(this.owner_id),ht(t,{fqPath:this.fq_path_of_restricting_sf,isFolder:!0,origin:"SHARE_LINK_MODAL",shouldFetchNsId:!0})?void 0:zt.show_shared_folder_options_modal(this.fq_path_of_restricting_sf,t)},e.prototype._refreshSharedWithColumnLinkData=function(){return be.dispatch({type:_t.SIGNAL_SHARED_LINK_DATA_OUT_OF_DATE,data:{fileFqPaths:[this.fq_path]}})},e.prototype._show_confirm_delete_link=function(){var e;return e=function(e){return function(){return ot.pop(),e._refreshSharedWithColumnLinkData()}}(this),On.confirm_remove(this.filename,this.tkey,null,!1,!1,this.owner_id,!1,null,null,e)},e.prototype._expiry_picker_callback=function(e,t){var n,i;if(t.clicked_val!==t.old_val)return n=t.clicked_val,"custom"!==n?(i=this._future_date(parseInt(n)),this._set_expiration(i)):(this.$selected_expiry.hide(),this._show_custom_expiry_label(),this._set_selected_date_text(this._future_date(30)),this._show_calendar())},e.prototype._toggle_expiration=function(e){var t,n;return"expiration-yes"===pe(e.currentTarget).attr("id")?(this.$selected_expiry.show(),this._hide_custom_expiry_label(),this.$unselected_expiry.hide(),Y.get_controller(pe(".expiration-picker")).set_value(30),n=30,t=this._future_date(n),this._set_expiration(t),this._set_selected_date_text(t)):(this.$expiry_posix.val(""),this.$unselected_expiry.show(),this.$selected_expiry.hide(),this.$static_expiry.hide(),this._hide_custom_expiry_label(),this._hide_calendar())},e.prototype._show_custom_expiry_label=function(){return this.$custom_expiry.show(),this.$selected_expiry.hide(),this.$unselected_expiry.hide(),pe(window).on("click",this._custom_expiry_click_handler)},e.prototype._hide_custom_expiry_label=function(){return this.$custom_expiry.hide(),pe(window).off("click",this._custom_expiry_click_handler)},e.prototype._custom_expiry_click_handler=function(e){return this._is_clicked(this.$calendar,e)?void 0:this.$selected_date_box.is(e.target)||this.$selected_date_box.has(e.target).length?this.$calendar.is(":visible")?this.$calendar.hide():this._show_calendar():this.$calendar.is(":visible")?this.$calendar.hide():void 0},e.prototype._enable_save_button=function(e){return this.$save_button.removeAttr("disabled")},e.prototype._future_date=function(e){var t;return t=Rt.start_of_day(new Date),t.setDate(t.getDate()+e),t},e.prototype._hide_calendar=function(){return this.$calendar.hide()},e.prototype._show_calendar=function(){var e,t,n;return pe(".selected-date").off("click"),this.calendar?this.$calendar.show():(n=this.$expiry_posix.val()?this._posix_time_to_date(parseInt(this.$expiry_posix.val())):this._future_date(30),t={disable_past:!0,first_day:this._future_date(1),last_day:this._future_date(365),selected_date:n,onDateChange:pe.proxy(this._date_change_callback,this)},this.calendar=new ri("expiration-calendar-container",t)),e=this.$selected_date_box.offset().left,this.$calendar.show().offset({left:e})},e.prototype._posix_time_to_date=function(e){return new Date(1e3*e)},e.prototype._set_selected_date_text=function(e){return this.$selected_date.text(Cr.localize(e))},e.prototype._set_expiration=function(e){var t,n;return bt(0===e.getMilliseconds()),bt(0===e.getSeconds()),bt(0===e.getMinutes()),bt(0===e.getHours()),n=(e.getTime()+this.MS_PER_DAY)/1e3,t=n-1,this.$expiry_posix.val(t)},e.prototype._date_change_callback=function(e){return this._set_selected_date_text(e),this._set_expiration(e),this._enable_save_button(),this._hide_calendar()},e.prototype._show_password_input=function(e){var t,n,i,r,o;return null==e&&(e=!1),t=this.$content.find("label[for=audience-password]").position().left,r=this.$content.find("#audience-password").position().left,n=t-r+10,this.$password.show().css({left:n}),this.$password_input.val(""),e?(this.$password_input.addClass("disabled").attr("readonly","true"),this.$password_input.data("is-saved-password","yes"),o="●●●●●●●●",this.$password_label.text(o).show(),i=this.$password.position(),this.$change_password.css({left:i.left,top:i.top}).show()):this._enable_password_input_for_editing()},e.prototype._enable_password_input_for_editing=function(){return this.$change_password.hide(),this.$password_input.removeAttr("readonly").removeClass("disabled"),this.$password_input.data("is-saved-password","no"),this.$password_label.text(At("Set password")).show(),this.$password_input.focus(),this._enable_save_button()},e.prototype._toggle_password_input=function(e){var t;return"audience-password"===pe(e.currentTarget).attr("id")?this._show_password_input(t=this.loaded_with_saved_password):(this.$password.hide(),this.$change_password.hide(),this.$password_input.data("is-saved-password","no"))},e.prototype._save_settings=function(e){var t,n,i,r;return"yes"===this.$password_input.data("is-saved-password")&&(i={type:"hidden",name:"password",value:this.saved_password_placeholder_value},t=pe("<input />",i),this.$form.append(t),this.$password_input.attr("name","inoperative_password")),r=function(e){return function(e){return ot.pop(),b.success(At("Settings saved."))}}(this),n=function(e){return function(t){return e.$password.length&&e.$password.is(":visible")&&e.$password_input.focus(),Hn.remove_loading()}}(this),Hn.ajax_submit(this.$form[0],"/sm/change_shared_link_settings",r,n,this.$save_button[0])},e}();var Mn,Pn,Fn,Un,jn,Bn,zn,An=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};jn=INLINE_JS.Upload=Xe.Upload={QUEUE_EVT:"db:upload:queue",QUEUE_ERROR_EVT:"db:upload:queue_error",UPDATE_EVT:"db:upload:update",COMPLETE_EVT:"db:upload:complete",ERROR_EVT:"db:upload:error",CANCEL_EVT:"db:upload:cancel",CHOOSE_FILE_BASIC:"db:upload:choose_file_basic",APPLE_PACKAGE_EXTENSIONS:["pages","key","app","numbers","band","photolibrary","rcproject","rtfd","graffle","logic","logicx","lpdf","sketch","screenflow","scriv","dvdproj","mindnode","cmproj","xcodeproj","imovielibrary","mpkg","imovieproject","1password","agilekeychain","fcpbundle","abbu","mindnode","theater","gameproj","aplibrary","itlp","lrdata","ydevice","bundle","framework","plugin","kext","pkg"],APPLE_PACKAGE_ERROR:-54321,current_dest:"",runtimes:function(){var e,t,n,i;n={"MSIE 8.0":"flash","MSIE 9.0":"flash"},t="html5";for(e in n)i=n[e],-1!==navigator.userAgent.indexOf(e)&&(t=i);return t}(),set_dest:function(e){return Mt.fillVal(e,"dest-folder"),this.current_dest=e},init:function(e,t,n,i){var r;return this.set_dest(e),r=this.initPLU(n,i),t?r():P.window_load(r),pe("#flash-upload-container > .moxie-shim").each(function(e){return e.observe?(Rt.freshbutton_overlay(e,$("choose-button")),Rt.freshbutton_overlay(e,$("add-button"))):void 0}),Pn.clear()},init_basic:function(){return Rt.freshbutton_overlay($("file-box"),$("basic-choose-button")),$("file-box").observe("click",function(e){return document.fire(jn.CHOOSE_FILE_BASIC)}),$("basic-choose-button").observe("mousemove",function(e){var t,n,i;return t=$("modal").cumulativeOffset(),i=e.clientY-t.top-3,n=e.clientX-t.left-$("file-box").getWidth()+3,$("file-box").setStyle({top:i+"px",left:n+"px"})}),$("file-box").observe("change",function(){var e,t,n,i,r,o;return Xn.hide=function(){},$("modal-x").hide(),$("basic-upload-desc").hide(),$("basic-upload-buttons").hide(),$("file-box").hide(),t=$("file-box").getValue().split("\\").pop(),i=G.make("web",We.file_icon(t)),$("basic-upload-status").down(".icon").__date(i),e=At("Uploading %(filename)s").format({filename:l.em_snippet(t,25)}),$("basic-upload-status").down(".file-desc").__date(e),$("basic-upload-status").show(),$("basic-uploading-message").show(),n=$("file-box").files,o=0,n&&(r=n[0].lastModifiedDate,r&&(o=Math.round(Date.parse(r)/1e3)||0)),o||(o=Math.round(Date.parse(new Date)/1e3)),$("mtime-utc").value=o,$("basic-upload-form").submit()})},initPLU:function(e,t){return function(n){return function(){var i,r;return i={url:"https://"+he.BLOCK_CLUSTER+"/chunked_upload",file_data_name:"file",runtimes:n.runtimes,multipart_params:{},multipart:!1,max_file_size:"50000mb",chunk_size:"8mb",max_retries:2,browse_button:"choose-button",container:"flash-upload-container",preinit:{PostInit:function(){return e&&e(),n.uploaderLoaded()},Error:n.uploadError.bind(n)},init:{FilesAdded:n.fileQueued.bind(n),UploadProgress:n.uploadProgress.bind(n),FileUploaded:n.uploadSuccess.bind(n),BeforeUpload:n.prepareFileForUploading.bind(n),ChunkUploaded:n.chunkUploaded.bind(n),UploadComplete:Pn.finished.bind(Pn),Refresh:function(){return"flash"===n.PLU.runtime&&$("upload-running-buttons").visible()?(Oe.clone_position(pe("#flash-upload-container"),pe("#add-button")),pe("#flash-upload-container > .moxie-shim")[0].style.width="100%",pe("#flash-upload-container > .moxie-shim")[0].style.height="100%"):void 0}},flash_swf_url:Ge.UrlConstants.MOXIE_SWF_URL},null!=t&&pe.extend(i,t),r=new B.Uploader(i),n.PLU=r,n.PLU.init()}}(this)},reset:function(){
return Pn.uploading&&Pn.current_file&&this.PLU.removeFile(Pn.current_file),Fn.hide()},show_upload:function(){return $("upload-desc").hide(),$("dnd-upload-desc").hide(),$("upload-files-list").show(),$("upload-start-buttons").hide(),$("upload-running-buttons").show(),$("hide-button").show(),$("done-button").hide(),$("modal-overlay").visible()?void 0:Fn.show()},updatePostParams:function(e){var t,n;n=this.PLU.settings.multipart_params;for(t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);return this.PLU.settings.multipart_params=n},fileQueued:function(e,t){var n,i,r,o;for(i=0,r=t.length;r>i;i++)n=t[i],void 0===("function"==typeof n.getNative&&null!=(o=n.getNative())?o.dest:void 0)?n.dest=jn.current_dest:n.dest=n.getNative().dest;return document.fire(this.QUEUE_EVT,{files:t}),pe(document).trigger(this.QUEUE_EVT,{files:t}),Nn.is_quicksend_dest(n.dest)?void 0:this.show_upload()},uploadNext:function(){var e,t,n,i,r,o;return i=Pn.next(),(n=v.contains(jn.APPLE_PACKAGE_EXTENSIONS,We.file_extension_for_logging(i.name))&&i.size%34===0||""===We.file_extension_for_logging(i.name)&&i.size%34===0&&i.size<=3400)?(i.status=B.FAILED,t={file:i,code:jn.APPLE_PACKAGE_ERROR,message:At("Can’t Upload"),tooltip_text:At('To upload a package file via the web, try zipping it first, or <a href="https://www.dropbox.com/help/6691" target="_blank">learn more</a>.'),response:"",responseHeaders:"",status:400},this.uploadError(this.PLU,t),!1):(r={dest:Pn.next().dest,t:Ie.read(Ae.JS_CSRF_COOKIE)},r[A.UID_PARAM_NAME]=pr.active_user,"url"!==(o=We.file_extension(i.name,e=!0))&&"webloc"!==o&&"website"!==o||(r.overwrite=0),jn.updatePostParams(r),this.PLU.start(),Pn.last_update_time=0,Pn.last_update_size=0,!0)},pause:function(){return jn.PLU.stop()},uploadProgress:function(e,t){return Pn.cancelled_files[t.id]?void 0:(document.fire(this.UPDATE_EVT,{file:t,percent_complete:t.loaded/t.size}),pe(document).trigger(this.UPDATE_EVT,{file:t,percent_complete:t.loaded/t.size}))},generateUploadId:function(){var e,t,n,r;for(e="",t=n=0;15>=n;t=++n)e+=String.fromCharCode(Math.floor(256*Math.random()));return r=i.encode(e),r=r.replace(/\+/g,"-"),r=r.replace(/\//g,"_"),r=r.replace(/\=*$/,"")},chunkUploaded:function(e,t,n){var i;return i=JSON.parse(n.response||""),this.updatePostParams({offset:i.offset})},prepareFileForUploading:function(){var e;return e=Pn.next(),this.updatePostParams({reported_total_size:e.size,dest:e.dest,t:Ie.read(Ae.JS_CSRF_COOKIE),upload_id:this.generateUploadId(),offset:0})},uploadSuccess:function(e,t,n){var i,r,o;try{o=JSON.parse(n.response)}catch(e){i=e,o=null}return"{'error': 'quota'}"===n.response?(document.fire(this.ERROR_EVT,{file:t,message:At("Quota exceeded"),tooltip_text:At("Your upload failed because you are over quota.")}),pe(document).trigger(this.ERROR_EVT,{file:t,message:At("Quota exceeded"),tooltip_text:At("Your upload failed because you are over quota.")})):"{'error': 'empty'}"===n.response?(document.fire(this.CANCEL_EVT,{file:t,message:At("Empty File")}),pe(document).trigger(this.CANCEL_EVT,{file:t,message:At("Empty File")})):"{'error': 'ignored'}"===n.response?(document.fire(this.CANCEL_EVT,{file:t,message:At("File Ignored")}),pe(document).trigger(this.CANCEL_EVT,{file:t,message:At("File Ignored")})):"complete"===(null!=o?o.status:void 0)?(document.fire(this.COMPLETE_EVT,{file:t}),pe(document).trigger(this.COMPLETE_EVT,{file:t})):(document.fire(this.ERROR_EVT,{file:t}),pe(document).trigger(this.ERROR_EVT,{file:t}))},uploadComplete:function(e,t){return document.fire(this.COMPLETE_EVT,{file:t}),pe(document).trigger(this.COMPLETE_EVT,{file:t})},uploadError:function(e,t){var n,i,r;return r=t.file.id,An.call(Pn.file_ids(),r)<0&&t.code!==jn.APPLE_PACKAGE_ERROR&&(document.fire(this.QUEUE_EVT,{files:[t.file]}),pe(document).trigger(this.QUEUE_EVT,{files:[t.file]})),i=function(){switch(t.code){case B.FILE_SIZE_ERROR:return At("File too large");default:return At("Upload Error")}}(),this.show_upload(),n={file:t.file,error_code:t.code,message:i},(null!=t?t.tooltip_text:void 0)&&(n.tooltip_text=t.tooltip_text),document.fire(this.ERROR_EVT,n),pe(document).trigger(this.ERROR_EVT,n)},grabURL:function(){var e;return e=$F("file-box"),/(^http|^https|^ftp):\/\//.match(e)&&($("url").value=e),!0},treeview_handler:function(e,t){var n;return Mt.fillVal(e,"dest-folder"),n=$("basic-uploader-url"),n&&(n.href=n.href.replace(/(\/upload)(.*)(\?basic=1)/,function(t,n,i,r){return n+Rt.urlquote(e)+r})),Pn.clear()},new_folder:function(){return ni.hide(),Xn.show(At("Create new folder..."),Mt.fromElm("create-folder"),{action:this.do_new_folder.bind(this,pr.active_user),wit_group:"new-folder-confirm"}),Rt.ie?void 0:pe("#first-treeview-link").trigger("click")},do_new_folder:function(e){var t,n;return Xn.vars.selected_path?(n=$F("entered-name"),t=Xn.vars.selected_path,new Ajax.DBRequest("/cmd/new"+Rt.urlquote(t)+"?to_path="+Rt.urlquote(n),{subject_user:e,onSuccess:function(e){return function(i){return e.treeview_handler(We.normalize(t)+"/"+n),ni.schedule_reset()}}(this),cleanUp:function(){}})):void b.error(At("Please select a parent folder."))},uploaderLoaded:function(){return $("upload-loading").hide(),$("choose-button").show(),"flash"===jn.PLU.runtime?(Oe.clone_position(pe("#flash-upload-container"),pe("#choose-button")),pe("#flash-upload-container > .moxie-shim")[0].style.top="0px",pe("#flash-upload-container > .moxie-shim")[0].style.left="0px",pe("#flash-upload-container > .moxie-shim")[0].style.width="100%",pe("#flash-upload-container > .moxie-shim")[0].style.height="100%"):(pe("#choose-button").click(function(e){return function(t){return pe("#"+e.PLU.id+"_html5").click()}}(this)),pe("#add-button").click(function(e){return function(e){return pe("#choose-button").click()}}(this)))}},Pn=Xe.FileQueue={init:function(){return Pn._listen()},_listen:function(){return document.observe(jn.QUEUE_EVT,Pn._file_queued.bind(this)),document.observe(jn.QUEUE_ERROR_EVT,Pn._file_queue_errored.bind(this)),document.observe(jn.UPDATE_EVT,Pn._file_updated.bind(this)),document.observe(jn.COMPLETE_EVT,Pn._file_completed.bind(this)),document.observe(jn.ERROR_EVT,Pn._file_errored.bind(this)),document.observe(jn.CANCEL_EVT,Pn._file_cancelled.bind(this))},_file_queued:function(e){var t,n,i,r,o;for(r=e.memo.files,o=[],n=0,i=r.length;i>n;n++)t=r[n],this.files[t.id]=t,Pn.uploading||this._start_uploading(),o.push(this.current_file=t);return o},_file_queue_errored:function(e){return this._file_queued(e),setTimeout(function(t){return function(){return t._file_errored(e)}}(this),250)},_file_updated:function(e){var t,n,i,r,o,s,a,_,l;return r=e.memo.file,s=e.memo.percent_complete,o=s*r.size,l=o+this.completed_size(),i=(new Date).getTime(),this.last_update_time&&(a=(i-this.last_update_time)/1e3,jn.PLU.total.bytesPerSec?this.average_bps=jn.PLU.total.bytesPerSec:(n=o-this.last_update_size,t=n/a,this.average_bps=((l-n)*this.average_bps+n*t)/l),_=(this.queue_size()-l)/this.average_bps,this.formatted_time=ie.format_time(_+this.num_left())),this.current_file=r,this.last_update_time=(new Date).getTime(),this.last_update_size=o},_file_completed:function(e){var t;return t=e.memo.file,this.completed_files[t.id]=!0,this._check_if_finished(t)},_file_errored:function(e){var t;return t=e.memo.file,this.errored_files[t.id]=!0,Mn.update_errors(),Fn.update_errors(),this._check_if_finished(t)},_file_cancelled:function(e){var t;return t=e.memo.file,this.cancelled_files[t.id]=!0,t.status===B.UPLOADING?(jn.PLU.stop(),jn.PLU.removeFile(t),jn.PLU.start()):jn.PLU.removeFile(t),this._check_if_finished(t)},_start_uploading:function(){var e;return this.uploading=jn.uploadNext(),this.uploading?(this.all_cancelled=!1,window.onbeforeunload=e=function(e){return function(){return At("Leaving this page will cancel your uploads.")}}(this)):void 0},finished:function(){return this._finished_uploading()},_check_if_finished:function(e){return this.empty()?this.uploading?this._finished_uploading():void 0:jn.uploadNext()},_finished_uploading:function(){var e,t,n,i;if(this.uploading=!1,this.num_files()?this.errors()?(Mn.errored(),Fn.errored()):(Mn.completed(),Fn.completed()):Mn.cancelled(),i=$("inline-upload-status").visible(),pr.select_fq_paths=[],pr.inside_dir){for(n in this.completed_files)t=this.files[n],e=We.normalize(t.dest),pr.select_fq_paths.push(e+"/"+t.name);pr.force_reload()}else pr.in_search_mode()&&Ji.force_reload();return i&&Fn.show(),Xn.onHide=null,window.onbeforeunload=null},empty:function(){return!this.num_left()},num_files:function(){return this.file_ids().length},num_non_cancelled_files:function(){return this.file_ids().length-this.cancels()},next:function(){return v(this.files).filter(function(e){return function(t){return!(e.cancelled_files[t.id]||e.errored_files[t.id]||e.completed_files[t.id])}}(this))[0]},cancels:function(){return v(this.cancelled_files).keys().length},errors:function(){return v(this.errored_files).keys().length},queue_size:function(){var e,t,n,i,r,o;for(o=0,r=this.file_ids(),n=0,i=r.length;i>n;n++)t=r[n],e=this.files[t],this.errored_files[t]||this.cancelled_files[t]||"undefined"==typeof e.size||(o+=e.size);return o},completed_size:function(){var e,t,n,i,r;for(r=0,i=v(this.completed_files).keys(),t=0,n=i.length;n>t;t++)e=i[t],"undefined"!=typeof this.files[e].size&&(r+=this.files[e].size);return r},file_ids:function(){return v(this.files).map(function(e){return function(e,t){return t}}(this))},totalPercentage:function(){return this.completed_size()/this.queue_size()},num_left:function(){return v(this.file_ids()).filter(function(e){return function(t){return!(e.cancelled_files[t]||e.errored_files[t]||e.completed_files[t])}}(this)).length},clear:function(){return this.files={},this.cancelled_files={},this.all_cancelled=!1,this.errored_files={},this.completed_files={},this.last_update_time=0,this.last_update_size=0,this.average_bps=0,this.formatted_time="",this.uploading=!1,window.onbeforeunload=null,"undefined"!=typeof Xn&&null!==Xn?Xn.onHide=null:void 0}},Pn.clear(),Bn=Xe.UploadFile={FILENAME_SNIPPET_LENGTH:15,DEST_SNIPPET_LENGTH:13,_tmpl:null,init:function(){return Bn._tmpl=Ke.tmpl("upload_list_item_tmpl"),Bn._listen()},_listen:function(){return document.observe(jn.QUEUE_EVT,Bn._file_queued),document.observe(jn.QUEUE_ERROR_EVT,Bn._file_queue_errored),document.observe(jn.UPDATE_EVT,Bn._file_updated),document.observe(jn.COMPLETE_EVT,Bn._file_completed),document.observe(jn.ERROR_EVT,Bn._file_errored),document.observe(jn.CANCEL_EVT,Bn._file_cancelled)},_file_queued:function(e){var t,n,i,r,o;for(r=e.memo.files,o=[],n=0,i=r.length;i>n;n++)t=r[n],o.push(function(e){var t,n,i,r,o,s,a,_;return t=e.dest,Nn.is_quicksend_dest(t)?void Nn.add_external_file(e):(s=y.format_bytes(e.size||0),n=Bn._tmpl({file:e,icon:We.file_icon(e.name),filename_snippet:l.em_snippet(e.name,Bn.FILENAME_SNIPPET_LENGTH),size:s,dest:t,dest_snippet:l.em_snippet(At("Dropbox")+t,Bn.DEST_SNIPPET_LENGTH,0),Sprite:G}),$("upload-files-list").__sert(n),r=$(e.id),o=Pn.num_files(),kn.show_share_button_in_file_uploader&&(i=pe("#"+e.id),i.find(".dest-col").hide()),a=$("upload-files-list"),6>=o?a.removeClassName("scroll"):a.addClassName("scroll"),a.scrollTop=a.scrollHeight,r.down(".dest").observe("click",function(){return pr.reload_fqpath(r.readAttribute("data-dest"),!0),Xn.hide()}),_=r.down(".status-col").down("a.small-x-button"),_.stopObserving("click"),_.observe("click",function(t){return document.fire(jn.CANCEL_EVT,{file:e}),pe(document).trigger(jn.CANCEL_EVT,{file:e})}),r.down(".upload-progress-bar").setStyle({width:"0"}))}(t));return o},_file_queue_errored:function(e){return Bn._file_queued(e),Bn._file_errored(e)},_file_updated:function(e){var t,n,i,r;return t=e.memo.file,n=$(t.id),1===Pn.num_files()&&(r=At("%(time_left)s left").format({time_left:Pn.formatted_time}),n.down(".time-col").__date(r)),i=parseInt(t.percent,10)+"%","100%"===i&&(n.down(".time-col").__date(),n.down(".status-col").__date(new Element("img",{src:"/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"}))),n.down(".upload-progress-bar").setStyle({width:i})},_file_completed:function(e){var t,n,i;return t=e.memo.file,t.completed=!0,i=$(t.id),i.addClassName("complete"),kn.show_share_button_in_file_uploader&&!Nn.is_quicksend_dest(t.dest)&&(n=pe("#"+t.id),n.find(".share-link").show(),ze.SharedFolderActivityLogger.log("web","share_button_in_uploader_impression",pr.active_user,{}),n.on("click",function(e){var n,i;return Xn.hide(),ze.SharedFolderActivityLogger.log("web","share_button_in_uploader_click",pr.active_user,{}),n=t.dest+"/"+t.name,i="file_uploader",kn.shmodel(n,i)})),setTimeout(function(){return i.down(".status-col").__date(G.make("web","s_check"))},0),i.down(".upload-progress-bar").setStyle({width:"100%"})},_file_errored:function(e){var t,n;return t=e.memo.file,n=$(t.id),n?Bn._actual_file_errored(e):setTimeout(function(t){return function(){return Bn._actual_file_errored(e)}}(this),0)},_actual_file_errored:function(e){var t,n,i,r,o;return i=e.memo.file,r=$(i.id),r.addClassName("error"),r.down(".dest-col").hide(),r.down(".time-col").__date(),r.down(".status-col").__date(Element("img",{src:"/static/images/nosync-vfl18cuTS.png",srcset:"/static/images/nosync@2x.png 2x"})),r.down(".upload-progress-bar").setStyle({width:"100%"}),Nn.is_quicksend_dest(i.dest)?void 0:(n=e.memo.message||At("Upload Error"),t=void 0,e.memo.tooltip_text?t=e.memo.tooltip_text:(t=At('Something went wrong with the advanced uploader. If the problem persists, please use the <a id="basic_link">basic uploader</a> to upload via the website.'),pe(document).on("click","a#basic_link",function(){return Vn.show_basic_upload(),!1})),r.down(".error-msg").__date(n),o=r.down(".error-details"),o.observe("mouseover",function(){return ti.show(o,t)}),r.down(".error-col").show())},_file_cancelled:function(e){var t,n;return t=e.memo.file,n=$(t.id),n.addClassName("cancelled"),n.down(".dest-col").__date(At(e.memo.message||"Canceled")),n.down(".time-col").__date(),n.down(".status-col").__date(Element("img",{src:"/static/images/cancelsync-vflGFIEUK.png",srcset:"/static/images/cancelsync@2x.png 2x"})),n.down(".upload-progress-bar").setStyle({width:"100%"})}},Mn=Xe.BulkUpload={init:function(){return this.elem=$("bulk-upload-status"),Mn._listen()},_listen:function(){return document.observe(jn.QUEUE_EVT,Mn._file_queued.bind(this)),document.observe(jn.UPDATE_EVT,Mn._file_updated.bind(this))},_file_queued:function(e){var t;return t=new Element("a",{class:"small-x-button"}),t.observe("click",function(){var e,t,n,i,r;for(Pn.all_cancelled=!0,e=Pn.file_ids().slice(0),r=[],n=0,i=e.length;i>n;n++)t=e[n],Pn.completed_files[t]||Pn.errored_files[t]?r.push(void 0):(document.fire(jn.CANCEL_EVT,{file:Pn.files[t]}),r.push(pe(document).trigger(jn.CANCEL_EVT,{file:Pn.files[t]})));return r}),this.elem.down(".status").__date(t)},_file_updated:function(e){var t,n,i;return Pn.num_files()>1&&(this.elem.removeClassName("error"),this.elem.removeClassName("complete"),this.elem.removeClassName("cancelled"),t=Tt("%d file","%d files",Pn.num_non_cancelled_files()).format(Pn.num_non_cancelled_files()),this.elem.down(".num-files").__date(t),n=At("- %(size)s").format({size:y.format_bytes(jn.PLU.total.size)}),this.elem.down(".size").__date(n),Pn.formatted_time&&(i=At("%(time_left)s left").format({time_left:Pn.formatted_time}),this.elem.down(".time-left").__date(i)),this.elem.down(".upload-progress-bar").style.width=Math.min(100,(100*Pn.totalPercentage()||0).toFixed(2))+"%",this.elem.show(),"flash"===jn.PLU.runtime)?Oe.clone_position(pe("#flash-upload-container"),pe("#add-button")):void 0},update_errors:function(){var e;return e=Tt("- %d error","- %d errors",Pn.errors()).format(Pn.errors()),$("bulk-upload-status").down(".num-errors").__date(e)},completed:function(){var e,t;return $("hide-button").hide(),$("done-button").show(),Pn.num_files()>1?(this.elem.addClassName("complete"),e=Tt("Uploaded %d file","Uploaded %d files",Pn.num_non_cancelled_files()).format(Pn.num_non_cancelled_files()),this.elem.down(".num-files").__date(e),t=At("- %(size)s").format({size:y.format_bytes(Pn.completed_size())}),this.elem.down(".size").__date(t),this.elem.down(".num-errors").__date(),this.elem.down(".time-left").__date(),this.elem.down(".status").__date(G.make("web","s_check")),this.elem.down(".upload-progress-bar").style.width="100%"):void 0},errored:function(){var e;return $("hide-button").hide(),$("done-button").show(),this.completed(),e=Tt("- %d error","- %d errors",Pn.errors()).format(Pn.errors()),this.elem.down(".num-errors").__date(e)},cancelled:function(){return $("hide-button").hide(),$("done-button").show(),Pn.num_files()>1?(this.elem.addClassName("cancelled"),this.elem.down(".num-files").__date(At("All uploads canceled")),this.elem.down(".size").__date(),this.elem.down(".num-errors").__date(),this.elem.down(".time-left").__date(),this.elem.down(".status").__date(Element("img",{src:"/static/images/cancelsync-vflGFIEUK.png",srcset:"/static/images/cancelsync@2x.png 2x"})),this.elem.down(".upload-progress-bar").style.width="100%"):void 0}},Fn=Xe.InlineUploadStatus={FILENAME_SNIPPET_LENGTH:30,init:function(){return this._listen()},_listen:function(){return document.observe(jn.QUEUE_EVT,Fn._file_queued.bind(this)),document.observe(jn.UPDATE_EVT,Fn._file_updated.bind(this))},_file_queued:function(e){var t,n;return t=$("inline-upload-status"),t.removeClassName("error"),t.removeClassName("complete"),t.down(".icon").__date(G.make("web","s_sync")),t.down(".file-desc").__date(At("Starting upload...")),t.down(".num-errors").__date(),n=Tt("%d file","%d files",Pn.num_left()).format(Pn.num_left()),t.down(".view-details").__date(n),t.down(".status").__date(),t.down(".inline-upload-progress").style.width="0%"},_file_updated:function(e){var t,n,i,r,o,s;return t=$("inline-upload-status"),n=e.memo.file,t.down(".icon").__date(G.make("web","s_sync")),i=At("Uploading %(filename)s").format({filename:l.em_snippet(n.name,this.FILENAME_SNIPPET_LENGTH)}),t.down(".file-desc").__date(i),Pn.num_left()>1?(s=Tt("%d file left","%d files left",Pn.num_left()-1).format(Pn.num_left()-1),t.down(".view-details").__date(s)):t.down(".view-details").__date(At("View details")),Pn.formatted_time&&(o=At("%(time_left)s left").format({time_left:Pn.formatted_time}),t.down(".status").__date(o)),r=n.percent+"%",t.down(".inline-upload-progress").style.width=r},update_errors:function(){var e,t;return e=$("inline-upload-status"),t=Tt("- %d error","- %d errors",Pn.errors()).format(Pn.errors()),e.down(".num-errors").__date(t)},add_x_button:function(){var e,t;return t=new Element("a",{class:"small-x-button"}),t.observe("click",function(){return Fn.hide(),jn.reset()}),e=$("inline-upload-status"),e.down(".status").__date(t)},completed:function(){var e,t;return e=$("inline-upload-status"),e.addClassName("complete"),e.removeClassName("error"),e.down(".icon").__date(G.make("web","s_check")),t=Pn.num_files()>1?At("Uploaded %(num_files)d files").format({num_files:Pn.num_non_cancelled_files()}):At("Uploaded %(filename)s").format({filename:l.em_snippet(Pn.current_file.name,this.FILENAME_SNIPPET_LENGTH)}),e.down(".file-desc").__date(t),e.down(".num-errors").__date(),e.down(".view-details").__date(At("View details")),this.add_x_button(),e.down(".inline-upload-progress").style.width="100%"},errored:function(){var e,t,n,i;return e=$("inline-upload-status"),e.addClassName("error"),e.removeClassName("complete"),e.down(".icon").__date(Element("img",{src:"/static/images/nosync-vfl18cuTS.png",srcset:"/static/images/nosync@2x.png 2x"})),t=void 0,Pn.num_files()>1?(t=At("Uploaded %(num_completed)d of %(num_files)d files").format({num_completed:Pn.num_non_cancelled_files()-Pn.errors(),num_files:Pn.num_non_cancelled_files()}),e.down(".file-desc").__date(t),i=Tt("- %d error","- %d errors",Pn.errors()).format(Pn.errors()),e.down(".num-errors").__date(i)):(null!=Pn.current_file&&(n=l.em_snippet(Pn.current_file.name,this.FILENAME_SNIPPET_LENGTH)),t=n?At("Unable to upload %(filename)s").format({filename:n}):At("Unable to upload file"),e.down(".file-desc").__date(t),e.down(".num-errors").__date()),e.down(".view-details").__date(At("View details")),this.add_x_button(),e.down(".inline-upload-progress").style.width="100%"},show:function(e){return $("inline-upload-status").show()},hide:function(){return $("inline-upload-status").hide()}},zn=Xe.UploadPrep={_drop_indicators:!1,_drop_dest_folder:null,file_counter:0,current_req:null,_notifications_cleared:!1,supported:function(){return Prototype.BrowserFeatures.DB_CORS},enabled:function(){return zn.supported()&&pr.inside_dir&&!(pr.in_search_mode()&&Ji.fulltext_search_enabled)},browse_indicators_enabled:function(){var e,t,n,i;if(!zn.enabled())return!1;for(i=["modal-overlay"],t=0,n=i.length;n>t;t++)if(e=i[t],$(e).visible())return!1;return!0},modal_indicators_enabled:function(){var e;return zn.enabled()&&pe("#modal #upload-modal-dropzone").length&&pe("#modal").is(":visible")&&(null!=(e=pe("#modal").offset())?e.left:void 0)>0},_show_border_drop_indicators:function(){return $$(".external-drop-indicator").each(function(e){return pe(e).css("opacity",0).fadeTo(500,.6)})},_hide_border_drop_indicators:function(){return $$(".external-drop-indicator").invoke("hide")},show_drop_indicators:function(e){var t;if(!zn._drop_indicators){if(zn.modal_indicators_enabled())t=$("upload-modal-dropzone"),Oe.clone_position(pe(t),pe("#modal"),{setLeft:!1,setTop:!1}),pe(t).fadeIn(500),zn._show_border_drop_indicators();else{if(!zn.browse_indicators_enabled())return;dr._add_drop_indicators(e)}return $("drag-status").removeClassName("active"),zn._drop_indicators=!0}},hide_drop_indicators:function(){return zn._drop_indicators&&(zn._hide_border_drop_indicators(),dr._remove_drop_indicators(),zn._notifications_cleared||b.clear(),$("upload-modal-dropzone").hide(),$("drag-status").addClassName("active"),setTimeout(function(){return zn._drop_indicators=!1,zn._drop_dest_folder=null,zn._notifications_cleared=!1},500)),zn._notifications_cleared=!0},folder_dragover:function(e){var t;return zn.browse_indicators_enabled()&&zn._drop_indicators?(Un.disabled?null==zn._drop_dest_folder&&(t=At("You can't upload files because you're out of space."),b.error(t,60),zn._notifications_cleared=!1,zn._show_border_drop_indicators()):e!==zn._drop_dest_folder&&(e===pr.containing_fq_path()?(pr.inside_read_only_shared_folder?(t=At("You don't have permission to add to this folder."),b.error(t,60)):(t=At("Drop your file to %(upload_action)s",{comment:"upload_action is a phrase like 'upload to folder 'XYZ'"}).format({upload_action:Vn.upload_plain_snippet()}),b.success(new Ke(t),60),zn._show_border_drop_indicators()),zn._notifications_cleared=!1):(b.clear(),zn._hide_border_drop_indicators())),zn._drop_dest_folder=e):void 0},supports_recursive_upload:function(e){var t;return window.File&&window.FileReader&&window.FileList&&window.Blob&&(null!=e&&null!=(t=e[0])?t.webkitGetAsEntry:void 0)},upload:function(e,t,n){var i,r,o,s;if(null==n&&(n=null),!pr.inside_read_only_shared_folder){if(Un.disabled)return s=At("You can't upload files because you're out of space."),b.error(s);if(zn.supports_recursive_upload(n))return zn._recursive_upload(e,n);for(r=0,o=t.length;o>r;r++)i=t[r],i.dest=e;return zn._upload(t,n)}},_recursive_upload:function(e,t){var n,i,r,o,s,a,_,l,u,d,c,h,f;for(u=[],f=[],i=function(t,n){return t.dest=e+We.parent_dir(n.fullPath),u.push(t)},c=0,h=t.length;h>c;c++)d=t[c],a=d.webkitGetAsEntry(),null!==a&&(a.isDirectory?Nn.is_quicksend_dest(e)?b.error(At("Please select files instead of folders.")):f.push(a):i(d.getAsFile(),a));return s=0,l=0,r=function(e,t){var n;return n=At('The drag and drop uploader can\'t upload %(name)s because it contains Unicode characters. Use the <a id="use-advanced-uploader"> advanced uploader</a> instead.').format({name:t.name}),b.error(new Ke(n)),pe("#use-advanced-uploader").on("click",function(e){return e.preventDefault(),Vn.show_upload()})},n=3e3,_=0,(o=function(){for(var e;f.length;)a=f.pop(),null!==a&&(a.isDirectory?!function(e){var t;return t=e.createReader(),s+=1,t.readEntries(function(e){var n,i,r;if(0!==e.length){for(i=0,r=e.length;r>i;i++)n=e[i],f.push(n);return t.readEntries(arguments.callee)}return s-=1},function(t){return s-=1,r(t,e)})}(a):(l+=1,e=function(e){return function(t){return i(t,e),l-=1}},a.file(e(a),function(e){return l-=1,r(e,a)})));return u.length>n&&!_?(_=1,void b.error(At("The Dropbox website can't upload more than %(max_files)s files.").format({max_files:n}))):s||l?o.defer():u.length?zn._upload(u):void 0})()},_upload:function(e,t){var n,i;return null==t&&(t=null),t&&(n=this._parse_upload_items(t)),i=function(){var t,i,r,o,s;for(s=[],i=0,r=e.length;r>i;i++)t=e[i],navigator.userAgent.toLowerCase().indexOf("chrome")>-1&&(null!=n&&null!=(o=n[t.name])?o.isDirectory:void 0)&&(t.is_directory=!0),t.id=B.guid(),s.push(jn.PLU.addFile(t));return s},$("modal").visible()?i():(Vn.show_upload(i),Xn.hide(null,!0))},_parse_upload_items:function(e){var t,n,i,r;for(t={},i=0,r=e.length;r>i;i++)n=e[i],n.getAsEntry?n=n.getAsEntry():n.webkitGetAsEntry&&(n=n.webkitGetAsEntry()),t[n.name]=n;return t}},Un=Xe.OverQuotaUploads={disabled:!1,init:function(e){return this.disabled=e,this.disabled?pe("body").addClass("uploads-disabled"):void 0}};var Vn;Vn=INLINE_JS.FileOps=Xe.FileOps={NOTIFICATION_SNIPPET_LEN:40,_find_app_by_id:function(e){var t,n,i,r;for(r=Xn.vars.apps,n=0,i=r.length;i>n;n++)if(t=r[n],t.app_id===e)return t;return null},create_album_from_folder:function(e,t){return g.WebProgressRequest({url:"/collection_from_folder",data:{path:e,album_name:t},subject_user:H.get_viewer().photos_user,progress_text:At("Creating album..."),success:function(e){return e=JSON.parse(e),He.redirect(e.url)}})},dir_handler:function(e,t){var n,i;return"string"==typeof t&&(t=$(t)),n=$$(".treeview .highlight")[0],n&&n.removeClassName("highlight"),i=t.up("div"),i.addClassName("highlight"),Xn.selected_div=i,Xn.shown()&&t.blur(),document.fire("db:dir_click",{path:e}),Xn.vars.selected_path=e},show_folder_pick:function(e,t,n,i,r){var o;return Mt.fillVal(We.filename(t).escapeHTML(),"folder-pick-file"),ni.move("copy-move-treeview","folder-pick-treeview",{user:pr.active_user}),o=At(r?"Move":"Copy"),Mt.fillVal(o,"folder-pick-action-text"),Xn.show(e,$("folder-pick"),{fq_path:t,action:n,folder:i}),pe("#first-treeview-link").trigger("click")},show_bulk_folder_pick:function(e,t,n,i){var r,o,s;return s=Wi.profile_files(n),o=Wi.profile_summary(s),Mt.fillVal(o,"bulk-folder-pick-file"),ni.move("copy-move-treeview","bulk-folder-pick-treeview",{user:pr.active_user}),r=At("move"===t?"Move":"copy"===t?"Copy":"Restore"),Mt.fillVal(r,"bulk-folder-pick-action-text"),Xn.show(e,$("bulk-folder-pick"),{files:n,action:i}),pe("#first-treeview-link").trigger("click")},show_copy:function(e,t){var n;return n=At(t?"Copy folder to...":"Copy file to..."),ni.set_params({disable_read_only:!0}),Vn.show_folder_pick(n,e,Vn.do_copy,t,!1)},show_copy_bulk:function(e){var t;return t=Tt("Copy %(item_count)s item to...","Copy %(item_count)s items to...",e.length).format({item_count:e.length}),ni.set_params({disable_read_only:!0}),Vn.show_bulk_folder_pick(t,"copy",e,Vn.do_bulk_copy)},show_compress_bulk:function(e,t){return ni.set_params({disable_read_only:!0}),xt.show({title_text:Tt("Compress file?","Compress files?",t.length),body_html:Tt("Do you want to compress <strong>%(filename)s</strong>?<br/>This might take a while.","Do you want to compress %(file_count)s files?<br/>This might take a while.",t.length).format({file_count:t.length,filename:v.escape(t.first().filename)}),confirm_text:At("Compress"),cancel_text:At("Cancel"),confirm_callback:function(){return Vn.do_bulk_compress(e,t)}})},do_bulk_compress:function(e,t){var n;return b.clear(),n=t.pluck("fq_path"),g.WebProgressRequest({url:"/cmd/compress",data:{files:n},subject_user:e,progress_text:At("Compressing..."),success:function(e){var n,i,r;return r=JSON.parse(e),n=r.compressed_files,bt(n.length>0,"Must have at least 1 compressed file"),i=v.escape(We.filename(n.first().fq_path)),b.success(Tt("Compressed successfully to %(filename)s","Compressed %(file_count)s files successfully.",n.length).format({file_count:n.length,filename:i})),pe(document).trigger(a.COMPRESS,{original_files:t,compressed_files:n})}})},show_move_bulk:function(e){var t;return t=Tt("Move %(item_count)s item to...","Move %(item_count)s items to...",e.length).format({item_count:e.length}),ni.set_params({disable_read_only:!0}),Vn.show_bulk_folder_pick(t,"move",e,Vn.do_bulk_move)},show_move:function(e,t){var n;return n=At(t?"Move folder to...":"Move file to..."),ni.set_params({disable_read_only:!0}),Vn.show_folder_pick(n,e,Vn.do_move,t,!0)},show_delete:function(e,t,n,i,r,o){var s,a;return null==r&&(r=null),null==o&&(o=!1),o?r?(bt(e.is_team,"Found a nested shared folder not on a business account"),a=H.get_viewer().team_name,s=At("Are you sure you want to remove the shared folder ‘<strong>%(items)s</strong>’ from your Dropbox? People outside %(team_name)s with whom you’ve shared this folder will still have access unless you remove them from the <a href='/work%(file_path)s?shareoptions=1&share_subfolder=0'>member list</a>.").format({items:We.filename(t).escapeHTML(),team_name:a.escapeHTML(),file_path:t.escapeHTML()})):s=At("Are you sure you want to remove the shared folder ‘<strong>%(items)s</strong>’ from your Dropbox? This shared folder will stay shared with other members and you can re-add it later.").format({items:We.filename(t).escapeHTML()}):s=r?At("Are you sure you want to delete <strong>%(items)s</strong> from the shared folder ‘%(sf_name)s’?").format({items:We.filename(t).escapeHTML(),sf_name:r.escapeHTML()}):At("Are you sure you want to delete <strong>%(items)s</strong> from your Dropbox?").format({items:We.filename(t).escapeHTML()}),xt.show({title_text:At(n?"Delete folder?":"Delete file?"),body_html:'<div class="simple-modal-word-wrap-content">'+s+"</div>",confirm_text:At("Delete"),cancel_text:At("Cancel"),confirm_callback:function(){return i?Vn.do_nonbrowse_delete(e,[t]):Vn.do_delete(e,t)}})},show_bulk_delete:function(e,t,n){var i;return null==n&&(n=null),i=n?Tt("Are you sure you want to delete %(item_count)s item from the shared folder ‘%(sf_name)s’?","Are you sure you want to delete %(item_count)s items from the shared folder ‘%(sf_name)s’?",t.length).format({item_count:t.length,sf_name:n.escapeHTML()}):Tt("Are you sure you want to delete %(item_count)s item from your Dropbox?","Are you sure you want to delete %(item_count)s items from your Dropbox?",t.length).format({item_count:t.length}),xt.show({title_text:Tt("Delete %(item_count)s item?","Delete %(item_count)s items?",t.length).format({item_count:t.length}),body_html:i,confirm_text:At("Delete"),cancel_text:At("Cancel"),confirm_callback:function(){return Vn.do_bulk_delete(e,t)}})},show_purge:function(e,t){return xt.show({title_text:At(t?"Permanently delete folder?":"Permanently delete file?"),body_html:At("Are you sure you want to permanently delete <strong>%(items)s</strong> from your Dropbox?").format({items:We.filename(e).escapeHTML()}),confirm_text:At("Permanently delete"),cancel_text:At("Cancel"),confirm_callback:function(){return Vn.do_purge(pr.find_file(e))}})},show_bulk_purge:function(e){return xt.show({title_text:Tt("Permanently delete %d item?","Permanently delete %d items?",e.length).format(e.length),body_html:Tt("Are you sure you want to permanently delete %(item_count)s item from your Dropbox?","Are you sure you want to permanently delete %(item_count)s items from your Dropbox?",e.length).format({item_count:e.length}),confirm_text:At("Permanently delete"),cancel_text:At("Cancel"),confirm_callback:function(){return Vn.do_bulk_purge(e)}})},show_bulk_restore:function(e,t){return xt.show({title_text:Tt("Restore %d item...","Restore %d items...",e.length).format(e.length),body_html:Tt("Are you sure you want to restore %(item_count)s item?","Are you sure you want to restore %(item_count)s items?",e.length).format({item_count:e.length}),confirm_text:At("Restore"),cancel_text:At("Cancel"),confirm_callback:function(){return Vn.do_bulk_restore(e)}})},wrap_strong:function(e){
return""===pr.containing_fq_path()?e.escapeHTML():"<strong>"+e.escapeHTML()+"</strong>"},upload_snippet:function(e){var t,n;return null==e&&(e=1e3),H.get_viewer().is_paired&&pr.active_user.is_team&&(n=l.em_snippet(H.get_viewer().team_name,e).escapeHTML()),""===pr.containing_fq_path()?H.get_viewer().is_paired?pr.active_user.is_team?At(" upload to your %(team_name)s Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({team_name:n}):At(" upload to your personal Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}):At(" upload to your Dropbox"):(t=l.em_snippet(We.filename(pr.containing_fq_path()),e).escapeHTML(),H.get_viewer().is_paired?pr.active_user.is_team?At(" upload to the folder <strong>%(folder)s</strong> in your %(team_name)s Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({folder:t,team_name:n}):At(" upload to the folder <strong>%(folder)s</strong> in your personal Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({folder:t}):At(" upload to the folder <strong>%(folder)s</strong>",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({folder:t}))},upload_short_snippet:function(e){var t,n;return null==e&&(e=1e3),(n=pr.containing_fq_path())?(t=l.em_snippet(We.filename(n),e),At("Upload to '%(folder_name)s'",{comment:"Upload a file to some folder on the website"}).format({folder_name:t})):At("Upload to Dropbox",{comment:"Upload a file to the root Dropbox folder"})},upload_plain_snippet:function(e){return null==e&&(e=1e3),this.upload_snippet(e).replace("<strong>","'").replace("</strong>","'")},show_upload:function(e,t,n){var i,r,o,s,a,_;if(i=pr.containing_fq_path(),Un.disabled)return Mt.fillVal(this.wrap_strong(We.filename(i)),"disabled-upload-foldername"),a=this.upload_short_snippet(20),Xn.show(a,$("disabled-upload-modal"),{},!1),void ze.ProEventsLogger.log("view_upload_modal_already_oq");if(!ue.versionAtLeast(9)&&"flash"===jn.runtimes)return Vn.show_basic_upload(),void $("enhanced-upload-toggle").hide();for(Mt.fillVal(this.upload_snippet(20),"upload-foldername"),Mt.fillVal(this.upload_plain_snippet(10),"dnd-upload-foldername"),$("upload-desc").visible()&&zn.supported()&&($("upload-desc").hide(),$("dnd-upload-desc").show()),a=this.upload_short_snippet(20),Xn.show(a,Mt.fromElm("advanced-upload-modal"),{wit_group:"advanced-uploader"},!1,!1,Pn.num_files()),_=[$("modal").down(".basic-link-start"),$("modal").down(".basic-link-running")],r=0,o=_.length;o>r;r++)s=_[r],null!=s&&s.observe("click",function(){return Vn.show_basic_upload(),!1});return Pn.num_files()?jn.set_dest(We.normalize(i)):jn.init(We.normalize(i),!0,e,n),Fn.hide()},show_basic_upload:function(){return Mt.fillVal(this.upload_snippet(20),"basic-upload-foldername"),Xn.show(this.upload_short_snippet(20),$("basic-upload-modal"),{},!1),$("modal").down(".enhanced-link").observe("click",function(){return Vn.show_upload(),!1}),jn.set_dest(We.normalize(pr.containing_fq_path())),jn.init_basic()},show_undelete:function(e){var t,n,i;return Mt.fillVal(e.filename.escapeHTML(),"undelete_filename"),t=G.make("web",e.icon,{}),t.addClassName("link-img"),t.style.backgroundColor="transparent",n=Vn.build_revisions_uri(e.fq_path,pr.active_user,{undelete:1}),$$(".undelete-icon").invoke("update",t),$$(".undelete-other-versions")[0].href=n,$$(".undelete-link")[0].href=n,i=At("Restore file?"),Xn.show(i,$("undelete-modal"),{file:e})},do_undelete:function(e){var t,n;return t=Xn.vars.file,n=At("Restored '%(file_name)s'").format({file_name:t.filename}),new Ajax.DBRequest("/cmd/restore",{parameters:{files:[t.fq_path]},subject_user:pr.active_user,job:!0,html_in_error_msg:!0,progress_text:At("Restoring..."),onSuccess:function(e){return Xn.hide(),b.success(n),document.fire(a.RESTORE,{files:[t]})}}),!1},do_copy:function(e,t){var n;return e=e||Xn.vars.fq_path,t=t||Xn.vars.selected_path,n=pr.find_file(e),bt(n,"Trying to copy a file we couldn't find."),Vn.do_bulk_copy([n],t)},do_bulk_copy:function(e,t){var n,i,r,o,s;if(pr.pre_action_selection=_r.get_selected_fq_paths(),e=e||Xn.vars.files,bt(e.length>0,"Tried to copy 0 files"),"undefined"==typeof t){if("undefined"==typeof Xn.vars.selected_path)return void b.error(At("You need to select a destination for the file."));t=Xn.vars.selected_path}for(t=We.normalize(t),r=0,o=0,s=e.length;s>o;o++)if(n=e[o],n.dir&&0===(t+"/").indexOf(n.fq_path+"/"))return void b.error(At("You cannot copy a folder into itself."));return i=e.pluck("fq_path"),b.clear(),new Ajax.DBRequest("/cmd/copy",{parameters:{files:i,to_path:t},subject_user:pr.active_user,job:!0,html_in_error_msg:!0,progress_text:At("Copying..."),onSuccess:function(r){var o,s,_,u,d,c,h,f;for(o=r.responseText.evalJSON().changesets,s=i.length,c=l.em_snippet(We.filename(t),Vn.NOTIFICATION_SNIPPET_LEN).escapeHTML(),h=Tt("Copied %(count)d item to '<a id=\"reload-link\">%(location)s</a>'.","Copied %(count)d items to '<a id=\"reload-link\">%(location)s</a>'.",s),h=h.format({count:s,location:c}),X.notifyWithUndo(new Ke(h),o,Vn.do_rollback),_=[],f=r.responseText.evalJSON().new_browse_files,u=0,d=f.length;d>u;u++)n=f[u],_.push(n.fq_path);return pr.select_fq_paths=_,$("reload-link").observe("click",function(){return Zi.set_path_url(null,t)}),ni.schedule_reset(),document.fire(a.COPY,{files:e,to_fq_path:t})}})},bulk_move_error:function(e,t){var n,i,r,o,s,a,_,l,u;if(r=pr.find_file(t),o=Wi.profile_files(e),l=void 0,a=void 0,u=void 0,r?(a=r.dir,l=r.fq_path,u=r.target_ns||r.ns_id):pr.inside_dir&&pr.can_get_details_from_fq_path(t)?(i=pr.details_from_fq_path(t),a=!0,l=i.fq_path,u=i.ns_id):(a=!0,l=t,u=void 0),s=e.pluck("fq_path").collect(We.normalize),-1!==s.indexOf(We.normalize(l)))return At("You cannot copy a folder into itself.");if(n=_=function(e){var t;return t=We.parent_dir(e.fq_path),t===(l||"/")},e.every(n))return At("Those files already exist in that folder.");if(!a)return At("You cannot put files inside one another.");if(o.target_namespaces>0&&u&&u!==c.root_ns&&r){if(o.sandboxes>0){if(r.is_sandbox())return At("You're not allowed to put an application folder inside another application folder.");if(r.is_shared_folder())return At("You're not allowed to put an application folder inside a shared folder.")}else if(o.shared_folders>0){if(r.is_sandbox())return At("You're not allowed to put a shared folder inside an application folder.");if(r.can_hold_shared_folders&&0===o.team_shared_folders)return;if(r.is_shared_folder())return At("You're not allowed to put a shared folder inside another shared folder.")}return At("You're not allowed to nest special folders.")}return pr.public_folder_enabled&&"/Public"===l&&o.target_namespaces>0?At("You're not allowed to move shared folders to your Public folder."):o.public_folder>0?At("You're not allowed to move your Public folder."):o.deleted>0?At("Moving deleted folders or files isn’t allowed."):void 0},do_move:function(e,t){var n;return e=e||Xn.vars.fq_path,t=t||Xn.vars.selected_path,n=pr.find_file(e),bt(n,"Trying to move a file we couldn't find."),Vn.do_bulk_move([n],t)},do_nonbrowse_move:function(e,t,n){var i,r;return i=pe.Deferred(),r="/cmd/move",new Ajax.DBRequest(r,{parameters:{files:t,to_path:n},subject_user:e,job:!0,html_in_error_msg:!0,progress_text:At("Moving…"),onSuccess:i.resolve,onFailure:i.reject}),i.promise()},do_bulk_move:function(e,t){var n,i,r,o;return pr.pre_action_selection=_r.get_selected_fq_paths(),(e=e||Xn.vars.files)?(bt(e.length>0,"Tried to move 0 files"),o=t||Xn.vars.selected_path||"",o=We.normalize(o),(n=Vn.bulk_move_error(e,o))?void b.error(n):(i=e.pluck("fq_path"),b.clear(),r=function(t){var n,r,s,_;return n=t.responseText.evalJSON().changesets,r=i.length,s=l.em_snippet(We.filename(o),Vn.NOTIFICATION_SNIPPET_LEN).escapeHTML(),_=Tt('Moved %(count)d item to ‘<a id="reload-link">%(location)s</a>’.','Moved %(count)d items to ‘<a id="reload-link">%(location)s</a>’.',r),_=_.format({count:r,location:s}),X.notifyWithUndo(new Ke(_),n,Vn.do_rollback),$("reload-link").observe("click",function(){return Zi.set_path_url(null,o)}),ni.schedule_reset(),document.fire(a.MOVE,{files:e,to_fq_path:o})},Vn.do_nonbrowse_move(pr.active_user.id,i,o).then(r))):void 0},do_rollback:function(e){return new Ajax.DBRequest("/cmd/rollback",{parameters:{ns_to_cs:JSON.stringify(e)},subject_user:pr.active_user,job:!0,html_in_error_msg:!0,progress_text:At("Undoing..."),onSuccess:function(e){var t;return t=At("Undo complete."),b.success(t),bt(pr.pre_action_selection instanceof Array,"Expected a selection from before the action to be undone"),pr.in_search_mode()?(Ji.select_fq_paths=pr.pre_action_selection,Ji.force_reload()):(pr.select_fq_paths=pr.pre_action_selection,pr.force_reload()),pr.pre_action_selection=!1}})},do_bulk_delete:function(e,t){var n,i;return pr.pre_action_selection=_r.get_selected_fq_paths(),t=t||Xn.vars.files,bt(t.length>0,"Tried to delete 0 files"),i=function(){var e,i,r;for(r=[],e=0,i=t.length;i>e;e++)n=t[e],r.push(n.fq_path);return r}(),b.clear(),new Ajax.DBRequest("/cmd/delete",{parameters:{files:i},subject_user:e,job:!0,html_in_error_msg:!0,progress_text:At("Deleting..."),onSuccess:function(e){var n,r;return r=e.responseText.evalJSON(),n=Tt("Deleted %d item.","Deleted %d items.",i.length).format(i.length),X.notifyWithUndo(n,r.changesets,Vn.do_rollback),ni.schedule_reset(),document.fire(a.DELETE,{files:t})}})},do_delete:function(e,t){var n;return n=pr.find_file(t||Xn.vars.fq_path),bt(n,"Trying to delete a file we couldn't find."),Vn.do_bulk_delete(e,[n])},do_nonbrowse_delete:function(e,t){var n,i;return n=pe.Deferred(),i=Tt("Deleted %(file_count)s item","Deleted %(file_count)s items",t.length),i=i.format({file_count:t.length}),b.success(i),new Ajax.DBRequest("/cmd/delete",{parameters:{files:t},subject_user:e,html_in_error_msg:!0,onSuccess:function(e){return document.fire(a.DELETE,{fq_paths:t}),n.resolve(e)},onFailure:function(e){return b.error(At("Failed to perform the delete. Please try again later.")),n.reject(e)}}),n.promise()},do_nonbrowse_rename:function(e,t,n){var i;return i=pe.Deferred(),new Ajax.DBRequest("/cmd/rename"+encodeURIComponent(t),{parameters:{to_path:n},subject_user:e,html_in_error_msg:!0,onSuccess:function(e){return i.resolve(e)},onFailure:function(e){return i.reject(e)}}),i.promise()},do_purge:function(e){return bt(e,"Trying to purge a file we couldn't find."),Vn.do_bulk_purge([e])},do_bulk_purge:function(e){var t,n;return bt(e.length>0,"Tried to purge 0 files"),t=e.collect(function(e){return e.fq_path}),n=Tt("Permanently deleted %d item","Permanently deleted %d items",t.length).format(t.length),new Ajax.DBRequest("/cmd/purge",{parameters:{files:t},subject_user:pr.active_user,job:!0,html_in_error_msg:!0,progress_text:At("Deleting..."),onSuccess:function(t){return b.success(n),ni.schedule_reset(),document.fire(a.PURGE,{files:e})}})},do_bulk_restore:function(e){var t,n,i;return e=e||Xn.vars.files,i=Xn.vars.user,bt(e.length>0,"Tried to restore 0 files"),t=e.collect(function(e){return e.fq_path}),n=Tt("Restored %d item","Restored %d items",t.length,{comment:"meaning, successfully restored x files and folders"}).format(t.length),new Ajax.DBRequest("/cmd/restore",{parameters:{files:t},subject_user:pr.active_user,job:!0,html_in_error_msg:!0,progress_text:At("Restoring..."),onSuccess:function(t){return b.success(n),ni.schedule_reset(),document.fire(a.RESTORE,{files:e})}})},do_folder_restore:function(e,t){var n;return n=function(t){var n,i;return n=At("Restoring '%(folder_name)s'").format({folder_name:We.filename(e)}),i=t.responseText,i.startsWith("err:")?(i=i.substring(4),pe("#async-result").html(i),b.error(new Ke(i),60)):(n=At("Restored '%(folder_name)s'").format({folder_name:We.filename(e)}),pe("#status-of-files").text(At("Restored files")),b.success(n,60)),pe("#restore-done-heading").text(n),pe(".pre-restore").hide(),pe(".post-restore").show()},new Ajax.DBRequest("/cmd/restore",{parameters:{files:[e]},job:!0,html_in_error_msg:!0,progress_text:At("Restoring..."),onSuccess:n,onFailure:n,subject_user:t})},do_bulk_download:function(e){var t,n,i,r;for(t=new Element("form",{action:s({scheme:"https",authority:he.BLOCK_CLUSTER,path:"/zip_batch"}).updateQuery(A.UID_PARAM_NAME,pr.active_user.id).toString(),method:"post"}),i=0,r=e.length;r>i;i++)n=e[i],Hn.add_vars(t,{files:n.fq_path});return Hn.add_vars(t,{parent_path:pr.block_hash_param||"/",w:pr.block_hash}),$(document.body).__sert(t),t.submit()},do_bulk_photo_view:function(e,t){var n,i,r,o;return o={},o[A.UID_PARAM_NAME]=e.id,n=String(s({scheme:"https",authority:he.WEBSERVER,path:"/app/view_in_timeline",query:o})),i=new Element("form",{action:n,method:"post"}),Hn.add_vars(i,{t:Ie.read(Ae.JS_CSRF_COOKIE),ns_ids:JSON.stringify(function(){var e,n,i;for(i=[],e=0,n=t.length;n>e;e++)r=t[e],i.push(r.ns_id);return i}()),ns_paths:JSON.stringify(function(){var e,n,i;for(i=[],e=0,n=t.length;n>e;e++)r=t[e],i.push(r.ns_path);return i}())}),$(document.body).__sert(i),i.submit()},build_revisions_uri:function(e,t,n){return null==n&&(n={}),n[A.UID_PARAM_NAME]=String(t),ee.getGandalfRule("revision_history_web")?s({path:"/history"+e}).updateQuery(n):s({path:"/revisions"+e}).updateQuery(n)}};var Hn,ln={}.hasOwnProperty;Hn=__CONDITIONAL_JS__.Forms=INLINE_JS.Forms=Xe.Forms={submitOnlyOnce:function(){var e;return e=Hn.submitted!==!0,Hn.submitted=!0,e},disable:function(e){return e?setTimeout(function(){return e.disabled=!0},0):void 0},enable:function(e){return e?setTimeout(function(){return e.disabled=!1},0):void 0},_button_on_change:function(e,t,n,i){var r,o,s,a;return r=pe(e),r[t](),null==i&&(i=r.closest("form")),o=i[0],null==this.next_id&&(this.next_id=0),s=this.next_id++,null==this.initial_vars&&(this.initial_vars={}),this.initial_vars[s]=this.collect_form_vars(o),r.attr("data-id",s),i.data("button-id",s),a=function(e){return function(){var i,a,_;r[t](),a=e.collect_form_vars(o),Object.keys(a).length!==Object.keys(e.initial_vars[s]).length&&r[n](),_=[];for(i in a)a[i]!==e.initial_vars[s][i]?_.push(r[n]()):_.push(void 0);return _}}(this),i.change(a),i.find("input").filter(":text").on("input",a),i.find("textarea").on("input",a)},show_button_on_change:function(e,t){return this._button_on_change(e,"hide","show",t)},hide_button_on_change:function(e,t){return this._button_on_change(e,"show","hide",t)},add_vars:function(e,t){var n,i,r;e=$(e),r=[];for(i in t)ln.call(t,i)&&(n=new Element("input",{type:"hidden",name:i}),n.setValue(t[i]),r.push(e.__sert(n)));return r},collect_form_vars:function(e,t){var n,i,r,o,s,a;for(null==t&&(t=!1),e=e||$(document.body),i=e.select("input").concat(e.select("textarea")).concat(e.select("select")),s={},r=0,o=i.length;o>r;r++)n=i[r],n.name&&"t"!==n.name&&!pe(n).attr("data-ignore-var")&&(a=n.getValue(),(a||t)&&("string"!=typeof a&&(a=a.join(",")),null!=s[n.name]?"string"==typeof s[n.name]?s[n.name]=[s[n.name],a]:s[n.name].push(a):s[n.name]=a));return s},add_loading:function(e,t){var n;return e?(e=$(e),n=new Element("img",{src:"/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"}),n.addClassName("text-img ajax_submit_loading"),"after"===t?pe(e).after(n):pe(e).before(n)):void 0},remove_loading:function(e){return pe(".ajax_submit_loading").remove()},ui_form_submit:function(e,t){return t=t||e.action,e.ajax_submitted?!1:(e.ajax_submitted=!0,new h(pe(e),t,{data:Hn.collect_form_vars(e),success:function(t){return function(n,i,r){var o,s;return s=pe(e).data("button-id"),null!=s?(o=pe(e).find("*[type='submit'][data-id='"+s+"']"),t.initial_vars[s]=t.collect_form_vars(e),o.hide()):void 0}}(this),complete:function(t){return function(t,n){return e.ajax_submitted=!1}}(this)}))},ajax_submit_obj:function(e){var t,n,i,r,o,s,a,_,l,u,d;return r=e.form,d=e.url,u=e.success_callback,i=e.fail_callback,t=e.button,a=e.more_vars,_=e.position,s=e.job,o=e.html_response,n=e.complete_callback,l=e.progress_text,Hn.ajax_submit(r,d,u,i,t,a,_,s,o,n,l)},ajax_submit:function(e,t,n,i,r,o,s,a,_,l,u){var d,c,h,f,p;if(null==_&&(_=!1),e.ajax_submitted)return!1;for(e.ajax_submitted=!0,p=pe(e).find(".suggestion-input"),c=0,h=p.length;h>c;c++)d=p[c],Zn.blank(d.identify())();return r&&Hn.add_loading(r,s),f=Hn.collect_form_vars(e),o&&Object.extend(f,o),new Ajax.DBRequest(t||e.action,{noAutonotify:!0,parameters:f,job:a,progress_text:u,evalJSON:!1,onSuccess:function(e){return Hn.remove_loading(),n&&"function"==typeof n?n(e):void 0},onFailure:function(t){var n,r;return t&&(0===t.responseText.indexOf("err:")?(n=t.responseText.substr(4),0===n.indexOf("{")?(r=n.evalJSON(!0),Hn.fill_errors(e,r)):(_&&(n=new Ke(n)),b.error(n))):b.error(),Hn.remove_loading(),i&&"function"==typeof i)?i(t):void 0},onComplete:function(t){var n,i,r;for(r=e.select(".suggestion-input"),n=0,i=r.length;i>n;n++)d=r[n],Zn.blur_elm(d);return e.ajax_submitted=!1,l&&"function"==typeof l?l(t):void 0}}),!1},clear_errors:function(e){return e=e||$(document.body),this.hide_errors(e),e.select(".error-removable").invoke("remove")},fill_errors:function(e,t){var n,i,r,o,s,a;t=t||{},e=e||$(document.body),Hn.clear_errors(e);for(s in t)ln.call(t,s)&&(i=e.down("[data-error-field-name='"+s+"']")||e.down("[name='"+s+"']"),i&&(n=new Element("br",{class:"error-removable"}),r=new Element("span",{class:"error-message error-removable"}),o=t[s],bt(o.message_html||o.message_text,"Error message must have a message_html or message_text property"),o.message_html?r.update(o.message_html):r.__date(o.message_text),pe(i).before(r),pe(i).before(n),a=pe(e).find("input[name='"+s+"'], textarea[name='"+s+"']"),a&&a.addClass("input-error")));return this.show_errors(e)},value:function(e){var t,n,i,r,o;for(i=$$('input[name="'+e+'"]'),o=null,t=0,r=i.length;r>t;t++)n=i[t],o=$(n).getValue()||o;return o},postRequest:function(e,t,n){var i;return null==t&&(t={}),null==n&&(n={}),bt(null!=e,"postRequest missing action"),t.t=Ie.read(Ae.JS_CSRF_COOKIE),i=new Element("form",{action:e,method:"POST"}),n.target&&(i.target=n.target),document.body.appendChild(i),Hn.add_vars(i,t),i.submit()},hide_errors:function(e){var t,n,i,r,o;for(t=this.get_errors(e),r=[],n=0,i=t.length;i>n;n++)o=t[n],o.down("span.error-message")?r.push(o.hide()):r.push(void 0);return r},show_errors:function(e){var t,n,i,r;for(t=this.get_errors(e),n=0,i=t.length;i>n;n++)r=t[n],r.down("span.error-message")&&r.show();return pe(".sick-input").find("label").css("top","")},get_errors:function(e){var t,n;return n=".error-bubble, .error-plain-text",t=e?e.select(n):$$(n)}},pe(function(){return Hn.show_errors()});var Yn;Yn=Xe.ActAsBlock={elm_list:["margin-left","margin-right","padding-left","padding-right","border-left-width","border-right-width"],parent_list:["padding-left","padding-right","border-left-width","border-right-width"],register:function(e,t){var n,i,r,o;for(null==t&&(t=document.body),r=$(t).getElementsByClassName("act_as_block"),o=[],n=0,i=r.length;i>n;n++)e=r[n],o.push(this.resize(e));return o},resize:function(e){var t,n,i,r;return e=$(e),n=e.up(),t=Rt.sumStyles(e,this.elm_list),i=Rt.sumStyles(n,this.parent_list),e.style.width="1px",r=n.getWidth()-t-i,r>0?e.style.width=r+"px":void 0}};var Wn;Wn=Xe.BrowseStyleRows={register_all:function(){var e,t,n,i;for(n=$$(".bs-row"),e=0,t=n.length;t>e;e++)i=n[e],this.register(i);return Event.observe(document,"click",this.kill_current.bind(this)),pe(document).on("dropdown-opened",this.kill_current.bind(this))},register:function(e){var t;return e=$(e),e.db_observe("mouseover",this.mouseover.bind(this)),e.db_observe("mouseout",this.mouseout.bind(this)),t=e.down(".action-button"),t?t.db_observe("click",this.click.bind(this)):void 0},mouseover:function(e,t){return t.hasClassName("no-hover")?void 0:t.addClassName("hover")},mouseout:function(e,t){return t.removeClassName("hover")},click:function(e,t){var n,i,r;if("A"!==e.target.tagName)return i=t.up(".bs-row"),Event.stop(e),i.hasClassName("selected")?void this.kill_current(!1):(pe(document).trigger("dropdown-opened"),this.kill_current(!1),r=$(e.target),r.match(".bs-actions-list *")||i.addClassName("selected"),n=r.hasClassName("bs-row")?r:r.up(".bs-row"),n.style.zIndex=9)},kill_current:function(e){var t,n,i,r,o;for(r=$$(".bs-row.selected"),o=[],n=0,i=r.length;i>n;n++)t=r[n],t.removeClassName("selected"),o.push(t.style.zIndex="");return o}};var Kn;Kn=Xe.Bubble={make:function(e,t,n,i,r){var o,s,a,_,l,u,d,c,h,f,p,m,v,g,w,b,y,k,E,x;return null==t&&(t="left"),r=null!=r?r:{},["left","right"].contains(t)?(n=n||"middle",bt(["top","middle","bottom"].contains(n),"expected tail position ['top', 'middle', 'bottom'], got "+n)):["bottom","top"].contains(t)?(n=n||"center",bt(["left","center","right"].contains(n),"expected tail position ['left', 'center', 'right'], got "+n)):["none"].contains(t)||bt(!1,"unexpected tail side, got "+t),m=new Element("table"),"titled"===r.style?(m.addClassName("bluebubble"),v="bluebubble"):(m.addClassName("bubble"),v="bubble"),i&&(m.style.width=i+"px"),w=new Element("tbody"),k=new Element("tr"),b=new Element("td"),b.addClassName("tl"),p=new Element("td"),p.addClassName("t"),"titled"===r.style&&i&&(p.style.width=i-42+"px"),y=new Element("td"),y.addClassName("tr"),"top"===t&&(g=new Element("img",{src:"/static/images/"+v+"_arrow_top.png"}),g.addClassName("tarrow"),"titled"===r.style?(g.addClassName("arrow-"+n),s=new Element("div"),s.addClassName("arrow-container"),i&&(s.style.width=i-42+"px"),s.__sert(g),p.__sert(s)):(p.style.textAlign=n,p.__sert(g))),k.__sert(b),k.__sert(p),k.__sert(y),w.__sert(k),E=new Element("tr"),c=new Element("td"),c.addClassName("l"),"left"===t&&(o="titled"===r.style?new Element("img",{src:"/static/images/bluebubble_arrow_left-vfl8zzy_-.png"}):new Element("img",{src:"/static/images/bubble_arrow-vfl8m7tk-.png"}),o.addClassName("arrow"),c.__sert(o),c.vAlign=n),d=new Element("td"),d.addClassName("c"),d.update(e),h=new Element("td"),h.addClassName("r"),"right"===t&&(f=new Element("img",{src:"/static/images/bubble_arrow_right-vflmW3_2s.png"}),f.addClassName("rarrow"),h.__sert(f),h.vAlign=n),E.__sert(c),E.__sert(d),E.__sert(h),w.__sert(E),x=new Element("tr"),l=new Element("td"),l.addClassName("bl"),a=new Element("td"),a.addClassName("b"),"bottom"===t&&(_=new Element("img",{src:"/static/images/"+v+"_arrow_bottom.png"}),_.addClassName("barrow"),"titled"===r.style?(_.addClassName("arrow-"+n),s=new Element("div"),s.addClassName("arrow-container"),i&&(s.style.width=i-42+"px"),s.__sert(_),a.__sert(s)):(a.style.textAlign=n,a.__sert(_))),u=new Element("td"),u.addClassName("br"),x.__sert(l),x.__sert(a),x.__sert(u),w.__sert(x),m.__sert(w),m}};var Gn;Gn=INLINE_JS.FreshDropdown=Xe.FreshDropdown={show:function(e,t,n,i){var r,o,s,a;return null==i&&(i=!1),pe(document).trigger("dropdownOpened",[1]),r=pe(t),n||(n=r[0].offsetHeight+10),this.hide_all(),o=pe(e).show(),a=o[0].offsetWidth,s=r[0].offsetWidth,Oe.clone_position(o,r,{setHeight:!1,setWidth:!1,offsetLeft:-1*(a-s)+22,offsetTop:n}),i&&o.width(a),r.addClass("pressed"),function(e){return function(){return document.observe("click",Gn.hide_all)}}(this).defer()},hide_all:function(e){var t,n;return n=pe(".freshdropdown-menu"),t=0,n.each(function(){return pe(this).is(":visible")?t+=1:void 0}),n.hide(),pe(document).trigger("dropdownClosed",[t]),$$(".freshdropdown-button").invoke("removeClassName","pressed"),document.stopObserving("click",Gn.hide_all)}};var Jn;Jn=Xe.JumpWatcher={inverval:null,last_hash:null,last_page_offset:0,check:function(){return window.location.href.endsWith("#")&&0===window.pageYOffset&&0!==Jn.last_page_offset?this.report():(this.last_page_offset=window.pageYOffset,this.last_hash=s.parse(window.location.href).fragment)},report:function(){return clearInterval(Jn.interval),yt("Hash jump detected, last hash = "+this.last_hash+". You may have an onclick handler that isn't firing, or you are not preventing the default action (eg. by returning false in your handler)")}};var Xn;Xn=__CONDITIONAL_JS__.Modal=INLINE_JS.Modal=Xe.Modal={KEY_SCOPE:"modal",width:640,vertical_offset:90,show:function(e,t,n,i,r,o,s,a,_){var l,u,d,c,h,f;return null==n&&(n=!1),null==i&&(i=!1),null==r&&(r=!1),null==o&&(o=!1),null==s&&(s=""),null==a&&(a=!0),null==_&&(_=!1),Xn.shown()&&Xn._cleanup(),r=r||this.width,u="#modal-content .error-message, #modal-content .error-removable, #modal-content .error-bubble",$$(u).invoke("hide"),Pn.uploading&&!o?(alert(At("You can't do this while uploading.")),!1):(bt(t,"Missing modal content!"),h=this.vars._prev_scope,this.vars=n||{},this.vars._prev_scope=h,$("modal").setStyle({width:r+"px",margin:"0 0 0 "+Math.floor(-r/2).toString()+"px"}),this.vars.extra_class="",s&&($("modal").addClassName(s),this.vars.extra_class=s),o||(Pn.num_files()&&(jn.reset(),Pn.clear()),c=Rt.childElement($("modal-content"),0),c&&c!==t&&$("grave-yard").__sert(c),l=new Element("div"),l.update(t),$("modal-content").__sert(l),t.show&&t.show(),Element.show("modal")),pe("#modal-overlay").off("click"),a?pe("#modal-overlay").on("click",function(e){return Xn.hide(null,!1,!0),e.preventDefault(),e.stopPropagation()}):pe("#modal-overlay").on("click",function(e){return e.preventDefault(),e.stopPropagation()}),this.fix_position(),$("modal-overlay").show(),$("modal-behind").setStyle({width:r+20+"px",margin:"0 0 0 "+Math.floor(-r/2-10).toString()+"px"}),pe("#modal-behind").css("opacity",.2),$("modal-behind").show(),i?$("modal-content").select("#"+i.id).first().focus():Rt.ie||(d=$("modal").down("input[type=submit]")||$("modal").down("input[type=button]"),d&&d.focus()),this.track_id||this.track_resizes(),e?(Rt.isElm(e)?pe("#modal-title").html(e):pe("#modal-title").text(e),pe("#modal-title").show(),f=pe("#modal-title").text()):pe("#modal-title").hide(),Yn.register(!1,"modal"),this.keydownHandler=this.keydown.bind(this),document.observe("keydown",this.keydownHandler),$("modal-content").style.height="auto",z.getScope()!==this.KEY_SCOPE&&(this.vars._prev_scope=z.getScope()),z.setScope(this.KEY_SCOPE),this.prevent_hide_if_loading=_,pe("#modal").find("input").filter(":visible:first").focus(),this.in_viewport()&&(this.scroll_locked=!0,Oe.scroll_lock_document()),pe(document).trigger("modalOpened",[1]),!1)},in_viewport:function(){var e,t,n,i,r;return e=pe("#modal"),t=e.height(),r=e.width(),n=Oe.viewport_dimensions(),i=Oe.viewport_offset(e),i.left>0&&i.top>0&&i.left+r<n.width&&i.top+t<n.height},fix_position:function(e){var t,n;return n=document.viewport.getScrollOffsets().top+this.vertical_offset,t=parseInt($("modal").getStyle("height"),10),t+this.vertical_offset<document.viewport.getHeight()?($("modal").setStyle({position:"fixed",top:this.vertical_offset+"px"}),$("modal-behind").setStyle({position:"fixed",height:t+20+"px",top:this.vertical_offset-10+"px"})):($("modal").setStyle({position:"absolute",top:n+"px"}),$("modal-behind").setStyle({position:"absolute",height:t+20+"px",top:n-10+"px"}))},keydown:function(e){var t,n,i,r;if(i=e.keyCode||e.which||e.charCode,(27===i||8===i&&!Oe.focus_in_input())&&(e.preventDefault(),this.hide(null,!1,!0)),9===i&&!Oe.focus_in_input()){for(n=$("modal").down("input[type=text], input[type=email]"),r=$("modal").down(".modal-tabs"),t=r;t&&t.next();)if(t=t.next(),t.visible()){n=t.down("input[type=text], input[type=email]");break}if(n)return e.preventDefault(),n.focus()}},shown:function(){return $("modal").visible()},hide:function(e,t,n){return e&&Event.stop(e),this.should_prevent_hide()?!1:(this.prevent_hide_if_loading=!1,this.onHide?void this.onHide(n):(this.onHide=null,Element.hide("modal-behind"),Element.hide("modal-overlay"),$("modal").removeClassName(this.vars.extra_class),t||Pn.num_files()?($("modal").style.marginLeft="-10000000px",Pn.uploading&&Fn.show()):Element.hide("modal"),Xn._cleanup(),this.track_id&&(clearInterval(this.track_id),this.track_id=!1),document.stopObserving("keydown",this.keydownHandler),document.activeElement&&-1===[document,window,document.body].indexOf(document.activeElement)&&$(document.activeElement).blur(),z.setScope(this.vars._prev_scope)))},_cleanup:function(){return pe(document).trigger("modalClosed",[1]),this.scroll_locked?Oe.scroll_unlock_document():void 0},should_prevent_hide:function(){return this.prevent_hide_if_loading&&v.some(pe("#modal form"),function(e){return e.ajax_submitted})},track_resizes:function(){return this.track_id=setInterval(this.on_resize.bind(this),150)},on_resize:function(){var e;return e=$("modal").getHeight(),this.old_height!==e||$("modal-behind").getHeight()<e?(this.old_height=e,this.fix_position()):void 0},vars:{}};var Qn;Qn=Xe.SickInput={init:function(){var e,t,n,i,r;for(i=$$(".sick-input"),r=[],t=0,n=i.length;n>t;t++)e=i[t],e.hasClassName("sickified")||r.push(this._create(e));return r},_create:function(e){var t,n,i;if(null!=e)return n=e.identify(),i=e.down("input")||e.down("textarea")||e.down("select"),i.observe("focus",function(){return e.addClassName("focused")}),i.observe("blur",function(){return e.removeClassName("focused")}),t=function(){return e.hasClassName("populated")&&""===i.getValue()?e.removeClassName("populated"):e.hasClassName("populated")||""===i.getValue()||e.addClassName("populated"),n in Qn._handler_map?Qn._handler_map[n]():void 0},Hn.show_errors(),t(),setInterval(t,100)},_handler_map:{},add_interval_handler:function(e,t){var n;return n=e.identify(),this._handler_map[n]=t},remove_interval_handler:function(e,t){var n;return n=e.identify(),this._handler_map[n]===t?delete this._handler_map[n]:void 0}};var Zn;Zn=Xe.SuggestionInput={register:function(e){var t;return e=$(e),t=e.up("form"),Zn.defaulted(e)||""===e.getValue()?e.setValue(e.title):e.addClassName("suggestion-input-unfaded"),e.observe("blur",this.blur.bind(this)),e.observe("focus",this.focus.bind(this)),e.observe("db:value_change",this.focus.bind(this)),t?(e.id||(e.id="r_elm_id_"+Math.random().toString()),t.observe("submit",Zn.blank(e.id).bind(this))):void 0},register_all:function(){var e,t,n,i,r;for(i=$$(".suggestion-input"),r=[],e=0,n=i.length;n>e;e++)t=i[e],r.push(this.register(t));return r},blank:function(e){return function(t){return function(){var n;return(n=$(e))&&t.defaulted(n)?n.setValue(""):void 0}}(this)},defaulted:function(e){return e=$(e),e.getValue()===e.title},do_blank:function(e){return this.blank(e)()},clear:function(e){var t;return t={target:e},this.focus(t)},focus:function(e){var t;return(t=$(e.target))&&this.defaulted(t)?(t.addClassName("suggestion-input-unfaded"),t.setValue("")):void 0},blur_elm:function(e){return""===e.getValue()&&(e.removeClassName("suggestion-input-unfaded"),e.setValue(e.title)),e.blur()},blur:function(e){var t;return(t=$(e.target))?this.blur_elm(t):void 0},reset:function(e){var t;return(t=$(e))?(t.removeClassName("suggestion-input-unfaded"),t.setValue(t.title),t.defaulted=!0,t.blur()):void 0},setValue:function(e,t){var n;return(n=$(e))?(n.addClassName("suggestion-input-unfaded"),n.setValue(t),n.defaulted=!1):void 0}};var ei;ei=Xe.TitleBubble=function(){var e,t,n,i,r,o,s;return s=0,e=0,o=function(e){return s=e},r=function(i){var r,o,a,_,l,u,d,c,h,f,p;return o=pe(i.currentTarget),p=o.attr("title"),(null!=p?p.length:void 0)&&(o.attr("data-title",p),o.removeAttr("title")),l=parseInt(o.data("title-delay")),_="title-bubble-"+e++,o.data("bubble-id",_),r=pe("<div/>",{id:_,class:"title_bubble_container"}),l||(r.css({opacity:0}),r.addClass("has-transition")),o.hasClass("white")&&r.addClass("white"),o.hasClass("black")&&r.addClass("black"),r.text(o.attr("data-title")),c=o.attr("data-title-html"),r.html(c),f="yes"!==o.attr("data-title-hide-tail"),f&&(a=pe("<div/>",{class:"tail"}),r.append(a)),pe(document.body).append(r),d=n(o[0],r[0]),u=t(d,r[0],o[0]),Oe.clone_position(r,o,{setWidth:!1,setHeight:!1,offsetTop:u.top-s,offsetLeft:u.left}),r.addClass("position-"+d),f&&Oe.clone_position(a,o,{setWidth:!1,setHeight:!1,setTop:!1,offsetLeft:u.left+u.tail_offset_left+pe(r).outerWidth()/2}),h=function(){var e;if(r.data("pending-delay")&&o.data("bubble-id")===_)return e=parseInt(o.data("title-fade-time"))||400,r.fadeIn(e)},l?(r.hide(),r.data("pending-delay",!0),setTimeout(h,l)):r.css({opacity:""})},n=function(e,t){var n,i,r;if(e=$(e),r=e.getAttribute("data-title-position"),n=document.viewport.getDimensions(),
i=e.viewportOffset(),"above"!==r&&"below"!==r&&"right"!==r&&"left"!==r&&(r="above"),"left"===r){if(i.left<t.width)return"right"}else if("right"===r){if(n.width-(i.left+e.getWidth())<t.width)return"left"}else if("below"===r){if(n.height-(i.top+e.getHeight())<t.height)return"above"}else if("above"===r&&i.top<t.height)return"below";return r},t=function(e,t,n){var i,r,o,s,a,_,l,u,d,c;return t=$(t),n=$(n),o=document.viewport.getDimensions(),i=t.getDimensions(),s=n.viewportOffset(),r=6,a=0,_=0,d=0,c=0,"below"!==e&&"above"!==e||(_="below"===e?n.getHeight()+r:-1*i.height-r,l=n.getWidth()/2-i.width/2,s.left+l+i.width>o.width?(a=o.width-s.left-i.width,d=l-a-5):(a=l,d=-5)),"left"!==e&&"right"!==e||(a="right"===e?n.getWidth()+r:-1*i.width-r,u=n.getHeight()/2-i.height/2,s.top+u+i.height>o.height?(_=o.height-s.top-i.height,c=u-_-5):(_=u,c=-5)),{left:a,top:_,tail_offset_left:d,tail_offset_top:c}},i=function(e){var t,n,i;return n=pe(null!=e?e.currentTarget:void 0),t=pe("#"+n.data("bubble-id")),t.data("pending-delay")?(t.removeData("pending-delay"),i=parseInt(n.data("title-fade-time"))||400,t.fadeOut(i,function(){return t.remove()})):t.remove()},{init:function(){return pe(document).on("mouseenter",".title_bubble",r),pe(document).on("mouseleave",".title_bubble",i).on("mouseup",".title_bubble",i),pe(document).on("mouseenter",".title_bubble_sticky",r),pe(document).on("mouseleave",".title_bubble_sticky",i)},set_vertical_space:o,hide_all:function(){return pe(".title_bubble_container").remove()}}}();var ti;ti=INLINE_JS.Tooltip=Xe.Tooltip={attach:function(e,t,n,i){var r,o;return null==i&&(i={}),e=$(e),n=n?$(n):null,r=Kn.make(t,e.tail_position,i.tail_position,i.width,i),r.setStyle({display:"none",position:"absolute"}),$("floaters").__sert(r),e.match("#modal-content *")||e.match(".db-modal-content *")?r.style.zIndex="13001":r.style.zIndex="","right"===e.tail_position&&(o=Rt.ie?32:12,r.style.marginLeft=-(r.getWidth()+e.getWidth()+o)+"px"),e.tooltip=r,e.out_target=!!n,e.observe("mouseout",this.mouseout("target",e)),e.observe("mouseover",this.mouseover("target",e)),e.out_trigger=!n,n&&(n.observe("mouseout",this.mouseout("trigger",e)),n.observe("mouseover",this.mouseover("trigger",e))),e.out_tooltip=!0,r.observe("mouseout",this.mouseout("tooltip",e)),r.observe("mouseover",this.mouseover("tooltip",e))},update:function(e,t){return e.tooltip?$(e.tooltip).update(t):void 0},mouseover:function(e,t){return function(){return t["out_"+e]=!1}},mouseout:function(e,t){return function(){return t["out_"+e]=!0,ti.hide_if_out.defer(t)}},show_by:function(e){var t,n;return t=pe(e.tooltip),e=pe(e),t.show(),n=Math.floor(t[0].offsetHeight/2),Oe.clone_position(t,e,{setWidth:!1,setHeight:!1,offsetTop:Math.floor(e[0].offsetHeight/2)-n,offsetLeft:e[0].offsetWidth+1})},hide_if_out:function(e){var t;if(e.out_target&&e.out_trigger&&e.out_tooltip)return t=$(e.tooltip),t.hide()},show:function(e,t,n,i,r){return null==i&&(i="left"),e=$(e),e.tail_position||(e.tail_position=i),n=n?$(n):null,e.tooltip||this.attach(e,t,n,r),this.show_by(e)}};var ni;ni=INLINE_JS.TreeView=Xe.TreeView={tv:{},loaded:!1,user:null,role_icon:"",set_params:function(e){return this.ajax_params=e},init:function(e,t,n){var i;return null==n&&(n="treeview"),this.tv[n]={},i=this.tv[n],i.autohide=null===t?!0:t,i.handler=e,i.viewdiv=$(n),i.hidefunc=this.hide.bindAsEventListener(this),this.ajax_params={},document.observe(Yi.ADD,function(e){return function(t){return e.schedule_reset()}}(this)),document.observe(Yi.REMOVE,function(e){return function(t){return e.schedule_reset()}}(this)),document.observe(Yi.MOVE,function(e){return function(t){return e.schedule_reset()}}(this))},schedule_reset:function(){return this.loaded=!1},reset:function(e){var t,n,i,r,o,s,a;return t={url:"/ajax_subtreeview",data:pe.extend({},this.ajax_params),success:function(t){return function(n){var i,r;i=[];for(r in t.tv)t.tv.hasOwnProperty(r)?(t.tv[r].viewdiv.down(".treeview-folders").update(n),e&&e.onSuccess?i.push(e.onSuccess(n)):i.push(void 0)):i.push(void 0);return i}}(this)},(null!=e?e.user:void 0)?(e.user.id!==(null!=(n=this.user)?n.id:void 0)&&(o=pe("<p />",{id:"treeview-loading"}),s=pe("<img />",{src:"/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"}),o.append(s),a=" "+At("Loading your folders"),o.append(a),pe("#dest-treeview .treeview-folders").html(o),this.user=e.user),t.subject_user=e.user,r=H.get_role_title(e.user),i=H.get_viewer().is_paired?e.user.is_team?"s_briefcase":"s_house":"dropbox",r||(r=At("Dropbox")),pe("#first-treeview-link span").text(r),G.replace(pe("#root-img")[0],"web",this.role_icon,i),this.role_icon=i):pe("#first-treeview-link span").text(At("Dropbox")),g.AuthenticatedRequest(t)},toggle:function(e,t){var n;return Event.stop(e),n=this.tv[t||"treeview"],n.shown?(n.shown=!1,this.hide(e,t)):(n.shown=!0,this.show(e.target,t)),!1},hide:function(e,t){var n;return n=this.tv[t||"treeview"],e&&$(e.target).descendantOf(n.viewdiv)?void 0:(n.viewdiv.hide(),Event.stopObserving(window,"click",n.hidefunc),n.shown=!1)},show:function(e,t){var n,i;return i=this.tv[t||"treeview"],e=$(e),e.blur(),n=e.cumulativeOffset(),i.viewdiv.setStyle({top:n.top+e.getHeight()+"px",left:n.left-4+"px"}),i.viewdiv.show(),Event.observe(window,"click",i.hidefunc)},toggleNode:function(e){var t;return e=$(e),t=e.down("img"),t.className.match("bullet_plus")?G.replace(t,"web","bullet_plus","bullet_minus"):G.replace(t,"web","bullet_minus","bullet_plus"),e.up().next("div").toggle(),e.blur(),!1},toggleNodeAjax:function(e,t,n){var i,r;return e.fetched_children?this.toggleNode(e):(e=$(e),i=e.down("img"),r=G._get(i),i.src="/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif",g.AuthenticatedRequest({url:"/ajax_subtreeview"+t,data:pe.extend({},this.ajax_params),subject_user:n,success:function(t){return function(n){var o;return o=new Element("div",{style:"display: none;"}).update(n),e.up().__sert({after:o}),e.fetched_children=!0,G._set(i,r),t.toggleNode(e)}}(this),complete:function(){return/loading/.match(i.src)?G._set(i,r):void 0}}),!1)},handle:function(e,t){var n,i;return n=$H(this.tv).keys(),(i=$(t).ancestors().find(function(e){return n.include(e.id)}))?(i=this.tv[i.id],pe(document).trigger("db:treeview_selected",[e]),i.handler&&i.handler(e,t),i.autohide&&this.hide(i.id),!1):void 0},move:function(e,t,n){var i;return i=$(e),this.loaded?n&&n.onSuccess&&n.onSuccess():this.reset({onSuccess:function(i){return function(){return i.loaded=1,i.move(e,t,n)}}(this),user:null!=n?n.user:void 0}),bt(i,"Couldn't find tree_id"),bt($(t),"Couldn't find location_id"),$(t).appendChild(i),i.show()}};var ii;ii=Xe.ULSelectMenu=function(){var e,t,n,i,r,o,s,a,_,l,u;return e=function(e){return e.removeClassName("shown")},u=function(e){return e.toggleClassName("shown")},s=function(){return this.removeClassName("hover")},o=function(){return this.addClassName("hover")},a=function(e,t){var n,i,r,o;for(r=[],n=0,i=t.length;i>n;n++)o=t[n],r.push(e.insert(o));return r},i=function(e,t,n){return a(e,n),e.firstChild!==t?e.__sert({top:t}):void 0},_=function(e,t){var n;return n="selected",pe(e).find("."+n).removeClass(n),pe(t).addClass(n)},l=function(e,t){var n,i,r,o,s;for(o=e.select("li"),s=[],i=0,r=o.length;r>i;i++)n=o[i],n.getAttribute("data-value")===t?s.push(_(e,n)):s.push(void 0);return s},r=function(t,n,r){return function(o){return t.hasClassName("selected")?(i(n,t,r),u(n)):(_(n,t),n.fire("db:change",t.getAttribute("data-value")),e(n))}},t=function(t){var n,i,a,_,l,u,d,c;if(_=t.select("li"),bt(_.length,"Empty list of options "+t.identify()),l=void 0,1===_.length)t.addClassName("one");else{for(i=0,a=_.length;a>i;i++)n=_[i],d=n.getAttribute("data-value"),bt(d,n.identify()+" missing data value"),n.observe("click",r(n,t,_)),n.observe("mouseenter",o),n.observe("mouseleave",s),n.hasClassName("selected")&&(l=n);$(document.body).observe("click",function(n){return $(n.target).up(".ul_select_menu")!==t?e(t):void 0})}return l||(l=_[0]),l.addClassName("selected"),c=new Element("span"),u=l.getDimensions(),c.setStyle({width:u.width+"px",height:u.height+"px",position:"relative",display:"inline-block"}),t.wrap(c)},n=function(){var e,n,i,r,o;for(r=$$(".ul_select_menu"),o=[],n=0,i=r.length;i>n;n++)e=r[n],o.push(t(e));return o},pe(n),{init:function(e){return t(e)},set_selected_by_value:l}}();var ri;ri=Xe.DBCalendar=Class.create({initialize:function(e,t){return this.options=t||{},this.container=$(e),bt(this.container,"Couldn't find the element"),this.today=new Date,this.options.disable_future&&(this.options.last_day=Rt.start_of_day(this.options.last_day||this.today)),this.options.disable_past&&(this.options.first_day=Rt.start_of_day(this.options.first_day||this.today)),this.view_date=Rt.start_of_day(this.options.selected_date||this.today),this.selected_date=Rt.start_of_day(this.options.selected_date||this.today),this.render()},_change_month:function(e,t){return Event.stop(e),this.view_date.setMonth(t),this.render()},is_valid_date:function(e,t,n,i,r){var o;return e=parseInt(e,10),t=parseInt(t,10),n=parseInt(n,10),i=parseInt(i,10),r=parseInt(r,10),i=i||1970,r=r||(new Date).getFullYear()+1,t+=1,i>n?!1:n>r?!1:1>t||t>12?!1:0>=e?!1:2===t?(o=n%4===0&&(n%100!==0||n%400===0),o?29>=e:28>=e):4===t||6===t||9===t||11===t?30>=e:31>=e},change_date:function(e,t,n){var i;if(this.is_valid_date(e,t,n))return i=n!==this.view_date.getFullYear()||t!==this.view_date.getMonth(),this.selected_date=new Date(n,t,e),i?(this.view_date.setMonth(t),this.view_date.setFullYear(n),this.render()):(pe(this.container).find(".selected").removeClass("selected"),pe(this.container).find("a#day"+e+"-"+t).addClass("selected")),this.options.onDateChange?this.options.onDateChange(this.selected_date):void 0},render:function(){var e,t,n,i,r,o,s,a,_,l;return t=this.render_days(),i=pe(".current-month",t),s=i.first().data("date"),o=i.last().data("date"),l=s<=this.options.first_day,_=o>=this.options.last_day,e=new Element("div"),e.addClassName("calendar clearfix"),_||(this._next_month=function(e){return this._change_month(e,this.view_date.getMonth()+1)}.bind(this),r=new Element("a"),r.addClassName("changemonth next"),r.update(G.make("web","arrowright",{})),Event.observe(r,"click",this._next_month),e.__sert(r)),l||(this._prev_month=function(e){return this._change_month(e,this.view_date.getMonth()-1)}.bind(this),a=new Element("a"),a.addClassName("changemonth prev"),a.update(G.make("web","arrowleft",{})),Event.observe(a,"click",this._prev_month),e.__sert(a)),n=new Element("h5"),n.update(At("%(month)s %(year)s",{comment:"For example 'January 2010'. This is used as part of a calendar."}).format({month:ie.month_name(this.view_date.getMonth()),year:this.view_date.getFullYear()})),e.__sert(n),e.__sert(t),this.container.__date(e)},render_days:function(){var e,t,n,i,r,o,s,a,_;for(t=new Date(this.view_date.getFullYear(),this.view_date.getMonth(),1),a=t.getDay(),e=new Element("div"),e.addClassName("days"),n=r=_=a;0>=_?0>r:r>0;n=0>=_?++r:--r)s=new Date(t.getFullYear(),t.getMonth(),t.getDate()),s.setDate(s.getDate()-n),e.__sert(this.render_day(s,!0));for(i=new Date(this.view_date.getFullYear(),this.view_date.getMonth(),1);i.getMonth()===this.view_date.getMonth();)e.__sert(this.render_day(i)),i=new Date(this.view_date.getFullYear(),this.view_date.getMonth(),i.getDate()+1);for(o=new Date(this.view_date.getFullYear(),this.view_date.getMonth()+1,0);6!==o.getDay();)o=new Date(o.getFullYear(),o.getMonth(),o.getDate()+1),e.__sert(this.render_day(o,!0));return e},render_day:function(e,t){var n,i;return i=!t,this.options.last_day&&(t=t||e>this.options.last_day),this.options.first_day&&(t=t||e<this.options.first_day),n=new Element(t?"span":"a"),pe(n).data("date",e),i&&n.addClassName("current-month"),n.update(e.getDate()),n.addClassName("date"),n.writeAttribute("id","day"+e.getDate()+"-"+e.getMonth()),this.selected_date.getDate()===e.getDate()&&this.selected_date.getMonth()===e.getMonth()&&this.selected_date.getFullYear()===e.getFullYear()&&n.addClassName("selected"),t?n.addClassName("inactive"):(this._handler=function(e){var t;return t=e.target.identify().substr(3).split("-"),this.change_date(t[0],this.view_date.getMonth(),this.view_date.getFullYear())}.bind(this),Event.observe(n,"click",this._handler)),n}});var oi;oi=Xe.DatePickerInput=Class.create({initialize:function(e,t){var n,i,r,o;return this.container=e,this.options={},Object.extend(this.options,t||{}),this.input=this.container.down(".input-date"),this.display=this.container.down(".visible-date"),o=this.input.value?Rt.from_mysql_date(this.input.value):new Date,this.container.hasAttribute("data-first")&&(r=Rt.from_mysql_date(this.container.getAttribute("data-first"))),n=null!=this.options.disable_future?this.options.disable_future:!0,i=null!=this.options.disable_past?this.options.disable_past:!0,this.cal_container=this.container.down(".cal-container"),this.calendar=new ri(this.cal_container,{onDateChange:this.onDateChange.bind(this),first_day:r,disable_future:n,disable_past:i,selected_date:o}),this.container.observe("click",this.show_cal.bindAsEventListener(this)),$(document.body).observe("click",this.hide_cal.bind(this)),this.onDateChange(o)},show_cal:function(e){var t;return e&&Event.stop(e),t=$(e.target),t.match(".cal-container")||t.up(".cal-container")?void 0:(pe(".cal-container").hide(),this.cal_container.show())},hide_cal:function(){return this.cal_container.hide()},onDateChange:function(e){return this.input.value=Rt.to_mysql_date(e,!1),this.display.update(Cr.localize(e)),this.hide_cal()}});var si;si=Xe.TextInputDatePicker=Class.create({initialize:function(e,t){var n,i,r,o;return this.options={include_seconds:!0,include_microseconds:!0,choose_eod:!1},Object.extend(this.options,t||{}),this.input=$(e),bt(this.input,"Couldn't find the element "+e.toString()),r=new Date,o=this.input.value?Rt.from_mysql_date(this.input.value):!1,i=new Date(r.getUTCFullYear(),r.getUTCMonth(),r.getUTCDate()),this.cal_icon=G.make("web","calendar_view_month",{align:"absmiddle"}),this.cal_container=new Element("div",{id:"cal_container_"+e,style:"display: none; position: absolute; z-index: 1"}),this.calendar=new ri(this.cal_container,{onDateChange:this.onDateChange.bind(this),last_day:i,selected_date:o}),this.input.__sert({after:this.cal_icon}),this.cal_icon.observe("click",this.toggle_cal.bindAsEventListener(this)),n=pe(this.input),Oe.clone_position(pe(this.cal_container),n,{setWidth:!1,setHeight:!1,offsetTop:n[0].offsetHeight}),this.cal_icon.__sert({after:this.cal_container})},toggle_cal:function(e){return e&&Event.stop(e),this.cal_container.toggle()},hide_cal:function(e){return e&&Event.stop(e),this.cal_container.hide()},onDateChange:function(e){return this.options.choose_eod&&e.setTime(Rt.start_of_day(e).getTime()+86399999),this.input.value=Rt.to_mysql_date(e,this.options.include_seconds,this.options.include_microseconds),this.hide_cal()}}),P.window_load(Yn.register.bind(Yn)),pe(Qn.init.bind(Qn)),pe(Zn.register_all.bind(Zn)),Event.observe(window,"scroll",function(){return ei.hide_all()}),pe(function(){return Jn.interval=setInterval(Jn.check.bind(Jn),500),ei.init()});var ai,_n=function(e,t){function n(){this.constructor=e}for(var i in t)ln.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},ln={}.hasOwnProperty;ai=INLINE_JS.ChangeNameModal=Xe.ChangeNameModal=function(e){function t(){t.__super__.constructor.call(this,{element_id:"change-name-modal"}),this.on_confirm_button_click=function(e){return function(t){var n,i,r;return t.preventDefault(),n=pe(t.target),i=n.closest("form"),r=function(){return e.hide(),location.reload()},Hn.ajax_submit(i[0],!1,r,null,n[0])}}(this)}return _n(t,e),t}(rt);var _i,li,un=function(e,t){return function(){return e.apply(t,arguments)}},_n=function(e,t){function n(){this.constructor=e}for(var i in t)ln.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},ln={}.hasOwnProperty;li=Xe.ManageAliasModal=function(e){function t(e){this.options=e,this._poll_until_verified=un(this._poll_until_verified,this),this._get_params_from_target=un(this._get_params_from_target,this),this._on_load=un(this._on_load,this),this._show_action_panel=un(this._show_action_panel,this),this._input_enter_handler=un(this._input_enter_handler,this),this.resend_verify=un(this.resend_verify,this),this.remove_alias=un(this.remove_alias,this),this.add_alias=un(this.add_alias,this),this.refresh_alias=un(this.refresh_alias,this),this.on_show=un(this.on_show,this),t.__super__.constructor.call(this,this.options)}return _n(t,e),t.prototype.before_show=function(e){return t.__super__.before_show.call(this,e),this.polling=0,e.find(".alias-action").on("click",this._show_action_panel),e.find(".alias-action-submit").on("click",this.add_alias),e.find("form").submit(function(){return!1}),e.find(".alias-action-inputs input").on("keyup",this._input_enter_handler)},t.prototype.on_show=function(){return this.refresh_alias(!0,this._poll_until_verified)},t.prototype.refresh_alias=function(e,t){return null==e&&(e=!0),e&&Hn.clear_errors(),new Ajax.DBRequest("/account/alias/get",{subject_user:this.options.subject_user,onSuccess:function(e){return function(n){return e.$modal_window.find(".dynamic-content").html(n.responseText),e._on_load(n),"function"==typeof t?t():void 0}}(this),onFailure:function(e){return function(t){return e.hide()}}(this)})},t.prototype.add_alias=function(e){var t,n,i,r;return e.preventDefault(),n=pe(e.currentTarget).closest("form"),t=n.find(".alias-action-submit"),r={},r[A.UID_PARAM_NAME]=this.options.subject_user.id,i=function(e){return function(){var t;return e.$modal_window.find(".alias-action-inputs input").val(""),e.polling=0,t=e.polling?null:e._poll_until_verified,e.refresh_alias(!0,t)}}(this),Hn.ajax_submit(n[0],!1,i,!1,t[0],r,"before")},t.prototype.remove_alias=function(e){var t;return e.preventDefault(),t=this._get_params_from_target(e.currentTarget),new Ajax.DBRequest("/account/alias/remove",{subject_user:this.options.subject_user,parameters:t,onSuccess:function(e){return function(t){return e.refresh_alias()}}(this)})},t.prototype.resend_verify=function(e){var t;return e.preventDefault(),t=this._get_params_from_target(e.currentTarget),new Ajax.DBRequest("/account/alias/send_verify",{subject_user:this.options.subject_user,parameters:t,onSuccess:function(e){return function(t){return e.refresh_alias()}}(this)})},t.prototype._input_enter_handler=function(e){return e.preventDefault(),e.stopPropagation(),13===e.which?this.add_alias(e):void 0},t.prototype._show_action_panel=function(e){var t,n;return e.preventDefault(),n=pe(e.currentTarget).data("target"),this.$modal_window.find(".alias-action-panel").hide(),t=this.$modal_window.find("#"+n).show(),t.find("input:visible:enabled:first").focus()},t.prototype._on_load=function(e){return Wn.register_all(),this.$dynamic=this.$modal_window.find("#alias-list-container"),this.$dynamic.on("click",".alias-remove",function(e){return function(t){return e.remove_alias(t)}}(this)),this.$dynamic.on("click",".alias-verify",function(e){return function(t){return e.resend_verify(t)}}(this))},t.prototype._get_params_from_target=function(e){var t,n,i;return t=pe(e),i=t.data("alias-type"),n=t.closest(".alias-row").find(".alias-text").text(),{alias:n,alias_type:i}},t.prototype._poll_until_verified=function(){var e,t,n,i;return t=5,e=60,n=function(e){return function(){return e.refresh_alias(!1,e._poll_until_verified)}}(this),i=this.$dynamic.find(".alias-verify").length,i&&this.polling<e?(this.polling++,setTimeout(n,1e3*t)):this.polling=0},t}(rt),_i=INLINE_JS.AliasManager=Xe.AliasManager={show:function(e){var t,n,i,r;if(r=H.get_viewer().get_user_by_role(e),null!=r){if(!r.is_email_verified)return void(e===A.ROLE_PERSONAL?personal_email_verification.verified_or_show():work_email_verification.verified_or_show());i=H.get_viewer().is_paired?e:"",n=At("Manage your %(role_show)s contact methods").format({role_show:i}),t=new li({element_id:"manage-alias",title:n,subject_user:r,role:r.role}),t.show()}}};var ui;ui=INLINE_JS.BonusTable=Xe.BonusTable={_tmpl:null,_inited:null,_next_page:0,_fetching_page:!1,init:function(e){return this.user_id=e,ui._inited?void 0:(ui._inited=!0,$("bonus-loading").show(),ui._tmpl=Ke.tmpl("bonus_row_tmpl"),ui.listen(),ui.get_next_page())},_render:function(e){var t,n,i,r;for(t=[],n=0,i=e.length;i>n;n++)r=e[n],t.push(ui._tmpl({row:r,Sprite:G}));return $("bonus-table").__sert(t)},get_next_page:function(){return ui._fetching_page?void 0:(ui._fetching_page=!0,new Ajax.DBRequest("/account/bonus_page/"+ui._next_page,{onSuccess:function(e){var t,n,i;return t=e.responseText.evalJSON(),i=t.rows,n=t.has_more,ui._render(i),$("bonus-loading").hide(),n?(ui._next_page+=1,$("load-more-bonus").show()):$("load-more-bonus").hide(),ui._fetching_page=!1},subject_user:this.user_id}))},_max_referral_over:function(e){var t,n,i;return n=pe(e.currentTarget),i=At("You've earned the maximum amount of referral space. Thanks for inviting people to Dropbox!"),t=pe(Kn.make(i,"right","middle")),Element.absolutize(t[0]),n.append(t),Oe.clone_position(t,n,{setWidth:!1,setHeight:!1}),t.css({width:"200px",left:parseInt(t.css("left"),10)-210+"px",top:parseInt(t.css("top"),10)-55+"px"})},_max_referral_out:function(e){var t,n,i,r,o;for(r=pe(".reached-max-referral-bonus .bubble"),o=[],n=0,i=r.length;i>n;n++)t=r[n],o.push(t.remove());return o},listen:function(){return pe("#load-more-bonus").on("click",ui.get_next_page.bind(ui)),pe(document).on("mouseenter",".reached-max-referral-bonus",ui._max_referral_over),pe(document).on("mouseleave",".reached-max-referral-bonus",ui._max_referral_out)},toggle:function(){return pe("#bonus-list").is(":visible")?(this.hide(),pe("#space-earned-link").text(At("View all space earned"))):(this.show(),pe("#space-earned-link").text(At("Hide space earned")))},show:function(){return pe("#bonus-list").slideDown(150)},hide:function(){return pe("#bonus-list").slideUp(150)}};var di,ci,hi,fi;di=INLINE_JS.DowngradeReasons=Xe.DowngradeReasons={reasons:{},addReason:function(e){return this.reasons[e]=!0},addReasons:function(e){var t,n,i,r;for(r=[],t=0,i=e.length;i>t;t++)n=e[t],r.push(this.addReason(n));return r},change:function(e,t,n){var i,r,o,s,a,_;e=parseInt(e,10),r=$(t),bt(r,"Couldn't find container for DowngradeReason"),i=!1,a=this.reasons;for(s in a)o=a[s],_=$(n+s),bt(_,"Couldn't find container for "+(n+s)),o&&parseInt(s,10)===e?(_.show(),i=!0):_.hide();return i?r.show():r.hide()}},ci=Xe.DowngradeReasons2={init:function(){var e,t,n,i;for(i=["input[name=downgrade_reason_id]","input[name=other_reason_id]"],e=0,t=i.length;t>e;e++)n=i[e],pe(n).change(function(e){var t;return t=e.target.id.indexOf("other")>=0,ci.change(t,e.target.getValue())});return pe(".shared-additional-info").attr("name","shared_additional_info")},change:function(e,t){var n;return pe(".downgrade-other-reason .error-message").hide(),e?void 0:(n="#downgrade-info-"+t,pe(".downgrade-info").hide(),pe(n).show(),pe(".downgrade-info textarea").removeAttr("name"),pe(n+" textarea").attr("name","additional_info"),pe("input[name=other_reason_id]").removeAttr("checked"))}},hi=Xe.DowngradeSurvey={init:function(){var e;return e="#downgrade-survey-form",pe(""+e).on("submit",function(t){return function(t){var n,i;return i=pe(e+" input[name=other_reason_id]:checked").length,n=pe(e+" input[id=downgrade-radio-8]"),n.is(":checked")&&0===i?(pe(".downgrade-other-reason .error-message").show(),t.preventDefault()):void 0}}(this))}},fi=Xe.TrialDowngradeReasons={init:function(){return pe(document).on("click",".reasons-option",function(e){var t,n,i,r;return i=e.target.getValue(),r=e.target.name,"other_reason_id"===r&&(n="#other-info-"+i,pe(".other-info").hide(),pe(n).show()),"downgrade_reason_id"===r?(t="#downgrade-info-"+i,pe(".downgrade-info").hide(),pe(t).show()):void 0}),pe("#downgrade-survey-form").on("submit",function(e){var t,n;return n=pe("#downgrade-survey-form input[id=downgrade-radio-207]"),n.is(":checked")&&0===pe(".q1-other-reason.textinput").val().length?(pe(".trial-downgrade--error-message").show(),void e.preventDefault()):(t="",pe(".reasons-option:checked").each(function(e,n){var i,r,o;return i=n.getValue(),r=pe("#downgrade-info-"+i+" textarea").val(),o=pe("#other-info-"+i+" textarea").val(),(null!=r?r.length:void 0)>0&&(t=i+":"+r),(null!=o?o.length:void 0)>0?t+=" "+i+":"+o:void 0}),pe(".downgrade-info textarea").removeAttr("name"),pe(".other-info textarea").removeAttr("name"),pe('#downgrade-survey-form input:hidden[name="additional_info"]').val(t))})}};var pi;pi=INLINE_JS.GetSpace=Xe.GetSpace={_current_space:null,_why_msg:null,_twitter_url:null,offer_highlight_color:"#ffa",init:function(e,t,n){var i;return pi._current_space=e,pi._why_msg=t,pi._twitter_url=n,$("space-actions").on("click",".space-action",pi.perform_action),i=s.parse(window.location.href).fragment,i?pi.highlight_offer(i):void 0},highlight_offer:function(e){var t,n;return t=pe("#"+e),n=t.css("background-color"),t.css("background-color",pi.offer_highlight_color).delay(2e3).animate({"background-color":n}).queue(function(){return t.css("background-color","")})},perform_action:function(e){var t,n;return n={contact_sales:pi._contact_sales,contact_support:pi._contact_support,teams:pi._teams,upgrade:pi._upgrade,plans:pi._plans,refer:pi._refer,get_started:pi._get_started,fb_link:pi._fb_link,twitter_link:pi._twitter_link,twitter_follow:pi._twitter_follow,why_like:pi._why_like,mailbox_link:pi._mailbox_link},t=$(e.target),t.hasClassName("space-action")||(t=t.up(".space-action")),n[t.id]()},_teams:function(){return window.location.href="/business?tk=dropbox&ag=getspace&ad=v1"},_contact_sales:function(){return window.location.href="mailto:sales@dropbox.com"},_contact_support:function(){return window.location.href="/support"},_plans:function(){return window.location.href="/plans"},_upgrade:function(){return window.location.href="/upgrade"},_refer:function(){return window.location.href="/referrals"},_get_started:function(){return window.location.href="/gs"},_fb_link:function(){return U.do_auth(function(){return pi._refresh_link_bonuses(),pi._completed($("fb_link"))},H.get_viewer().personal_user.id)},_twitter_link:function(){return Dr.do_auth(function(){return pi._refresh_link_bonuses(),Dr.set_is_authed(H.get_viewer().personal_user.id,!0),pi._completed($("twitter_link"))},H.get_viewer().personal_user.id)},_twitter_follow:function(){return Dr.is_authed(H.get_viewer().personal_user.id)?pi.follow_dropbox():Dr.do_auth(pi.follow_dropbox,H.get_viewer().personal_user.id)},_why_like:function(){return Xn.show(At("Tell us why you love Dropbox"),$("why-i-like-modal")),$("why-i-like-input").focus(),Rt._track_twitter_chars_left("why-i-like-input",90)},_mailbox_link:function(){return window.location.href="http://www.mailboxapp.com/"},follow_dropbox:function(){return Dr.is_authed(H.get_viewer().personal_user.id)||(pi._refresh_link_bonuses(),Dr.set_is_authed(H.get_viewer().personal_user.id,!0)),Dr.follow_dropbox({showWorking:function(){return $("twitter_follow").down(".title").__date(At("Following Dropbox on Twitter..."))},onFailure:function(){return $("twitter_follow").down(".title").__date(At("Follow Dropbox on Twitter"))},onSuccess:function(){return $("twitter_link")&&$("twitter_link").visible()&&pi._completed($("twitter_link")),pi._completed($("twitter_follow"))}},H.get_viewer().personal_user.id)},submit_why:function(){return pi._why_msg=$F("why-i-like-input"),Hn.ajax_submit($("why-i-like-form"),!1,function(){return Xn.hide(),pi._completed($("why_like"))},!1,$("why-i-like-submit"))},_completed:function(e){var t;return e.addClassName("completed"),e.down(".icon-col").__date(Element("img",{src:"/static/images/check_36-vflimxFPn.png"})),pe(e).css("opacity",.5).fadeTo(500,1),setTimeout(function(){return pe(e).css("opacity",1).slideUp().animate({opacity:0},{queue:!1,duration:"normal"})},1500),t=parseInt(e.down(".space").readAttribute("data-space"),10),pi._current_space+=t,$("current-space").__date(y.format_bytes(pi._current_space)),$("current-space").addClassName("updated"),setTimeout(function(){return $("current-space").removeClassName("updated")},5e3)},_refresh_link_bonuses:function(){return new Ajax.DBRequest("/social_recheck")}};var mi;mi=Xe.Help={toggle_more_help:!1,show_os:function(e,t,n){return t=$(t),$$(".os-filter").invoke("removeClassName","selected"),t.addClassName("selected"),$$(".help-os-section").invoke("hide"),$$(".help-os-"+n).invoke("show"),Event.stop(e)},vote:function(e,t){return new Ajax.DBRequest("/help/"+e+"/vote/"+t),pe("#help-vote-cont").fadeOut(),b.success(At("Thanks for your feedback!"))}};var vi,gi,wi,bi,un=function(e,t){return function(){return e.apply(t,arguments)}},_n=function(e,t){function n(){this.constructor=e}for(var i in t)ln.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},ln={}.hasOwnProperty;gi=INLINE_JS.Hosts=Xe.Hosts={attach_host_listener:function(e,t){var n,i,r,o;return n=pe("#"+e),r=n.data("host-ids"),i=n.data("display-name"),o=function(){return new wi(r,i,t,null,null).show()},pe(".unlink-host-link",n).on("click",o),n.on("dblclick",function(){return gi.edit(r,e)})},edit:function(e,t){var n,i,r,o,s,a;return r=pe("#"+t+" .host-item .sprite-text"),"true"===r.data("editing")?!1:(r.data("editing","true"),i=r.text(),r.data("previous",i),e=v.values(e),o=pe('<input type="text" class="name-input skinny-input" size="20" maxlength="256" style="word-wrap: break-word;" />').val(i),a=pe('<input type="button" class="button">').val(At("Save")),a.on("click",function(){return gi.doneEditing(e,t)}),n=pe('<input type="button" class="button grayed">').val(At("Cancel")),n.on("click",function(){return gi.cancelEditing(t)}),r.empty(),r.append(o,"&nbsp;",a,"&nbsp;",n),s=pe("input",r),s.on("keydown",function(){return gi.checkKey(e,t)}),s.focus(),!1)},doneEditing:function(e,t){var n,i;return n=pe("#"+t+" .host-item .sprite-text"),i=pe("input",n).val(),g.AuthenticatedRequest({url:"/account/change_host_name",data:{host_ids:JSON.stringify(e),name:i},dataType:"json",success:function(e){return gi.unedit(n,e.display_name)}})},cancelEditing:function(e){var t;return t=pe("#"+e+" .host-item .sprite-text"),gi.unedit(t,t.data("previous"))},unedit:function(e,t){return e.data("editing","false"),e.text(t)},dismiss:function(e,t,n,i,r){return g.AuthenticatedRequest({url:"/account/dismiss_unlink",data:{host_id:e,user_id:t,team_id:n},subject_user:r,success:function(e){return i.remove()}}),!1},checkKey:function(e,t){return function(n){return n=n||window.event,n.keyCode===Event.KEY_RETURN&&gi.doneEditing(e,t),n.keyCode===Event.KEY_ESC?gi.cancelEditing(t):void 0}},show_device_unlink_modal:function(e,t,n,i,r,o){var s,a;return s=pe("#unlink-device-modal-"+r),a={both:v.values(i),personal:[i[A.ROLE_PERSONAL]],work:[i[A.ROLE_WORK]]},Xn.show(n,s[0]),v.values(i).length>1&&s.addClass("show-selector"),pe("form input[type=submit]",s).on("click",function(n){return n.preventDefault(),i=a[pe(".unlink-select select",s).val()],Hn.add_vars(pe("form",s)[0],{user_ids:JSON.stringify(i),app_id:t,device_id:JSON.stringify(e),device_name:o}),pe("form",s).submit()})}},vi=Xe.DeleteFailuresModal=function(e){function t(){return this.on_show=un(this.on_show,this),this.on_confirm_button_click=un(this.on_confirm_button_click,this),t.__super__.constructor.apply(this,arguments)}return _n(t,e),t.prototype.on_confirm_button_click=function(e){return e.preventDefault(),window.location.href="/delete_failures?host_id="+this.host_id,this.hide()},t.prototype.on_show=function(e){var t;return t=Tt("Dropbox couldn't delete %(num_failures)d file from the computer <strong>%(host_name)s</strong>. You can download the name of this file and the reason why it couldn't be deleted.","Dropbox couldn't delete %(num_failures)d files from the computer <strong>%(host_name)s</strong>. You can download the names of these files and the reasons why they couldn't be deleted.",this.num_failures).format({host_name:this.name.escapeHTML(),num_failures:this.num_failures}),this.$modal_window.find(".failures_message").html(t)},t}(rt),bi=INLINE_JS.show_delete_failures_modal=Xe.show_delete_failures_modal=function(e,t,n){
var i;return i=new vi({element_id:"delete-failures-modal"}),i.host_id=e,i.name=t,i.num_failures=n,i.show(),!1},wi=INLINE_JS.UnlinkHostModal=Xe.UnlinkHostModal=function(e){function t(e,n,i,r,o){this.host_ids=e,this.name=n,this.delete_support_type=i,this.owner_id=r,this.team_id=o,this.on_show=un(this.on_show,this),this._set_delete_text=un(this._set_delete_text,this),this.fail_callback=un(this.fail_callback,this),this.success_callback=un(this.success_callback,this),this.on_confirm_button_click=un(this.on_confirm_button_click,this),t.__super__.constructor.call(this,{element_id:"unlink-host-modal"}),this.show_host_selector=v(this.host_ids).values().length>1}return _n(t,e),t.prototype.on_confirm_button_click=function(e){var t,n,i;return e.preventDefault(),n=this.$modal_window.find(".unlink_host_form")[0],t=$(this.$modal_window.find(".confirm-button")[0]),this.$modal_window.find("[type=button]").attr("disabled",""),i={host_ids:JSON.stringify(this.get_selected_hosts())},Hn.ajax_submit(n,!1,this.success_callback,this.fail_callback,t,i)},t.prototype.success_callback=function(){return window.location.reload()},t.prototype.fail_callback=function(){return this.$modal_window.find("[type=button]").removeAttr("disabled")},t.prototype._set_delete_text=function(e){return this.$modal_window.find(".delete_data_label").text(e)},t.prototype._get_unlink_select=function(){return this.$modal_window.find(".unlink-select select").val()},t.prototype._clear_delete_checkbox=function(){return this.$modal_window.find(".delete_data").prop("checked",!1)},t.prototype.on_show=function(e){var t;return this._clear_delete_checkbox(),this.delete_support_type===c.DELETE_ON_UNLINK_OLD_CLIENT?this.$modal_window.find(".unlink_host_modal_content").addClass("show_old_client_modal"):this.delete_support_type===c.DELETE_ON_UNLINK_UNSUPPORTED?this.$modal_window.find(".unlink_host_modal_content .unlink_host_form").addClass("hidden"):this.delete_support_type===c.DELETE_ON_UNLINK_SUPPORTED_TEAM_ONLY?(this.$modal_window.find(".unlink-choice").change(function(e){return function(t){return e._get_unlink_select()===A.ROLE_PERSONAL?e.$modal_window.find(".new_client").hide():e.$modal_window.find(".new_client").show()}}(this)),this._set_delete_text(At("Delete files from %(team_name)s Dropbox the next time this computer comes online.").format({team_name:H.get_viewer().team_name}))):this.delete_support_type===c.DELETE_ON_UNLINK_SUPPORTED_PERSONAL_ONLY?(this.$modal_window.find(".unlink-choice").change(function(e){return function(t){return e._get_unlink_select()===A.ROLE_WORK?e.$modal_window.find(".new_client").hide():e.$modal_window.find(".new_client").show()}}(this)),this._set_delete_text(At("Delete files from my personal Dropbox the next time this computer comes online."))):this.delete_support_type===c.DELETE_ON_UNLINK_SUPPORTED&&(this._set_delete_text(At("Delete files from these Dropboxes the next time this computer comes online.")),this.$modal_window.find(".unlink-choice").change(function(e){return function(t){return e._get_unlink_select()===A.ROLE_PERSONAL?e._set_delete_text(At("Delete files from my personal Dropbox the next time this computer comes online.")):e._get_unlink_select()===A.ROLE_WORK?e._set_delete_text(At("Delete files from %(team_name)s Dropbox the next time this computer comes online.").format({team_name:H.get_viewer().team_name})):e._set_delete_text(At("Delete files from these Dropboxes the next time this computer comes online."))}}(this))),this.show_host_selector&&(t="<span class='host_name'></span>",this.$modal_window.find(".unlink-select").removeClass("hidden"),this.$modal_window.find(".unlink-modal-text").html(At("Which Dropboxes do you want to unlink from %(host_name)s? Any Dropbox you unlink will immediately stop syncing.").format({host_name:t}))),this.$modal_window.find("[name=host_id]").attr("value",this.host_id),this.$modal_window.find("[name=team_id]").attr("value",this.team_id),this.$modal_window.find("[name=user_id]").attr("value",this.owner_id),this.$modal_window.find(".host_name").text(this.name)},t.prototype.get_selected_hosts=function(){var e;return 1===v.values(this.host_ids).length?v.values(this.host_ids):(e=pe(".unlink-choice").val(),"both"===e?v.values(this.host_ids):[this.host_ids[e]])},t}(rt);var yi;yi=Xe.News={DEFAULT_TAB:"recent-news",init:function(){return $("news-home").on("click","#nav a",function(e,t){var n;return t.hasAttribute("data-div")?(e.preventDefault(),n=t.readAttribute("data-div"),p.push_state("/news/"+n)):void 0}),p.add_callback("/news",yi.history_change)},change_tab:function(e){var t;return t=$$("#nav a[data-div="+e+"]").first(),$(t)?($$(".section").invoke("removeClassName","selected"),$$("#nav a").invoke("removeClassName","selected"),$(t).addClassName("selected"),$(e).addClassName("selected")):void 0},history_change:function(e){return e=e||yi.DEFAULT_TAB,yi.change_tab(e)}};var ki;ki=Xe.Recover={init:function(){var e;return e=$("recover-form"),e.observe("submit",this.form_submit.bind(this))},form_submit:function(e){return this.clear_error(),e.preventDefault(),Hn.ajax_submit($("recover-form"),null,this.submit_response.bind(this))},submit_response:function(e){var t;return t=JSON.parse(e.responseText),"error"===t.status&&this.show_error(t.msg),"ok"===t.status&&this.show_hosts(t),"redirect"===t.status?window.location.href=t.url:void 0},show_hosts:function(e){var t,n,i,r,o,s,a;for(Hn.add_vars($("recover-form"),{check_file:"true"}),$("filename-to-create").update(e.filename),n=$("trusted-hosts"),n.update(),a=e.hosts,i=0,o=a.length;o>i;i++)t=a[i],s=new Element("li"),r="lnx","mac"===t.platform&&(r="osx"),"win"===t.platform&&(r="win"),s.__sert(G.make("web",r)),s.__sert(new Ke(t.display_name.escapeHTML())),n.appendChild(s);return $("login-step").hide(),$("hosts-step").show()},show_error:function(e){return $("error-messages").update(e),$("error-messages").show()},clear_error:function(){return $("error-messages").update()}};var Ei;Ei=Xe.Restore={next:function(e,t){var n,i;return i=pe("ul.selected"),n=i.next("ul"),n.addClass("selected"),i.removeClass("selected"),n.next("ul").length?pe("#next-page").show():pe("#next-page").hide(),pe("#prev-page").show(),Ei.inc_page(1)},prev:function(e,t){var n,i;return i=pe("ul.selected"),n=i.prev("ul"),n.addClass("selected"),i.removeClass("selected"),n.prev("ul").length?pe("#prev-page").show():pe("#prev-page").hide(),pe("#next-page").show(),Ei.inc_page(-1)},inc_page:function(e){var t,n;return t=parseInt(pe("#page_num").text(),10),n=t+e,pe("#page_num").text(n)},init:function(e,t,n){var i;return i=H.get_viewer().get_user_by_id(n),pe("#next-page").on("click",function(e){return Ei.next(e),!1}),pe("#prev-page").on("click",function(e){return Ei.prev(e),!1}),pe("#restore-submit-button").on("click",function(t){return Vn.do_folder_restore(e,i),!1}),pe("#restore-cancel-button").on("click",function(e){return He.redirect(t)}),pe("#restore-back-button").on("click",function(e){return He.redirect(t)})}};var xi,Ci,Si,Ti,Ai,un=function(e,t){return function(){return e.apply(t,arguments)}},_n=function(e,t){function n(){this.constructor=e}for(var i in t)ln.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},ln={}.hasOwnProperty;xi=Xe.SelectRoleModal=function(e){function t(){return this.on_show=un(this.on_show,this),t.__super__.constructor.apply(this,arguments)}return _n(t,e),t.prototype.on_select_role=null,t.prototype.on_show=function(){return pe(".role-options li").click(function(e){return function(t){var n,i;return n=pe(t.target).closest("li"),i=n.data("role"),bt(e.on_select_role,"missing on_select_role implementation"),e.on_select_role(i),e.hide()}}(this))},t}(rt),Si=Xe.SharedFolderSelectRoleModal=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return _n(t,e),t.prototype.on_select_role=function(e){var t;return t=function(){return En.role_picker.ensure_role_is_visible(e),zt.start_wizard_for_user(H.get_viewer().get_user_by_role(e))},e===te.logged_out_role?te.show_modal({role:e,on_success:t}):t()},t}(xi),Ti=Xe.ShmodelC2DSelectRoleModal=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return _n(t,e),t.prototype.on_select_role=function(e){var t;return t=function(){return On.show_c2d_modal(e)},H.get_viewer().is_role_signed_in(e)?t():te.show_modal({role:e,on_success:t})},t}(xi),Ai=Xe.ShmodelSyncSelectRoleModal=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return _n(t,e),t.prototype.on_select_role=function(e){var t;return t=function(){return On.request_shared_folder_sync(e)},H.get_viewer().is_role_signed_in(e)?t():te.show_modal({role:e,on_success:t})},t}(xi),Ci=Xe.ShareShmodelSelectRoleModal=function(e){function t(){return this.on_select_role=un(this.on_select_role,this),t.__super__.constructor.apply(this,arguments)}return _n(t,e),t.prototype.on_select_role=function(e){return On.prompt_login_then_share(this.options.link_url,this.options.short_url,this.options.tokenizer_type,e)},t}(xi);var Di;Di=Xe.TabController=Class.create({initialize:function(e,t){var n;return n=$(e),bt(n,e+" is missing."),this.container=n,this.options={killEvent:!0},Object.extend(this.options,t),this.listen()},listen:function(){var e,t,n,i,r,o;for(o=this,i=this.container.select("a"),r=[],t=0,n=i.length;n>t;t++)e=i[t],bt(e.id&&e.id.length>0,"Element is missing an id"),r.push(e.observe("click",function(e){return this.click(e)}.bindAsEventListener(o)));return r},click:function(e){return this.options.killEvent&&Event.stop(e),this.toggle($(e.target))},toggle:function(e){var t,n,i,r,o;return o=this.container.down("a.selected"),o&&(r=$(o.id+"-content"),r&&r.hide()),this.container.select(".selected").invoke("removeClassName","selected"),n=!1,e||(e=this.container.down("a"),n=!0),e.addClassName("selected"),t=$(e.id+"-content"),t&&t.show(),this.options.onTabChange&&this.options.onTabChange(e,o),this.options.url_prefix?(i=this.options.url_prefix,n||(i+="/"+e.id),p.push_state(i)):void 0}});var Oi;Oi=Xe.InviteForm={initialized:!1,init:function(){return this.initialized?void 0:pe(function(e){return function(){return e.add_auto_completer=new Autocompleter.ContactsTokenizer(H.get_viewer().get_user_by_role(A.ROLE_WORK),"team-invite-new-collab-input","team-invite-new-whobulk","team-invite-hidden-input",{tokens:[",",";"],hide_import_contacts:!0,suggestions_disabled:!0,contact_filter:function(e){return e.excludeTeamMembers().excludeFacebook().excludeNewStyleGroups().excludeMe()}}),e.add_auto_completer.clearTokens(),e.tokenAdd=pe.proxy(e._tokenAdd,e),e.tokenRemove=pe.proxy(e._tokenRemove,e),pe("#team-invite-new-collab-input")[0].on("token:add",e.tokenAdd),pe("#team-invite-new-collab-input")[0].on("token:remove",e.tokenRemove),e.reset_licenses(),e.update_free_licenses_message(),e.initialized=!0,e.setup_tab_support(pe),Qn.init()}}(this))},set_emails:function(e){return null!=e?pe(function(t){return function(){var n,i,r,o,s;for(t.init(),s=[],r=0,o=e.length;o>r;r++)n=e[r],i=t.add_auto_completer.createTokenInfo(null,n,ae.EMAIL),s.push(t.add_auto_completer.addContact(i));return s}}(this)):void 0},rebind_modal_submit_autocompleter:function(){var e,t;return e=this.invite_modal.$modal_window,t=e.find(".tokenizer-submit-button"),t.on("mousedown",function(e){return function(){return e.add_auto_completer.beforeSubmit()}}(this)),this.setup_tab_support(e)},setup_tab_support:function(e){return e.find("#team-invite-new-collab-input").first().on("keyup change",function(){var t;return t=e.find(".new-collab-input").first(),""!==t.val()?t.attr("tabindex",-1):t.removeAttr("tabindex")})},reset_modal_licenses:function(){var e,t,n;return n=null!=__CIRCULAR_DEPENDENCY__.Dashboard?__CIRCULAR_DEPENDENCY__.Dashboard.get_licensed_members():null!=__CIRCULAR_DEPENDENCY__.MembersReact?__CIRCULAR_DEPENDENCY__.MembersReact.get_licensed_members():window.active_team_member_table.get_licensed_members(),this.total_licenses=null!=(e=null!=(t=__CIRCULAR_DEPENDENCY__.MembersReact)&&"function"==typeof t.get_total_licenses?t.get_total_licenses():void 0)?e:this.total_licenses,this.update_used_licenses(n),this.available_licenses=this.total_licenses-this.used_licenses,this.update_license_count(),this.new_users=0},reset_licenses:function(){return this.available_licenses=this.total_licenses-this.used_licenses,this.update_license_count(),this.new_users=0},get_new_users:function(){return this.new_users},_tokenAdd:function(e){return this.available_licenses--,pe(window).trigger("token:changed",{remaining_licenses:this.available_licenses}),this.new_users++},_tokenRemove:function(e){return this.available_licenses++,pe(window).trigger("token:changed",{remaining_licenses:this.available_licenses}),this.new_users--},already_invited_user:function(e){var t,n,i;if(window.active_team_member_table){t=window.active_team_member_table.data.users;for(i in t)if(n=t[i],n.email===e)return!0}},update_license_count:function(){var e,t;return e=pe("#license-count-message"),this.available_licenses<0?(t=this.invite_modal.get_remaining_licenses_message(this.available_licenses),e.addClass("over")):0===this.available_licenses?(t=At("You have no remaining licenses."),e.removeClass("over")):this.available_licenses>0?(t=Tt("You have %(invites)d remaining license.","You have %(invites)d remaining licenses.",this.available_licenses).format({invites:this.available_licenses}),e.removeClass("over")):t="You have   remaining licenses.",e.text(t)},init_modal_licenses_and_reseller:function(e,t,n,i,r){return this.total_licenses=e,this.is_trial=t,this.allow_trial_add_licenses=n,this.is_trial&&!this.allow_trial_add_licenses&&(i=void 0),this.invite_modal||(this.invite_modal=new $i(i,this.is_trial,r)),pe("body").trigger("invite-modal-initialized")},update_used_licenses:function(e){return this.used_licenses=e,this.reset_licenses()},init_form_licenses:function(e,t,n){return this.total_licenses=e,this.used_licenses=t,this.is_trial=n,Oi.reset_licenses()},add_total_licenses:function(e){return e=e||0,e>0&&(this.total_licenses+=e,this.available_licenses+=e,this.update_license_count(),null!=__CIRCULAR_DEPENDENCY__.Dashboard)?__CIRCULAR_DEPENDENCY__.Dashboard.add_licenses(e):void 0},on_add_licenses_exit:function(e,t){var n;return(null!=(n=this.invite_modal)?n.$modal_window:void 0)&&this.rebind_modal_submit_autocompleter(),this.add_total_licenses(t)},reset_modal:function(){var e;return e=this.invite_modal.$modal_window,Zn.reset(e.find("#team-invite-message")[0]),this.add_auto_completer&&(this.add_auto_completer.clearTokens(),this.add_auto_completer.update.hide()),this.reset_modal_licenses(),e.find(".new-collab-input").val("")},on_add_licenses_click:function(e){var t;return e.preventDefault(),this.is_trial&&!this.allow_trial_add_licenses?(null!=(t=this.invite_modal)&&t.hide(),__CIRCULAR_DEPENDENCY__.add_more_licenses_to_trial()):(null!=this.add_licenses_cb&&ot.unregister(__CIRCULAR_DEPENDENCY__.AddLicensesModal.LICENSES_ADDED,this.add_licenses_cb),this.add_licenses_cb=pe.proxy(this.on_add_licenses_exit,this),ot.register(__CIRCULAR_DEPENDENCY__.AddLicensesModal.LICENSES_ADDED,this.add_licenses_cb),ot.push(new __CIRCULAR_DEPENDENCY__.AddLicensesModal))},update_free_licenses_message:function(){var e;return e=this.invite_as_limited(),pe(".team-invite-add-licenses").toggle(!e),pe("#license-count-message").toggle(!e),pe("#license-free-message").toggle(e)},invite_as_limited:function(){var e;return e=pe('input[name="membership_type"]'),e&&e.is(":checked")}};var $i,un=function(e,t){return function(){return e.apply(t,arguments)}},_n=function(e,t){function n(){this.constructor=e}for(var i in t)ln.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},ln={}.hasOwnProperty;$i=Xe.InviteModal=function(e){function t(e,n,i){this.transition_view_model=e,this.is_trial=n,this.reseller_contact_info=i,this._reset=un(this._reset,this),this._update_form_pricing_information=un(this._update_form_pricing_information,this),this._update_remaining_licenses_message=un(this._update_remaining_licenses_message,this),this._make_transition_info_request=un(this._make_transition_info_request,this),this._handle_token_change=un(this._handle_token_change,this),this._licenses_total=un(this._licenses_total,this),this.is_making_transition_info_request=un(this.is_making_transition_info_request,this),this.__overlay_click_handler=un(this.__overlay_click_handler,this),this.__x_click_handler=un(this.__x_click_handler,this),this.on_cancel_button_click=un(this.on_cancel_button_click,this),this.on_cancel_and_log=un(this.on_cancel_and_log,this),this.on_hide=un(this.on_hide,this),this.on_show=un(this.on_show,this),t.__super__.constructor.call(this,{element_id:"team-invite-wizard",focus:".new-collab-input",title:At("Invite team members")}),this.inline_add_license=null!=this.transition_view_model,this.inline_add_license&&(this.transition_info_fetcher=new $t([this.transition_view_model]),this.probability=Math.random()),this.skip_reset=!1,this.making_transition_info_request=!1,this.transition_info_callback=null}return _n(t,e),t.prototype.on_confirm_button_click=function(e){var t,n,i;return i=Oi.invite_as_limited()?0:this.add_qty,n="send_invites",i&&(n="invite_buy"),t="false",pe("#team-invite-message").val()&&(t="true"),ze.TeamsWebActionsLogger.log("invite_member_open_invite_click",{invite_or_buy:n,invite_count:""+this._getInvitesCount(),added_message:t}),ji.add_users(e,i)},t.prototype.on_show=function(){var e,t,n;return this._reset(),n=pe('input[name="membership_type"]'),null!=n&&n.attr("checked",!1),null!=n&&n.click(function(e){return function(){return Oi.update_free_licenses_message(),e._updated_charges_messages(Oi.invite_as_limited())}}(this)),e=pe("#team-invite-wizard .team-invite-add-licenses"),e.on("click",pe.proxy(Oi.on_add_licenses_click,Oi)),pe(window).on("token:changed",this._handle_token_change),Oi.initialized&&(Hn.clear_errors(),Oi.update_license_count(),Oi.update_free_licenses_message()),ot.register(ot.CLEAR,function(){return Oi.reset_modal()}),t=this.inline_add_license&&this.add_qty>0&&!Oi.invite_as_limited(),ze.TeamsWebActionsLogger.log("invite_member_open",{invite_or_buy:t?"invite_buy":"send_invites"})},t.prototype.on_hide=function(){return pe(window).off("token:changed",this._handle_token_change)},t.prototype.on_cancel_and_log=function(){var e,t,n;return n=this.inline_add_license&&this.add_qty>0&&!Oi.invite_as_limited(),t="send_invites",n&&(t="invite_buy"),e="false",pe("#team-invite-message").val()&&(e="true"),ze.TeamsWebActionsLogger.log("invite_member_open_cancel",{invite_or_buy:t,invite_count:""+this._getInvitesCount(),added_message:e})},t.prototype.on_cancel_button_click=function(e){return this.on_cancel_and_log(),t.__super__.on_cancel_button_click.call(this,e)},t.prototype.__x_click_handler=function(e){return this.on_cancel_and_log(),t.__super__.__x_click_handler.call(this,e)},t.prototype.__overlay_click_handler=function(e){return this.on_cancel_and_log(),t.__super__.__overlay_click_handler.call(this,e)},t.prototype.is_making_transition_info_request=function(){return this.making_transition_info_request},t.prototype._licenses_to_add=function(){return-1*Oi.available_licenses},t.prototype._licenses_total=function(){return Oi.total_licenses+this._licenses_to_add()},t.prototype._getInvitesCount=function(){return Oi.total_licenses-Oi.used_licenses-Oi.available_licenses},t.prototype._handle_token_change=function(e,t){return this.remaining_licenses=t.remaining_licenses,this._updateConfirmButton(),this._update_remaining_licenses_message(),this.inline_add_license?(clearTimeout(this.fetch_transition_timeout_id),this.fetch_transition_timeout_id=setTimeout(function(e){return function(){return e._make_transition_info_request(),e.fetch_transition_timeout_id=null}}(this),100)):void 0},t.prototype._make_transition_info_request=function(){var e,t,n,i;return this.making_transition_info_request=!0,t=Math.floor(1e6*Math.random()),this.current_callback_token=t,e=this._licenses_to_add(),n=this._licenses_total(),i=function(i){return function(r){return i._update_form_pricing_information(t,e,n,null!=r?r[0]:void 0)}}(this),e>0?this.transition_info_fetcher.get(i,{total_users:this._licenses_total()}):i(null)},t.prototype._update_remaining_licenses_message=function(){var e;return e=this.get_remaining_licenses_message(this.remaining_licenses),this.$modal_window.find("#license-count-message").text(e)},t.prototype.get_remaining_licenses_message=function(e){var t,n,i;return i=this._getInvitesCount(),0>e?n=this.reseller_contact_info?this.reseller_contact_info.name&&this.reseller_contact_info.phone?Tt("You need more licenses for this invitation. Contact %(name)s at %(phone)s to add more.","You need more licenses for these invitations. Contact %(name)s at %(phone)s to add more.",i).format(this.reseller_contact_info):Tt("You need more licenses for this invitation. Contact your reseller to add more.","You need more licenses for these invitations. Contact your reseller to add more.",i):Tt("You need more licenses for this invitation.","You need more licenses for these invitations.",i):0===e?(n=At("After these invitations, you’ll have no remaining licenses."),1===i&&(n=At("After this invitation, you’ll have no remaining licenses."))):(t=Tt("After this invitation","After these invitations",i),n=t+Tt(", you’ll have %(count)d remaining license.",", you’ll have %(count)d remaining licenses.",e).format({count:e})),n},t.prototype._update_form_pricing_information=function(e,t,n,i){var r,o,s,a,_;if(e===this.current_callback_token)return i&&t>0?(this.add_qty=t,r=this.transition_view_model.state.currency,a=i.current_total.amount,s=Ot.formatCurrency(a,r),_=Ot.formatCurrency(i.recurring_total_tax.amount,r),o=this.is_trial?0:a,pe(".new-amount").text(s),pe(".add-qty").text(t),pe(".recurring-amount").text(_),pe(".total-qty").text(n),pe("#expected_price").val(o),this._updated_charges_messages(Oi.invite_as_limited())):this._reset(),this.making_transition_info_request=!1},t.prototype._updateConfirmButton=function(e){var t,n;return null==e&&(e=!1),t=pe(".team-invite-buttons .confirm-button"),n=e?At(this.is_trial?"Invite and add":"Invite and buy"):Tt("Send invite","Send invites",this._getInvitesCount()),t.val(n)},t.prototype._reset=function(){return this.add_qty=0,pe(".charges-section").hide(),pe("#expected_price").val(0),this._updateConfirmButton()},t.prototype._updated_charges_messages=function(e){var t;return t=this.inline_add_license&&this.add_qty>0&&!e,pe(".charges-section").toggle(t),this._updateConfirmButton(t)},t}(rt);var Ni,Ii,Li,Ri,qi,Mi,Pi,Fi,Ui,ji,Bi,zi,Vi,Hi,un=function(e,t){return function(){return e.apply(t,arguments)}},_n=function(e,t){function n(){this.constructor=e}for(var i in t)ln.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},ln={}.hasOwnProperty;ji=INLINE_JS.Team=Xe.Team={_use_async_reset:!1,team_id:H.get_viewer().team_id,set_team_id:function(e){this.team_id=e},setup_beta_modal_listeners:function(){var e,t,n,i,r,o,s,a,_;for(t=pe(".feature-list .enroll-button"),i=pe(".feature-list .feedback-button"),r=0,s=t.length;s>r;r++)e=t[r],n=pe(e).data("feature"),pe(e).click(function(e){return function(){return new Ii(e).show()}}(n)),e.disabled=!1;for(_=[],o=0,a=i.length;a>o;o++)e=i[o],n=pe(e).data("feature"),_.push(pe(e).click(function(e){return function(){return new Li(e).show()}}(n)));return _},invite_modal_show:function(e){return Oi.invite_modal?(this.invite_modal_already_initialized?(Oi.invite_modal.show(),Oi.rebind_modal_submit_autocompleter()):(Oi.invite_modal.show(),Oi.init(),this.invite_modal_already_initialized=!0),null!=window.active_team_member_table&&Oi.update_used_licenses(window.active_team_member_table.get_licensed_members()),Oi.set_emails(e)):pe("body").one("invite-modal-initialized",function(t){return function(){return t.invite_modal_show(e)}}(this))},init_admin:function(){return ei.set_vertical_space(2),pe("form.activity-report-generator").submit(this.submit_report_form.bind(this))},init_team_name_change_notice:function(){return pe(".team_name_change_notice .hide_link").click(function(e){return function(t){return e.hide_team_name_change_banner()}}(this))},init_trial_notice:function(){return pe(".highlight_buttons").on("click","a",function(){var e,t,n,i;switch(e=pe(this),t=null!=(i=e.attr("class"))?i.match(/button-(primary|secondary|as-link)/):void 0,n=null!=t?t[1]:"checkbox-and-link"){case"primary":n="button-blue";break;case"secondary":n="button-white";break;case"as-link":n="button-as-link"}return ze.TeamsWebActionsLogger.log("clicked_dfb_butter_bar",{button_action:e.attr("href"),button_type:n,button_label:e.text()})})},add_users:function(e,t){var n,i,r,o,s;return Event.stop(e),r=$("team-invite-form"),bt(r,"Couldn't find the team invite form."),i=pe(r).find("input[name='emails']"),o="send_invites",t&&(o="invite_buy"),n="false",pe("#team-invite-message").val()&&(n="true"),0===i.length?(b.error(At("You haven't included anyone to invite! Please invite at least one person.")),void ze.TeamsWebActionsLogger.log("invite_member_open_invite_error",{invite_or_buy:o,error_reason:"no_invites"})):(s=function(s){return function(){var a;return a=Hn.collect_form_vars(r),pe.extend(a,{team_id:s.team_id}),Hn.add_loading(e.target),new Ajax.DBRequest("/account/team/add_users",{parameters:a,subject_user:H.get_viewer().work_user,progress_text:At("Inviting members..."),noAutonotify:!0,onSuccess:function(e){var r,s,a,_;return Hn.remove_loading(),Oi.reset_modal(),Oi.add_total_licenses(t),Oi.invite_modal.hide(),a=JSON.parse(e.responseText),a?(null!=__CIRCULAR_DEPENDENCY__.MembersReact?__CIRCULAR_DEPENDENCY__.MembersReact.refresh_member_stats():window.active_team_member_table?window.active_team_member_table.add_users(null!=a?a.users:void 0):null!=__CIRCULAR_DEPENDENCY__.Dashboard&&__CIRCULAR_DEPENDENCY__.Dashboard.set_num_invited(null!=a?a.num_invited:void 0),r=function(){var e,t;e=null!=a?a.users:void 0,t=[];for(s in e)_=e[s],t.push(_);return t}(),1===r.length?b.success(At("Invited %(user_email)s.").format({user_email:r[0].email})):r.length>1?b.success(At("Invited %(user_count)d people.").format({user_count:r.length})):b.error(Tt("Skipped %(num_skipped)d person who is already a member of the team.","Skipped %(num_skipped)d people who are already members of the team.",i.length).format({num_skipped:i.length})),ze.TeamsWebActionsLogger.log("invite_member_open_invite_success",{invite_or_buy:o,invite_count:""+r.length,added_message:n})):b.error()},onFailure:function(e){var t,n;return e&&(0===e.responseText.indexOf("err:")?(t=e.responseText.substr(4),0===t.indexOf("{")?(n=t.evalJSON(!0),Hn.fill_errors(r,n),ze.TeamsWebActionsLogger.log("invite_member_open_invite_error",{invite_or_buy:o,error_reason:"form_input_invalid"})):(t=new Ke(t),b.error(t))):(b.error(),ze.TeamsWebActionsLogger.log("invite_member_open_invite_error",{invite_or_buy:o,error_reason:"problem_request"}))),Hn.remove_loading(),pe("input[type='submit']").prop("disabled",!1)}})}}(this),setTimeout(function(){return Oi.invite_modal.is_making_transition_info_request()?void 0:s()},100))},show_demo_signup_modal:function(e,t,n,i,r){var o,s,a,_;return this.webinar_key=e,this.webinar_iso_datetime=t,this.webinar_date=n,this.webinar_title=i,this.tab_url=r,_=At("Register for a webinar on %(start_time)s").format({start_time:this.webinar_date}),s=new Ri({element_id:"demo-signup-modal",title:_}),s.show(),s.$modal_window.find("input[name=webinar_key]").attr("value",this.webinar_key),s.$modal_window.find("input[name=webinar_title]").attr("value",this.webinar_title),s.$modal_window.find("input[name=Sales_Webinar_Topic__c]").attr("value",this.webinar_title),s.$modal_window.find("input[name=Sales_webinar_date__c]").attr("value",this.webinar_iso_datetime),a=s.$modal_window.find("input[name=retURL]"),a.attr("value",a.val()+"#"+this.tab_url),o=s.$modal_window.find("#demo-signup-form")[0],o.on("submit",s.on_confirm_button_click)},show_unsuspend_modal:function(e,t,n,i){var r;return r=new Pi({element_id:"dfe-unsuspend-modal",focus:"confirm"}),r.user_name=e||n,r.email=n,r.user_id=t,r.team_id=this.team_id,r.refresh_cb=i,r.show(),!1},show_remove_or_deactivate_modal:function(e,t,n,i,r,o,s,a,_){var l;return l=new qi({element_id:"dfe-remove-or-deactivate-user-modal",focus:".new-collab-input"}),l.user_name=t||i,l.email=i,l.user_id=n,l.team_id=this.team_id,l.invited=r,l.limited=o,l.hide_transfer_wipe=s,l.user_recovery_enabled=a,l.refresh_cb=_,l.show(),!1},show_remove_modal:function(e,t,n,i,r,o,s,a,_,l){var u;return u=new Mi({element_id:"dfe-remove-user-modal",focus:".new-collab-input"}),u.user_name=t||i,u.email=i,u.user_id=n,u.team_id=this.team_id,u.invited=r,u.num_api_apps=o,u.hide_transfer_setting=s,u.hide_remote_wipe_setting=a,u.refresh_cb=l,u.user_is_managed=_,u.show(),!1},remove_user:function(e,t){var n,i,r;return alert("in remove_user"),Event.stop(e),i=pe("input[type=submit]","#remove-user-modal"),i.attr("disabled",1),r=Xn.vars.user_id,n=t?!0:pe("input[name=should_disable]:checked","#remove-user-modal").val(),new Ajax.DBRequest("/account/team/remove_user",{parameters:{team_id:this.team_id,user_id:r,should_disable:n},onSuccess:function(e){return function(t){var n,i,r;return r=JSON.parse(t.responseText),null!=(n=window.active_team_member_table)&&n.remove_user(Xn.vars.user_id),null!=(i=window.removed_team_member_table)&&i.add_users(r),e.decrement_used_licenses(),b.success(At("User removed."))}}(this),cleanUp:function(){return Xn.hide(),i.removeAttr("disabled")}})},show_reinvite_modal:function(e,t,n,i){var r;return Mt.fillVal(i,"reinvite-user-email"),Mt.fillVal(t,"reinvite-user-team"),r=At("Resend invite to '%(email_address)s'").format({email_address:l.em_snippet(i,18)}),Xn.show(r,$("reinvite-user-modal"),{user_id:n,button:e})},email_verification:this.email_verification=new it("work"),show_email_verification_modal:function(){return this.email_verification.show_verify_modal(null,Me.NEW_DFB_TEAM)},reinvite_user:function(e){var t;return Event.stop(e),t=Xn.vars.user_id,new Ajax.DBRequest("/account/team/reinvite_user",{parameters:{team_id:this.team_id,user_id:t},onSuccess:function(e){var n,i,r,o;return b.success(At("Invite sent.")),null!=(i=$("team-member-info"))&&i.update(e.responseText),n=window.active_team_member_table,n?(o=n.data.users[t],o.invite_expired=!1,r={},r[t]=o,n.update_user_data(r)):void 0},cleanUp:function(){return Xn.hide()}})},show_request_license_modal:function(e,t){var n;return n=At("Send upgrade request?"),Xn.show(n,$("request-license-modal"),{user_id:t,button:e})},request_license:function(e){var t;return Event.stop(e),t=Xn.vars.user_id,new Ajax.DBRequest("/team/request_license",{parameters:{team_id:this.team_id,user_id:t},onSuccess:function(e){return pe("#request_license_text").hide(),pe("#request-license-section").hide(),b.success(At("Request sent."))},cleanUp:function(){return Xn.hide()}})},show_user_activity_log_modal:function(e,t,n){var i;return i=pe("#activity-log-modal"),i.find(".activity-log-email").text(t),i.find(".activity-log-name").text(n),i.find("#activity-log-user-message").show(),Xn.show(At("Create activity report"),i[0],{user_id:e})},show_team_activity_log_modal:function(e,t){var n;return n=pe("#activity-log-modal"),n.find(".activity-log-email").text(e),n.find(".activity-log-name").text(t),n.find("#activity-log-team-message").show(),Xn.show(At("Create full activity report"),n[0])},generate_activity_log:function(e){var t,n,i,r,o,s,a;return Event.stop(e),n=pe("#activity-log-modal"),i=n.find("input[name='from_date']").val(),o=n.find("input[name='to_date']").val(),i>o?void b.error(At("Your start date is after your end date.")):(r=this.team_id,a=Xn.vars.user_id,s=(new Date).getTimezoneOffset().toString(),t=pe(".activity-report-generator .freshbutton-blue"),t.prop("disabled",!0),new Ajax.DBRequest("/team/events_report/csv",{parameters:{from_date:i,to_date:o,team_id:r,user_id:a,tzoffset:s},onSuccess:function(e){return b.success(At("Report started. We'll email you when it's ready."))},cleanUp:function(){return Xn.hide(),t.prop("disabled",!1)}}))},show_reset_password_modal:function(e,t,n){
var i,r;return r=s({path:"/team/admin/member",query:{id:n}}).toString(),pe("#reset-password-modal .member-name").text(t),pe("#reset-password-modal .member-page-link").attr("href",r),i=At("Reset password for '%(user_name)s'").format({user_name:t}),Xn.show(i,$("reset-password-modal"),{user_id:n,button:e})},reset_password:function(e){var t;return Event.stop(e),t=Xn.vars.user_id,new Ajax.DBRequest("/account/team/reset_password",{parameters:{team_id:this.team_id,user_id:t},onSuccess:function(e){return b.success(At("User's password reset."))},cleanUp:function(){return Xn.hide()}})},show_reset_all_passwords_modal:function(){return Xn.show(At("Reset all passwords"),$("reset-all-passwords-modal"))},set_async_password_reset:function(e){return this._use_async_reset=e},reset_all_passwords:function(){return new Ajax.DBRequest("/account/team/reset_all_passwords",{parameters:{team_id:this.team_id},job:this._use_async_reset,subject_user:H.get_viewer().work_user,progress_text:At("Resetting all passwords..."),onSuccess:function(e){return b.success(At("All passwords reset."))},cleanUp:function(){return Xn.hide()}})},show_admin_status_modal:function(e,t,n,i,r,o){var s,a,_,l;return a=r.trim()||i,_=void 0,s=void 0,l=void 0,o?(l=At("Add admin permissions for '%(person_name)s'").format({person_name:a.escapeHTML()}),_=At("Are you sure you want to add admin permissions for <strong>%(person_name)s</strong>?").format({person_name:a.escapeHTML()}),s=At("Add admin permissions",{comment:"make this user an admin; give them the permissions an admin has"})):(l=At("Remove admin privileges from '%(person_name)s'").format({person_name:a.escapeHTML()}),_=At("Are you sure you want to remove admin permissions from <strong>%(person_name)s</strong>?").format({person_name:a.escapeHTML()}),s=At("Remove admin permissions",{comment:"clicking this button completes the action: it removes a person's admin status"})),Mt.fillVal(i,"admin-status-email"),Mt.fillVal(_,"admin-status-action"),Mt.fillVal(s,"admin-status-button-action"),Xn.show(l,$("admin-status-modal"),{user_id:n,button:e,admin_on:o}),!1},set_admin_status:function(e){var t;return Event.stop(e),t=Xn.vars.user_id,new Ajax.DBRequest("/account/team/set_admin_status",{parameters:{team_id:this.team_id,user_id:t,on:Xn.vars.admin_on?"yes":"no"},onSuccess:function(e){var t,n;return t=At(Xn.vars.admin_on?"User's admin status granted.":"User's admin status removed."),null!=__CIRCULAR_DEPENDENCY__.MembersReact?__CIRCULAR_DEPENDENCY__.MembersReact.refresh_member_stats():window.active_team_member_table?(n=JSON.parse(e.responseText),window.active_team_member_table.update_user_data(n),b.success(t)):Xn.vars.admin_on?window.location="/team/admin/member?id=%d&msg=granted".format(Xn.vars.user_id):window.location="/team/admin/member?id=%d&msg=removed".format(Xn.vars.user_id)},cleanUp:function(){return Xn.hide()}})},show_disable_2fa_modal:function(e,t,n){return pe("#disable-2fa-modal .member-name").text(n),Xn.show(At("Disable two-step verification"),$("disable-2fa-modal"),{user_id:t,elm:e})},show_reset_2fa_modal:function(e,t,n){return pe("#reset-2fa-modal .member-name").text(n),Xn.show(At("Reset two-step verification"),$("reset-2fa-modal"),{user_id:t,user_name:n,elm:e})},reset_2fa:function(){return new Ajax.DBRequest("/account/team/reset_2fa",{parameters:{team_id:this.team_id,user_id:Xn.vars.user_id},onSuccess:function(e){var t;return pe(".tfa_enabled").replaceWith(At("Disabled")),t=JSON.parse(e.responseText),null!=__CIRCULAR_DEPENDENCY__.MembersReact?__CIRCULAR_DEPENDENCY__.MembersReact.refresh_member_stats():window.active_team_member_table?window.active_team_member_table.update_user_data(t):__CIRCULAR_DEPENDENCY__.MemberActionsMenu&&__CIRCULAR_DEPENDENCY__.MemberActionsMenu.update_container_users(".buttons",t),b.success(At("Two-step verification reset for %(user_name)s").format({user_name:Xn.vars.user_name})),Xn.hide()}})},disable_2fa:function(){return new Ajax.DBRequest("/account/team/disable_2fa",{parameters:{team_id:this.team_id,user_id:Xn.vars.user_id},onSuccess:function(e){var t;return pe(".tfa_enabled").replaceWith(At("Disabled")),t=JSON.parse(e.responseText),null!=__CIRCULAR_DEPENDENCY__.MembersReact?__CIRCULAR_DEPENDENCY__.MembersReact.refresh_member_stats():window.active_team_member_table?window.active_team_member_table.update_user_data(t):__CIRCULAR_DEPENDENCY__.MemberActionsMenu&&__CIRCULAR_DEPENDENCY__.MemberActionsMenu.update_container_users(".buttons",t),b.success(At("Two-step verification disabled.")),Xn.hide()}})},show_sso_preview_email:function(e){return Xn.show(At("Email preview"),$(e))},show_sso_sample_email:function(e){return Xn.show(At("Sample email"),$(e))},show_user_message_modal:function(e,t,n){var i;return Mt.fillVal(n,"user-message-email"),i=At("Send email to '%(user_name)s'").format({user_name:e}),$("user-message").value="",Xn.show(i,$("user-message-modal"),{user_name:e,user_id:t}),Rt.focus.defer("user-message")},send_user_message:function(){var e,t;return t=Xn.vars.user_id,e=$F("user-message").trim(),new Ajax.DBRequest("/account/team/send_user_message",{parameters:{user_id:t,team_id:this.team_id,message:e},onSuccess:function(){var e;return e=Xn.vars.user_name,b.success(At("Message successfully sent to %(user_name)s.").format({user_name:e})),Xn.hide()}})},hide_team_name_change_banner:function(){return new Ajax.DBRequest("/account/team/name_change_notice_received",{parameters:{team_id:this.team_id}}),pe(".team_name_change_notice").hide(),!1},hide_pin_banner:function(){return new Ajax.DBRequest("/team/invalidate_pin"),pe(".pin_notice").hide()},hide_pin_banner_with_user_id:function(e,t){var n;return n=function(e){return pe(t).closest("span").removeClass("on").addClass("off")},null===e?new Ajax.DBRequest("/team/invalidate_pin",{onSuccess:n}):new Ajax.DBRequest("/team/invalidate_pin",{parameters:{user_id:e},onSuccess:n})},get_pin_with_user_id:function(e,t,n){var i;return null==n&&(n=null),null===n&&(n=function(e,t){return pe(t).closest("span").find(".pin-value").text(e.pin+" -"),pe(t).closest("span").removeClass("off").addClass("on")}),i=function(e){var i;return i=JSON.parse(e.responseText),n(i,t)},null===e?new Ajax.DBRequest("/team/generate_pin",{onSuccess:i}):new Ajax.DBRequest("/team/generate_pin",{parameters:{user_id:e},onSuccess:i})},send_team_message:function(e){var t;return Event.stop(e),t=$F("team-message").trim(),t?new Ajax.DBRequest("/account/team/send_team_message",{parameters:{team_id:this.team_id,message:t},onSuccess:function(e){return b.success(At("Message successfully sent to team.")),Xn.hide()}}):void 0},show_security_message_modal:function(){return(new Bi).show()},send_team_security_message:function(e){var t,n;return Event.stop(e),n=$F("team-security-message").trim(),t=$("team-security-message-form"),new Ajax.DBRequest("/account/team/send_team_message",{parameters:t.serialize(!0),onSuccess:function(e){return b.success(At("Message successfully sent.")),Xn.hide()}})},used_licenses:0,total_licenses:0,set_used_licenses:function(e,t){return this.used_licenses=e,this.total_licenses=t},decrement_used_licenses:function(){return this.set_used_licenses(this.used_licenses-1,this.total_licenses)},show_migration_link:function(e,t){return $("migration-url").value=t,Xn.show(At("Migration link for '%(email)s'").format({email:l.em_snippet(e,18)}),$("migrate-url-modal")),$("migration-url").select()},show_end_session_modal:function(e,t,n){return ei.hide_all(),pe("#end-session-modal .member-name").text(pe("#member-name").text()),Xn.show(At("Close web session",{comment:"Log out of your current Dropbox web session"}),$("end-session-modal"),{login_id:e,user_id:t,elm:n})},end_session:function(){return new Ajax.DBRequest("/logout_remote_session",{parameters:{remote_login_id:Xn.vars.login_id,team_id:this.team_id,user_id:Xn.vars.user_id},onSuccess:function(){return Xn.hide(),ji.remove_closest_row(Xn.vars.elm),b.success(At("Web session closed."))}})},unlink_device:function(e,t,n,i,r,o,s){var a,_;return ei.hide_all(),a=$("unlink-device-modal-"+o),_=At("Unlink %(device_name)s").format({device_name:n}),Xn.show(_,a,{app_id:t,user_id:r,elm:s,device_id:e,display_name:n})},unlink_device_submit:function(){return new Ajax.DBRequest("/account/unlink_team_device",{parameters:{app_id:Xn.vars.app_id,team_id:this.team_id,user_id:Xn.vars.user_id,device_id:JSON.stringify(Xn.vars.device_id)},subject_user:H.get_viewer().work_user,onSuccess:function(){return Xn.hide(),ji.remove_closest_row(Xn.vars.elm),b.success(At("%(device_name)s unlinked.").format({device_name:Xn.vars.display_name}))}})},disable_app:function(e,t,n,i){return ei.hide_all(),pe("#disable-app-modal .app-name").text(t),pe("#disable-app-modal .member-name").text(pe("#member-name").text()),Xn.show(At("Disable '%(app_name)s'?").format({app_name:t}),$("disable-app-modal"),{app_id:e,user_id:n,elm:i})},disable_app_submit:function(){return new Ajax.DBRequest("/api/uninstall_app",{parameters:{app_id:Xn.vars.app_id,keep_sandbox_files:!0,team_id:this.team_id,user_id:Xn.vars.user_id},subject_user:H.get_viewer().work_user,onSuccess:function(e){return Xn.hide(),ji.remove_closest_row(Xn.vars.elm),b.success(e.responseText)}})},remove_closest_row:function(e){var t,n,i;return t=pe(e).closest(".team_admin_table_row"),n=pe(t).closest(".team_admin_table"),1===n.find(".team_admin_table_row").length?(i=n.prev(".team_admin_table_title"),i.length||(i=pe(".team_apps_table_panel")),i.remove(),n.remove()):t.remove()},submit_report_form:function(e){return pe(e.target.elements.tzoffset).val(""+(new Date).getTimezoneOffset()),!0},show_recover_user_modal:function(e,t,n,i){var r;return r=new Ui({element_id:"recover-user-modal",focus:"cancel"}),r.user_name=e||n,r.email=n,r.user_id=t,r.team_id=this.team_id,r.refresh_cb=i,r.show(),!1}},Ii=Xe.BetaEnrollConfirmationModal=function(e){function t(e){this.feature_name=e,this.on_confirm_button_click=un(this.on_confirm_button_click,this),t.__super__.constructor.call(this,{element_id:"beta-enroll-confirmation-modal"})}return _n(t,e),t.prototype.on_confirm_button_click=function(e){return pe("<input>").attr({type:"hidden",name:"feature_name",value:this.feature_name}).appendTo("#beta-enroll-confirmation-modal form"),this.$modal_window.addClass("ajax-loading")},t}(rt),Li=Xe.BetaFeedbackModal=function(e){function t(e){this.feature_name=e,this.success=un(this.success,this),t.__super__.constructor.call(this,{element_id:"beta-feedback-modal"}),this.on_confirm_button_click=function(e){return function(t){var n,i,r;return t.preventDefault(),n=pe(t.target),i=n.closest("form"),r={feature_name:e.feature_name},Hn.ajax_submit(i[0],!1,e.success,e.error,n[0],r)}}(this)}return _n(t,e),t.prototype.success=function(e){return b.success(At("Thank you for your feedback.")),this.$modal_window.hide()},t.prototype.error=function(e){return 200!==e.status?b.error(At("Failed to submit feedback. Please try again.")):void 0},t}(rt),Ri=Xe.DemoSignupModal=function(e){function t(){return this.on_show=un(this.on_show,this),this.on_confirm_button_click=un(this.on_confirm_button_click,this),t.__super__.constructor.apply(this,arguments)}return _n(t,e),t.prototype.on_confirm_button_click=function(e){var t,n,i,r,o,s,a,_,l,u,d,c;return e.preventDefault(),d=$("demo-signup-form"),_=$("1210"),s=pe(d).find("input[name='first_name']").val(),pe(_).find("input[name='FirstName']").attr("value",s),a=pe(d).find("input[name='last_name']").val(),pe(_).find("input[name='LastName']").attr("value",a),o=pe(d).find("input[name='email']").val(),pe(_).find("input[name='Email']").attr("value",o),u=pe(d).find("input[name='phone_number']").val(),pe(_).find("input[name='Phone']").attr("value",u),t=pe(d).find("input[name='company_name']").val(),pe(_).find("input[name='Company']").attr("value",t),i=pe(d).find("select[name='company_size']"),n=i.find("option:selected").val(),pe(_).find("input[name='Company_size__c']").attr("value",n),r=$(this.$modal_window.find(".confirm-button")[0]),c=function(e){return function(t){return e.$modal_window.hide(),_.submit()}}(this),l=Hn.collect_form_vars(d,!0),Hn.ajax_submit(d,!1,c,!1,r,l,!0)},t.prototype.on_show=function(e){return this.$modal_window.find(".db-modal-content").css({"overflow-y":""}),Qn.init()},t}(rt),Ni=Xe.AccountTransferBaseModal=function(e){function t(e,n,i){this.file_action_selector=n,this.transfer_choice_selector=i,this._clearInput=un(this._clearInput,this),this._markInputInvalid=un(this._markInputInvalid,this),this._markInputValid=un(this._markInputValid,this),this._tokenRemove=un(this._tokenRemove,this),this._tokenAdd=un(this._tokenAdd,this),this._selectChange=un(this._selectChange,this),this._isTransferSelected=un(this._isTransferSelected,this),this.checkAndApproveMemberRemoval=un(this.checkAndApproveMemberRemoval,this),this.on_cancel_button_click=un(this.on_cancel_button_click,this),this.execute_form=un(this.execute_form,this),this.get_cancel_button=un(this.get_cancel_button,this),this.get_confirm_button=un(this.get_confirm_button,this),this.get_button_class=un(this.get_button_class,this),this.set_modal_class=un(this.set_modal_class,this),this.handleAjaxFailure=un(this.handleAjaxFailure,this),this.on_show=un(this.on_show,this),t.__super__.constructor.call(this,e,this.file_action_selector,this.transfer_choice_selector)}return _n(t,e),t.prototype.on_show=function(){return 0!==this.$modal_window.find("#manage-files-new-collab-input").length?(this.auto_completer=new Autocompleter.TeamTokenizer(H.get_viewer().get_user_by_role(A.ROLE_WORK),"manage-files-new-collab-input","manage-files-new-whobulk","manage-files-hidden-input",{hide_import_contacts:!0,suggestions_disabled:!0,wrap_name:!0,single_token:!0,contact_filter:function(e){return function(t){return t.excludeNonTeam().excludeNewStyleGroups().excludeByEmail(e.email)}}(this)}),this.tokenAdd=pe.proxy(this._tokenAdd,this),this.tokenRemove=pe.proxy(this._tokenRemove,this),this.$collab_input=this.$modal_window.find("#manage-files-new-collab-input")[0],this.$collab_input.on("token:add",this.tokenAdd),this.$collab_input.on("token:remove",this.tokenRemove),this.$textinput=this.$modal_window.find(".tokenized_autocompleter_container .textinput"),this.selectChange=pe.proxy(this._selectChange,this),this.$modal_window.find(this.file_action_selector).on("change",this.selectChange)):void 0},t.prototype.handleAjaxFailure=function(e){return 200===e.status&&this._isTransferSelected()?this._markInputInvalid():void 0},t.prototype.set_modal_class=function(e){var t,n,i,r,o,s;return i="suspending deleting approve_transfer_to_suspended",r=this.get_form(),r.removeClass(i),null!=e&&r.addClass(e),null!=(o=pe(".suspend_option_content"))&&o.removeClass("title_bubble no_suspend"),n=null!=this.limited&&this.limited,t=null!=this.invited&&this.invited,n||t?(pe(".suspend_option_content").addClass("title_bubble no_suspend"),s="",s=At(t?"Invited members can not be suspended":"Limited members can not be suspended"),pe(".suspend_option_content").attr("data-title",s)):void 0},t.prototype.get_button_class=function(){var e;return e=this.get_form(),e.hasClass("suspending")?".confirm_deactivate_button":e.hasClass("deleting")?".confirm_delete_button":e.hasClass("approve_transfer_to_suspended")?".confirm_transfer_to_suspended_button":void 0},t.prototype.get_confirm_button=function(){var e;return e=this.get_button_class(),null!=e?$(this.$modal_window.find(e+" .confirm-button")):$(this.$modal_window.find(".confirm-button"))},t.prototype.get_cancel_button=function(){var e;return e=this.get_button_class(),null!=e?$(this.$modal_window.find(e+" .cancel-button")):$(this.$modal_window.find(".cancel-button"))},t.prototype.execute_form=function(){var e,t;return t=this.get_form()[0],e=this.get_confirm_button(),Hn.ajax_submit(t,!1,this.success_callback,this.handleAjaxFailure,e)},t.prototype.on_cancel_button_click=function(e){var n;return e.preventDefault(),n=this.get_form(),n.hasClass("approve_transfer_to_suspended")?(this.reset_button_click(this.$confirm_button,this.on_confirm_button_click),this.reset_button_click(this.$cancel_button,this.on_cancel_button_click)):t.__super__.on_cancel_button_click.apply(this,arguments)},t.prototype.reset_button_click=function(e,t){return e.off("click"),null!=t?e.on("click",t):void 0},t.prototype.checkAndApproveMemberRemoval=function(e){var t,n;return!pe("#deactivate_option").is(":checked")&&pe("#transfer_files_on").is(":checked")&&!this.invited&&(t=pe(".tokenized_autocompleter_container .token-display-text"),n=pe(".tokenized_autocompleter_container .token-suspended"),t.length&&n.length)?(this.set_modal_class("approve_transfer_to_suspended"),this.$modal_window.find(".target_user_name").text(t.text()),this.$confirm_button=this.get_confirm_button(),this.reset_button_click(this.$confirm_button,function(e){return function(t){return e.execute_form()}}(this)),this.$cancel_button=this.get_cancel_button(),void this.$cancel_button.on("click",e)):this.execute_form()},t.prototype._isTransferSelected=function(){return pe(this.transfer_choice_selector).prop("checked")},t.prototype._selectChange=function(e){return this._isTransferSelected()?this.$textinput.removeClass("unselected"):this.$textinput.addClass("unselected")},t.prototype._tokenAdd=function(e){return this.$collab_input.hide(),e.memo.valid?this._markInputValid():this._markInputInvalid()},t.prototype._tokenRemove=function(e){return this.$collab_input.show(),this._clearInput()},t.prototype._markInputValid=function(){return this._clearInput(),this.$textinput.addClass("valid")},t.prototype._markInputInvalid=function(){return this._clearInput(),this.$textinput.addClass("invalid")},t.prototype._clearInput=function(){return this.$textinput.removeClass("valid"),this.$textinput.removeClass("invalid")},t}(rt),Bi=Xe.TwoFactorMessageModal=function(e){function t(){t.__super__.constructor.call(this,{element_id:"team-security-message-modal",focus:"#team-security-message"})}return _n(t,e),t.prototype.on_confirm_button_click=function(e){return ji.send_team_security_message(e),this.hide()},t}(rt),Pi=Xe.DfeUnsuspendUserModal=function(e){function t(e){this.on_confirm_button_click=un(this.on_confirm_button_click,this),this.success_callback=un(this.success_callback,this),t.__super__.constructor.call(this,e)}return _n(t,e),t.prototype.before_show=function(){var e;return t.__super__.before_show.call(this),e=At("Unsuspend %(user_name)s").format({user_name:this.user_name}),this.$modal_window.find(".db-modal-title-text").text(e),this.$modal_window.find("[name=user_id]").attr("value",this.user_id),this.$modal_window.find("[name=team_id]").attr("value",this.team_id),this.$modal_window.find("[name=email]").attr("value",this.email),this.$modal_window.find(".unsuspended_name").text(this.user_name),this.$modal_window.find(".unsuspended_email").text(this.email)},t.prototype.success_callback=function(e){var t;return null!=(t=__CIRCULAR_DEPENDENCY__.MembersReact)&&t.refresh_member_stats(),this.hide(),"function"==typeof this.refresh_cb?this.refresh_cb("unsuspended"):void 0},t.prototype.on_confirm_button_click=function(e){var t,n;return e.preventDefault(),n=this.$modal_window.find(".dfe-unsuspend-modal")[0],t=$(this.$modal_window.find(".confirm-button")[0]),Hn.ajax_submit(n,!1,this.success_callback,!1,t)},t}(rt),qi=Xe.DfeRemoveOrDeactivateUserModal=function(e){function t(e){this.on_confirm_button_click=un(this.on_confirm_button_click,this),this.success_callback=un(this.success_callback,this),this.on_show=un(this.on_show,this),this.handle_change_action=un(this.handle_change_action,this),this.switch_to_removal_mode=un(this.switch_to_removal_mode,this),this.switch_to_deactivation_mode=un(this.switch_to_deactivation_mode,this),this.show_removal_content=un(this.show_removal_content,this),this.show_deactivation_content=un(this.show_deactivation_content,this),t.__super__.constructor.call(this,e,"input[name=transfer_files]","#transfer_files_on")}return _n(t,e),t.prototype.get_form=function(){return this.$modal_window.find(".dfe-remove-or-deactivate-user-modal")},t.prototype.set_form_action_to_deactivate=function(){return pe(".dfe-remove-or-deactivate-user-modal").attr("action","/account/team/suspend_user")},t.prototype.set_form_action_to_remove=function(){return pe(".dfe-remove-or-deactivate-user-modal").attr("action","/account/team/remove_user")},t.prototype.show_deactivation_content=function(){return this.set_modal_class("suspending")},t.prototype.show_removal_content=function(){return this.set_modal_class("deleting")},t.prototype.switch_to_deactivation_mode=function(){return this.show_deactivation_content(),this.set_form_action_to_deactivate()},t.prototype.switch_to_removal_mode=function(){return this.show_removal_content(),this.set_form_action_to_remove(),this.invited?this.$modal_window.find(".remote_wipe_setting").remove():void 0},t.prototype.handle_change_action=function(e){return e.preventDefault(),pe("#deactivate_option").is(":checked")?this.switch_to_deactivation_mode():this.switch_to_removal_mode()},t.prototype.on_show=function(e){var n;return t.__super__.on_show.call(this),pe("input[name=deactivate_or_remove]").on("change",this.handle_change_action),this.$modal_window.find(".deleted_user_name").text(this.user_name),n=At("Suspend or delete %(user_name)s").format({user_name:this.user_name}),this.limited||this.invited?(pe("#deactivate_option").prop("disabled",!0),pe("#delete_option").attr("checked","checked"),this.switch_to_removal_mode()):(pe("#deactivate_option").attr("checked","checked"),this.switch_to_deactivation_mode()),this.$modal_window.find(".db-modal-title-text").text(n),this.$modal_window.find("[name=user_id]").attr("value",this.user_id),this.$modal_window.find("[name=team_id]").attr("value",this.team_id),this.hide_transfer_wipe&&(this.$modal_window.find(".transfer_data_on_remove_setting").remove(),this.$modal_window.find(".remote_wipe_setting").remove()),this.user_recovery_enabled?(this.$modal_window.find(".desc_content_recovery_disabled").remove(),this.$modal_window.find(".desc_content_recovery_enabled").show()):(this.$modal_window.find(".desc_content_recovery_disabled").show(),this.$modal_window.find(".desc_content_recovery_enabled").remove())},t.prototype.success_callback=function(e){var t;return null!=__CIRCULAR_DEPENDENCY__.MembersReact&&__CIRCULAR_DEPENDENCY__.MembersReact.refresh_member_stats(),t="",t=pe("#deactivate_option").is(":checked")?"suspended":"deleted",this.hide(),"function"==typeof this.refresh_cb?this.refresh_cb(t):void 0},t.prototype.on_confirm_button_click=function(e){return e.preventDefault(),this.checkAndApproveMemberRemoval(this.switch_to_removal_mode)},t}(Ni),Mi=Xe.DfeRemoveUserModal=function(e){function t(e){this.on_confirm_button_click=un(this.on_confirm_button_click,this),this.switch_to_removal_mode=un(this.switch_to_removal_mode,this),this.success_callback=un(this.success_callback,this),this.on_show=un(this.on_show,this),t.__super__.constructor.call(this,e,"input[name=transfer_files]","#transfer_files_on")}return _n(t,e),t.prototype.get_form=function(){return this.$modal_window.find(".dfe-remove-user-modal")},t.prototype.on_show=function(e){var n,i;return t.__super__.on_show.call(this),this.$modal_window.find(".remove_user_name").text(this.user_name),i=this.invited?At("Uninvite %(user_name)s").format({user_name:this.user_name}):At("Delete %(user_name)s").format({user_name:this.user_name}),this.$modal_window.find(".db-modal-title-text").text(i),this.num_api_apps?(n=Tt("%(num)s API app","%(num)s API apps",this.num_api_apps).format({num:this.num_api_apps}),this.$modal_window.find(".num_api_app").text(n)):this.$modal_window.find(".api_app_warning").hide(),this.$modal_window.find("[name=user_id]").attr("value",this.user_id),this.$modal_window.find("[name=team_id]").attr("value",this.team_id),this.user_is_managed?this.$modal_window.find(".remove-content-limited-member").remove():(this.$modal_window.find(".remove_content").remove(),this.$modal_window.find(".remote_wipe_setting").remove()),this.invited&&(this.$modal_window.find(".transfer_files_option").remove(),this.$modal_window.find(".remote_wipe_setting").remove(),this.get_form().addClass("invited")),this.hide_transfer_setting&&this.$modal_window.find(".transfer_files_option").remove(),this.hide_remote_wipe_setting?this.$modal_window.find(".remote_wipe_setting").remove():void 0},t.prototype.success_callback=function(e){var t,n,i,r;return r=JSON.parse(e.responseText),null!=__CIRCULAR_DEPENDENCY__.MembersReact?__CIRCULAR_DEPENDENCY__.MembersReact.refresh_member_stats():(null!=(n=window.active_team_member_table)&&n.remove_user(this.user_id),null!=(i=window.removed_team_member_table)&&i.add_users(r)),t="",t=this.invited?"uninvited":"deleted",ji.decrement_used_licenses(),this.hide(),"function"==typeof this.refresh_cb?this.refresh_cb(t):void 0},t.prototype.switch_to_removal_mode=function(){return this.set_modal_class()},t.prototype.on_confirm_button_click=function(e){return e.preventDefault(),this.checkAndApproveMemberRemoval(this.switch_to_removal_mode)},t}(Ni),Fi=Xe.ManageFilesModal=function(e){function t(e,n,i){this.source_user_id=e,this.source_user_name=n,this.options=i,this.on_confirm_button_click=un(this.on_confirm_button_click,this),this.switch_to_manage_files=un(this.switch_to_manage_files,this),this.success_callback=un(this.success_callback,this),t.__super__.constructor.call(this,this.options,"input[name=file_action]","#transfer_files_on")}return _n(t,e),t.prototype.get_form=function(){return this.$modal_window.find(".manage-files-modal")},t.prototype.on_show=function(){var e;return t.__super__.on_show.call(this),this.$modal_window.find("[name='source_user_id']").attr("value",this.source_user_id),this.$modal_window.find(".source-user-name").text(this.source_user_name),e=At("Manage %(team_member)s's files").format({team_member:this.source_user_name}),this.$modal_window.find(".db-modal-title-text").text(e)},t.prototype.success_callback=function(e){var t;return t=JSON.parse(e.responseText),null!=__CIRCULAR_DEPENDENCY__.MembersReact?__CIRCULAR_DEPENDENCY__.MembersReact.refresh_member_stats():window.removed_team_member_table?window.removed_team_member_table.update_user_data(t):null!=__CIRCULAR_DEPENDENCY__.MemberActionsMenu&&__CIRCULAR_DEPENDENCY__.MemberActionsMenu.update_container_users(".buttons",t),pe("#transfer_files_on").prop("checked")?b.success(At("Transfer started",{comment:"This refers to the start of a file transfer from one Dropbox to another"})):b.success(At("Permanently deleted files")),this.hide()},t.prototype.switch_to_manage_files=function(){return this.set_modal_class("manage-files-modal")},t.prototype.on_confirm_button_click=function(e){return e.preventDefault(),this.checkAndApproveMemberRemoval(this.switch_to_manage_files)},t}(Ni),Vi=Xe.show_manage_files_modal=function(e,t){var n;return n=new Fi(e,t,{element_id:"manage-files-modal",focus:".new-collab-input"}),n.show()},Ui=Xe.RecoverUserModal=function(e){function t(e){this.on_confirm_button_click=un(this.on_confirm_button_click,this),this.success_callback=un(this.success_callback,this),t.__super__.constructor.call(this,e)}return _n(t,e),t.prototype.before_show=function(){var e;return t.__super__.before_show.call(this),e=At("Recover deleted user %(user_name)s").format({user_name:this.user_name}),this.$modal_window.find(".db-modal-title-text").text(e),this.$modal_window.find("[name=user_id]").attr("value",this.user_id),this.$modal_window.find("[name=team_id]").attr("value",this.team_id),this.$modal_window.find(".user_name").text(this.user_name),this.$modal_window.find(".user_email").text(this.email)},t.prototype.success_callback=function(e){var t;return null!=(t=__CIRCULAR_DEPENDENCY__.MembersReact)&&t.refresh_member_stats(),this.hide(),"function"==typeof this.refresh_cb?this.refresh_cb("recovered"):void 0},t.prototype.on_confirm_button_click=function(e){var t,n;return e.preventDefault(),n=this.$modal_window.find(".recover-user-modal")[0],t=$(this.$modal_window.find(".confirm-button")[0]),Hn.ajax_submit(n,!1,this.success_callback,!1,t)},t}(rt),Hi=function(){var e;return e=function(e,t){var n,i;return pe(t).css("display","none"),n=pe(t).closest("#user_generate_liveops_pin"),i=n.find(".user_generate_liveops_pin_value"),i.text(e.pin),pe(t).addClass("liveops_pin_elem_invisible"),n.find(".user_generate_liveops_pin_text").removeClass("liveops_pin_elem_invisible")},ji.get_pin_with_user_id(null,this,e),!1},pe("#user_generate_liveops_pin_button").click(Hi),zi=function(){return pe("#help_callus_title").hide(),pe("#help_callus_details").show(),!1},pe("#help_callus_trigger").click(zi);var Yi;Yi=Xe.UpdateEvents={ADD:"db:add_file_objects",REMOVE:"db:remove_file_objects",MOVE:"db:move_file_objects"};var Wi;Wi=Xe.BrowseUtil={THUMBS_BATCH_SIZE:16,make_browsefile:function(e,t){var n;return null==t&&(t=null),n=Object.clone(e),n.is_dir?(n.ago="",n.ts=0):n.target_ns=!1,n.sort_key=Rt.decode_sort_key(n.sort_key),n.request_id=null!=t?t:null,new er(n)},filepreview_from_selected:function(e,n,i,r){var o,a,_,l,u;return null==n&&(n=!1),null==i&&(i=!1),null==r&&(r=K.OREF_CONSTANTS.BROWSE_UNKNOWN),e.bytes<0||"download"===e.preview_type?void window.open(e.href,"_blank"):void(ee.getGandalfRule("file_viewer_react")?(a=this.getIndexOfFileInArray(pr.files,e),l=function(){var n,i;return n=t.browse_uri_for_fq_path(pr.active_user,e.fq_path),n.setPath(We.parent_dir(n.path)),i=s.encode_parts(n.getPath()),p.push_state(i,n.getQuery(),{immediatelyRestoreState:!1})},ce.open(pr.files,a,pr.active_user,"react-file-viewer",{fileViewTarget:K.FileViewTargetType.PRIVATE,fileViewOrigin:K.FileViewOriginType.BROWSE,fileViewAction:K.FileViewActionType.CLICK,shouldFocusCommentInput:i,disableRouting:n,disableFlipping:n,onCloseViewer:n?l:void 0})):(u=p.get_url(),_=p.deconstruct_url(u),o=0===u.indexOf("/s/"),jr.show(e,pr.active_user,{files:pr.files,file_view_target:K.FileViewTargetType.PRIVATE,should_focus_comment_input:i},r),n||o||_.qargs.preview===e.filename||jr.set_preview_url()))},profile_files:function(e){var t,n,i,r,o;for(r={files:0,folders:0,shared_folders:0,team_shared_folders:0,deleted:0,public_folder:0,rejoinables:0,sandboxes:0,target_namespaces:0,in_root_coll:0,compressible_count:0,can_permanently_delete:0},n=0,i=e.length;i>n;n++)t=e[n],t.dir?r.folders+=1:r.files+=1,t.is_sandbox()&&(r.sandboxes+=1),t.is_shared_folder()&&(r.shared_folders+=1),t.is_team_shared_folder()&&(r.team_shared_folders+=1),-1===t.bytes&&(r.deleted+=1),t.target_ns&&(r.target_namespaces+=1),"/public"===t.fq_path.toLowerCase()&&pr.public_folder_enabled&&(r.public_folder=1),t.in_root_coll&&(r.in_root_coll+=1),t.compressible&&(r.compressible_count+=1),(null!=(o=pr.permanent_delete_is_disabled_by_ns_id)?o[t.ns_id]:void 0)||(r.can_permanently_delete+=1);return r},profile_summary:function(e){var t,n;return t=Tt("%d file","%d files",e.files,{comment:"used in a phrase such as 'x files and y folders'"}).format(e.files),n=Tt("%d folder","%d folders",e.folders,{comment:"used in a phrase such as 'x files and y folders'"}).format(e.folders),e.files&&e.folders?At("%(x_files)s and %(y_folders)s",{comment:"x_files will either be '1 file' or 'd files', similar for x_folders"}).format({x_files:t,y_folders:n}):e.files?t:e.folders?n:""},BROWSE_MODE:"browse",SEARCH_MODE:"search",SPECIAL_MODES:["search"],set_browse_mode:function(){var e,t,n,i,r,o,s,a;for(e=pe("#browse"),n=e.find("#browse-root-actions"),i=e.find("#browse-sort"),t=e.find("#browse-header-status"),a=this.SPECIAL_MODES,r=0,o=a.length;o>r;r++)s=a[r],e.removeClass(s),n.removeClass(s),i.removeClass(s),t.removeClass(s);return Ji.reset_fulltext_search(!0),e.removeClass("fulltext_search"),n.removeClass("fulltext_search"),i.removeClass("fulltext_search"),t.removeClass("fulltext_search"),pe("#fulltext-search-loading").hide(),pe("#fulltext-search-all-link").hide()},set_special_mode:function(e){var t,n,i,r,o,s,a,_;for(t=pe("#browse"),i=t.find("#browse-root-actions"),r=t.find("#browse-sort"),n=t.find("#browse-header-status"),bt(-1!==this.SPECIAL_MODES.indexOf(e),"unknown mode"),_=this.SPECIAL_MODES,o=0,s=_.length;s>o;o++)a=_[o],a!==e&&(t.removeClass(a),i.removeClass(a),r.removeClass(a),n.removeClass(a));
return t.addClass(e),i.addClass(e),r.addClass(e),n.addClass(e),e===this.SEARCH_MODE?(t.addClass("fulltext_search"),i.addClass("fulltext_search"),r.addClass("fulltext_search"),n.addClass("fulltext_search")):void 0},get_mode:function(){var e,t,n,i,r;for(r=this.BROWSE_MODE,i=this.SPECIAL_MODES,e=0,t=i.length;t>e;e++)n=i[e],pe("#browse").hasClass(n)&&(r=n);return r},load_visible_thumbs:function(){var e,t,n,i,r,o,s,a,_,l,u,d,c,h,f,p;for(a=this.get_files_in_view(),t=a[1]-a[0],s=[Math.max(a[0]-t,0),a[0]],o=[Math.min(a[1],pr.files.length),Math.min(a[1]+t,pr.files.length)],e=[],f=[a,o,s],l=0,d=f.length;d>l;l++)for(r=f[l],i=r[0],_=r[1],p=pr.files.slice(i,+_+1||9e9),u=0,c=p.length;c>u;u++)n=p[u],n.get_div()&&e.push(n.get_div().down("img"));return h=function(e){return e.src.endsWith(G.SPACER)?void 0:(e.addClassName("thumbnail"),e.__sert({before:new Element("div",{class:"thumbnail-border"})}))},Ve.batch_load_thumbs(e,this.THUMBS_BATCH_SIZE,h)},get_files_in_view:function(){var e,t,n,i,r,o,s,a,_,l,u;return s=[0,pr.files.length-1],l=Oe.viewport_dimensions().height,u=Oe.scroll_offsets().top,(o=this._get_elm_height())?(e=pe("#browse-files"),i=parseInt(e.css("padding-top"),10),!e.length||isNaN(i)?s:("absolute"===pe("#browse-header").css("position")?(t=e.offset().top+i,n=t-u,n>0?(a=0,r=l-n,_=r/o):(a=Math.abs(n/o),_=Math.abs(l-n)/o)):(a=u/o,r=l-i,_=(r+u)/o),a=Math.max(Math.floor(a),0),_=Math.min(Math.floor(_),pr.files.length-1),[a,_])):s},_get_elm_height:function(){var e,t;return pr.files.length>=3&&pr.files[1].get_div()?(e=pe(pr.files[1].get_div()),t=e.outerHeight()+parseInt(e.css("margin-bottom"))+parseInt(e.css("margin-top"))):null},append_ellipsis:function(e){return At("%(action_text)s…","web","action which requires further user interaction").format({action_text:e})},getIndexOfFileInArray:function(e,t){var n,i,r,o,s;for(s=-1,i=r=0,o=e.length;o>r;i=++r)n=e[i],n.sjid===t.sjid&&(s=i);return s}};var Ki;Ki=Xe.Sort=function(){var e,t,n,i,r,o,s;return n=function(e){var t;return t=e?1:-1,function(e,n){return t*Rt.sort_by_rank_or_key(e,n)}},i=function(e){var t;return t=e?1:-1,function(e,n){return e.bytes>n.bytes?t:e.bytes<n.bytes?-t:t*Ki.FILES_BY_NAME(e,n)}},e=function(e){var t;return t=e?1:-1,function(e,n){return t*(e.fq_path.toLowerCase()>n.fq_path.toLowerCase()?1:-1)}},t=function(e){var t;return t=e?1:-1,function(e,n){var i;return i=e.ts===n.ts?0:e.ts>n.ts?1:-1,t*i}},o=function(e){return function(t){var i,r;return r=e(t),i=n(!0),function(e,t){return e.dir^t.dir?(e.dir?1:0)-(t.dir?1:0):r(e,t)||i(e,t)}}},r=function(e){return function(t){var n,i;return Ki.FOLDERS_FIRST?(i=e(t),n=t?1:-1,function(e,t){var r;return e.dir^t.dir?(r=(e.dir?0:1)-(t.dir?0:1),n*r):i(e,t)}):e(t)}},s=function(e){return function(t){var n,i;return i=Ki.FILES_BY_NAME(t),n=t?1:-1,function(t,r){var o;return t.is_deleted^r.is_deleted?(t.is_deleted?1:0)-(r.is_deleted?1:0):(o=0,e?t.get_category()!==r.get_category()?o=t.get_category()<r.get_category()?-1:1:t.get_extension()!==r.get_extension()&&(o=t.get_extension()<r.get_extension()?-1:1):t.get_extension()!==r.get_extension()?o=t.get_extension()<r.get_extension()?-1:1:t.get_category()!==r.get_category()&&(o=t.get_category()<r.get_category()?-1:1),n*o||i(t,r))}}},{FILES_BY_NAME:r(n),SHARED_WITH:r(n),FILES_BY_SIZE:o(i),FILES_BY_LOCATION:o(e),FILES_BY_KIND:o(s(!0)),FILES_BY_EXTENSION:o(s(!1)),FILES_BY_MODIFIED:o(t),FOLDERS_FIRST:!Rt.is_mac(),ALL_BY_MODIFIED:t}}();var Gi,An=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};Gi=Xe.FlexColumn=function(){var e,t,n,i,r,o,s,a;for(e=[{label:"SHARED_WITH",func:Ki.FILES_BY_NAME,display:At("Shared With"),is_asc:!0},{label:"FILES_BY_KIND",func:Ki.FILES_BY_KIND,display:At("Kind"),is_asc:!0},{label:"FILES_BY_EXTENSION",func:Ki.FILES_BY_EXTENSION,display:At("Extension"),is_asc:!0},{label:"FILES_BY_SIZE",func:Ki.FILES_BY_SIZE,display:At("Size"),is_asc:!1}],t={},n={},r=[],i=[],s=0,a=e.length;a>s;s++)o=e[s],r.push(o.func),t[o.label]=o.display,n[o.label]=o.is_asc,i.push(o.label);return{SORT_FUNCTIONS:r,DISPLAY:t,IS_ASC:n,LABELS:i,has_label:function(e){return An.call(this.LABELS,e)>=0},has_sort:function(e){return An.call(this.SORT_FUNCTIONS,e)>=0},next:function(t){var n;return n=Gi.LABELS.indexOf(t)+1,n===Gi.LABELS.length&&(n=0),e[n]},set_column_display:function(n,i){return e[Gi.LABELS.indexOf(n)].display=i,t[n]=i}}}();var Ji;Ji=Xe.FileSearch={MAX_RESULTS:100,last_state:!1,last_fq_path:null,scoped_search:!0,last_new_search_ts:{},is_loaded:!1,init:function(e,t){return this.firefly_enabled=e,this.fulltext_search_enabled=t,pe(document).on("db:searchbar:submit",function(e){return function(t){return pr.is_initialized?(t.preventDefault(),pe(t.target).blur(),e.search(!0)):void 0}}(this)),pe(document).on("db:searchbar:preview",function(e,t){return pr.is_initialized?(e.preventDefault(),pr.open_file(t.file,t.force_new_window,!0,K.OREF_CONSTANTS.BROWSE_SEARCHBOX)):void 0})},get_state:function(){return k.queryParams(this.get_basic_query(),this.last_fq_path)},set_state:function(e){return this.last_fq_path=null!=e.last_fq_path?e.last_fq_path:"",this.scoped_search=""!==this.last_fq_path,pr.inside_dir=this.scoped_search,this.set_basic_query(e.query_unnormalized),this.do_search(!1,!0)},state_changed:function(){var e,t;return e=this.get_state(),t=this.last_state,t===!1?!!e.query:e.query!==t.query||e.last_fq_path!==t.last_fq_path},get_basic_query:function(){return this._get_browse_search_input().val()},set_basic_query:function(e){return e!==this.get_basic_query()?this._get_browse_search_input().val(e):void 0},set_title:function(){var e,t;return e=this.get_state(),t=At("Search - Dropbox"),e.query_unnormalized&&(t=e.query_unnormalized+" - "+t),document.title=t},_set_scope_path_to_browse_location:function(){return pr.inside_dir?this.last_fq_path=pr.containing_fq_path():this.last_fq_path=""},do_search:function(e,t){var n,i,r,o;return null==t&&(t=!1),"function"==typeof pr.entered_search&&pr.entered_search(),o=!t&&!pr.in_search_mode(),o&&this._set_scope_path_to_browse_location(),r=this.get_state(),(i=""===this.get_basic_query())?void(pr.in_search_mode()&&(this._clear_on_reload=!1,this.exit_search())):(this.last_state=r,this._clear_on_reload=!0,_r.deselect_all(),pr.clear(),Wi.set_special_mode("search"),this.scoped_search=""!==this.last_fq_path,t||(n=null,p.push_state("/search/"+pr.active_user.role,r)),this.set_title(),this.reset_fulltext_search(this.scoped_search),this.last_new_search_ts=new Date,pe("#fulltext-search-loading").show(),this.ask_server("/ajax_fulltext_search",e,0,this.MAX_RESULTS,!1))},search:function(e){return null==e&&(e=!1),e!==this.scoped_search&&(this.last_state=!1),this.scoped_search=this.scoped_search&&e,this.scoped_search||(this.last_fq_path=""),this.do_search(!1)},load_more_results:function(){var e;return this.end_of_results?void 0:(e=this.search_pos,this.end_of_active_results&&(e=this.deleted_search_pos),this.ask_server("/ajax_fulltext_search",!1,e,this.MAX_RESULTS,this.end_of_active_results))},firefly_filename_search:function(){return this.do_search(!0)},update_empty:function(){var e;return e=At("No results found"),this.scoped_search&&(e=At("No results found in '%(path)s'").format({path:We.filename(this.last_fq_path)})),pe("#noresults-header").text(e),pe("#fulltext-search-all-link").hide(),pe("#noresults-directions").toggle(!this.scoped_search),pe("#noresults-search-all-link").toggle(this.scoped_search)},show_empty:function(){return this.update_empty(),$("search-empty").show()},hide_empty:function(){return $("search-empty").hide()},reset_fulltext_search:function(e){return _r.deselect_all(),pr.clear(),pr.reset_state(),pr.update_header_status(""),this.search_pos=0,this.deleted_search_pos=0,this.end_of_active_results=!1,this.end_of_results=!1,this.scoped_search=e,pe("#fulltext-search-all-link").hide()},exit_search:function(){var e;return pr.in_search_mode()&&(e=[pr.inside_deleted_dir,pr.inside_deleted_sandbox,pr.inside_deleted_shared_folder],v.any(e)||(pr.deleted_shown=!1)),$("browse").removeClassName("pending-search"),this.hide_empty(),Zi.set_path_url(null,this.last_fq_path,pr.deleted_shown)},force_reload:function(){return this.search()},ask_server:function(e,t,n,i,r){var o,s,a,_,l,u;return u=this.get_state(),l=null,_=new Date,l=r?Fe.DELETED:t?Fe.COMPLETION:Fe.FULLTEXT,o={firefly:this.firefly_enabled,infinite_scroll:n>0,path_scoped:!1,search_type:l,query_string:u.query},ze.SearchClientActivityLogger.log("query_started",pr.active_user.id,o),n||pe("#web-search-results").html(At("Searching...")),pe("#browse").addClass("pending-search"),s={query:u.query},n&&(s.start=n),i&&(s.max_results=i),r&&(s.deleted=r),this.scoped_search&&(s.fq_path=this.last_fq_path),t||(this.last_fulltext_query=u.query),t&&(s.filename_only=!0),a=!1,new Ajax.DBRequest(e,{no_watch:!0,evalJSON:!1,parameters:s,log_timing:!0,onSuccess:function(e){return function(t){var n,i,r,s,l;if(pr.in_search_mode())return s=t.request.parameters.parent_request_id,n=JSON.parse(t.responseText),l=n.search_results.length,u.query===e.last_fulltext_query&&_>=e.last_new_search_ts&&(e.search_pos=e.search_pos+l,e.end_of_active_results&&(e.deleted_search_pos=e.deleted_search_pos+l),l<e.MAX_RESULTS&&(e.end_of_results=e.end_of_active_results,e.end_of_active_results=!0,e.end_of_results?pe("#fulltext-search-loading").hide():a=!0),e.update_results(n,a,s)),i=n.search_results.length>0?n.search_results[0]:null,o=ze.SearchClientActivityLogger.create_completion_log_dict(o,s,t.request.start_time,u.query,u.query===(null!=(r=e.last_state)?r.query:void 0),l,null,i),ze.SearchClientActivityLogger.log("query_completed",pr.active_user.id,o)}}(this),onFailure:function(e){return function(t){var n;return o=ze.SearchClientActivityLogger.create_completion_log_dict(o,t.request.parameters.parent_request_id,t.request.start_time,u.query,u.query===(null!=(n=e.last_state)?n.query:void 0),null,t.status),ze.SearchClientActivityLogger.log("query_failed",pr.active_user.id,o)}}(this),cleanUp:function(e){return function(){return a?e.load_more_results():pe("#browse").removeClass("pending-search")}}(this),subject_user:pr.active_user})},update_results:function(e,t,n){var i;return null==t&&(t=!1),null==n&&(n=null),i=this.get_state(),pr.update(e,n),pr.set_selection_from_fq_paths_or_index(Ji),t?void 0:(this._update_number_results(this.search_pos),pr.files.length?this.hide_empty():this.show_empty())},_update_number_results:function(e){var t,n;return t=0===e?"":this.end_of_results?this.fulltext_search_enabled?Tt("%(num_results)s result in files, folders, and content.","%(num_results)s results in files, folders, and content.",e).format({num_results:e}):Tt("%(num_results)s result in files and folders.","%(num_results)s results in files and folders.",e).format({num_results:e}):this.fulltext_search_enabled?Tt("Over %(num_results)s result in files, folders, and content.","Over %(num_results)s results in files, folders, and content.",e).format({num_results:e}):Tt("Over %(num_results)s result in files and folders.","Over %(num_results)s results in files and folders.",e).format({num_results:e}),n=At("Search")+" - "+t,pr.update_header_status(t),n=At("Results for '%(query)s'").format({query:this.get_state().query}),this.scoped_search&&(n=At("Results for '%(query)s' in '%(path)s'").format({query:this.get_state().query,path:We.filename(this.last_fq_path+"'")})),pe("#web-search-results").text(n),this.scoped_search?pe("#fulltext-search-all-link").show():void 0},history_change_handler:function(e,t){var n,i,r;return i="string"==typeof this._get_browse_search_input().find("input").attr("value"),r=i&&!this.is_loaded,t&&(this.last_state=t),this.last_state?((this.state_changed()||r)&&this.set_state(this.last_state),jr.shown()||z.setScope(pr.KEY_SCOPE),_r.get_selected_files().length&&(n=_r.get_selected_files()[0].get_div(),pr.scrollToWithPadding(n,2*n.getHeight())),this.is_loaded=!0):void Zi.set_path_url(c.root_ns,"")},clear_searchbox:function(){return this._get_browse_search_input().val("")},_get_browse_search_input:function(){return pe("#browse-search-input")}};var Xi;Xi=Xe.BrowseKeys={_handlers:{},init:function(){},init_advanced:function(){var e,t,n;n=this.advanced_dict;for(t in n)e=n[t],z(e.key,pr.KEY_SCOPE,e.onPress);return this.customize_chart(),Rt.is_mac()&&Prototype.Browser.Gecko?document.observe("keypress",function(e){return function(t){return 63!==t.charCode||Oe.focus_in_input()?void 0:e.advanced_dict.help.onPress()}}(this)):void 0},customize_chart:function(){var e,t,n,i;for(e=Rt.is_mac()?".key-windows":".key-macos",n=0,t=void 0,i=[];;){if(t=$("keys-chart").down(e,n++),!t)break;i.push(t.hide())}return i},toggle_chart:function(){return"none"===$("keys-chart").style.display?this.show_chart():this.hide_chart()},show_chart:function(){var e,t;return e=$("keys-chart"),e.style.position="fixed",t=$("browse-sort"),pr.in_search_mode()?t=$("browse-header-wrapper"):"none"===t.getStyle("display")&&(t=$("browse-root-actions")),Oe.clone_position(pe(e),pe(t),{setHeight:!1}),e.style.top=t.cumulativeOffset()[1]+t.getHeight()+"px",e.setOpacity(.9),e.show()},hide_chart:function(){return $("keys-chart").hide()},advanced_dict:{rename:{title:At("Rename selected files",{comment:"'selected' means files that have been highlighted by the user to be acted upon"}),key:"f2",onPress:function(e,t){var n;return n=_r.get_selected_files(),n.length?n.first().edit():void 0}},delete:{title:At("Delete selected files",{comment:"'selected' means files that have been highlighted by the user to be acted upon"}),key:"delete, command+backspace, backspace",onPress:function(e,t){var n,i,r,o;if(Event.stop(e),pr.inside_read_only_shared_folder&&b.warning(At("You don't have permission to delete files in this folder.")),o=_r.get_selected_files(),1===o.length)return i=o.first(),i.is_deleted?Vn.show_purge(i.fq_path,i.dir):(n=i.mount_point?We.filename(i.mount_point):null,Vn.show_delete(pr.active_user,i.fq_path,i.dir,void 0,n,i.is_shared_folder()));if(o.length>1){if(r=Wi.profile_files(o),r.deleted===o.length)return Vn.show_bulk_purge(o);if(0===r.deleted)return Vn.show_bulk_delete(pr.active_user,o)}}},help:{title:At("Show/hide keyboard shorcuts"),key:"shift+/, "+z.main_modifier()+"+/",onPress:function(){return Xi.toggle_chart()}},close_help:{title:At("Hide keyboard shorcuts"),key:"escape",onPress:function(){return Xi.hide_chart()}},up_dir:{title:At("Up a folder",{comment:"meaning, go from the current folder to its containing (parent) folder. this is one step up only -- the parent, not the root."}),key:"left",onPress:function(){var e,t;return pr.keyboard_nav=!0,pr.reloading?void 0:pr.inside_dir?(pr.containing_ns_path()||pr.containing_ns_id()===c.root_ns?(t=pr.containing_ns_id(),e=We.normalize(We.parent_dir(pr.containing_ns_path()))):(t=c.root_ns,e=We.normalize(We.parent_dir(pr.containing_fq_path()))),pr.containing_ns_path()!==e||pr.containing_ns_id()!==t?(pr.select_fq_paths=[pr.containing_fq_path()],Zi.set_path_url(t,e)):_r.flicker_selected()):_r.flicker_selected()}},open_file:{title:At("Open highlighted file"),key:"enter",onPress:function(e){var t,n;return pe(e.target).closest(".db-modal").length?void 0:(n=_r.get_selected_files(),1===n.length&&(t=n[0],pr.open_file(t,!1,!1,K.OREF_CONSTANTS.BROWSE_FILE_OPEN)),!1)}},open_dir:{title:At("Open highlighted folder"),key:"right",onPress:function(){var e,t;return pr.keyboard_nav=!0,t=_r.get_selected_files(),1===t.length&&(e=t[0],e.dir?(pr.select_index=0,pr.open_folder(e)):_r.flicker_selected()),!1}},undo:{title:At("Undo recent move/copy/rename/delete"),key:z.main_modifier()+"+z",onPress:function(){return X.perform_undo(),!1}},search:{title:At("Search"),key:"/",onPress:function(){return pe(document).trigger("db:searchbar:focus"),!1}}}};var Qi;Qi=Xe.BrowseSharedLink={store_shared_link_info:function(e,t,n){return"/"===e.charAt(0)&&(e=e.substring(1)),this._shared_link_fq_dir=e,this._shared_link_file=n,this._shared_link_url=t},shared_link_handler:function(e,t){return Qi._shared_link_url==="/s/"+e||Qi._shared_link_url==="/scl/"+e&&0===e.indexOf("fi")?(Zi.load_browse_view(void 0,encodeURIComponent(Qi._shared_link_fq_dir)),pr.open_preview(Qi._shared_link_file,null,!0)):Qi._shared_link_url==="/sh/"+e||Qi._shared_link_url==="/scl/"+e&&0===e.indexOf("fo")?(Zi.load_browse_view(void 0,encodeURIComponent(Qi._shared_link_fq_dir)),Qi._shared_link_file&&pr.open_preview(Qi._shared_link_file)):location.reload(),Qi.highlight_user()},close_shared_link_view:function(){return window.location.pathname===this._shared_link_url?Zi.set_path_url(null,"/"+this._shared_link_fq_dir):void 0},highlight_user:function(){return pr.active_user.role===A.ROLE_WORK?(pe("#work-nav-item").addClass("selected"),pe("#personal-nav-item").removeClass("selected")):(pe("#personal-nav-item").addClass("selected"),pe("#work-nav-item").removeClass("selected"))}};var Zi;Zi=Xe.BrowseURL={_DEFAULTS:{d:!1,from_scl_sync_modal:!1,select:!1,open_preview:!1},_get_helper:function(e){var t;return t=p.deconstruct_url().qargs,e in t?!!t[e]:(bt(e in this._DEFAULTS,"bad query param in BrowseURL"),this._DEFAULTS[e])},get_del:function(){return this._get_helper("d")},ns_to_fq_path:function(e,t){var n;return e===pr.active_user.root_ns||e in pr.ns_id_to_mount_point||(e=pr.active_user.root_ns),e===pr.active_user.root_ns?t:(n=pr.ns_id_to_mount_point[e],n+t)},make_browse_url_from_fq_path:function(e,n,i){var r,o,a,_;null==i&&(i={}),bt("string"==typeof n,"expected explicit fq_path string"),a=s({path:t.get_browse_root(e)+n}),o=p.deconstruct_url().qargs;for(r in i)_=i[r],r in this._DEFAULTS&&!!_!==this._DEFAULTS[r]&&(o[r]=_);for(r in o)r in this._DEFAULTS||delete o[r];return p.construct_url(String(a),o)},_make_url:function(e,t,n){var i;return null==n&&(n={}),e||(e=pr.active_user.root_ns),bt("number"==typeof e,"expected ns_id as a number"),bt("string"==typeof t,"expected explicit ns_path string"),i=this.ns_to_fq_path(e,t),this.make_browse_url_from_fq_path(pr.active_user,i,n)},set_path_url:function(e,t,n){var i,r,o;return e?(r=parseInt(e,10),e=isNaN(r)?c.root_ns:r):e=pr.active_user.root_ns,t=We.normalize(t),o=null!=n?this._make_url(e,t,{d:n?1:0}):this._make_url(e,t),i=p.deconstruct_url(o),p.push_state(i.path,i.qargs)},set_del_url:function(e){var t,n,i;return i=p.deconstruct_url(),t=i.path,n=i.qargs,e?n.d="1":delete n.d,p.push_state(t,n)},_first_load:!0,_last_ns_dir:null,_last_ns_id:null,load_browse_view:function(e,t,n){var i,r,o;return null==n&&(n=!1),z.setScope(pr.KEY_SCOPE),t=We.normalize(t),o=!1,this._first_load||(o=!pr.inside_dir||t!==this._last_ns_dir||e!==this._last_ns_id||pr.in_search_mode()),i=n!==pr.deleted_shown,pr.deleted_shown=n,(this._first_load||o||i)&&pr.reload(e,t,!0),this._first_load=!1,this._last_ns_dir=t,this._last_ns_id=e,_r.get_selected_files().length&&(r=_r.get_selected_files()[0].get_div())?pr.scrollToWithPadding(r,2*r.getHeight()):void 0},history_change_handler:function(e,n){var i,r,o,a,_;if(a=n.ns,_="1"===n.d,this.load_browse_view(a,e,_),null!=n.preview){if(r="/"+s.encode(n.preview),e&&(r="/"+e+r),i=pr.find_file(s.decode(r)),null==i)return ze.UserActivityLogger.log("web","browse_preview_does_not_exist"),p.replace_state(t.get_browse_root(pr.active_user));if(ee.getGandalfRule("file_viewer_react"))return o=Wi.getIndexOfFileInArray(pr.files,i),ce.open(pr.files,o,pr.active_user,"react-file-viewer",{fileViewTarget:K.FileViewTargetType.PRIVATE,fileViewOrigin:K.FileViewOriginType.BROWSE,fileViewAction:K.FileViewActionType.CLICK});if(!jr.shown()||jr.file!==i)return pr.open_preview(i,K.OREF_CONSTANTS.BROWSE_UNKNOWN,!0)}else{if(!ee.getGandalfRule("file_viewer_react")&&jr.shown())return jr.hide();if(ee.getGandalfRule("file_viewer_react")&&ce.isShown())return ce.close()}},parse_b2_hash:function(e){var t,n,i,r,o;return r=e.split(":"),4!==r.length?!1:(i=r[0],t="1"===r[2],n=r[3],(o=!n||Rt.isNumber(n))?(n=parseInt(n,10)||c.root_ns,{ns_id:n,ns_path:i,deleted:t}):!1)}};var er;er=Xe.BrowseFile=Class.create({initialize:function(e){var t,n,i,r;return t=We.filename(e.fq_path),this.can_hold_shared_folders=e.can_hold_shared_folders,this.allows_shared_link=e.allows_shared_link?1:0,this.icon=e.icon,this.filename=t,this.filename_highlights=null!=(n=e.filename_highlights)?n:[],this.unresolved_comment_count=e.unresolved_comment_count,this.unseen_comment_count=e.unseen_comment_count,this.update_caption(),this.ns_id=e.ns_id,this.ns_path=e.ns_path,this.fq_path=e.fq_path,this.mount_point=e.mount_point,this.hash=e.hash,this.href=e.href,this.size="None"!==e.size?e.size:"",this.file_id=e.file_id,this.bytes=e.bytes,this.is_deleted=-1===this.bytes,this.ago=e.ago,this.ts=e.ts,this.dir=e.is_dir?1:0,this.target_ns=e.target_ns,this.sort_rank=e.sort_rank,this.sort_key=e.sort_key||[""],this.sjid=e.sjid,this.tkey=void 0,this.preview_url=e.preview_url||null,this.thumbnail_url_tmpl=e.thumbnail_url_tmpl,this.large_thumbnail_url_tmpl=e.large_thumbnail_url_tmpl,this.type=e.type,this.preview_type=e.preview_type,e.last_modified_fname&&(this.last_modified_fname=l.em_snippet(e.last_modified_fname,wr),this.last_modified_name=e.last_modified_name),this.event_type=e.event_type,this.htmlified_link=e.htmlified_link,this.linkfile_data=e.linkfile_data,this.direct_blockserver_link=e.direct_blockserver_link,this.doc_preview_status=e.doc_preview_status,this.in_root_coll=e.in_root_coll,this.compressible=e.compressible,this.user_id=e.user_id,this.sf_perm_role=e.sf_perm_role,this.fulltext_search=e.fulltext_search,this.read_only=!!e.read_only,this.is_read_only_mount=!!e.is_read_only_mount,this.request_id=null!=(i=e.request_id)?i:null,this.match_type=null!=(r=e.match_type)?r:"UNKNOWN_MATCH",this.video_transcode_url=e.video_transcode_url},track_in_browse:function(){return this.to_key()in er._file_index?void 0:(pr.add_file(this),er._file_index[this.to_key()]=this)},is_shared_folder:function(){return this.type===at.SHARED_FOLDER||this.type===at.TEAM_SHARED_FOLDER},is_team_shared_folder:function(){return this.type===at.TEAM_SHARED_FOLDER},could_be_shared_link:function(){return this.allows_shared_link},could_be_shared_folder:function(){var e,t,n,i;return t=pr.public_folder_enabled&&this.fq_path.toLowerCase().startsWith("/public/"),i=pr.public_folder_enabled&&"/public"===this.fq_path.toLowerCase(),n=this.target_ns,e=this.ns_id!==c.root_ns,this.type===at.FOLDER&&!n&&!t&&!i&&!this.is_sandbox()&&(!e||this.can_hold_shared_folders&&!pr.inside_read_only_shared_folder)},is_sandbox:function(){return this.type===at.SANDBOX},get_div:function(){return $("f_"+this.to_key())},rename:function(e,t,n,i,r,o){var s,_,l;return _=this.fq_path,pr.pre_action_selection=[_],s=pr.find_file(e),s&&pr.remove_file(s),this.filename=We.filename(e),this.update_caption(),this.fq_path=e,this.ns_path=t,this.htmlified_link=o,this.hash=n,this.sort_key=i,this.sort_rank=null,this.last_modified_fname=null,this.dir?(this.href="/home"+Rt.urlquote(e),this.target_ns&&(pr.ns_id_to_mount_point[this.target_ns]=e)):(l=this.href.split("/"),l[l.length-1]=Rt.urlquote(this.filename)+("?w="+n),this.href=l.join("/"),this.icon=r),pr.in_search_mode()&&(this.filename_highlights=[]),er._file_index[this.to_key()]=this,pr.update_file_pos(this),pe(document).trigger(a.RENAME,{old_fq_path:_,file:this})},edit:function(){var e,t,n,i,r;return this.editing=!0,pr.selectable(),r=function(e){return function(t){var n,i,r,o,s,a,_,l,u,d;return d=t.responseText.evalJSON(!0),bt(1===d.new_browse_files.length,"No new file data returned."),r=d.new_browse_files.first(),o=r.fq_path,s=r.hash,u=Rt.decode_sort_key(r.sort_key),_=r.icon,l=r.ns_path,a=r.htmlified_link,n=d.changesets,i=At("Rename complete."),X.notifyWithUndo(i,n,Vn.do_rollback),e.rename(o,l,s,u,_,a),_r.set_selected_files([e]),e.get_div().smoothScrollIntoView(),Wi.load_visible_thumbs(),pr.fire_visible_change_callbacks()}}(this),t=s({path:"/cmd/rename"+this.fq_path}).updateQuery(A.UID_PARAM_NAME,pr.active_user).toString(),n=pr.in_search_mode()?".filename-col":".filename-col a",e=new Ajax.InPlaceEditor(this.get_div().down(n),t,{htmlResponse:!1,okControl:!1,cancelControl:!1,highlightColor:"transparent",highlightEndColor:"transparent",clickToEditText:"",cols:25,ajaxClass:Ajax.DBRequest,submitOnBlur:!0,initialText:this.filename,cancelIfSame:!0,clickToEdit:!1,onComplete:function(e){return function(){return e.editing=!1}}(this),onFailure:function(){},savingText:At("Saving..."),ajaxOptions:{job:!0,subject_user:pr.active_user,html_in_error_msg:!0,progress_text:At("Renaming..."),method:"POST",onCreate:b.clear,onSuccess:r,onUninitialized:pr.unselectable},callback:function(e){return function(t,n){return{to_path:n||"",folder:e.dir?"yes":""}}}(this)}),e.enterEditMode(),i=this.get_div().down(".editor_field"),"selectionEnd"in i&&this.filename.lastIndexOf(".")>-1?i.selectionEnd=this.filename.lastIndexOf("."):void 0},to_key:function(){return this.ns_id+"_"+this.sjid},get_category:function(){var e,t;return this.dir&&(pr.inside_dir&&""===pr.containing_fq_path()&&"public"===this.filename.toLowerCase()&&pr.public_folder_enabled&&(e="PUBLIC_FOLDER"),null==e&&(e=this.type===at.FOLDER?"FOLDER":this.type===at.PACKAGE?"FOLDER":this.type===at.TEAM_SHARED_FOLDER?"TEAM_SHARED_FOLDER":this.type===at.SHARED_FOLDER?"SHARED_FOLDER":this.type===at.SANDBOX?"SANDBOX":this.target_ns?"SHARED_FOLDER":"FOLDER")),null==e&&(e=er.EXTENSION_TO_CATEGORY[this.get_extension()]||"FILE"),t=this.is_deleted?er.CATEGORY_TO_DELETED_TRANSLATION[e]:er.CATEGORY_TO_TRANSLATION[e],bt(t,"CATEGORY MISSING FOR "+e),t},get_icon_alt:function(){return this.dir?At(this.is_shared_folder()?this.is_team_shared_folder()?this.is_read_only_mount?"Read-only team folder":"Team folder":this.is_read_only_mount?"Read-only shared folder":"Shared folder":this.is_read_only_mount?"Read-only folder":"Folder"):""},get_extension:function(){return this.dir||-1===this.filename.indexOf(".")?void 0:We.file_extension(this.filename).toLowerCase()},is_shmodelable:function(){return!this.is_deleted&&pr.is_shmodelable_path(this.fq_path)},update_caption:function(){var e;return e=pr.inside_dir?fr:br,this.unresolved_comment_count>0&&(e-=vr),this.caption=l.em_snippet(this.filename,e)}}),er._CATEGORIES={IMAGE:"bmp cr2 gif ico jpeg jpg nef png psd tif tiff svg svgz",VIDEO:"3gp 3gpp 3gpp2 avi dv flv m2t m4v mkv mov mp4 mpeg mpg mts ts vob wmv",AUDIO:"aif flac m4a m4p mp3 ogg wav wma",DOCUMENT:"ai cdr csv doc docx docm eps fla indd keynote numbers otf pages pdf ppt pptx pptm pps ppsx ppsm ps rtf swf txt wpd xls xlsx xlsm",COMPRESSED_FILE:"7z bz2 gz gzip rar tar zip",CODE:"as as3 c coffee cpp cs css cxx h html java js less php py rb sass scss sh sql vb xhtml xml",DISK_IMAGE:"dmg iso",EXECUTABLE:"exe",SHORTCUT:"lnk",LINK:"url webloc",FONT:"ttf"},er.EXTENSION_TO_CATEGORY={},er.CATEGORY_TO_TRANSLATION={FILE:At("file"),FOLDER:At("folder"),SHARED_FOLDER:At("shared folder"),TEAM_SHARED_FOLDER:At("team folder"),PUBLIC_FOLDER:At("folder"),IMAGE:At("image"),VIDEO:At("video"),AUDIO:At("audio"),DOCUMENT:At("document"),COMPRESSED_FILE:At("archive"),CODE:At("code"),DISK_IMAGE:At("disk image"),EXECUTABLE:At("executable"),SHORTCUT:At("shortcut"),LINK:At("link"),FONT:At("font"),SANDBOX:At("app folder")},er.CATEGORY_TO_DELETED_TRANSLATION={FILE:At("deleted file"),FOLDER:At("deleted folder"),SHARED_FOLDER:At("deleted shared folder"),TEAM_SHARED_FOLDER:At("deleted team folder"),PUBLIC_FOLDER:At("deleted folder"),IMAGE:At("deleted image"),VIDEO:At("deleted video"),AUDIO:At("deleted audio"),DOCUMENT:At("deleted document"),COMPRESSED_FILE:At("deleted archive"),CODE:At("deleted code"),DISK_IMAGE:At("deleted disk image"),EXECUTABLE:At("deleted executable"),SHORTCUT:At("deleted shortcut"),LINK:At("deleted link"),FONT:At("deleted font"),SANDBOX:At("deleted app folder")},function(){var e,t,n,i,r;i=er._CATEGORIES,r=[];for(e in i)n=i[e],r.push(function(){var i,r,o,s;for(o=n.trim().split(" "),s=[],i=0,r=o.length;r>i;i++)t=o[i],s.push(er.EXTENSION_TO_CATEGORY[t]=e);return s}());return r}(),er._file_index={},er.from_key=function(e){return er._file_index[e]},er.from_elem=function(e){var t;if(e)return t=e.readAttribute("data-identity"),t?er.from_key(t):er.from_elem(e.up("[data-identity]"))};var tr,nr,ir,rr,or,sr,An=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};tr=INLINE_JS.BrowseActions=Xe.BrowseActions=Class.create({initialize:function(e){return this._set_files(e)},firefly_logging_helper:function(e){return pr.in_search_mode()&&e?(this._firefly_log_values.action_type=e,ze.SearchClientActivityLogger.log("result_action",pr.active_user.id,this._firefly_log_values)):void 0},unlisten:function(){},get_action_names:function(){var e;return e=this.get_files(),e.length<2?this._get_actions_single(e.first()):this._get_actions_multi(e)},get_files:function(){return this._files},get_action_by_name:function(e){return this.evaluate_action(tr.option_dict[e],e)},evaluate_action:function(e,t){var n,i,r;return n=function(e){return function(t,n){return null!=n&&null==t?n:pe.isFunction(t)?t.call(e):null!=t?t:n}}(this),r={icon_href:e.icon_href,target:e.target,click_handler:e.click_handler,type:e.type,name:t||e.name,is_dropdown:!!e.is_dropdown,icon:n(e.icon),text:n(e.text),detail_text:n(e.detail_text),href:n(e.href,""),kind:n(e.kind,"icon"),button_label:n(e.button_label,e.text)},pe.isFunction(e.subactions)?r.subactions=e.subactions.call(this):pe.isArray(e.subactions)?r.subactions=function(){var t,n,r,o;for(r=e.subactions,o=[],t=0,n=r.length;n>t;t++)i=r[t],o.push(this.get_action_by_name(i));return o}.call(this):e.subactions&&bt(0,"subactions must be a function or an array of actions"),r},_set_files:function(e){var t;return this._files=$A(e),this._log_extras={},this.get_files().length>0?(t=e.first(),this._log_extras={path:t.fq_path,ns_id:t.ns_id},this._firefly_log_values={file_nsid:t.ns_id,file_sjid:t.sjid,firefly:Ji.firefly_enabled,match_type:t.match_type,position:t.sort_rank,request_id:t.request_id,viewport:"full-view"}):void 0},_get_actions_single:function(e){var t,n,i,r,o,s,a,_,l,u,d,h,f,p;return t=[],e?(i=pr.public_folder_enabled&&e.fq_path.toLowerCase().startsWith("/public/"),_=pr.public_folder_enabled&&"/public"===e.fq_path.toLowerCase(),s=e.target_ns,n=e.ns_id!==c.root_ns,u=e.type===at.SHARED_FOLDER,l=e.type===at.SANDBOX,a=e.type===at.PACKAGE,o=e.in_root_coll,r=e.compressible,e.is_deleted?(t=t.concat(["restore"]),(null!=(h=pr.permanent_delete_is_disabled_by_ns_id)?h[e.ns_id]:void 0)||t.push("purge"),t):(p=null!=__CONDITIONAL_JS__.UnityFeatures&&(null!=(f=__CONDITIONAL_JS__.UnityCheckFileCache)?f.is_cached_and_locally_available(e.ns_id,e.ns_path):void 0),d=p?"open":"download",e.dir?(t.push(l?"app_info":Ce.Tiburon.foldersUI(pr.active_user.id)?"share":e.is_shared_folder()||e.could_be_shared_folder()?"single_entry_share_dropdown_variant_menu":"single_entry_share_dropdown_variant_token_share_only"),t.push(d),_||(t=t.concat(["delete","rename","move"]),a||s||t.push("copy")),pr.can_use_photos_features&&pr.can_use_photos_features&&t.push("album_from_folder")):(t.push(i||pr.public_app_token?"copy_url":Ce.Tiburon.filesUI(pr.active_user.id)?"share":"single_entry_share_dropdown_variant_token_share_only"),t.push(d),pr.can_show_preview(e)&&pr.browser_supports_comments&&t.push("comment"),t=t.concat(["delete","rename","move","copy","revisions"]),o&&pr.can_use_photos_features&&t.push("view_in_photos"),r&&t.push("compress")),t)):[]},_get_actions_multi:function(e){var t,n,i;return t=["download","delete","move","copy","restore","purge"],t.push("view_in_photos"),n=Wi.profile_files(e),(n.deleted>0||n.public_folder>0)&&(t.removeItem("move"),t.removeItem("copy"),t.removeItem("delete")),n.shared_folders>0&&t.removeItem("copy"),n.deleted>0&&(t.removeItem("send_copy"),t.removeItem("delete"),t.removeItem("download")),pr.inside_dir||t.removeItem("download"),n.deleted===e.length&&(0===n.shared_folders||n.shared_folders===(i=e.length)&&1===i)||t.removeItem("restore"),n.deleted===e.length&&n.can_permanently_delete===e.length||t.removeItem("purge"),n.in_root_coll===e.length&&pr.can_use_photos_features||(t.removeItem("view_in_photos"),t.removeItem("view_in_carousel")),t},get_disabled_action_names:function(){var e,t,n,i,r;for(e=!1,
r=this.get_files(),n=0,i=r.length;i>n;n++)if(t=r[n],e=!0,!t.read_only){e=!1;break}return pr.inside_read_only_shared_folder||e?["move","rename","delete","restore","purge","upload","new_folder","compress"]:[]},show_disabled_action_warning:function(e){return pr.inside_read_only_shared_folder?"move"===e?b.warning(At("You don't have permission to move files in this folder.")):"rename"===e?b.warning(At("You don't have permission to rename files in this folder.")):"delete"===e?b.warning(At("You don't have permission to delete files in this folder.")):"restore"===e?b.warning(At("You don't have permission to restore files in this folder.")):"purge"===e?b.warning(At("You don't have permission to permanently delete files in this folder.")):"upload"===e?b.warning(At("You don't have permission to upload files into this folder.")):"new_folder"===e?b.warning(At("You don't have permission to create a new folder in this folder.")):"compress"===e?b.warning(At("You don't have permision to create a compressed file in this folder.")):b.warning(At("You only have permission to view this folder.")):b.warning(At("You do not have permission to perform the requested action."))}}),Object.extend(tr,{PUBLIC_FOLDER_PATH_LENGTH:7,showCopyPublicUrlModal:function(e){var t,n;return Xn.show(Wi.append_ellipsis(At("Copy public link")),Mt.fromElm("copy-public-url"),{wit_group:"copy_public_link"}),Xn.onHide=function(){return $("flash_copy_container").remove(),delete Xn.onHide,Xn.hide()},t=Le.clipboard_overlay(e,pe("#real_copy"),function(){return b.success(At("Link copied to clipboard!")),Xn.hide()}),t.css({zIndex:1001}),n=$("modal-content").down("#public_url"),bt(n,"Text element not found for copy pulic link"),n.setValue(e),n.select()},shortenPublicLink:function(){var e;return Rt.shorten_url($F("public_url"),tr.updatePublicLink),e=new Element("img",{id:"publink_loading",src:"/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif",className:"right"}),$("modal-content").down("a").__date(e)},updatePublicLink:function(e){var t;return $("public_url").setValue(e),$("public_url").select(),$("publink_loading").remove(),$("flash_copy_container").remove(),t=Le.clipboard_overlay(e,pe("#real_copy"),function(){return b.success(At("Link copied to clipboard!")),Xn.hide()}),t.css({zIndex:1001})},option_dict:{new_folder:{icon:"folder_add",text:At("New folder"),click_handler:function(e){return pr.new_folder()}},global_restore:{icon:"restore",text:function(){return bt(pr.inside_deleted_dir,"Global restore from not a deleted dir"),At(pr.inside_deleted_shared_folder?"Re-add shared folder":pr.inside_deleted_sandbox?"Restore app folder":"Restore folder")},click_handler:function(){var e,t,n,i,r;return e=pr.containing_fq_path(),n=e.toLowerCase(),pr.inside_deleted_sandbox?(bt(pr.old_path_to_ns_id[n],"Deleted sandbox missing nsid"),Tr.restore_sandbox(pr.active_user,e,pr.old_path_to_ns_id[n])):pr.inside_deleted_shared_folder?(bt(pr.old_path_to_ns_id[n],"Deleted shared folder missing nsid"),On.sync_shared_folder(pr.old_path_to_ns_id[n],pr.active_user.role,"BROWSE_GLOBAL_ACTIONS",!1,!0)):(t=s.parse(location.href).setFragment("").toString(),i={prev:t},i[A.UID_PARAM_NAME]=pr.active_user,r=s({path:"/restore"+e}).updateQuery(i),window.location.href=String(r))}},restore:{icon:"restore",text:function(){var e,t;return e=this.get_files(),t=Wi.profile_files(e),t.shared_folders===e.length?Tt("Re-add shared folder","Re-add shared folders",e.length,{comment:"BUTTON"}):Wi.append_ellipsis(At("Restore",{comment:"Restore a previously-deleted file"}))},click_handler:function(){var e,t,n,i,r,o,a,_;if(t=this.get_files(),0===t.length);else{if(1!==t.length)return Vn.show_bulk_restore(t,pr.active_user);if(e=t.first(),!e.is_deleted)return;i=e.fq_path,n=i.toLowerCase(),e.type===at.SANDBOX?(bt(pr.old_path_to_ns_id[n],"Restore is missing ns"),Tr.restore_sandbox(pr.active_user,i,pr.old_path_to_ns_id[n])):(a=e.type)===at.SHARED_FOLDER||a===at.TEAM_SHARED_FOLDER?(bt(pr.old_path_to_ns_id[n],"Re-add is missing ns"),On.sync_shared_folder(pr.old_path_to_ns_id[n],pr.active_user.role,"BROWSE_FILE_ACTIONS",!1,!0)):e.dir?(r=s.parse(location.href).updateQuery({select:e.filename}),o={prev:String(r)},o[A.UID_PARAM_NAME]=pr.active_user,_=s({path:"/restore"+e.fq_path}).updateQuery(o),window.location=String(_)):Vn.show_undelete(e)}}},global_share:{icon:"rainbow_16",text:function(){return pr.inside_team_folder?Wi.append_ellipsis(At("Team folder options",{comment:"BUTTON. please keep this as short as possible"})):pr.inside_shared_folder?Wi.append_ellipsis(At("Shared folder options",{comment:"BUTTON. please keep this as short as possible."})):""===pr.containing_fq_path()?Wi.append_ellipsis(At("Share a folder",{comment:"BUTTON. this initiates a wizard that lets the user select a folder to share."})):Wi.append_ellipsis(At("Share this folder",{comment:"BUTTON. this button lets the user share the current folder that they're viewing."}))},click_handler:function(e){return e.preventDefault(),""===pr.containing_fq_path()?zt.start_wizard_for_user(pr.active_user):Ce.Tiburon.foldersUI(pr.active_user.id)?null:pr.inside_shared_folder?zt.show_shared_folder_options_modal(pr.containing_mount_point(),pr.active_user):zt.show_share_existing_modal(pr.containing_fq_path(),pr.active_user)}},share:{icon:"rainbow_16",text:Wi.append_ellipsis(At("Share",{comment:"BUTTON"})),click_handler:function(e,t){var n;return n=this.get_files().first(),zt.logAndShowSharingModal(n,t)}},revisions:{icon:"previous_versions",click_handler:function(){return window.location.href=Vn.build_revisions_uri(this.get_files().first().fq_path,pr.active_user)},text:At("Previous versions",{comment:"BUTTON"})},global_token_share:{icon:"s_link",text:Wi.append_ellipsis(At("Share link",{comment:"BUTTON"})),click_handler:function(e,t){return ze.ShmodelUILogger.log("via-global-toolbar"),kn.shmodel(pr.containing_fq_path(),t+"_global_token_share")}},copy_url:{icon:"world_link",text:Wi.append_ellipsis(At("Copy public link",{comment:"BUTTON"})),click_handler:function(e){var t,n;return t=this.get_files().first(),n=pr.public_app_token?"/spa/"+pr.public_app_token+t.ns_path:"/u/"+pr.active_user.id+t.fq_path.substring(tr.PUBLIC_FOLDER_PATH_LENGTH),tr.showCopyPublicUrlModal(String(new s({scheme:"https",authority:he.PUBSERVER,path:n})))}},download:{icon:"download",text:function(){return At("Download",{comment:"BUTTON"})},click_handler:function(){var e,t,n,i,r,o,a,_;return n=this.get_files(),1!==n.length||n[0].dir?Vn.do_bulk_download(n):(t=n.first(),a=[he.BLOCK_CLUSTER,t.fq_path,t.hash],e=a[0],r=a[1],i=a[2],o={w:i,dl:1},_=s({scheme:"https",authority:e,path:"/get"+r,query:o}),window.location=String(_.updateQuery(A.UID_PARAM_NAME,pr.active_user)))}},view:{href:function(){var e,t,n,i,r;return t=this.get_files().first(),r=[he.BLOCK_CLUSTER,Rt.urlquote(t.fq_path),t.hash],e=r[0],i=r[1],n=r[2],"https://"+e+"/get"+i+"?w="+n},icon:"page_white_magnify",text:At("View file",{comment:"BUTTON"})},ignore:{click_handler:function(){return zt.show_ignore_modal(this.get_files().first().fq_path)},icon:"folder_user_delete",text:At("Permanently remove",{comment:"BUTTON"})},show_del:{click_handler:function(e){return pr.toggle_deleted()},icon:"trash-can",text:At("Show deleted files",{comment:"BUTTON"})},hide_del:{click_handler:function(e){return pr.toggle_deleted()},icon:"trash-can-open",text:At("Hide deleted files",{comment:"BUTTON"})},copy:{icon:"copy",text:Wi.append_ellipsis(At("Copy",{comment:"BUTTON"})),click_handler:function(e){var t,n;return n=this.get_files(),1===n.length?(t=n.first(),Vn.show_copy(t.fq_path,t.dir)):n.length>1?Vn.show_copy_bulk(n):void 0}},move:{icon:"move_16",text:Wi.append_ellipsis(At("Move",{comment:"BUTTON"})),click_handler:function(e){var t,n;return n=this.get_files(),1===n.length?(t=n.first(),Vn.show_move(t.fq_path,t.dir)):n.length>1?Vn.show_move_bulk(n):void 0}},rename:{icon:"rename",text:At("Rename",{comment:"BUTTON"}),click_handler:function(){return this.get_files().first().edit()}},delete:{icon:"delete_16",text:Wi.append_ellipsis(At("Delete",{comment:"BUTTON"})),click_handler:function(e){var t,n,i,r,o,s,a,_;if(i=this.get_files(),a=i.length,a>=1){if(s=i[0].mount_point)for(r=o=1,_=a;_>=1?_>o:o>_;r=_>=1?++o:--o)if(i[r].mount_point!==s){s="";break}if(t=s?We.filename(s):null,a>1)return Vn.show_bulk_delete(pr.active_user,i,t);if(1===a)return n=i[0],Vn.show_delete(pr.active_user,n.fq_path,n.dir,void 0,t,n.is_shared_folder())}}},global_purge:{icon:"cancel",text:Wi.append_ellipsis(At("Permanently delete folder")),click_handler:function(){return Vn.show_purge(pr.containing_fq_path(),!0)}},purge:{icon:"cancel",text:Wi.append_ellipsis(At("Permanently delete",{comment:"BUTTON"})),click_handler:function(e){var t,n;return n=this.get_files(),1===n.length?(t=n.first(),Vn.show_purge(t.fq_path,t.dir)):Vn.show_bulk_purge(n)}},upload:{icon:"upload_16",text:Wi.append_ellipsis(At("Upload")),click_handler:function(e){return Vn.show_upload()}},app_info:{icon:"application_double",text:Wi.append_ellipsis(At("Application info")),click_handler:function(e){return window.location.href="/account/security"}},more_actions:{is_dropdown:!0,text:At("More",{comment:"Show more options"}),click_handler:Prototype.emptyFunction},more_global_actions:{text:At("More actions"),click_handler:function(){return or.show_secondary(),document.body.observe("click",or.hide_secondary)}},view_in_photos:{icon:"s_photo",text:function(){return At("View in Photos")},click_handler:function(){var e;return e=this.get_files(),Vn.do_bulk_photo_view(pr.active_user,e)}},compress:{icon:"s_photo",text:function(){return At("Compress (experimental)")},click_handler:function(){var e;return e=this.get_files(),Vn.show_compress_bulk(pr.active_user,e)}},view_in_carousel:{icon:"s_carousel",text:function(){return At("View in Timeline")},click_handler:function(){var e;return e=this.get_files(),Vn.do_bulk_photo_view(pr.active_user,e)}},album_from_folder:{icon:"create-album",text:function(){return At("Create album")},click_handler:function(){var e,t;return e=this.get_files(),t=e.first(),Vn.create_album_from_folder(t.fq_path,t.filename)}},open:{icon:"open",text:function(){return At("Open")},click_handler:function(){var e;return e=this.get_files().first(),__CONDITIONAL_JS__.UnityFeatures.open_file(e.ns_id,e.ns_path,e.user_id,__CONDITIONAL_JS__.UnityFeatures.standard_open_file_handler,function(e){return __CONDITIONAL_JS__.UnityFeatures.standard_open_file_handler(!1)})}},comment:{icon:"s_file_comment",text:function(){return At("Comment",{comment:"BUTTON"})},click_handler:function(e){var t;return t=this.get_files().first(),pr.open_preview(t,e,!1,!0)}},single_entry_share_dropdown_variant_token_share_only:{icon:"s_rainbow",text:Wi.append_ellipsis(At("Share")),click_handler:function(e,t){var n;return n=this.get_files().first(),ze.ShmodelUILogger.log_with_target_file("single_entry_share_click",t,n),kn.shmodel(n.fq_path,t)}},single_entry_share_dropdown_variant_menu:{icon:"s_rainbow",text:Wi.append_ellipsis(At("Share")),is_dropdown:!0,subactions:["single_entry_share_dropdown_variant_menu_invite_option","single_entry_share_dropdown_variant_menu_token_share_option"],click_handler:function(){},hover_handler:function(e,t){var n;return n=this.get_files().first(),ze.ShmodelUILogger.log_with_target_file("single_entry_share_hover",t,n)}},single_entry_share_dropdown_variant_menu_invite_option:{icon:"user_add",text:Wi.append_ellipsis(At("Invite people to collaborate")),click_handler:function(e,t){var n,i;return it.get_for_user(pr.active_user).verified_or_show()?(n=this.get_files().first(),n.is_shared_folder()?(ze.ShmodelUILogger.log_with_target_file("sf_options",t,n),i=new Yt(pr.active_user,n.fq_path)):(ze.ShmodelUILogger.log_with_target_file("sf_invite",t,n),i=new pn(pr.active_user,{folder_name:n.fq_path,element_id:"invite-to-new-sf-wizard-modal-"+pr.active_user.id})),i.show()):void 0}},single_entry_share_dropdown_variant_menu_token_share_option:{icon:"s_link",text:Wi.append_ellipsis(At("Send link")),click_handler:function(e,t){var n;return n=this.get_files().first(),ze.ShmodelUILogger.log_with_target_file("token_share",t,n),kn.shmodel(n.fq_path,t)}}}}),ir=Xe.BrowseActionsContext=Class.create(tr,{initialize:function($super,e){return $super(e),this._listen()},_listen:function(){return $("context-menu-container").stopObserving("click"),$("context-menu-container").stopObserving("contextmenu"),pe("#context-menu-container").off("mouseenter"),$("context-menu-container").on("click",".action button",this._click.bind(this)),$("context-menu-container").on("contextmenu",".action button",this._click.bind(this)),pe("#context-menu-container").on("mouseover","li.primary",this._over.bind(this)),pe("#context-menu-container").on("mouseout","li.primary",this._out.bind(this)),pe("#context-menu-container").on("mouseenter",".action button",this._enter.bind(this))},_click:function(e,t){var n,i;return n=t.readAttribute("data-value"),An.call(this.get_disabled_action_names(),n)>=0?(this.show_disabled_action_warning(n),!1):(ze.TimeToFirstActionLogger.log(pr.active_user.id,n),this.firefly_logging_helper(n),i=tr.option_dict[n],ze.BrowseActionsContextMenuLogger.log(this.get_files(),n),i.is_dropdown&&!t.hasAttribute("submenu-index")||hr.hide(),e.preventDefault(),i.click_handler.call(this,K.OREF_CONSTANTS.BROWSE_COMMENT_CONTEXTMENU,e,"browse_actions_context"),"share"===n?ze.SharedFolderActivityLogger.log("web","browse_view_share_existing",pr.active_user,this._log_extras,!0):void 0)},_reset_all_submenus:function(){return pe("#context-menu-container .hover").removeClass("hover")},_reset_submenu:function(e){return pe(e).removeClass("hover")},_enter:function(e){var t,n,i;return t=pe(e.currentTarget).data("value"),bt(t),n=tr.option_dict[t],bt(n,"Action info is missing for "+t),null!=(i=n.hover_handler)?i.call(this,e,"browse_actions_context"):void 0},_over:function(e){return pe(e.currentTarget).children(".secondary").length?(clearTimeout(this.timeoutID),this._reset_all_submenus(),pe(e.currentTarget).addClass("hover")):void 0},_out:function(e){return pe(e.currentTarget).children(".secondary").length?this.timeoutID=setTimeout(function(t){return function(){return t._reset_submenu(e.currentTarget)}}(this),300):void 0}}),nr=Xe.BrowseActionsBasic=Class.create(tr,{initialize:function($super){var e;return e=_r.get_selected_files(),$super(e),this._render(),this._listen()},_listen:function(){var e;return this.bound_update=this._update.bind(this),this.bound_disable=this._disable.bind(this),this.bound_enable=this._enable.bind(this),this.bound_click=this._click.bind(this),document.observe(_r.UPDATED_EVT,this.bound_update),document.observe(hr.SHOW_EVT,this.bound_disable),document.observe(hr.HIDE_EVT,this.bound_enable),e=$("browse-root-actions"),e.stopObserving("click"),e.on("click",".action button",this.bound_click)},unlisten:function(){return document.stopObserving(_r.UPDATED_EVT,this.bound_update),document.stopObserving(hr.SHOW_EVT,this.bound_disable),document.stopObserving(hr.HIDE_EVT,this.bound_enable),$("browse-root-actions").stopObserving("click",this.bound_click)},_update:function(){return this._set_files(_r.get_selected_files()),this._render()},_disable:function(){return $("browse-root-actions").stopObserving("click"),$("browse-root-actions").down(".secondary")&&$("browse-root-actions").down(".secondary").addClassName("disabled"),$$("#browse-root-actions .action *").invoke("setStyle",{cursor:"default"})},_disable_action:function(e){var t,n;return n="#browse-root-actions #"+e+"_action_button",t=pe(n),t.addClass("disabled"),t.click(function(t){return function(n){return t.show_disabled_action_warning(e),!1}}(this))},_enable:function(){return $("browse-root-actions").stopObserving("click"),$("browse-root-actions").on("click",".action button",this._click.bind(this)),$("browse-root-actions").down(".secondary")&&$("browse-root-actions").down(".secondary").removeClassName("disabled"),$$("#browse-root-actions .action *").invoke("setStyle",{cursor:"pointer"})},_render:function(){var e,t,n,i,r,o,s,a,_,u,d,c,h,f,p,m,v,g,w,b,y,k,E,x,C,S,T,A,D,O,N,I;for(c=this.get_files(),n=this.get_action_names(),D=["single_entry_share_dropdown_variant_token_share_only","single_entry_share_dropdown_variant_menu"],m=0,w=D.length;w>m;m++)if(t=D[m],p=n.indexOf(t),p>-1){n.splice(p,1);break}for(e=13.5,_="",h="",1===c.length?(_=l.em_snippet(c[0].filename,e),!c[0].dir&&c[0].bytes>=0&&(h=c[0].size)):1<c.length&&(S=Wi.profile_files(c),k=[],S.files&&(E=Tt("%d file","%d files",S.files).format(S.files),k.push(E)),S.folders&&(E=Tt("%d folder","%d folders",S.folders).format(S.folders),k.push(E)),_=Rt.nice_list(k)),o=$("browse-root-actions"),r=o.getLayout().get("width"),f=o.getStyle("font-size"),bt(f.endsWith("px"),"Invalid font size "+f),f=parseInt(f,10),u=new l(_).length*f,O=new l(h).length*f,r-=u+O,N=[],A=[],r-=30,v=0,b=n.length;b>v;v++)x=n[v],t=this.get_action_by_name(x),I=new l(t.text).length*f,s=I+16+8+10+9,r>s?N.push(x):(0===A.length&&(C=N.pop(),A.push(C)),A.push(x)),r-=s;for(A.length&&N.push("more_actions"),i=function(){var e,t,n;for(n=[],e=0,t=N.length;t>e;e++)x=N[e],n.push(this.get_action_by_name(x));return n}.call(this),A.length&&(i[i.length-1].subactions=function(){var e,t,n;for(n=[],e=0,t=A.length;t>e;e++)x=A[e],n.push(this.get_action_by_name(x));return n}.call(this)),a=Ke.tmpl("actions_bar_tmpl",{context:this,description:_,filesize:h,has_actions:!!n.length,actions:i,_:At,Sprite:G}),$("browse-root-actions").__date(a),d=this.get_disabled_action_names(),T=[],g=0,y=d.length;y>g;g++)t=d[g],T.push(this._disable_action(t));return T},_click:function(e,t){var n,i;return n=t.readAttribute("data-value"),bt(n),this.firefly_logging_helper(n),i=tr.option_dict[n],bt(i,"Action info is missing for "+n),e.preventDefault(),ze.TimeToFirstActionLogger.log(pr.active_user.id,n),i.click_handler.call(this,K.OREF_CONSTANTS.BROWSE_COMMENT_BUTTON,e,"browse_actions_basic"),"share"===n?ze.SharedFolderActivityLogger.log("web","browse_view_select_share_existing",pr.active_user,this._log_extras,!0):void 0}}),Object.extend(nr,{STANDARD_ACTIONS:["share","app_info","copy_url","download","delete","rename","restore","purge","view_in_photos","view_in_carousel","compress"]}),rr=Xe.GlobalActions=Class.create(tr,{initialize:function($super){return $super()},get_action_names:function(){var e;return pr.inside_dir?(e=[],pr.inside_deleted_dir?e=e.concat(["global_restore"]):(e=e.concat(["upload","new_folder"]),this._should_show_shared_folder_options()&&e.push("global_share"),this._should_show_share_link()&&e.push("global_token_share"),e.push(pr.deleted_shown?"hide_del":"show_del")),e):[]},_should_show_shared_folder_options:function(){return!pr.is_in_subfolder_of_shared_folder()&&!pr.inside_sandbox},_should_show_share_link:function(){return!pr.inside_team_folder&&pr.is_shmodelable_path(pr.containing_fq_path())}}),or=Xe.GlobalActionsBasic=Class.create(rr,{initialize:function($super){return $super(),this._listen(),this._render()},_listen:function(){return $("global-actions").stopObserving("click"),$("global-actions").on("click","a",this._click.bind(this)),document.observe(hr.SHOW_EVT,this._disable.bind(this)),document.observe(hr.HIDE_EVT,this._enable.bind(this))},_render:function(){var e,t,n,i,r,o,s,a,_,l,u,d,c;for(t=this.get_action_names(),c=t.intersect(or.STANDARD_ACTIONS),u=t.without.apply(t,or.STANDARD_ACTIONS),1===u.length&&(c=t,u=[]),u.length&&c.push("more_global_actions"),d=function(){var e,t,n;for(n=[],e=0,t=c.length;t>e;e++)a=c[e],n.push(this.get_action_by_name(a));return n}.call(this),n=function(){var t,n,i;for(i=[],t=0,n=d.length;n>t;t++)e=d[t],"button"===e.kind&&i.push(e);return i}(),_=function(){var t,n,i;for(i=[],t=0,n=d.length;n>t;t++)e=d[t],"button"!==e.kind&&i.push(e);return i}(),i=Ke.tmpl("global_actions_tmpl",{context:this,standard_actions:n.concat(_),secondary_actions:function(){var e,t,n;for(n=[],e=0,t=u.length;t>e;e++)a=u[e],n.push(this.get_action_by_name(a));return n}.call(this),Sprite:G}),$("global-actions").__date(i),pe(document).trigger(ke.GA_RENDERED),r=this.get_disabled_action_names(),l=[],o=0,s=r.length;s>o;o++)e=r[o],l.push(this._disable_action(e));return l},_disable:function(){return $("global-actions").stopObserving("click"),$$("#global-actions .action a").invoke("removeClassName","title_bubble"),$$("#global-actions .action a").invoke("addClassName","disabled")},_disable_action:function(e){var t,n;return n="#global-actions #"+e+"_button",t=pe(n),t.addClass("disabled"),t.click(function(t){return function(n){return t.show_disabled_action_warning(e),!1}}(this))},_enable:function(){var e,t,n,i,r;for($("global-actions").stopObserving("click"),$("global-actions").on("click","a",this._click.bind(this)),$$("#global-actions .action a").invoke("removeClassName","disabled"),$$("#global-actions .action a").invoke("addClassName","title_bubble"),t=this.get_disabled_action_names(),r=[],n=0,i=t.length;i>n;n++)e=t[n],r.push(this._disable_action(e));return r},_click:function(e,t){var n,i;return n=t.readAttribute("data-value"),bt(n),i=tr.option_dict[n],bt(i,"Action info is missing for "+n),or.hide_secondary(),_r.deselect_all(),e.preventDefault(),i.click_handler.call(this,e,"global_actions_basic"),"global_share"===n?""===this._log_extras.path?ze.SharedFolderActivityLogger.log("web","browse_view_share_button",pr.active_user,this._log_extras,!0):ze.SharedFolderActivityLogger.log("web","folder_view_share_button",pr.active_user,this._log_extras,!0):void 0}}),Object.extend(or,{STANDARD_ACTIONS:["upload","new_folder","global_share","global_token_share","global_restore","global_purge"],show_secondary:function(){var e,t;return t=$("secondary-actions"),e=$("more_global_actions_button"),t.show(),e.addClassName("down")},hide_secondary:function(){var e,t;return(t=$("secondary-actions"))?(e=$("more_global_actions_button"),t.hide(),e.removeClassName("down")):void 0}}),sr=Xe.GlobalActionsContext=Class.create(rr,{initialize:function($super,e){return $super(e),this._listen()},_listen:function(){return $("context-menu-container").stopObserving("click"),$("context-menu-container").stopObserving("contextmenu"),$("context-menu-container").on("click",".action button",this._click.bind(this)),$("context-menu-container").on("contextmenu",".action button",this._click.bind(this))},_click:function(e,t){var n,i;return n=t.readAttribute("data-value"),An.call(this.get_disabled_action_names(),n)>=0?(this.show_disabled_action_warning(n),!1):(this.firefly_logging_helper(n),i=tr.option_dict[n],_r.deselect_all(),i.is_dropdown||hr.hide(),e.preventDefault(),i.click_handler.call(this,e,"global_actions_context"),"global_share"===n?""===this._log_extras.path?ze.SharedFolderActivityLogger.log("web","browse_view_right_click_share",pr.active_user,this._log_extras,!0):pr.inside_shared_folder?ze.SharedFolderActivityLogger.log("web","folder_view_right_click_options",pr.active_user,this._log_extras,!0):ze.SharedFolderActivityLogger.log("web","folder_view_right_click_share",pr.active_user,this._log_extras,!0):void 0)}});var ar;ar=Xe.BrowseClipboard=function(){var e,t,n,i,r,o,s,_,l,u,d,c,h;return e=0,t=1,r=[],n=null,h=function(){var e,t,n,i,o,s;if(!Oe.focus_in_input()&&(n=_r.get_selected_files(),n&&n.length)){for(i=0,o=n.length;o>i;i++){if(t=n[i],t.bytes<0)return b.error(At("Deleted files cannot be added to the clipboard")),!1;if(t.target_ns)return s=At("'%(filename)s' cannot be added to the clipboard"),s=s.format({filename:t.filename}),b.error(s),!1}return r=n,e=n.length,s=Tt("Added %d item to clipboard","Added %d items to clipboard",e).format(e),b.success(s),!0}},o=function(){return h()?(n=e,!1):void 0},s=function(){return h()?(n=t,!1):void 0},_=function(t){var i;return bt("undefined"!=typeof t,"BrowseClipboard _paste got an undefined path"),r.length?(i=n===e?Vn.do_bulk_copy:Vn.do_bulk_move,i(r,t),!0):void 0},c=function(e){var t;if(!(Oe.focus_in_input()||pr.in_search_mode()||pr.inside_deleted_dir))return t=_(pr.containing_fq_path()),t?!1:void 0},i=function(){return r=[]},u=function(e){var t,n,o,s,a,_,l;for(o=e.memo.files,s=0,_=o.length;_>s;s++)for(n=o[s],a=0,l=r.length;l>a;a++)if(t=r[a],t.fq_path===n.fq_path||t.fq_path.startsWith(n.fq_path+"/"))return void i()},l=function(e){return bt(null!=e.memo.file&&null==e.memo.files),e.memo.files=[e.memo.file],u(e)},d=function(){var e,t,n,i,r;for(pe(document).on(a.RENAME,function(e){return function(e,t){return e.memo=t,l(e)}}(this)),r=[a.DELETE,a.MOVE],t=0,n=r.length;n>t;t++)e=r[t],document.observe(e,u);return i=z.main_modifier(),z(i+"+c",pr.KEY_SCOPE,o),z(i+"+x",pr.KEY_SCOPE,s),z(i+"+v",pr.KEY_SCOPE,c)},{init:function(){return d()}}}();var _r,lr;_r=Xe.BrowseSelection=function(){var e,t,n,i,r,o,s,a,_,l,u,d,c,h,f,p,m,v,g,w,b,y,k,E,x,C,S,T,A,D,O,N,I,L;return S=[],i=null,l=null,a=null,o=[],N=function(){return $$("#browse-files li.browse-file.file-select").invoke("removeClassName","file-select").invoke("removeClassName","file-select-one"),_r.get_selected_files().invoke("get_div").findAll(function(e){return e}).invoke("addClassName","file-select"),1===_r.get_selected_files().length?_r.get_selected_files().invoke("get_div").findAll(function(e){return e}).invoke("addClassName","file-select-one"):void 0},I=function(){return a||($$("#browse-files li.browse-file[draggable]").invoke("writeAttribute","draggable",!1),pr.in_search_mode())?void 0:_r.get_selected_files().filter(function(e){return!e.editing}).invoke("get_div").findAll(function(e){return e}).invoke("writeAttribute","draggable","true")},L=function(e){return e.apply(null,$A(arguments).slice(1)),document.fire(_r.UPDATED_EVT)},T=function(e,t){var n,r;return r=S.length,S=e instanceof er?[e]:$A(e),n=t||S.last(),bt(!n||n instanceof er,"Invalid anchor type"+n),i=n},T=T.wrap(L),e=function(e,t){return e&&S.push(e),i=t||e},e=e.wrap(L),k=function(e){var t;return t=S.indexOf(e),-1!==t?S.splice(t,1):void 0},k=k.wrap(L),E=function(){return S=[]},E=E.wrap(L),A=function(e){return o=e,$$("#browse-files li.browse-file.context-select").invoke("removeClassName","context-select"),e.invoke("get_div").findAll(function(e){return e}).invoke("addClassName","context-select")},m=function(t){var n,r,s,a,_,l,u,d,c,h,f,p,m;if(p=$(t.target),d=p.match("li.browse-file")?p:p.up("li.browse-file"),n=p.match("a")?p:p.up("a"),s=er.from_elem(d),!t.isRightClick()&&d&&!n&&!d.hasClassName("unselectable")&&(pr.keyboard_nav=!1,!o.length)){if(l=Rt.is_mac(),l&&t.metaKey||!l&&t.ctrlKey)return-1===S.indexOf(s)?e(s):k(s);if(t.shiftKey){for(r=pr.files.indexOf(i),m=pr.files.indexOf(s),u=pr.files.indexOf(S.last()),h=S.slice(0),_=r>u?-1:1,a=r;a!==u;)a+=_,f=h.indexOf(pr.files[a]),-1!==f&&h.splice(f,1);for(_=r>m?-1:1,a=r;a!==m;)a+=_,c=h.indexOf(pr.files[a]),-1!==c&&h.splice(c,1),h.push(pr.files[a]);return T(h,i)}return T(s)}},v=function(e){var t,n,r,s,_,u,d,c,h;if(!(e.isRightClick()||o.length||Rt.in_scrollbar(e.pointerX()))){for(u=$(e.target),Element.match(u,"object")&&(u=u.parentNode),h=["browse-box","context-menu-container","modal","modal-overlay"],d=!1,r=0,s=h.length;s>r;r++)if(c=h[r],u.descendantOf(c)||u.match("#"+c)){d=!0;break}return d?(_=u.match("li.browse-file")?u:u.up("li.browse-file"),n=er.from_elem(_),t=u.match("[draggable]")||u.up("[draggable]"),n&&!t&&(l=i,e.shiftKey||(n?l=n:u.match("#browse-files")&&(l=pr.files.last())),a=[],e.metaKey||e.ctrlKey)?a=_r.get_selected_files():void 0):void T()}},D=function(e){var t,n;return t=er.from_elem(p(e)),e.preventDefault(),t?(n="browse_file_row",ze.ShmodelUILogger.log_with_target_file("token_share",n,t),kn.shmodel(t.fq_path,n)):void 0},p=function(e){var t;return t=$(e.target),t.match("li.browse-file")?t:t.up("li.browse-file")},f=function(e){return function(e){var t,n,i,r,o,s;return n=p(e),t=er.from_elem(n),e.preventDefault(),t?(i="browse_file_row",s=ze.ShmodelUILogger.get_target_item(t),ze.ShmodelUILogger.log("single_entry_share",i,s),o=t.dir&&(t.is_shared_folder()||t.could_be_shared_folder()),o?Ce.Tiburon.foldersUI(pr.active_user.id)?zt.logAndShowSharingModal(t,i):t.could_be_shared_link()?(it.get_for_user(pr.active_user).verified_or_show(),r=pr.in_search_mode()?pe(n).find(".inline-share-button")[0]:pe(n).find(".sharing .inline-share-button")[0],lr.open(t.fq_path,t.is_shared_folder(),r,pr.active_user,s,pr.can_change_new_ns_options)):_r.show_share_modal_if_email_verified(pr.active_user,t.is_shared_folder(),s,t.fq_path,pr.can_change_new_ns_options):Ce.Tiburon.filesUI(pr.active_user.id)?zt.logAndShowSharingModal(t,i):(it.get_for_user(pr.active_user).verified_or_show(),_r.firefly_logging_helper(t,"single_entry_share_button_file_link"),kn.shmodel(t.fq_path,i))):void 0}}(this),r=function(e){var t,n,i;return i=$(e.target),n=i.match("li.browse-file")?i:i.up("li.browse-file"),t=er.from_elem(n),t?m(e):void 0},h=null,u=function(){var e;return clearInterval(h),e=function(){return pr.keyboard_nav=!1,$("browse-files").addClassName("mouse-active")},h=setTimeout(e,100)},s=function(){return pr.keyboard_nav?void 0:(pr.keyboard_nav=!0,$("browse-files").removeClassName("mouse-active"))},g=function(e){var t,n,i,r,o,s,_,d;if(u(),_r.is_selecting()){for(t=pr.files.indexOf(l),d=pr.files.indexOf(er.from_elem(e.target)),bt(t<pr.files.length&&t>=0,"anchor_index: "+t+" "+l),bt(d<pr.files.length&&d>=0,"target_index: "+d),n=pr.files.slice(Math.min(t,d),Math.max(t,d)+1),i=a.slice(0),s=0,_=n.length;_>s;s++)o=n[s],r=i.indexOf(o),-1===r?i.push(o):i.splice(r,1);return T(i)}},_=function(e){return l=null,a=null},y=function(e){var t,n;return"undefined"!=typeof cr&&null!==cr&&cr.reset(),s(),e&&Event.extend(e).preventDefault(),n=S.length?S.last()===pr.files.first()?pr.files.first():(t=pr.files.indexOf(S.last())-1,pr.files[t]):pr.files.last(),T(n),n?pr.scrollTo(n.get_div()):void 0},w=function(e){var t,n;return"undefined"!=typeof cr&&null!==cr&&cr.reset(),s(),e&&Event.extend(e).preventDefault(),n=S.length?S.last()===pr.files.last()?pr.files.last():(t=pr.files.indexOf(S.last())+1,pr.files[t]):pr.files.first(),T(n),n?pr.scrollTo(n.get_div()):void 0},n=function(t){var n,r,o,a,_,l,u,d;if("undefined"!=typeof cr&&null!==cr&&cr.reset(),s(),t&&Event.extend(t).preventDefault(),!(S.length>0))return y();if(_=pr.files.indexOf(S.last()),n=pr.files.indexOf(i),!(i===S.last()||n>_))return k(S.last()),pr.scrollTo(S.last().get_div());if(_>0){for(d=[],o=a=u=_-1;0>=u?0>=a:a>=0;o=0>=u?++a:--a){if(r=pr.files[o],l=S.indexOf(r),e(r,i),-1===l){pr.scrollTo(r.get_div());break}d.push(S.splice(l,1))}return d}},t=function(t){var n,r,o,a,_,l,u,d,c;if("undefined"!=typeof cr&&null!==cr&&cr.reset(),s(),t&&Event.extend(t).preventDefault(),S.length>0){if(_=pr.files.indexOf(S.last()),n=pr.files.indexOf(i),i===S.last()||_>n){for(c=[],o=a=u=_+1,d=pr.files.length;d>=u?d>a:a>d;o=d>=u?++a:--a){if(r=pr.files[o],l=S.indexOf(r),e(r,i),-1===l){pr.scrollTo(r.get_div());break}c.push(S.splice(l,1))}return c}return k(S.last()),pr.scrollTo(S.last().get_div())}return w()},x=function(){return"undefined"!=typeof cr&&null!==cr&&cr.reset(),T(pr.files),!1},C=function(){return"undefined"!=typeof cr&&null!==cr&&cr.reset(),T(null,null,null)},c=function(){return $$(".file-select").invoke("removeClassName","file-select").invoke("removeClassName","file-select-one"),setTimeout(N,100)},b=function(t){return t.memo.files.each(function(t){var n;return n=S.indexOf(t[0]),-1!==n?(S.splice(n,1),e(t[1])):void 0})},d=function(e,t){var n;return pr.in_search_mode()&&e&&t?(n={file_nsid:e.ns_id,file_sjid:e.file_sjid,firefly:Ji.firefly_enabled,match_type:e.match_type,position:e.sort_rank,request_id:e.request_id,viewport:"full-view",action_type:t},ze.SearchClientActivityLogger.log("result_action",pr.active_user.id,n)):void 0},O=function(e,t,n,i,r,o){var s,a;return it.get_for_user(e).verified_or_show()?(a="file_row_sharing_menu",t?(ze.ShmodelUILogger.log("sf_options",a,n),d("single_entry_share_button_folder_options"),s=new Yt(e,i)):(ze.ShmodelUILogger.log("sf_invite",a,n),d("single_entry_share_button_folder_invite"),s=new pn(e,{folder_name:i,element_id:"invite-to-new-sf-wizard-modal-"+e.id,can_change_options:r})),"function"==typeof o&&o(),s.show()):void 0},document.observe(Yi.REMOVE,function(e){return e.memo.files.each(k)}),document.observe(Yi.MOVE,b),{UPDATED_EVT:"db:select:updated",
init:function(){var e;return document.observe("click",r),document.observe("mousedown",v),document.observe("mouseup",_),document.observe("dragend",_),document.observe("mouseup",I),$("browse-files").on("mouseover","li.browse-file",g),$("browse-files").on("click",".shmodel-file",D),$("browse-files").on("click",".inline-share-button",f),document.observe(_r.UPDATED_EVT,N),document.observe(_r.UPDATED_EVT,I),document.observe(ke.RENDER,N),document.observe(ke.RENDER,I),document.observe(ke.UPDATE,T.bind(null,null,null)),e=z.main_modifier(),z("up",pr.KEY_SCOPE,y),z("down",pr.KEY_SCOPE,w),z(e+"+a",pr.KEY_SCOPE,x),z("escape",pr.KEY_SCOPE,C),z("shift+up",pr.KEY_SCOPE,n),z("shift+down",pr.KEY_SCOPE,t)},set_selected_files:function(e){return T(e)},get_selected_files:function(){return S.slice(0)},get_selected_fq_paths:function(){return S.map(function(e){return e.fq_path})},has_selected_files:function(){return S.length},is_selected:function(e){return-1!==S.indexOf(e)},is_selecting:function(){return!!l},deselect_all:E,set_context_selected:function(e){return A(e)},flicker_selected:c,firefly_logging_helper:function(e,t){return d(e,t)},show_share_modal_if_email_verified:O}}(),lr=Xe.SharingGrowthExperimentsDropdown={open:function(e,t,n,i,r,o){var s;if(this.fq_path=e,this.existing_sf=t,this.button=n,this.user=i,this.target_item=r,this.can_change_options=o,this.$menu=pe("#sharing-growth-experiments-dropdown-menu"),s=this.$button&&this.$button.length){if(this.$button[0]===this.button)return void this._hide();this._hide()}return this._show()},_show:function(){var e;return this.$menu.show(),this.$button=pe(this.button),this.$button.addClass("pressed"),e={offsetLeft:-1*Math.abs(this.$button.outerWidth()-this.$menu.outerWidth())+6,offsetTop:46,setWidth:!1,setHeight:!1},Oe.clone_position(this.$menu,this.$button,e),pe("#browse-box").addClass("dropdown-menu-open"),this._listen()},_listen:function(){return this.$menu.on("click dblclick",function(e){return e.stopPropagation()}),pe(document).on("mousedown",pe.proxy(this._click_outside_menu_callback,this)),this.$menu.find(".option-to-share-folder").on("click",pe.proxy(this._sf_click,this)),this.$menu.find(".option-to-share-link").on("click",pe.proxy(this._share_link_click,this))},_unlisten:function(){return this.$menu.hide().off("click dblclick"),pe(document).off("mousedown",this._click_outside_menu_callback),this.$menu.find(".option-to-share-folder").off("click",pe.proxy(this._sf_click,this)),this.$menu.find(".option-to-share-link").off("click",pe.proxy(this._share_link_click,this))},_sf_click:function(e){return this._hide(),_r.show_share_modal_if_email_verified(this.user,this.existing_sf,this.target_item,this.fq_path,this.can_change_options)},_share_link_click:function(e){var t;return this._hide(),t="file_row_sharing_menu",ze.ShmodelUILogger.log("token_share",t,this.target_item),this._firefly_logging_helper("single_entry_share_button_folder_link"),kn.shmodel(this.fq_path,t)},_firefly_logging_helper:function(e){return _r.firefly_logging_helper(pr.find_file(this.fq_path),e)},_clicked:function(e,t){return e.is(t.target)||e.has(t.target).length},_click_outside_menu_callback:function(e){return this._clicked(this.$menu,e)||this._clicked(this.$button,e)?void 0:this._hide()},_hide:function(e){return this._unlisten(),pe("#browse-box").removeClass("dropdown-menu-open"),this.$button.removeClass("pressed"),this.$button=null}};var ur;ur=Xe.DragScroll={_timer:null,_mouse_y:0,_initial_mouse_y:null,_scroll_amount:40,_scroll_window:50,_min_drag_distance:20,_exclude_move_event:null,init:function(e,t){return this._exclude_move_event=e,null!=t?this._scroll_window=t:void 0},start:function(){return this._initial_mouse_y=null,this._listen(),this._timer=setInterval(this._check_for_scroll.bind(this),100)},end:function(){return this._unlisten(),clearInterval(this._timer)},_mousemove:function(e){var t;return("function"==typeof this._exclude_move_event?this._exclude_move_event(e):void 0)?this._mouse_y=0:(t=e.pointerY(),this._mouse_y=t-Oe.scroll_offsets().top)},_listen:function(){return document.observe("mousemove",this._mousemove.bind(this)),document.observe("dragover",this._mousemove.bind(this))},_unlisten:function(){return document.stopObserving("mousemove",this._mousemove.bind(this)),document.stopObserving("dragover",this._mousemove.bind(this))},_check_for_scroll:function(){var e;return null===this._initial_mouse_y&&(this._initial_mouse_y=this._mouse_y),Math.abs(this._mouse_y-this._initial_mouse_y)<this._min_drag_distance?void 0:(e=0,this._mouse_y<this._scroll_window?e=-1*this._scroll_amount:this._mouse_y>Oe.viewport_dimensions().height-this._scroll_window&&(e=this._scroll_amount),e?Oe.scroll_to(Oe.scroll_offsets().left,Oe.scroll_offsets().top+e):void 0)}};var dr;dr=Xe.BrowseDrag={_BODY_DRAG_CLASS:"external_drag",_STATUS_CLASS:"dragging",_STATUS_OFFSET:10,_SELECTION_CONST:"SELECTION",_current_item_key:null,_drag_from_window:!1,init:function(){var e;return this.listen(),e=function(e){var t;return t=pe(e.target),t.closest("#browse-location").length||"browse-location"===t.attr("id")},ur.init(e,pe("#browse-header").height())},listen:function(){var e;return e=$(document.body),document.observe(ke.UPDATE,this._update_body_data.bind(this)),e.on("dragleave","[dropzone]",this._dropzone_dragleave.bind(this)),e.on("dragend",this._body_dragend.bind(this)),e.on("dragover","[dropzone]",this._dropzone_dragover.bind(this)),Prototype.Browser.IE&&(e.on("dragenter","[dropzone]",this._dropzone_dragover.bind(this)),e.on("mousedown",this._ie_start_drags.bind(this)),e.on("mouseover","a.filename-link",this._ie_mouseover.bind(this))),e.observe("dragover",this._body_dragover.bind(this)),e.observe("dragleave",this._body_dragleave.bind(this)),e.observe("dragstart",this._body_dragstart.bind(this)),e.observe("mousemove",this._body_mousemove.bind(this)),e.on("dragstart","li.browse-file",this._file_dragstart.bind(this)),document.observe(_r.UPDATED_EVT,this._build_selected_drag_icon.bind(this)),document.observe(ke.RENDER,this._build_selected_drag_icon.bind(this)),e.on("mousedown","li.browse-file",this._build_file_drag_icon.bind(this)),e.on("drop","[dropzone]",this._drop.bind(this))},_file_mousemove:function(e){var t;if(window.event&&1===window.event.button)return t=e.findElement("[draggable]"),t&&t!==document&&t.dragDrop?(t.dragDrop(),dr._ie_end_drags()):void 0},_ie_start_drags:function(e,t){return"OBJECT"!==t.tagName&&$(t).match("[draggable]")?$("browse-files").observe("mousemove",this._file_mousemove):void 0},_ie_end_drags:function(){return $("browse-files").stopObserving("mousemove")},_update_body_data:function(){var e,t;return e=pr.inside_dir?"copy move":!1,t=pr.inside_dir?pr.containing_fq_path():!1,$(document.documentElement).writeAttribute("dropzone",e),$(document.documentElement).writeAttribute("data-fq_path",t)},_body_dragover:function(e){var t;return t=this._get_event_browse_files(),t.length?this._update_status_position(e,t):!this._drag_from_window&&this._can_drop_transfer(e.dataTransfer)?zn.show_drop_indicators(e):void 0},_body_dragleave:function(e){var t,n,i;return n=e.x||e.clientX,i=e.y||e.clientY,t=Oe.viewport_dimensions(),n>0&&n<t.width&&i>0&&i<t.height?void 0:zn.hide_drop_indicators()},_body_dragstart:function(){return this._drag_from_window=!0},_body_dragend:function(){return $("breadcrumb-dropdown")&&($("breadcrumbs-box").removeClassName("down"),$("breadcrumb-dropdown").hide()),this._clear_event_browse_files(),this._remove_drop_indicators(),zn.hide_drop_indicators(),ur.end(),this._drag_from_window=!1},_body_mousemove:function(){return zn.hide_drop_indicators()},_ie_mouseover:function(e,t){return Oe.focus_in_input()?void 0:t.focus()},_dropzone_dragover:function(e,t){var n,i,r,o;if(!qe.isFileDragEnabled())return!0;if(e.preventDefault(),r=this._get_event_browse_files(),o=this._target_fq_path(t),r.pluck("fq_path").indexOf(-1===o)){if(!this._can_drop(e,t))return void t.addClassName("drag_nodrop");try{i=e.dataTransfer.effectAllowed}catch(e){}return"move"===i||"copyMove"===i||"linkMove"===i||"all"===i?e.dataTransfer.dropEffect="move":e.dataTransfer.dropEffect="copy",e.preventDefault(),n=$$(".dragover"),n.removeItem(t),n.invoke("removeClassName","dragover"),Un.disabled||t.addClassName("dragover"),zn.folder_dragover(o)}},_dropzone_dragleave:function(e,t){return this._clear_hover_state(t)},_file_dragstart:function(e,t){var n,i,r,o,s,a,_,l,u,d;if(Rt.clear_selected(),_r.is_selecting())return e.preventDefault();if(e.dataTransfer.effectAllowed="copyMove",e.dataTransfer.setData("URL","about:blank"),a=er.from_elem(t),this._set_event_browse_files(a),_=this._get_event_browse_files(),_.length<=1&&!a.dir){d=a.href,l=(a.filename||At("file")).replace(/:/g,"-"),u="application/octet-stream";try{e.dataTransfer.setData("DownloadURL",[u,l,d].join(":"))}catch(e){}}r=new Element("img",{src:"/static/images/icons/icon_spacer-vflN3BYt2.gif",width:1,height:1}),n=!0;try{e.dataTransfer.setDragImage(r,150,150)}catch(e){s=e,n=Rt.ie8}return this._add_drop_indicators(e),ur.start(),n?(this._update_status_position(e,_),i=$("drag-status"),i.removeClassName("rotatein").removeClassName("fadein").removeClassName("selection"),_.length>1&&i.addClassName("rotatein"),this._is_dragging_selection()&&i.addClassName("selection"),i.addClassName("fadein")):void 0},_add_drop_indicators:function(e){var t,n,i,r,o;if($(document.body).addClassName(this._STATUS_CLASS),!Un.disabled){for(r=$$('[dropzone="copy move"]'),o=[],n=0,i=r.length;i>n;n++)t=r[n],this._can_drop(e,t)?o.push(t.addClassName("can_drop")):o.push(void 0);return o}},_remove_drop_indicators:function(){return this._clear_hover_state(),$(document.body).removeClassName(this._STATUS_CLASS),$$(".can_drop").invoke("removeClassName","can_drop")},_build_selected_drag_icon:function(){var e,t,n,i,r,o,s,a,_,l,u;for(u=_r.get_selected_files(),n=new Element("div",{id:"drag-selection-status"}),l=u.slice(0,4),r=s=0,a=l.length;a>s;r=++s)t=l[r],e=t.get_div(),e&&(_=e.down(".icon"),_.stopObserving("load"),_.observe.bind(_).defer("load",dr._build_selected_drag_icon),o=_.cloneNode(!1),Element.addClassName(o,"icon icon"+r),n.__sert(o));return i=new Element("span",{className:"badge"}),i.__date(u.length),n.appendChild(i),$("drag-selection-status").replace(n)},_build_file_drag_icon:function(e,t){var n,i,r,o;return n=er.from_elem(t),o=n.get_div().down(".icon").cloneNode(!1),Element.addClassName(o,"icon icon0"),r=new Element("span",{className:"badge"}),r.__date("1"),i=new Element("div",{id:"drag-file-status"}),i.__date(o).__sert(r),$("drag-file-status").replace(i)},_drop:function(e,t){var n,i,r,o,a,_,l,u,d,c,h,f,p,m,v;if(i=this._get_event_browse_files(),this._linkfile_drop_enabled()&&(_=qe.getDraggedLink(e.dataTransfer)),null!=_?(m=qe.buildUrlLinkfileContents(_),p=new Blob([m],{type:"text/plain"}),f=s.parse(_).getAuthority(),p.name=pr.unused_filename(f+".url"),p.overwrite=!1,l=[p],ze.LinkfileActivityLogger.log("droplink","url",f,!0,"browse",{})):(l=e.dataTransfer.files,u=e.dataTransfer.items),e.preventDefault(),!t.readAttribute("quicksend"))return this._is_read_only(t)?(v=At("You don't have permission to add to this folder."),void b.error(v)):pr.inside_read_only_shared_folder?(v=At("You don’t have permission to move these files."),void b.error(v)):(o=null,a=er.from_elem(t),n=t.readAttribute("data-fq_path"),a?o=a.fq_path:(n||""===n)&&(o=n),l&&l.length?zn.supported()?zn.browse_indicators_enabled()||zn.modal_indicators_enabled()?zn.upload(o,l,u):b.error(At("You can't drag and drop upload right now.")):b.error(At("Drag and drop not supported. Please try the simple uploader.")):i.length&&("copy"===e.dataTransfer.dropEffect||"copy"===e.dataTransfer.effectAllowed?Vn.do_bulk_copy(i,o):pr.inside_dir&&pr.containing_fq_path()===o||Vn.do_bulk_move(i,o)),this._remove_drop_indicators(),zn.hide_drop_indicators());if(l&&l.length)r=function(){return zn.upload(Nn.DEST_FOLDER,l,u)},Nn.get_folder_name(r);else if(i.length)for(c=0,h=i.length;h>c;c++)d=i[c],d.id=B.guid(),Nn.add_dropbox_file(d)},_set_event_browse_files:function(e){var t;return t=_r.is_selected(e),this._current_item_key=t?this._SELECTION_CONST:e.to_key()},_clear_event_browse_files:function(){return this._current_item_key=null},_get_event_browse_files:function(){var e,t,n,i;try{if(i=this._current_item_key,this._is_dragging_selection())return _r.get_selected_files();if(i)return n=er.from_key(i),n?[n]:[]}catch(e){t=e,console.log(t)}return[]},_is_dragging_selection:function(){return this._current_item_key&&this._current_item_key===this._SELECTION_CONST},_is_read_only:function(e){return e.readAttribute("read_only")?!0:!!e.readAttribute("is_read_only_mount")},_linkfile_drop_enabled:function(){return"undefined"!=typeof Blob&&null!==Blob},_can_drop_transfer:function(e){var t;return t=["Files"],this._linkfile_drop_enabled()&&t.push.apply(t,["text/x-moz-url","text/uri-list","Url"]),v.intersection(null!=e?e.types:void 0,t).length>0},_can_drop:function(e,t){var n,i;return t.readAttribute("quicksend")?!0:this._is_read_only(t)?!1:(n=this._target_fq_path(t),i=this._get_event_browse_files(),i.length?!Vn.bulk_move_error(i,n):this._can_drop_transfer(e.dataTransfer)?(zn.supported(),!0):!1)},_target_fq_path:function(e){var t;return t=er.from_elem(e),t?t.fq_path:e.readAttribute("data-fq_path")},_clear_hover_state:function(e){var t,n,i,r;for(r=$$("#browse .dragover"),n=0,i=r.length;i>n;n++)t=r[n],t!==e&&t.removeClassName("dragover");return $$("#browse .drag_nodrop").invoke("removeClassName","drag_nodrop")},_update_status_position:function(e){return e=Event.extend(e),Rt.scry("drag-status").setStyle({left:e.pointerX()-Oe.scroll_offsets().left+this._STATUS_OFFSET+"px",top:e.pointerY()-Oe.scroll_offsets().top+this._STATUS_OFFSET+"px"})}};var cr;cr=Xe.BrowseJump={_active:"",_listening:!1,_RESET_WAIT:1e3,_RESET_TIMER_ID:null,_CODEPOINTS:null,_BLACKLIST:["/","\\",":","?","*","<",">","|"].map(function(e){return e.charCodeAt(0)}),update:function(){var e,t,n,i,r,o;for(cr._listening||(cr.listen(),cr._listening=!0),e=[],o=pr.files,i=0,r=o.length;r>i;i++)n=o[i],t=cr.to_codepoint_list(n.filename),e.push([t,n]);return e.sort(function(e,t){return cr.cmp_codepoints(e[0],t[0])}),cr._CODEPOINTS=e},reset:function(){return cr._active=""},is_active:function(){return cr._active},jump:function(e){return e?(_r.set_selected_files([e]),pr.scrollTo(e.get_div())):void 0},listen:function(){var e,t,n,i,r;for(document.observe("keypress",function(e){var t;if(z.getScope()===pr.KEY_SCOPE&&!(Oe.focus_in_input()||e.metaKey||e.altKey||e.altGraphKey||e.ctrlKey||(t=e.charCode||e.keyCode,32>t||t>=33&&40>=t))){if(32===t){if(!cr._active)return;e.preventDefault()}if(-1===cr._BLACKLIST.indexOf(t))return clearTimeout(cr._RESET_TIMER_ID),cr._active+=String.fromCharCode(t).toLowerCase(),cr.jump(cr.nearest_file(cr._active)),cr._RESET_TIMER_ID=setTimeout(cr.reset,cr._RESET_WAIT)}}),i=[a.DELETE,a.COPY,a.MOVE,a.RENAME,a.PURGE,a.RESTORE,a.UPLOAD,a.SF_NEW,a.SF_LEAVE,a.SF_UNSHARE,a.SF_ADD_TO_DROPBOX,a.SF_IGNORE,a.LINKS_REMOVE,Yi.ADD,Yi.REMOVE,Yi.MOVE],r=[],t=0,n=i.length;n>t;t++)e=i[t],document.observe(e,function(e){return cr.update()}),r.push(pe(document).on(e,function(e){return cr.update()}));return r},nearest_file:function(e){var t,n,i,r,o,s,a,_;if(null!=(s=cr._CODEPOINTS)?s.length:void 0){for(t=cr.to_codepoint_list(e),a=cr._CODEPOINTS,r=0,o=a.length;o>r;r++)if(_=a[r],i=_[0],n=_[1],cr.cmp_codepoints(t,i)<1)return n;cr._CODEPOINTS.last()[1]}return null},cmp_codepoints:function(e,t){var n,i,r;for(bt(e.length>0&&t.length>0,"bad input to cmp_codepoints"),n=i=0,r=e.length;r>=0?r>i:i>r;n=r>=0?++i:--i){if(null==t[n])return 1;if(e[n]!==t[n])return e[n]<t[n]?-1:1}return t.length>e.length?-1:0},to_codepoint_list:function(e){var t,n,i,r;for(e=e.toLowerCase(),r=[],t=n=0,i=e.length;i>=0?i>n:n>i;t=i>=0?++n:--n)r.push(e.charCodeAt(t));return r}};var hr;hr=Xe.ContextMenu={KEY_SCOPE:"context",SHOW_EVT:"db:contextmenu:show",HIDE_EVT:"db:contextmenu:hide",_prev_key_scope:null,listen:function(){return pe(document).click(this.hide_on_click),pe(document).on(ke.UPDATE,this.hide_on_click),z("esc",this.KEY_SCOPE,function(e){return function(e){return hr.hide()}}(this))},unlisten:function(){return pe(document).off("click",this.hide_on_click),pe(document).off(ke.UPDATE,this.hide_on_click)},hide_on_click:function(e){return 3===e.which||pe(e.target).parents("#context-menu").length?void 0:hr.hide()},show_for_file:function(e,t,n){var i,r;return pr.keyboard_nav=!1,this.hide(),i=er.from_elem(n),r=_r.is_selected(i)?_r.get_selected_files():(_r.deselect_all(),[i]),_r.set_context_selected(r),this._show(t,new e(r))},show_global:function(e,t){return this.hide(),this._show(t,new e)},show_shmodel:function(e){var t,n,i,r,o,s;return t=["get_original"],o=e.findElement("img"),"true"===o.readAttribute("enable-download")?(r=o.readAttribute("data-original-href"),n=[]):(r="",n=["get_original"]),this.hide(),s={get_original:{icon:"download",text:At("Download original"),href:r}},i=Class.create({get_action_names:function(){return t},get_disabled_action_names:function(){return n},get_action_by_name:function(e){var t;return t=s[e],t.name=e,t}}),this._show(e,new i)},show_for_lightbox:function(e){var t,n,i,r,o,a,_;return t=["download","view_original"],this.hide(),o=e.findElement("img"),"false"===o.readAttribute("enable-download")?(n=["download","view_original"],r="",_=""):(n=[],r=s.parse(o.readAttribute("data-original-href")).updateQuery({dl:1}).toString(),_=o.readAttribute("data-original-href")),a={download:{icon:"download",text:At("Download"),href:r},view_original:{icon:"view_original",text:Wi.append_ellipsis(At("View original")),href:_,target:"_blank"}},i=Class.create({initialize:function(){return this._listen()},_listen:function(){var e;return e=$("context-menu-container"),e.stopObserving("click"),e.stopObserving("contextmenu"),e.on("click",".action button",this._click.bind(this)),e.on("contextmenu",".action button",this._click.bind(this))},_click:function(e,t){var n,i,r;return n=t.readAttribute("data-value"),i=a[n],hr.hide(),e.preventDefault(),null!=(r=i.click_handler)?r.call(this,e):void 0},get_action_names:function(){return t},get_disabled_action_names:function(){return n},get_action_by_name:function(e){var t;return t=a[e],t.name=e,t}}),this._show(e,new i)},_show:function(e,t,n){var i,r,o,s,a,_,l,u,d,c,h,f,p,m,v;if(null==n&&(n=!1),v="INPUT"===(null!=e&&null!=(h=e.target)?h.tagName.toUpperCase():void 0)&&"TEXT"===(null!=e&&null!=(f=e.target)?f.type.toUpperCase():void 0)||"TEXTAREA"===(null!=e&&null!=(p=e.target)?p.tagName.toUpperCase():void 0),_=["#page-footer","#account-header","#browse-global-actions-bar","#modal","#modal-overlay","#file-preview-modal","#file-viewer","#react-file-viewer","#notify-wrapper",".db-modal-wrapper","#sharing-growth-experiments-dropdown-menu",".inline-share-button",".inline-member-list-button","#wizard-overlay","#react-bubble-dropdown-root",".preview-sf-members-box",".db-modal",".db-modal-overlay",".waiting_for_items"],m=$(e.target),!pe(m).parents("#context-menu").length){if(i=pe("#file-preview-modal"),!i.find(m).length||!pe(m).is("img"))for(r=0,u=_.length;u>r;r++)if(a=_[r],s=$$(a))for(l=0,d=s.length;d>l;l++)if(o=s[l],m.descendantOf(o)||m.match(a))return;if(!((null!=e?e.shiftKey:void 0)||v)&&(Event.stop(e),null==this._context_menu_tmpl&&(this._context_menu_tmpl=Ke.tmpl("context_menu_tmpl")),t.get_action_names().length))return Gn.hide_all(),$("context-menu-container").__date(this._context_menu_tmpl({context:t,actions:function(){var e,n,i,r;for(i=t.get_action_names(),r=[],e=0,n=i.length;n>e;e++)c=i[e],r.push(t.get_action_by_name(c));return r}(),disabled_actions:t.get_disabled_action_names(),big:n,Sprite:G})),this.position_at(e.clientX,e.clientY),$("context-menu-container").show(),this.listen(),this._prev_key_scope=z.getScope(),z.setScope(this.KEY_SCOPE),document.fire(this.SHOW_EVT)}},position_at:function(e,t){var n,i,r,o;return o=Oe.viewport_dimensions(),i=parseInt($("context-menu").getStyle("width"),10),n=parseInt($("context-menu").getStyle("height"),10),r=15,e+i>o.width-r?$("context-menu").setStyle({left:o.width-i-r+"px"}):$("context-menu").setStyle({left:e+"px"}),t+n>o.height-r?$("context-menu").setStyle({top:o.height-n-r+"px"}):$("context-menu").setStyle({top:t+"px"})},hide:function(){return $("context-menu-container").empty()?void 0:(this.unlisten(),_r.set_context_selected([]),$("context-menu-container").__date(),z.getScope()===this.KEY_SCOPE&&z.setScope(this._prev_key_scope),document.fire(this.HIDE_EVT))}};var fr,pr,mr,vr,gr,wr,br,An=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};fr=Xe.BROWSE_SNIPPET_LEN=25,br=Xe.SEARCH_SNIPPET_LEN=20,vr=Xe.COMMENT_COUNT_SNIPPET_LEN=3,wr=Xe.LAST_MODIFIED_FNAME_SNIPPET=4,gr=[Ki.FILES_BY_NAME,!0,"FILES_BY_NAME"],pr=INLINE_JS.Browse=Xe.Browse={KEY_SCOPE:"browse",SCROLL_DURATION:.5,msg:!1,files:[],reloading:!1,creating_folder:!1,first_load:!0,last_sort:gr,folder_loading_notification:null,folder_loading_timeout:null,keyboard_nav:!1,paginating:!1,is_initialized:!1,init:function(e,t,n,i,r,o,a){return this.browse_actions_ctor=t,this.global_actions_ctor=n,this.browse_actions_context_ctor=i,this.global_actions_context_ctor=r,this.ns_id_to_mount_point=o,"number"!=typeof a?void yt("a user_id was not passed into Browse.init"):(this.active_user=H.get_viewer().get_user_by_id(a),__CIRCULAR_DEPENDENCY__.active_user_loaded=!0,this.active_user?(this.unselectable(),this.listen(),Oe.viewport_dimensions(),this.browser_supports_previews=e,this.compiled_search_tmpl=Ke.tmpl("search_list_item_tmpl"),g.AuthenticatedRequest({url:s({path:"/flash_detect_log"}),data:{installed:ue.installed,major:ue.major,minor:ue.minor,revision:ue.revision,revisionStr:ue.revisionStr,raw:ue.raw}}),this.is_initialized=!0):void yt("No active_user was found in Browse.init"))},setup:function(e,t){var n;return null==t&&(t=null),null==e?void this._setup_actions():(this.ns_id_to_mount_point=e.ns_id_to_mount_point,this.old_path_to_ns_id=e.old_path_to_ns_id,this.compiled_tmpl=Ke.tmpl("list_item_tmpl"),this.render_timeout=null,this.inside_root_folder=""===e.containing_fq_path,this.inside_dir=e.inside_dir,this.inside_deleted_dir=e.inside_deleted_dir,this.inside_shared_folder=e.inside_shared_folder,this.can_nest_in_containing_ns=e.can_nest_in_containing_ns,this.can_change_new_ns_options=!e.inside_shared_folder||e.containing_sf_perm_role===D.NameSpaceAccess.ACCESS_OWNER,this.inside_read_only_shared_folder=e.inside_read_only_shared_folder,this.inside_sandbox=e.inside_sandbox,this.public_app_token=e.public_app_token,this.public_folder_enabled=e.public_folder_enabled,this.inside_deleted_sandbox=e.inside_deleted_sandbox,this.inside_deleted_shared_folder=e.inside_deleted_shared_folder,this.inside_team_folder=e.inside_team_folder,this.is_read_only=e.is_read_only,this.permanent_delete_is_disabled_by_ns_id=e.permanent_delete_is_disabled_by_ns_id,this.contents_cache_key=e.contents_cache_key,n="inside_deleted_dir",this.inside_deleted_dir?$("browse").addClassName(n):$("browse").removeClassName(n),this.block_hash=e.block_hash,this.block_hash_param=e.block_hash_param,this.inside_dir&&(this._containing_ns_id=e.containing_ns_id,this._containing_ns_path=e.containing_ns_path,this._containing_fq_path=e.containing_fq_path,this._containing_mount_point=e.containing_mount_point,this._containing_sf_perm_role=e.containing_sf_perm_role,this.breadcrumb(),this._setup_actions(),e.file_info||e.paginated||this.show_message(At('<h3>This folder is empty</h3> Add files using the <a href="/install">desktop application</a> or the upload button above.'))),e.paginated?this._start_pagination(e.first_page):this._push_files(e.file_info,t))},_setup_actions:function(){var e,t,n,i;for(i=[this.browse_actions,this.global_actions],t=0,n=i.length;n>t;t++)e=i[t],null!=e&&e.unlisten();return this.browse_actions=new this.browse_actions_ctor,this.global_actions=new this.global_actions_ctor},entered_search:function(){return this._stop_pagination()},_start_pagination:function(e){var t;return null!=e.unsupported_sort&&this.reset_sort(),this.paginating=!0,t=pr.active_user.id,this.pagination_manager=new x,this.pagination_manager.initialize(e,"sjid","/browse_get_next",t,function(e){return function(t,n){return e._new_data_available(t,n)}}(this)),this.pagination_manager.startAutoFetching(),pe("#more-loading").show(),this.disable_sorting()},_stop_pagination:function(){return this.paginating?(this.paginating=!1,this.pagination_manager.stopAutoFetching(),this.pagination_manager=null,pe("#more-loading").hide(),this.enable_sorting(),this._stop_waiting_for_items()):void 0},_new_data_available:function(e,t){var n,i;if(this.paginating)return i=this._push_files(t),ee.getGandalfRule("file_viewer_react")&&ce.updateFiles(this.files),this.in_search_mode()||(this.smartfill(),Wi.load_visible_thumbs(),this.fire_visible_change_callbacks()),n=1===e.loadedPageCount(),n||(this._is_item_selection_needed()&&(this._are_all_selected_items_fetched()||e.areAllItemsReady())&&(this._stop_waiting_for_items(),this.set_selection_from_fq_paths_or_index(pr)),document.fire(ke.NEW_PAGE,{page_files:i}),pe(document).trigger(ke.NEW_PAGE,{page_files:i})),e.areAllItemsReady()?this._stop_pagination():void 0},_is_item_selection_needed:function(){return this.select_fq_paths&&this.select_fq_paths.length>0||this.select_index>-1},_are_all_selected_items_fetched:function(e){var t,n,i,r,o,s,a,_,l;if(null==e&&(e=this.files),this.select_fq_paths&&this.select_fq_paths.length>0){for(l=this.select_fq_paths,r=0,s=l.length;s>r;r++){for(t=l[r],i=!1,_=t.toLowerCase(),o=0,a=e.length;a>o;o++)if(n=e[o],n.fq_path.toLowerCase()===_){i=!0;break}if(!i)return!1}return!0}return this.select_index>-1?this.select_index<e.length:bt(0,"Expected something to select (@select_index or @select_fq_paths)")},_wait_for_items:function(){return pe("#waiting-for-items").show(),pe("#global-actions").addClass("disabled"),pe("body").addClass("waiting_for_items")},_stop_waiting_for_items:function(){return pe("body").removeClass("waiting_for_items"),pe("#global-actions").removeClass("disabled"),pe("#waiting-for-items").hide()},_push_files:function(e,t){var n,i,r,o,s;for(null==t&&(t=null),i=[],o=0,s=e.length;s>o;o++)r=e[o],n=Wi.make_browsefile(r,t),n.track_in_browse(),i.push(n);return cr.update(),i},_get_helper:function(e){return bt(this.inside_dir,"accessed "+e+", but not inside a directory"),pr[e]},containing_ns_id:function(){return this._get_helper("_containing_ns_id")},containing_ns_path:function(){return this._get_helper("_containing_ns_path")},containing_mount_point:function(){return this._get_helper("_containing_mount_point")},containing_fq_path:function(){return this.inside_dir?this._get_helper("_containing_fq_path"):""},containing_sf_perm_role:function(){return this._get_helper("_containing_sf_perm_role")},listen:function(){var e,t,n,i,r,o,s,_,l,u,d,c,h,f,p,m;for(pe("#fulltext-search-all-link").click(this.unscoped_search),pe("#noresults-search-all-link").click(this.unscoped_search),$("browse-files").on("click","li.browse-file",this.click.bind(this)),$("browse-files").on("dblclick","li.browse-file",this.dblclick.bind(this)),$("browse-files").on("contextmenu","li.browse-file",hr.show_for_file.bind(hr,this.browse_actions_context_ctor)),this.enable_sorting(),f="#browse-sort a.sortable-column-header",Rt.add_sort_arrow_mouseover($("name-sorter"),!0,f,!1),Event.observe(window,"scroll",this.window_scroll.bind(this)),Event.observe(window,"resize",this.updateOffset.bind(this)),$(document.body).on("click","a.crumb",this.crumb_click.bind(this)),$("browse-files").on("click","a.parent-dir",this.parent_click.bind(this)),document.observe("contextmenu",hr.show_global.bind(hr,this.global_actions_context_ctor)),document.observe(_r.UPDATED_EVT,this.selection_handler.bind(this)),document.observe(a.COPY,function(e){return function(t){return e.inside_dir&&t.memo.to_fq_path===e.containing_fq_path()?e.force_reload():void 0}}(this)),d=[a.MOVE,a.RESTORE,a.UPLOAD,a.SF_NEW,a.SF_ADD_TO_DROPBOX,a.SF_IGNORE,a.LINKS_REMOVE,a.LINKS_ADD],r=0,s=d.length;s>r;r++)n=d[r],i=function(e){return function(t){return e.inside_dir&&!pr.in_search_mode()?e.force_reload():void 0}}(this),document.observe(n,i),pe(document).on(n,i);for(c=[a.SF_LEAVE,a.SF_UNSHARE],o=0,_=c.length;_>o;o++)n=c[o],document.observe(n,function(e){return function(t){return e.inside_dir?t.memo.target_ns_id===e.containing_ns_id()?t.memo.folder_deleted?e.reload_fqpath(""):e.reload_fqpath(e.containing_fq_path()):e.force_reload():void 0}}(this));for(h=[a.DELETE,a.PURGE],u=0,l=h.length;l>u;u++)n=h[u],document.observe(n,function(e){return function(t){var n,i,r,o,s,_,l,u;if(e.inside_dir){if(t.eventName===a.PURGE||t.eventName===a.DELETE&&!Zi.get_del()){for(i=o=l=e.files.length-1;(0>=l?0>=o:o>=0)&&-1===t.memo.files.indexOf(e.files[i]);i=0>=l?++o:--o)s=e.files[i];for(_r.deselect_all(),u=t.memo.files,_=0,r=u.length;r>_;_++)n=u[_],n.get_div().remove(),e.files.removeItem(n);return e.files.length?null!=s?_r.set_selected_files(s):_r.set_selected_files(e.files.last()):e.show_empty()}return e.keyboard_nav&&(e.select_fq_paths=[e.containing_fq_path()+"/"+t.memo.files.last().filename]),e.force_reload()}}}(this));return document.observe(hr.SHOW_EVT,this.disable_sorting.bind(this)),document.observe(hr.HIDE_EVT,this.enable_sorting.bind(this)),e=function(){var e,t;return e=$("browse-header"),t=e.cumulativeOffset().top+e.getHeight(),Oe.viewport_dimensions().height-t},z("pagedown",this.KEY_SCOPE,function(t){return Event.extend(t).preventDefault(),window.scrollBy(0,e())}),z("pageup",this.KEY_SCOPE,function(t){return Event.extend(t).preventDefault(),window.scrollBy(0,-1*e())}),p=function(){var e;return e=pr.in_search_mode()?Ji:pr,0===pr.files.length?e.show_empty():e.hide_empty()},document.observe(Yi.ADD,function(e){return function(t){var n,i,r,o;for(o=t.memo.files,r=0,i=o.length;i>r;r++)n=o[r],e.insert_file(n,!0);return p()}}(this)),document.observe(Yi.REMOVE,function(e){return function(t){var n,i,r,o;for(o=t.memo.files,r=0,i=o.length;i>r;r++)n=o[r],e.remove_file(n);return p()}}(this)),document.observe(Yi.MOVE,function(e){return function(t){var n,i,r,o,s,a,_,l,u;for(i=e.in_search_mode(),a=t.memo.files,l=[],o=0,r=a.length;r>o;o++){if(_=a[o],n=_[0],u=_[1],i){if(null==n)continue;s=e.get_file_pos(n)}e.remove_file(n),e.insert_file(u),i&&s>=0?l.push(e.update_file_pos(u,s)):l.push(void 0)}return l}}(this)),pe(document).on(a.COMPRESS,function(e){return function(t,n){var i;return e.force_reload(),1===n.compressed_files.length&&1===n.original_files.length?(i=Wi.make_browsefile(n.compressed_files.first()),e.preview_compressed(i,n.original_files.first())):void 0}}(this)),t=this.fire_visible_change_callbacks.bind(this),pe(window).on("resize",t),this._last_visible_change_timeout_id=null,m=function(e){return function(n){return clearTimeout(e._last_visible_change_timeout_id),e._last_visible_change_timeout_id=setTimeout(t,250)}}(this),pe(window).on("scroll",m)},disable_sorting:function(){return $("browse-sort").stopObserving("click"),$$("#browse-sort *").invoke("setStyle",{cursor:"default"})},enable_sorting:function(){return $("browse-sort").stopObserving("click"),$("browse-sort").on("click","#browse-sort a.sortable-column-header",this.sort_handler.bind(this)),$$("#browse-sort *").invoke("setStyle",{cursor:"pointer"})},click:function(e,t){var n,i,r;return n=pe(e.target),(n.is("img.icon")||n.closest("a.filename-link").length>0||n.closest(".filename-col__comment-count-bubble").length>0)&&this._click(e,t),n.is("a.parent-dir")&&(i=er.from_elem(t))?(r={file_nsid:i.ns_id,file_sjid:i.sjid,firefly:Ji.firefly_enabled,match_type:i.match_type,position:i.sort_rank,request_id:i.request_id,viewport:"full-view",action_type:"click_path_link"},ze.SearchClientActivityLogger.log("result_action",pr.active_user.id,r)):void 0},dblclick:function(e,t){return $(e.target).match("a")?void 0:this._click(e,t)},open_file:function(e,t,n,i){var r;return null==n&&(n=!1),null==i&&(i=K.OREF_CONSTANTS.BROWSE_UNKNOWN),r={file_nsid:e.ns_id,file_sjid:e.sjid,firefly:Ji.firefly_enabled,match_type:e.match_type,position:e.sort_rank,request_id:e.request_id,viewport:n?"dropdown-view":"full-view"
},e.dir?((this.in_search_mode()||n)&&(r.action_type="folder_open",ze.SearchClientActivityLogger.log("result_action",pr.active_user.id,r)),t?this.open_folder_in_new_window(e):this.open_folder(e),ze.TimeToFirstActionLogger.log(pr.active_user.id,"folder_open")):!t&&this.can_show_preview(e)?(ze.TimeToFirstActionLogger.log(pr.active_user.id,"file_view"),this.open_preview(e,i,n)):(ze.TimeToFirstActionLogger.log(pr.active_user.id,"file_view"),window.open(e.href,"_blank"))},close_preview_callback:function(){return pe(document).off("db:filepreview:close",this.close_preview_callback),Qi.close_shared_link_view(),pr.set_title()},preview_compressed:function(e,t){return jr.show(e,pr.active_user,{files:[e,t],file_view_target:K.FileViewTargetType.PRIVATE,hide_comments:!0})},open_preview:function(e,t,n,i){return null==t&&(t=K.OREF_CONSTANTS.BROWSE_UNKNOWN),null==n&&(n=!1),null==i&&(i=!1),this.can_show_preview(e)?(Wi.filepreview_from_selected(e,n,i,t),pe(document).on("db:filepreview:close",this.close_preview_callback)):void 0},_click:function(e,t){var n,i;this.keyboard_nav=!1,n=er.from_elem(t),n.editing||(i=2===e.which||Rt.is_mac()&&e.metaKey,pr.open_file(n,i,!1,K.OREF_CONSTANTS.BROWSE_FILE_OPEN),e.preventDefault())},crumb_click:function(e,t){var n,i;return this.keyboard_nav=!1,e.preventDefault(),i=t.readAttribute("data-fq_path"),n=this.details_from_fq_path(i),Zi.set_path_url(n.ns_id,n.ns_path)},parent_click:function(e,t){var n,i,r,o;return this.keyboard_nav=!1,e.preventDefault(),o=t.readAttribute("data-parent_ns_path"),r=parseInt(t.readAttribute("data-parent_ns_id"),10),Zi.set_path_url(r,o),n=er.from_elem(t),n?(i={file_nsid:n.ns_id,file_sjid:n.sjid,firefly:Ji.firefly_enabled,match_type:n.match_type,position:n.sort_rank,request_id:n.request_id,viewport:"full-view",action_type:"click_path_link"},ze.SearchClientActivityLogger.log("result_action",pr.active_user.id,i)):void 0},selection_handler:function(){return _r.get_selected_files().length?$("browse-box").addClassName("selected"):$("browse-box").removeClassName("selected")},POST_SCROLL_WAIT:100,_last_scroll_timeout:null,window_scroll:function(){var e,t,n,i;return this.in_search_mode()&&!Ji.end_of_results&&(n=Wi.get_files_in_view(),i=n[0],t=n[1],e=this.files.length-(i+t),50>=e&&!$("browse").hasClassName("pending-search")&&Ji.load_more_results()),clearTimeout(this._last_scroll_timeout),this._last_scroll_timeout=setTimeout(Wi.load_visible_thumbs.bind(Wi),this.POST_SCROLL_WAIT)},unscoped_search:function(){return Ji.search(!1)},updateOffset:function(){return this.div_parent?(this._cumulativeOffset=this.div_parent.cumulativeOffset(),this.viewportOffset()):void 0},reset_sort:function(){var e,t;return this.last_sort=gr,t="#browse-sort a.sortable-column-header",e=$$(t)[0],Rt.add_sort_arrow_mouseover(e,!0,t,!1),$("kind-sorter-label").__date(Gi.DISPLAY.FILES_BY_KIND),G.src(e.down("img"),"web","arrow-up-gray")},sort_handler:function(e,t,n){var i,r,o,s;return t=$(t),t.blur(),s=t.readAttribute("data-sort"),null!=n||(n=this.last_sort[0]===Ki[s]?"false"===t.readAttribute("data-ascending"):"FILES_BY_MODIFIED"!==s),Gi.has_label(s)?(r=Gi.next(s),$("sharing-sorter-label").__date(r.display),s=r.label,t.writeAttribute("data-sort",s),n=Gi.IS_ASC[s]):t.writeAttribute("data-ascending",n?"true":"false"),o="#browse-sort a.sortable-column-header",Rt.add_sort_arrow_mouseover(t,n,o,!0),i=Ki[s],this.sort(i,n,s),e?e.stop():void 0},toggle_deleted:function(){var e;return e=!Zi.get_del(),Zi.set_del_url(e)},unused_filename:function(e,t){var n,i,r,o,s,a,_,l,u,d,c,h,f,p,m,v;for(null==t&&(t=!1),v=We.filename_without_extension(e),m=We.file_extension(e,n=!0),o=[],f=pr.files,u=0,d=f.length;d>u;u++)i=f[u],h=We.filename_without_extension(i.filename),c=We.file_extension(i.filename,n=!0),a=0===h.toLowerCase().indexOf(v.toLowerCase()),s=m.toLowerCase()===c.toLowerCase(),l=!t||i.dir,a&&s&&l&&o.push(i.filename.toLowerCase());for(m=m?"."+m:"",r=v+m,_=1;;){if(p=r.toLowerCase(),An.call(o,p)<0)break;r=v+" ("+_+")"+m,_++}return r},new_folder:function(){var e,t,n,i,r,o,s,a,_,u,d,c;if(!this.reloading&&!this.creating_folder)return pr.sharing_create_and_share_new_folder_enabled&&!this.inside_shared_folder?(r=new hn(pr.active_user,{element_id:"create-and-share-new-folder-modal-"+pr.active_user.id,destination_dir:this.containing_fq_path()}),void r.show()):(this.hide_empty(),this.selectable(),n=this.unused_filename(At("New folder"),_=!0),c=Ke.tmpl("new_folder_tmpl",{name:n,Sprite:G,_:At}),i=-1,this.files.length&&(d=Oe.scroll_offsets(),d.top>0&&(u=this.files[0].get_div().getLayout().get("margin-box-height"),i=Math.floor(d.top/u))),i>0?this.files[i].get_div().__sert({after:c}):$("browse-files").__sert({top:c}),o=$$("#browse-files .browse-new-folder .name").first(),bt(null!=o,"expected new_folder_name to be defined"),e=this.containing_fq_path(),a=function(e){return function(t){var n,i,r;return r=t.responseText.evalJSON(!0),bt(1===r.new_browse_files.length,"No new file data returned."),n=We.filename(r.new_browse_files.first().fq_path),i=At("Created folder '%(folder_name)s'"),i=i.format({folder_name:l.em_snippet(n,25)}),b.success(i),e.select_fq_paths=[r.new_browse_files.first().fq_path],e.force_reload()}}(this),s=function(e){return function(t){var n;return n=$$("#browse-files li.browse-new-folder").first(),n&&n.remove(),e.creating_folder=!1}}(this),t=new Ajax.InPlaceEditor(o,"/cmd/new"+Rt.urlquote(e),{htmlResponse:!1,okControl:!1,cancelControl:!1,highlightColor:"transparent",highlightEndColor:"transparent",clickToEditText:"",cols:25,ajaxClass:Ajax.DBRequest,submitOnBlur:!0,onFailure:function(){},onComplete:s,savingText:At("Creating folder..."),onLeaveEditMode:this.unselectable,ajaxOptions:{method:"POST",onSuccess:a,subject_user:pr.active_user},callback:function(e){return function(t,n){return e.creating_folder=!0,{to_path:n||"",folder:"yes"}}}(this)}),t.enterEditMode())},open_folder:function(e){var t,n,i;return bt(e.dir,"Only open directories, not files"),!pr.inside_dir||pr.containing_ns_path()!==e.ns_path||this.in_search_mode()?(1===_r.get_selected_files().length&&0===_r.get_selected_files().indexOf(e)||(_r.deselect_all(),t="function"==typeof e.get_div?e.get_div():void 0,t&&t.addClassName("file-select")),clearTimeout(this.folder_loading_timeout),this.folder_loading_timeout=setTimeout(function(t){return function(){var n;if(t.reloading)return n=At("Loading %(filename)s..."),n=n.format({filename:l.em_snippet(e.filename,50)}),t.folder_loading_notification=b.success(n,60,!0)}}(this),1e3),e.target_ns?(n=e.target_ns,i=""):(n=e.ns_id,i=e.ns_path),e.is_deleted?Zi.set_path_url(n,i,!0):Zi.set_path_url(n,i)):void 0},open_folder_in_new_window:function(e){return window.open(Zi._make_url(e.ns_id,e.ns_path),"_blank")},show_message:function(e){var t,n;return"string"!=typeof e?(n=$("browse-files").down(".browse-message"),void(n&&n.show())):(this.msg=e,t=new Element("div",{class:"browse-message"}),t.__date(e),$("browse-files").__sert(t))},sort:function(e,t,n,i){var r;if(i||e!==this.last_sort[0]||t!==this.last_sort[1])return this.last_sort=[e,t,n],r=e(t),this.files.sort(r),this.smartfill(),Wi.load_visible_thumbs(),this.fire_visible_change_callbacks()},resort:function(){var e,t,n,i;return t=this.last_sort,n=t[0],e=t[1],i=t[2],this.sort(n,e,i,!0)},in_search_mode:function(){return pe("#browse").hasClass("search")},flex_column:function(){return $("sharing-sorter").readAttribute("data-sort")},update_shared_with_string:function(){var e;return e=At(this.inside_shared_folder?"Additional sharing":"Shared with"),Gi.set_column_display("SHARED_WITH",e),pe("#sharing-sorter-label").text(Gi.DISPLAY[this.flex_column()])},smartfill:function(){var e,t,n,i,r,o,s,a;for(e=$("browse-files"),a=[],i=this.in_search_mode(),s=this.files,r=0,o=s.length;o>r;r++)t=s[r],n=this.flex_column(),a.push(this.compiled_tmpl({file:t,in_search_mode:i,flex_column:n,Browse:pr,Emstring:l,FilePath:We,GandalfUtil:ee,SharingUIUtil:Ce,Sprite:G,_:At}));return e.__date(a),document.fire(ke.RENDER),pe(document).trigger(ke.RENDER)},search_smartfill:function(e,n){var i,r,o,s,a,_,u;for(null==n&&(n=null),u=[],a=0,_=e.length;_>a;a++)r=e[a],s=Wi.make_browsefile(r,n),s.track_in_browse(),o=this.compiled_search_tmpl({Browse:pr,BrowseInterface:t,Emstring:l,file:s,FilePath:We,HTML:Ke,searchHelpers:k,SharingUIUtil:Ce,Sprite:G,Util:Rt,_:At}),i=pe(o.toHTML()),u.push(i);return pe("#browse-files").append(u),document.fire(ke.RENDER),pe(document).trigger(ke.RENDER),Wi.load_visible_thumbs(),this.fire_visible_change_callbacks()},add_file:function(e){return this.files.push(e),e.target_ns&&(pr.ns_id_to_mount_point[e.target_ns]=e.fq_path),e.bytes<0?this.deleted_shown=!0:void 0},insert_file:function(e,t){var n;if(e)return t=t||0,n=this.find_file(e.fq_path),n&&n!==e&&this.remove_file(n),er._file_index[e.to_key()]=e,this.update_file_pos(e),t&&e.get_div().setStyle({display:"none"}),document.fire(ke.RENDER),pe(document).trigger(ke.RENDER)},add_files:function(e){return pr._push_files(e.file_info)},get_file_pos:function(e){var t;return t=this.files.indexOf(e),bt(-1!==t,"file not present in @files"),bt(e.to_key()in er._file_index,"file not present in BrowseFile._file_index"),t},remove_file:function(e){var t,n;if(e)return t=this.files.indexOf(e),-1!==t?(this.files.splice(t,1),delete er._file_index[e.to_key()],null!=(n=e.get_div())?n.remove():void 0):void 0},update_file_pos:function(e,n){var i,r,o,s,a,_,u,d;return null==n&&(n=-1),d=this.files.indexOf(e),-1!==d&&this.files.splice(d,1),delete e.sort_rank,_=this.last_sort[0],a=this.last_sort[1],n>=0&&(d=n),s=this.in_search_mode()?d:Rt.bsearch(this.files,e,_(a),!0),this.files.splice(s,0,e),o=e.get_div(),i=$("browse-files"),o&&o.remove(),u=this.in_search_mode()?this.compiled_search_tmpl({Browse:pr,BrowseInterface:t,Emstring:l,file:e,FilePath:We,HTML:Ke,searchHelpers:k,SharingUIUtil:Ce,Sprite:G,Util:Rt,_:At}):this.compiled_tmpl({Browse:pr,Emstring:l,file:e,flex_column:this.flex_column(),FilePath:We,GandalfUtil:ee,in_search_mode:this.in_search_mode(),SharingUIUtil:Ce,Sprite:G,_:At}),r=i.childElements(),s<r.length?i.childElements()[s].__sert({before:u}):i.__sert(u)},find_file:function(e){return this.files.find(function(t){return t.fq_path.toLowerCase()===e.toLowerCase()})},reset_state:function(){return this.msg=!1,this.dragging=!1,this.files=[],this.selected_files=[],this.selection=[],er._file_index={},dr._body_dragend()},clear:function(){return $("browse-files").__date(),this.hide_empty(),Ji.hide_empty()},show_empty:function(){var e;return this.hide_empty(),e=pe("#browse-empty-team-folder").length&&this.inside_team_folder&&!this.is_in_subfolder_of_team_folder()?"#browse-empty-team-folder":"#browse-empty",pe(e+" .drag-prompt").toggle(!this.is_read_only),pr.in_search_mode()?void 0:pe(e).show()},hide_empty:function(){return pe("#browse-empty, #browse-empty-team-folder").hide()},update:function(e,t){return null==t&&(t=null),$("browse-box").show(),this.in_search_mode()?(this.search_smartfill(e.search_results,t),this.setup(null)):(this.clear(),"string"==typeof e&&(e=JSON.parse(e)),this.setup(e,t),this.resort(),document.fire(ke.UPDATE),pe(document).trigger(ke.UPDATE,[e]))},reload_fqpath:function(e,t){return this.reload(null,Rt.urlquote(e),t)},force_reload:function(){return this.reload(this.containing_ns_id(),Rt.urlquote(this.containing_ns_path()),!0)},set_title:function(){var e;if(pr.in_search_mode())return void Ji.set_title();if(pr.inside_dir)return e=this.containing_fq_path(),document.title=e?We.filename(e)+" - Dropbox":H.get_viewer().is_paired&&pr.active_user.role===A.ROLE_WORK?H.get_viewer().team_name+" - Dropbox":H.get_viewer().is_paired&&pr.active_user.role===A.ROLE_PERSONAL?At("Personal")+" - Dropbox":At("Home")+" - Dropbox"},set_selection_from_fq_paths_or_index:function(e){var t,n,i,r,o,s,a,_;if(a=e.select_fq_paths,_=e.select_index,a||_>-1){if(n=[],a)for(r=0,o=a.length;o>r;r++)i=a[r],s=this.find_file(i),s&&n.push(s);return!n.length&&_>-1&&(t=this.files[_],t&&n.push(t)),n.length&&(_r.set_selected_files(n),this.scrollToWithPadding(n.first().get_div(),100)),e.select_fq_paths=!1,e.select_index=-1}},set_selection_from_item_counters:function(){var e,t,n,i,r,o,s,a,_,l;if(null!=this.select_item_counters){for(n={},a=this.select_item_counters,i=0,o=a.length;o>i;i++)t=a[i],n[t]=!0;for(l=[],_=this.files,r=0,s=_.length;s>r;r++)e=_[r],e.root_coll_item_counter in n&&l.push(e);return _r.set_selected_files(l),this.select_item_counters=null}},reload:function(e,t,n){var i,r,o,a,_,l,u,d;return a="Browse.reload ns_path contains an invalid character: # ; ? : @ & = + $ (ns_path = "+t+")",bt(-1===t.search(p.URL_ESCAPE_REGEX),a),null==e&&(e=pr.active_user.root_ns),t=We.normalize(t),Wi.get_mode()!==Wi.BROWSE_MODE&&(this.clear(),Wi.set_browse_mode()),Ji._clear_on_reload&&Ji.clear_searchbox(),Pn.uploading||Fn.hide(),this._stop_pagination(),this.reloading||this.inside_dir&&t===this.containing_ns_path()&&e===this.containing_ns_id()&&!n?void 0:(u=this.first_load?c.referrer:"",o=this.deleted_shown?"?show_deleted=yes":"",l={ns_id:e,referrer:u,delays_parent_request_rendering:this.first_load,sort_label:this.last_sort[2],sort_is_ascending:this.last_sort[1],sort_folders_first:Ki.FOLDERS_FIRST},l=Object.extend(l,this.extra_reload_args),this.reloading=!0,d="/browse"+t+o,i=2,r=["browse",e,t,o,pr.active_user.id,i],_=function(e){return function(t){return e.reset_state(),e.update(t),(e.files.length?e.hide_empty.bind(e):e.show_empty.bind(e))(),clearTimeout(e.folder_loading_timeout),b.isShown()&&b.current()===e.folder_loading_notification&&b.clear(),Oe.scroll_clear_cache(),e._is_item_selection_needed()&&(e.paginating&&!e._are_all_selected_items_fetched()?e._wait_for_items():e.set_selection_from_fq_paths_or_index(pr)),jr.shown()||e.set_title(),e.update_shared_with_string()}}(this),pe(document).trigger(ke.BEFORE_UPDATE,{ns_id:e,ns_path:s.decode(t)}),new Ajax.DBRequest(d,{allow_retries:!0,subject_user:pr.active_user,parameters:l,log_timing:!0,on304:function(e){},onSuccess:function(e){return function(t){var n,i,r,o,s,a,l,u;if(!e.in_search_mode()){if(o=JSON.parse(t.responseText),u=null,l=null,_(o),u){for(a=[],r=0,s=u.length;s>r;r++)n=u[r],a.push(pr.find_file(n.fq_path));_r.set_selected_files(a),window.scrollTo(l[0],l[1])}else pr.set_selection_from_item_counters();return pr.sharing_autoselect_first_file_enabled&&!_r.has_selected_files()&&(i=e.files[0],_r.set_selected_files([i])),e.first_load?($e.mark_time_to_view(),$e.mark_time_to_interactive()):void 0}}}(this),onFailure:function(e){return function(){return e.first_load&&e.reload.bind(e).defer(c.root_ns,""),clearTimeout(e.folder_loading_timeout)}}(this),cleanUp:function(e){return function(){return e.first_load=!1,e.reloading=!1}}(this),no_feed_reload:!0,evalJSON:!1}),!0)},is_in_subfolder_of_shared_folder:function(){return pr.inside_shared_folder&&pr.containing_ns_path()},is_in_subfolder_of_team_folder:function(){return pr.inside_team_folder&&pr.containing_ns_path()},is_shmodelable_path:function(e){var t;return pr.public_app_token?!1:""===e?!1:!pr.public_folder_enabled||(t=e.toLowerCase(),!t.startsWith("/public/"))},can_show_preview:function(e){var t;return this.browser_supports_previews||"photo"===(t=e.preview_type)||"video"===t},can_get_details_from_fq_path:function(e){var t,n;return t=this.containing_fq_path(),n=this.containing_mount_point(),n&&e.startsWith(n)||t.startsWith(e)},details_from_fq_path:function(e){var n,i,r,o;return bt(this.can_get_details_from_fq_path(e)),i=this.containing_mount_point(),i&&e.startsWith(i)?(r=this.containing_ns_id(),o=e.slice(i.length),n=We.filename(e,this._get_root_name())):(r=c.root_ns,o=e,n=We.filename(e,this._get_root_name())),{ns_id:r,ns_path:o,fq_path:e,folder_name:n||this._get_root_name(),url:String(t.browse_uri_for_fq_path(pr.active_user,e)),icon:e.length?"folder_32":this._get_root_icon()}},update_header_status:function(e){return pe("#browse-header-status").text(e)},update_header_height:function(){var e,t,n,i;return t=pe("#browse-header"),e=pe("#browse-files"),i=0,"fixed"===t.css("position")&&(i=pe(window).scrollTop()),Oe.is_page_scrollable()||(i=Math.abs(parseFloat(pe("html").css("top"))||0)),n=t.offset().top+t.height()-e.offset().top-i,e.css("padding-top",n)},_make_breadcrumbs_data:function(){var e,t,n,i,r,o,s;for(t=this.containing_fq_path(),e=[],o=t.split("/"),n=i=0,s=o.length;s>=0?s>i:i>s;n=s>=0?++i:--i)r=We.normalize(o.slice(0,n+1).join("/")),e.push(this.details_from_fq_path(r));return e},_get_root_icon:function(){return H.get_viewer().is_paired?pr.active_user.role===A.ROLE_WORK?"work_icon":pr.active_user.role===A.ROLE_PERSONAL?"personal_icon":void 0:"glyph"},_get_root_name:function(){return H.get_root_name(pr.active_user)},_get_max_breadcrumb_width:function(e){var t,n,i;return n=e?this._DROPDOWN_WIDTH:new l(this._get_root_name()).length,this.use_shorter_breadcrumbs?(t=pe("#browse-rightmenu").width(),i=pe("#browse-global-actions-bar").width(),(i-t)*this._FUDGE_FACTOR/this._PX_TO_EM-n):this._MAX_BREADCRUMB_WIDTH-n},_PX_TO_EM:16,_FUDGE_FACTOR:.75,_DROPDOWN_WIDTH:2.625,_MAX_BREADCRUMB_WIDTH:20,_CONNECT_WIDTH:1.64,breadcrumb:function(){var e,n,i,r,o,s,a,_,u,d,c,h;for(n=this._make_breadcrumbs_data(),h=n.collect(function(e){return new l(e.fq_path?e.folder_name:"").length}),c=0,i=0,bt(n.length>0,"expected at least one breadcrumb"),u=this._get_max_breadcrumb_width(),o=s=d=n.length-1;(0>=d?0>=s:s>=0)&&(c+=h[o],!(c>u));o=0>=d?++s:--s)i+=1,c+=this._CONNECT_WIDTH;return r=n.slice(0,n.length-Math.max(1,i)),n=n.slice(r.length,n.length),!r.length&&n.length>1&&n.shift(),a=n.pop(),e=Ke.tmpl("breadcrumb_tmpl",{breadcrumbs:n,dropdown:r,containing_fq_path:this.containing_fq_path(),url_root:t.get_browse_root(pr.active_user),root_name:this._get_root_name(),Sprite:G}),_=a.folder_name,""!==a.fq_path&&(_=l.em_snippet(_,this._get_max_breadcrumb_width(r.length>1))),$("browse-location").__date(e),$("browse-location").__sert(" "+_),r.length>1?this._render_breadcrumbs_dropdown(r):void 0},_render_breadcrumbs_dropdown:function(e){var t,n,i,r;return n=$("breadcrumbs-box"),e.reverse(),r=Ke.tmpl("breadcrumb_li_tmpl",{breadcrumbs:e,Sprite:G,Emstring:l}),$("browse-location").__sert(r),i=$("breadcrumb-dropdown"),t=function(e){var t;return e.stopPropagation(),i.show(),t=pe(n),Oe.clone_position(pe(i),t,{setWidth:0,setHeight:0,offsetTop:t[0].offsetHeight,offsetLeft:parseInt(t.css("padding-left"),10)})},n.observe("click",t),n.observe("dragover",t),document.observe("click",function(){return n.removeClassName("down"),i.hide()})},viewportOffset:function(){var e,t,n;if(this.files.length){if(!this.div_parent){if(t=this.files[0].get_div().offsetParent,!t)return;this._viewportOffset={},this.div_parent=$(t),this._cumulativeOffset=this.div_parent.cumulativeOffset()}return e=Rt.scrollLeft(this.div_parent),n=Rt.scrollTop(this.div_parent),this.scrollTop&&this.scrollLeft&&this.scrollTop===n&&this.scrollLeft===e||(this._viewportOffset.top=this._cumulativeOffset.top-n,this._viewportOffset.left=this._cumulativeOffset.left-e,this.scrollLeft=e,this.scrollTop=n),this._viewportOffset}},selectable:function(){return Rt.enableSelection($("browse-files"))},unselectable:function(){return Rt.disableSelection($("browse-files"))},_header_offset:function(){var e;return e=$("browse-header"),e.getHeight()+e.cumulativeOffset().top}.cached(1e3),scrollTo:function(e){return this.scrollToWithPadding(e,3)},scrollToWithPadding:function(e,t){var n,i,r,o,s;if(e)return o=Oe.viewport_dimensions(),s=Oe.scroll_offsets(),i=e.cumulativeOffset().top-s.top,n=e.getHeight(),r=this._header_offset(),r>i?Oe.scroll_to(0,s.top+i-r-t):i+n>o.height&&Oe.scroll_to(0,s.top+i+n-o.height+t),$("modal-overlay").visible()&&"absolute"===$("modal").getStyle("position")?Xn.fix_position():void 0},_visible_change_callbacks:{},_next_visible_change_callback_id:0,add_visible_change_callback:function(e){return this._visible_change_callbacks[this._next_visible_change_callback_id]=e,this._next_visible_change_callback_id++},remove_visible_change_callback:function(e){return delete this._visible_change_callbacks[e]},fire_visible_change_callbacks:function(){var e,t,n,i,r,o,s;if(!pe.isEmptyObject(this._visible_change_callbacks)){i=Wi.get_files_in_view(),s=i[0],e=i[1],r=this._visible_change_callbacks,o=[];for(n in r)t=r[n],o.push(t(this.files,this.active_user.id,s,e));return o}}},mr=Xe.BrowseUpdate=function(){var e,n,i,r,o,s,a,_;return a=function(e){var t,n,i;if(pr.inside_dir)return n=e.parent_changes,null!=n.change_to_fq_path?("moved"===n.change_type?n.is_changing_view?(t=At("The folder '%s' has been moved. <a href=\"/home%s\">View</a>"),t=t.format(n.old_fq_path.escapeHTML(),Rt.urlquote(n.new_fq_path))):t=At("This folder has been moved"):"renamed"===n.change_type?n.is_changing_view?(t=At("The folder '%s' has been renamed. <a href=\"/home%s\">View</a>"),t=t.format(n.old_fq_path.escapeHTML(),Rt.urlquote(n.new_fq_path))):(t=At("This folder has been renamed to '%s'."),i=n.change_to_fq_path.split("/"),t=t.format(i[i.length-1].escapeHTML())):(t=At("The folder '%s' has been deleted."),t=t.format(n.old_fq_path.escapeHTML())),n.is_changing_view?b.error(new Ke(t)):n.old_fq_path===pr.containing_fq_path()&&b.success(new Ke(t)),void pr.reload_fqpath(n.change_to_fq_path)):s(e)},_=function(e){var n,i,r,o,a,_,l,u,d,c;if(o=[],c=[],pr.in_search_mode()){for(_ in pr.ns_id_to_mount_point)_ in e.mount_points||(e.mount_points[_]=null);u=e.mount_points;for(_ in u)if(a=u[_],_=parseInt(_,10),l=pr.ns_id_to_mount_point[_],a!==l)for(a?pr.ns_id_to_mount_point[_]=a:delete pr.ns_id_to_mount_point[_],d=pr.files,i=0,r=d.length;r>i;i++)n=d[i],0===n.fq_path.indexOf(l)&&n.target_ns!==_&&(a?(n.fq_path=a+n.fq_path.slice(l.length),n.href=t.get_browse_root(pr.active_user)+a+n.href.slice(5+l.length),o.push([n,n])):c.push(n));return s(e,[],c,o)}},s=function(e,t,n,i){var r,s,a,_,l,u,d,c,h,f,p,m,v,g,w,b,y,k,E,x;for(null==t&&(t=[]),null==n&&(n=[]),null==i&&(i=[]),v=e.added,d=0,h=v.length;h>d;d++)a=v[d],s=We.normalize(We.parent_dir(a.ns_path)),(pr.in_search_mode()||a.ns_id===pr.containing_ns_id()&&s===pr.containing_ns_path())&&(r=Wi.make_browsefile(a),r.track_in_browse(),t.push(r));for(g=e.removed,c=0,f=g.length;f>c;c++)_=g[c],n.push(pr.find_file(_));for(w=e.moved,m=0,p=w.length;p>m;m++)b=w[m],l=b[0],x=b[1],E=We.normalize(We.parent_dir(x.ns_path)),k=null,y=pr.in_search_mode()||x.ns_id===pr.containing_ns_id()&&E===pr.containing_ns_path(),u=pr.in_search_mode(),!y||u&&pr.find_file(x.ns_path)||(k=Wi.make_browsefile(x),k.track_in_browse()),i.push([pr.find_file(l),k]);return document.fire(Yi.ADD,{files:t}),pe(document).trigger(Yi.ADD,{files:t}),document.fire(Yi.MOVE,{files:i}),Wi.load_visible_thumbs(),pr.fire_visible_change_callbacks(),o(t,n,i)},e=function(e,t,n,i){return e.css("background",""),pe(document).trigger(ke.UPDATE_RENDERED),document.fire(Yi.REMOVE,{files:n})},o=function(e,t,i){var o,s,a,_,l,u,d,c,h,f,p,m;for(p=e.length+t.length<=10,a=0,l=e.length;l>a;a++)o=e[a],o&&o.get_div()&&n(o,p,e,t,i);for(_=0,u=t.length;u>_;_++)o=t[_],o&&o.get_div()&&r(o,p,e,t,i);for(f=[],c=0,d=i.length;d>c;c++)h=i[c],s=h[0],m=h[1],s&&r(s,p,e,t,i),m?f.push(n(m,p,e,t,i)):f.push(void 0);return f},i=function(e){var t;return t=_r.is_selected(e)?"#83B8DC":"#CCEAFF",pe(e.get_div()).css("background-color",t)},r=function(t,n,r,o,s){var a;return i(t),a=pe(t.get_div()),n?a.show().slideUp("normal",function(){return e(a,r,o,s)}):(a.hide(),e(a,r,o,s))},n=function(t,n,r,o,s){var a;return i(t),a=pe(t.get_div()),n?a.hide().slideDown("normal",function(){return e(a,r,o,s)}):(a.show(),e(a,r,o,s))},{init:function(){var e,t;return t=ft[pr.active_user.id],e=t.subscribe_sfj({name:"BrowseUpdater",handler:function(){var n,i,r,o,s,l,u;return o=pr.in_search_mode(),n=o?_:a,u=o?"/update/list_search":"/update/list_dir",pr.inside_dir||o?(o?(l=Ji.get_state(),r={all_terms:l.query}):r={fq_dir:pr.containing_fq_path(),show_deleted:pr.deleted_shown},r.ns_map=function(){var e,n;e=t.get_ns_map(),n=[];for(i in e)s=e[i],n.push(i+"_"+s);return n}().join(","),pr.active_user||yt("No active_user was set before calling "+u+". Active user loaded? "+(__CIRCULAR_DEPENDENCY__.active_user_loaded||!1)+". Error before loading? "+(__CIRCULAR_DEPENDENCY__.an_error_happened_before_loading||!1)+". Error after loading? "+(__CIRCULAR_DEPENDENCY__.an_error_happened_after_loading||!1)+"."),g.AuthenticatedRequest({url:u,data:r,dataType:"json",subject_user:pr.active_user,success:function(i){return n(i),t.handler_success(e,{ns_map:i.ns_map})},error:function(){return t.handler_failure(e)}})):void t.handler_failure(e)}})}}}();var yr;yr=Xe.ProgressWatcher={job_info:{},INIT_POLL_INT:1e3,FAILS_MEAN_FAIL:3,MODAL_WAIT_MS:1e3,watch:function(e,t){var n,i,r;if(e.async_task_id){if(!e.async_task_id.match(/^[A-Za-z0-9_\-=]*$/))return;i=e.async_task_id}else i=e.job_id;return yr.job_info[i]={},n=yr.job_info[i],n.subject_user=e.subject_user||(null!=(r=e.parameters)?r[A.UID_PARAM_NAME]:void 0),n.req=e,n.is_async_task=!!e.async_task_id,n.poll_int=yr.INIT_POLL_INT,n.poll_count=0,n.int_id=setInterval(yr.update_for(i),n.poll_int),n.failures=0,n.start_time=ie.time(),n.dont_hide=t},update_for:function(e){return function(){return yr.update(e)}},backoff:function(e){var t;return t=yr.job_info[e],clearInterval(t.int_id),t.poll_int=Math.min(Math.floor(1.5*t.poll_int),3e4),t.int_id=setInterval(yr.update_for(e),t.poll_int)},update:function(e){var t,n;return n=yr.job_info[e],tt.peek(e)?yr.done(e):(n.poll_count++,n.poll_count%10===0&&yr.backoff(e),!n.modaled&&ie.time()-n.start_time>yr.MODAL_WAIT_MS&&(t=n.req.options,nt.show(t.progress_text),t.onProgress=nt.update,null!=t.on_modal_shown&&t.on_modal_shown(),n.modaled=!0),n.is_async_task?yr.get_async_task_status(e):yr.get_job_status(e))},get_job_status:function(e){return new Ajax.DBRequest("/job_status/"+e,{method:"post",subject_user:yr.job_info[e].subject_user,onSuccess:function(t){var n,i;if(n=yr.job_info[e],i=t.responseText,0===i.indexOf("err"))return yr.done(e),void(n.req.options.onFailure&&!tt.handled(e)&&n.req.options.onFailure(t));if(0===i.indexOf("done"))return n.req.options.job=!1,tt.peek(e)||new Ajax.Request("/job_results/"+e,{method:"post",parameters:{t:Ie.read(Ae.JS_CSRF_COOKIE)},onSuccess:function(t){return tt.handled(e)?void 0:(Pt.clearWorkingMessage(),n.req.options.onSuccess?n.req.options.onSuccess(t):void 0)},onFailure:function(t){return tt.handled(e)?void 0:(Pt.clearWorkingMessage(),n.req.options.onFailure?n.req.options.onFailure(t):void 0)}}),yr.done(e);try{if(n.req.options.onProgress)return n.req.options.onProgress(t.responseText)}catch(e){}},onFailure:function(t){var n;return n=yr.job_info[e],n.failures++,n.failures>=yr.FAILS_MEAN_FAIL?(n.req.options.onFailure&&n.req.options.onFailure(t,!0),Pt.remove(n.req),yr.done(e)):void 0}})},get_async_task_status:function(e){return new Ajax.DBRequest("/async_task_status/"+e,{method:"post",subject_user:yr.job_info[e].subject_user,onSuccess:function(t){var n,i;if(n=yr.job_info[e],i=t.responseText,0===i.indexOf("done:")||0===i.indexOf("err:"))return tt.handled(e),Pt.clearWorkingMessage(),0===i.indexOf("done:")&&(t.responseText=i.substr(5)),n.req.options.onSuccess&&n.req.options.onSuccess(t),n.req.options.onComplete&&n.req.options.onComplete(t),yr.done(e);if(0===i.indexOf("async_task_err:"))return b.error(new Ke(i.substr(15))),tt.handled(e),Pt.clearWorkingMessage(),yr.done(e),pr.force_reload();try{if(n.req.options.onProgress)return n.req.options.onProgress(t.responseText)}catch(e){}},onFailure:function(t){var n;if(n=yr.job_info[e],n.failures++,n.failures>=yr.FAILS_MEAN_FAIL){try{n.req.options.onFailure&&n.req.options.onFailure(t,!0)}catch(e){}return Pt.remove(n.req),yr.done(e)}}})},done:function(e){var t;return t=yr.job_info[e],clearInterval(t.int_id),t.dont_hide?nt.update("1/1"):(delete yr.job_info[e],t.req.async_task_id&&t.req.async_task_id!==e?void 0:nt.hide(e))}};var kr,Er,xr,An=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};xr=Xe.NamespaceEvents=function(){function e(e){this.ns_id=e,this.earliest=Number.MAX_VALUE,this.events=[],this.seen={},this.done=!1}return e}(),kr=Xe.EventDatePicker=function(){function e(e){var t,n,i;this.on_change=e,pe(document.body).on("click",function(e){return function(t){return e.hide_calendar(t)}}(this)),i=new Element("div",{id:"cal_container"}),pe(i).bind("click",function(e){return e.preventDefault()}),pe(document.body).append(i),this.calendar=new ri("cal_container",{onDateChange:function(e){return function(t){return e.on_change(t)}}(this),disable_future:!0}),pe(i).css("position","fixed"),n=pe("#cal_date"),t=pe("#cal_container"),Oe.clone_position(t,n,{setWidth:!1,setHeight:!1,offsetTop:n.height(),offsetLeft:n.width()-t.children().first()[0].offsetWidth}),this.hide_calendar()}return e.prototype.show_calendar=function(e){return this.shown?(pe("#cal_container").hide(),void(this.shown=!1)):(pe("#cal_container").show(),this.shown=!0)},e.prototype.hide_calendar=function(e){return e&&pe(e.target).closest("#cal_date").length>0?void 0:(pe("#cal_container").hide(),this.shown=!1,!0)},e}(),Er=INLINE_JS.Events=Xe.Events={ns:null,role:"all",now:Number(new Date),timestamp:Rt.start_of_day(new Date(Number(new Date)+864e5)),request_in_flight:!1,one_day:864e5,user_navigated_away:!1,init:function(e,t,n,i,r){var o,s,a;return null==r&&(r=!1),this.awaitingFirstRender=!0,a=p.deconstruct_url(),this.first_event_map=e,this.roles=t,this.rss_data=n,this.role_has_events=i,this.deletions_only=r,this.role_picker=Y.get_controller(pe("#role-selector")),1===this.roles.length?this.role=this.roles[0].role:a.qargs.role?(this.role=a.qargs.role,this.role_picker.set_state(this.role)):this.deletions_only&&(this.role=this.roles[this.roles.length-1].role),this.date_picker=new kr(function(e){return function(t){return e.change_date(t),e.set_url(),ze.WebMiscActivityLogger.log("filter_events_date")}}(this)),this._init_state(),this.role_picker.on_state_change=function(e){return function(){return e.role=e.role_picker.get_state(),e.ns&&!e.valid_roles().some(function(t){return t.ns_ids.contains(e.ns.ns_id)})&&(e.ns=null,ii.set_selected_by_value(pe("#namespace-list")[0],"false")),e.set_url(),e.get_more(!0)}}(this),te.set_during_login_callback(function(e){return function(e,t){return window.location.reload()}}(this)),pe(window).bind("beforeunload",function(e){return function(){e.user_navigated_away=!0}}(this)),pe("#namespace-list-container")[0]&&pe("#namespace-list-container")[0].observe("db:change",function(e){return function(t){return e.ns=e.namespaces[JSON.parse(t.memo)],e.set_url(),e.get_more(!0),ze.WebMiscActivityLogger.log("filter_events_shared_folder")}}(this)),pe(window).on("scroll",function(e){return function(){return document.body.scrollTop=Math.min(document.body.scrollTop,document.body.scrollHeight-Oe.viewport_dimensions().height-10),e.get_more()}}(this)),a.qargs.ns&&(ii.set_selected_by_value(pe("#namespace-list")[0],a.qargs.ns),this.ns=this.namespaces[a.qargs.ns]),a.qargs.date&&(s=a.qargs.date.split("-").map(Number),o=new Date(s[2],s[1]-1,s[0]),this.date_picker.calendar.selected_date=o,this.change_date(o)),this.update_calendar_first_day(),pe("#reset-rss-link").on("click",function(e){return function(t){var i;return n=e.rss_data[null!=(i=e.ns)?i.ns_id:void 0]||e.rss_data[e.role],new Ajax.DBRequest("/reset_rss",{parameters:{ns_id:n.ns_id},onSuccess:function(){return b.success(At("RSS feed url successfully reset.")),He.redirect("/events")}}),!1}}(this)),this.get_more()},_init_state:function(){var e,t,n,i,r,o,s,a;for(this.namespaces={},o=v(this.roles).values(),e=0,n=o.length;n>e;e++)for(a=o[e],s=a.ns_ids,t=0,i=s.length;i>t;t++)r=s[t],this.namespaces[r]=new xr(r);return this.ns?this.ns=this.namespaces[this.ns.ns_id]:void 0},change_date:function(e){return this.timestamp=Number(e)+this.one_day,(this.timestamp<this.earliest()||this.timestamp>this.latest)&&(this.latest=this.timestamp,this._init_state()),pe("#cur_date_text").text(Cr.localize(e)),this.get_more(!0)},is_scrolled_down:function(){var e,t,n;return n=Oe.scroll_offsets().top,t=Oe.viewport_dimensions().height,e=pe("#events").height(),n+t+50>=e},get_more:function(e){var t,n,i;if(!this.request_in_flight)return v(this.valid_nss()).all(function(e){
return e.done})?void this.render():e||this.is_scrolled_down()?(this.request_in_flight=!0,this.render(),n=function(e){return function(){return v(e.valid_nss()).map(function(e){return e.ns_id}).join(",")}}(this),t=Math.min(this.earliest(),this.timestamp/1e3,Math.floor(this.now/1e3)),i={page_size:25,ns_ids:n(),timestamp:t},this.deletions_only&&(i.deletions_only=!0),new Ajax.DBRequest("/events/ajax",{method:"POST",parameters:i,onSuccess:function(e){return function(t){var i,r,o,s,a,_,l,u,d,c,h,f,p,m;for(i=JSON.parse(t.responseText),e.request_in_flight=!1,f=i.events,o=0,_=f.length;_>o;o++)r=f[o],r.html=pe(r.html)[0],h=r.pkey+" "+(r.html.textContent||r.html.innerText),d=e.namespaces[r.ns_id],d.seen[h]||(d.events.push(r),d.seen[h]=!0,d.earliest=r.timestamp);if(i.events.length>0)for(p=i.ns_ids,s=0,l=p.length;l>s;s++)c=p[s],e.namespaces[c].earliest=v(i.events).map(function(e){return e.timestamp}).min();if(e.render(),i.events.last())e.get_more();else if(v(i.ns_ids).join(",")!==n())e.get_more();else for(m=i.ns_ids,a=0,u=m.length;u>a;a++)c=m[a],e.namespaces[c].done=!0;return L.configureAllLinks("#event-table",".inline-restore","events")}}(this),onError:function(e){return function(){return e.request_in_flight=!1,e.user_navigated_away?void 0:b.error(At("We had problems loading your events feed; please try again later."))}}(this)})):void this.render()},valid_roles:function(){return"all"!==this.role?v(this.roles).filter(function(e){return function(t){return t.role===e.role}}(this)):this.roles},valid_nss:function(){return this.ns?[this.ns]:v(this.valid_roles()).map(function(e){return function(e){return e.ns_ids}}(this)).flatten().map(function(e){return function(t){return e.namespaces[t]}}(this)).uniq()},earliest:function(){return v(this.valid_nss()).map(function(e){return function(e){return e.earliest}}(this)).max()},latest:Number.MAX_VALUE,update_calendar_first_day:function(){return this.date_picker.calendar.options.first_day=Rt.start_of_day(new Date(v(this.valid_nss()).map(function(e){return function(t){return e.first_event_map[t.ns_id]}}(this)).min())),this.date_picker.calendar.selected_date<this.date_picker.calendar.options.first_day&&(this.date_picker.calendar.selected_date=Rt.start_of_day(new Date(Number(this.date_picker.calendar.options.first_day)+this.one_day)),this.change_date(this.date_picker.calendar.selected_date)),this.date_picker.calendar.render()},set_url:function(){var e,t,n,i;return n=new Date(this.timestamp-this.one_day),t=this.now-this.timestamp>0,e={},this.ns&&(e.ns=this.ns.ns_id),"all"!==this.role&&(e.role=this.role),t&&(e.date=n.getDate()+"-"+(n.getMonth()+1)+"-"+n.getFullYear()),i=this.deletions_only?"/deleted_files":"/events",p.push_state(i,e)},on_preview_open:function(e){var t;return t=H.get_viewer().get_user_by_id(e.user_id),pe(document).on("db:filepreview:close",this.on_preview_close),jr.show(e,t),!1},on_preview_close:function(){return pe(document).off("db:filepreview:close",this.on_preview_close),document.title=At("Recent events - Dropbox")},render:function(){var e,t,n,i,r,o,s,a,_,l,u,d,c,h,f,p,m,g,w,b,y,k,E,x;if(this.role_has_events[this.role]&&this.update_calendar_first_day(),e=v(this.valid_nss()).map(function(e){return function(e){return e.events}}(this)).flatten(),t=this.earliest(),k=v(e).sortBy(function(e){return-e.timestamp}),r=v(k).filter(function(e){return function(n){return n.timestamp>=t&&n.timestamp<e.timestamp/1e3&&(null!==e.ns||!n.is_dup)}}(this)),this.role_has_events[this.role]){for(pe("#event-table").empty(),o=0,_=r.length;_>o;o++)m=r[o],n=pe(m.html),g=v(this.valid_roles()).filter(function(e){return function(e){return e.ns_ids.contains(m.ns_id)}}(this)).map(function(e){return function(e){return e.name}}(this)).join(" & "),this.deletions_only?n.find("span.role-path").text(g):n.find("span.role-label > span").text(g),pe("#event-table").append(n),null!=m.preview_jsinfo&&(i=m.preview_jsinfo,u=n.find("#prev_link"),u.on("click",this.on_preview_open.bind(this,i)),y=n.find(".inline-button"),y.on("click",this._inline_share_button.bind(this,i)));pe("#events-container").show(),pe("#events-sub-header").show(),pe("#events-sub-header").css("visibility","visible"),pe("#events-empty-state").hide(),pe(".empty-explanation").hide()}else this.request_in_flight||(pe("#events-container").hide(),pe("#events-sub-header").hide(),pe("#events-empty-state").show(),pe(".empty-explanation").show());for(this.request_in_flight?pe("#more-loading").show():(this.awaitingFirstRender&&(this.awaitingFirstRender=!1,ze.WebMiscActivityLogger.log("events-first-load",{time:Number(new Date)-this.now})),pe("#more-loading").hide()),pe("#more-loading").css("marginTop",this.earliest()===Number.MAX_VALUE?"140px":"20px"),d=pe("#namespace-list > li"),a=0,l=d.length;l>a;a++)s=d[a],E=pe(s).data("value"),p=An.call(v(this.valid_roles()).map(function(e){return e.ns_ids}).flatten(),E)>=0,f=E===!1,x=f||p,pe(s).css("display",x?"":"none");return b=An.call(function(){var e,t,n,i;for(n=this.valid_roles(),i=[],e=0,t=n.length;t>e;e++)h=n[e],i.push(h.ns_ids.length>1);return i}.call(this),!0)>=0,this.request_in_flight?void 0:(b?(pe("#namespace-list-container").css("visibility","visible"),pe("#namespace-list-container").show()):pe("#namespace-list-container").hide(),w=this.rss_data[null!=(c=this.ns)?c.ns_id:void 0]||this.rss_data[this.role],w&&this.role_has_events[this.role]?(pe("#rss-feed a").attr("data-title",w.title),pe("#rss_url").val(w.url),pe("#rss_url").focus(),pe("#rss-feed").show(),pe("#rss-feed").css("visibility","visible")):pe("#rss-feed").hide())},show_rss_modal:function(){var e,t;return Xn.show(At("Subscribe to this RSS feed"),pe("#rss-modal")[0]),t=pe("#rss_url").val(),e=Le.clipboard_overlay(t,pe("#real_copy"),function(){return b.success(At("Link copied to clipboard!")),Xn.hide()},pe(".modal-buttons")),e.css({zIndex:1001})},_inline_share_button:function(e,t){var n,i;return t.preventDefault(),ht(e.user_id,{fqPath:e.fq_path,isFolder:e.is_dir,nsId:e.ns_id,targetNsId:e.target_ns})?void 0:(n="events_table_row",i=ze.ShmodelUILogger.get_target_item(e),ze.ShmodelUILogger.log("single_entry_share",n,i),new In(e.user_id,e.fq_path,n).show())}};var Cr;Cr=Xe.DateUtil={fromSecondsSinceEpochUTC:function(e){var t;return t=new Date(1970,0,1),t.setSeconds(e),t},applyTimezoneOffset:function(e,t){var n,i;return n=parseInt(t,10),i=60*(t-n),e.setHours(e.getHours()+n),e.setMinutes(e.getMinutes()+i)},contextualFormat:function(e){var t,n,i,r,o;return i=new Date(Date.now()),r=(i.getTime()-e.getTime())/1e3,t=0,28800>r?ie.ago(e):(this.applyTimezoneOffset(i,A.TIMEZONE_OFFSET),this.applyTimezoneOffset(e,A.TIMEZONE_OFFSET),o=new Date(Date.now()),this.applyTimezoneOffset(o,A.TIMEZONE_OFFSET),o.setDate(o.getDate()-1),e.getYear()===i.getYear()&&e.getMonth()===i.getMonth()&&e.getDate()===i.getDate()?(n=At("Today %(time)s"),n.format({time:Cr.format(e,A.time_format)})):e.getYear()===o.getYear()&&e.getMonth()===o.getMonth()&&e.getDate()===o.getDate()?(n=At("Yesterday %(time)s"),n.format({time:Cr.format(e,A.time_format)})):Cr.format(e,A.datetime_format))},toUTCDate:function(e){return new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds())},differenceStr:function(e,t){var n,i,r,o,s,a,_;return s=(e.getTime()-t.getTime())/1e3,60>s?Tt("%d sec","%d secs",s).format(s):3600>s?(r=parseInt(s/60,10),Tt("%d min","%d mins",r).format(r)):86400>s?(i=parseInt(s/3600,10),Tt("%d hour","%d hours",i).format(i)):2592e3>s?(n=parseInt(s/86400,10),Tt("%d day","%d days",n).format(n)):4838400>s?(a=parseInt(s/604800,10),Tt("%d week","%d weeks",a).format(a)):31536e3>s?(o=parseInt(s/2592e3,10),Tt("%d month","%d months",o).format(o)):(_=parseInt(s/31536e3,10),Tt("%d year","%d years",_).format(_))},localize:function(e){return bt(null!=A.date_format,"Date format missing."),Cr.format(e,A.date_format)},format:function(e,t){var n;return bt("string"==typeof t,"Date format requires a format string"),n={yy:function(t){return function(){return e.getFullYear().toString().substring(2)}}(this),yyyy:function(t){return function(){return e.getFullYear().toString()}}(this),M:function(t){return function(){return(e.getMonth()+1).toString()}}(this),MM:function(t){return function(){return(e.getMonth()+1).toString().lpad(2)}}(this),d:function(t){return function(){return e.getDate().toString()}}(this),dd:function(t){return function(){return e.getDate().toString().lpad(2)}}(this),h:function(t){return function(){return(e.getHours()%12||12).toString()}}(this),H:function(t){return function(){return e.getHours().toString()}}(this),HH:function(t){return function(){return e.getHours().toString().lpad(2)}}(this),m:function(t){return function(){return e.getMinutes().toString()}}(this),mm:function(t){return function(){return e.getMinutes().toString().lpad(2)}}(this),a:function(t){return function(){return e.getHours()>11?At("PM",{comment:"PM as in evening"}):At("AM",{comment:"AM as in morning"})}}(this)},t.replace(/([a-zA-Z]+)/g,function(e){return null!=n[e]?n[e]():e})}};var Sr;Sr=INLINE_JS.Timezone=Xe.Timezone={check_timezone:function(){var e;if(H.get_viewer().is_signed_in)return e=Sr.get_current_timezone(),null==A.auto_timezone_offset||A.auto_timezone_offset!==e?Sr.update(e):void 0},get_current_timezone:function(){var e,t,n,i;return t=new Date,t.setSeconds(0),t.setMilliseconds(0),i=t.toGMTString(),e=new Date(i.substring(0,i.lastIndexOf(" "))),n=(t-e)/36e5},update:function(e){return bt("number"==typeof e,"Timezone offset was not a number: "+e),new Ajax.DBRequest("/set_timezone",{parameters:{offset:e},noAutonotify:!0})},update_timezones_dropdown:function(e,t){var n,i;return null==t&&(t=null),i=Sr.timezones_by_country[e],pe("#timezone_id").empty(),pe("#timezone_id").append(function(){var e,r,o;for(o=[],e=0,r=i.length;r>e;e++)n=i[e],o.push(pe('<option value="'+n.id+'">'+n.name+"</option>").prop("selected",n.id===t));return o}())},auto:function(){var e;return e=$F("timezone_auto"),e?pe("#tz").hide():(Sr.default_country&&(pe("#timezone_country").val(Sr.default_country),Sr.update_timezones_dropdown(Sr.default_country)),pe("#tz").show())},load_data:function(e,t){return Sr.timezones_by_country=e,Sr.default_country=t}};var Tr,Ar;Ar=Xe.CreateApp={init:function(e,t){var n,i,r;return this.accepted_tos_by_uid=e,this.form=n=pe("#create-app-form"),this.email_verification=null,H.get_viewer().is_paired||(r=H.get_viewer().get_users()[0],this.select_user(r.id)),i=function(e){return function(e){var t;return t=e.target.name,n.find("input[name="+t+"]").each(function(){return pe(this).parents("label").removeClass("active"),n.removeClass(pe(this).data("next"))})}}(this),n.find("input[type=radio]").change(function(e){return i(e),pe(e.target).parents("label").addClass("active"),n.addClass(pe(this).data("next"))}),n.find("input[type=checkbox]").change(function(e){var t;pe(this).filter("#accept-tos").length||(pe(e.target).parents("label").toggleClass("active"),t=n.find("input[name="+pe(this).attr("name")+"]:checked"),n.toggleClass(pe(this).data("next"),0!==t.length))}),n.find(".role-choice input").change(function(e){return function(t){var r,o;return r=n.find(".role-choice input:checked"),o=r.val(),H.get_viewer().is_uid_signed_in(o)?e.select_user(o):(r.prop("checked",!1),i(t),te.show_modal({user_id:o,on_success:function(){return r.prop("checked",!0).trigger("change")}}),!1)}}(this)),n.find("input:checked").trigger("change"),n.find("input[name=tos_accept]").change(function(e){return function(t){return e.update_submit_enabled()}}(this)),n.find("#send-verify-email, #resend-verify-email").click(function(e){return function(i){return e.email_verification.send_email(t,function(){return n.addClass("verify-email-sent"),e.email_verification.flash_email_sent_notification(),e.email_verification.ensure_polling(function(){return e.email_verification.user.is_email_verified?(n.addClass("email-verified"),n.removeClass("verifiy-email-sent"),n.removeClass("email-unverified"),e.update_submit_enabled()):void 0})}),!1}}(this)),n.submit(function(e){return n=pe(e.target),Hn.ajax_submit(n[0],!1,function(e){return window.location.href=e.responseText}),!1})},select_user:function(e){return this.email_verification=it.get_for_user(H.get_viewer().get_user_by_id(e)),this.form.find("#accept-tos-wrapper").toggle(!this.accepted_tos_by_uid[e]),this.form.find("input[name=tos_accept]").prop("checked",!1),this.form.removeClass("verify-email-sent"),this.form.find("#verify-email-wrapper").toggle(!this.email_verification.user.is_email_verified),this.form.toggleClass("email-verified",this.email_verification.user.is_email_verified),this.update_submit_enabled()},update_submit_enabled:function(){var e,t;return t=this.email_verification.user,e=this.accepted_tos_by_uid[t.id]||this.form.find("input[name=tos_accept]").prop("checked"),this.form.find("#create-button").prop("disabled",!e)}},Tr=INLINE_JS.Apps=Xe.Apps={init_apps:function(){return pe("#show-disabled-apps").click(function(){return pe(this).parent().hide(),pe("#disabled-apps").show(),!1})},init_app_info:function(e,t,n){return this.user_email=n,pe("#app-info .icon-container").each(function(e,t){var n;return n=pe(t),n.append(Dropbox.createChooseButton({success:function(e){return n.find(".icon").attr("src",e[0].thumbnailLink),n.find("input[type=hidden]").val(e[0].link)},linkType:"direct",extensions:["images"]}))}),this._hoverable_tmpl=Ke.tmpl("hoverable_tmpl"),pe(".modal-okay-triggers-refresh").on("click",function(e){location.reload()}),pe("#unlink-users-button").on("click",function(t){Tr.unlink_all_users_in_dev(e)}),pe("#enable-additional-users-button").on("click",function(t){Tr.enable_users_in_dev(e)}),pe("#increase-max-users-button").on("click",function(t){Tr.enable_users_in_dev(e)}),pe("#unlink-teams-button").on("click",function(t){Tr.unlink_all_teams_in_dev(e)}),this._webhook_info_row_tmpl=Ke.tmpl("webhook_info_row_tmpl"),pe("#domain-list").on("click",".img-container",function(t){Tr.remove_domain(t.currentTarget.parentNode,e)}),pe("#oauth-uri-list").on("click",".img-container",function(t){Tr.remove_oauth_uri(t.currentTarget.parentNode,e)}),pe("#webhook-list").on("click",".img-container",function(t){Tr.remove_webhook(t.currentTarget.parentNode,e)}),pe("#webhook-list").on("click",".webhook-actions.enabled .webhook_disable",function(t){Tr.update_webhook_url(t.currentTarget,e,!1)}),pe("#webhook-list").on("click",".webhook-actions.disabled .webhook_enable",function(t){Tr.update_webhook_url(t.currentTarget,e,!0)}),pe("#delete-app-button").on("click",function(n){Tr.confirm_disable(t,e,0)}),pe("#webhook_url").on("click change paste focus",function(e){pe("#webhook-form").removeClass("error")}),this.init_app_info_add_redirect_uri(),pe("#oauth2-allow-implicit-grant").on("change",function(t){return Tr.set_oauth2_allow_implicit_grant(t.currentTarget,e)})},init_app_info_add_redirect_uri:function(){var e,t,n,i;t=/^\#?add_redirect_uri=(.*)$/.exec(window.location.hash||""),t&&(i=window.decodeURIComponent(t[1]),e=pe("#oauth-add-uri-form"),pe("input[name=oauth_uri]",e).val(i),n=pe("#add-redirect-uri-modal")[0],pe("#add-redirect-uri-modal-uri").text(i),Xn.show(At("Add OAuth redirect URI"),n,{doit:function(){var e;return window.history&&window.history.replaceState?(e=window.location.href,e=e.substring(0,e.indexOf("#")),window.history.replaceState({},document.title,e)):window.location.hash="",Xn.hide(),Tr.submit_new_oauth_uri(pe("#oauth-add-uri-form")[0])}}))},init_app_datastores_browse:function(e){return this.ds_info=e,H.get_viewer().is_paired?(this.role_picker=Y.get_controller(pe("#role-selector")),this.role_picker.on_state_change=this.app_datastores_browse_render.bind(this),te.set_during_login_callback(function(e){return function(t,n){return e.app_datastores_browse_reload_info(function(){return n()},function(){return n("Error displaying datastores"),window.location.reload()})}}(this))):void 0},app_datastores_browse_reload_info:function(e,t){return pe.ajax({url:"/developers/apps/datastores/info",success:function(t){return function(n){return t.ds_info=n,t.app_datastores_browse_render(),"function"==typeof e?e():void 0}}(this),error:function(e){return function(e){return"function"==typeof t?t(e):void 0}}(this)}),!1},app_datastores_browse_render:function(){return this.app_datastores_browse_render_id("#apps_developed_container"),this.app_datastores_browse_render_id("#apps_used_container"),this.app_datastores_browse_render_empty()},app_datastores_browse_render_empty:function(){var e,t,n,i;if(t=pe("#no_apps_container").empty(),0===pe("#apps_developed_container").children().length&&0===pe("#apps_used_container").children().length)switch(e=pe("<div class='empty-state'></div>").appendTo(t),null!=(n=this.role_picker)?n.get_state():void 0){case dt.PERSONAL:case dt.WORK:return i=H.get_viewer().get_user_by_role(this.role_picker.get_state()),e.append("You don't have any datastores in your "+H.get_role_title(i)+" Dropbox.");default:return e.append("You don't have any datastores in your Dropbox.")}},app_datastores_browse_render_id:function(e){var t,n,i,r,o,s,a;for(r=this.app_datastores_browse_get_id_info(e),n=pe(e),n.empty(),t="",o=0,s=r.length;s>o;o++)i=r[o],this.app_datastores_should_render(i.uid)&&(t+=i.html);return t?(n.append(this.app_datastores_browse_get_id_header(e)),a=pe("<div class='app-list clearfix'/>").appendTo(n),a.html(t)):void 0},app_datastores_should_render:function(e){var t;return null!=this.role_picker?(t=H.get_viewer().get_user_by_id(e),this.role_picker.is_role_visible(t.role)):!0},app_datastores_browse_get_id_info:function(e){switch(e){case"#apps_developed_container":return this.ds_info.apps_developed;case"#apps_used_container":return this.ds_info.apps_used;default:return bt(!1,"invalid ds group id")}},app_datastores_browse_get_id_header:function(e){switch(e){case"#apps_developed_container":return pe("<h2>Apps you develop</h2>");case"#apps_used_container":return pe("<h2>Apps you use</h2>");default:return bt(!1,"invalid ds group id")}},confirm_disable:function(e,t,n){var i,r;return i=At(n?"Are you sure you want to disable '%(app_name)s'?":"Are you sure you want to delete '%(app_name)s'?"),Mt.fillVal(i.format({app_name:e.escapeHTML()}),"app-disable-text"),Xn.show(At(n?"Confirm disable":"Confirm delete"),$("app-disable-modal")),r="/developers/disable_app/"+t,$("app-disable-modal").down("form").action=r,$("disable-app-button").setValue(At(n?"Disable":"Delete"))},enable_app:function(e){var t;return t="/developers/enable_app/"+e,pe("#status-button-form").attr("action",t).submit()},show_uninstall:function(e,t,n,i,r,o){var s;if(e&&Event.stop(e),Xn.vars={app_id:n,user_id:o},s=pe("#delete-"+i+"-app-confirm"),"sandbox"===i){if(!r)return void Tr.do_uninstall();pe(".app_folder",s).text(r)}return pe(".app_name",s).text(t),Xn.show(At("Remove %(app_name)s?").format({app_name:l.em_snippet(t,22)}),s[0],Xn.vars),null},do_uninstall:function(){var e;return e=Xn.vars.user_id,new Ajax.DBRequest("/api/uninstall_app",{parameters:{app_id:Xn.vars.app_id,keep_sandbox_files:$F("keep_sandbox_files")},onSuccess:function(t){var n;return b.success(t.responseText),n=pe(".apps-"+e),pe("#inst-app-"+Xn.vars.app_id+"-row",n).hide().removeClass("active_app"),0===pe(".active_app",n).length&&n.hide(),0===pe(".active_app").length?(pe("#empty-explanation").text(At("You have no apps linked to your Dropbox.")),pe("#applications-explanation",n).remove()):void 0},subject_user:e}),Xn.hide()},enable_users_in_dev:function(e,t){return new Ajax.DBRequest("/developers/enable_users_in_dev/"+e,{onSuccess:function(e){var t;return"ok"===e.responseText?Xn.show(At("User limit increased"),$("increased-dev-user-limit-modal")):(t=JSON.parse(e.responseText),Xn.show(At("Limit raised to %(user_limit)s users").format({user_limit:t.new_limit}),$("increased-dev-user-limit-modal")))}}),!1},unlink_all_users_in_dev:function(e){return Xn.show(At("Unlink all users"),$("confirm-unlink-all-users"),{doit:function(){return new Ajax.DBRequest("/developers/unlink_all_users/"+e,{onSuccess:function(e){return Xn.hide(),location.reload()}})}}),!1},unlink_all_teams_in_dev:function(e){return Xn.show(At("Unlink all teams"),$("confirm-unlink-all-teams"),{doit:function(){return g.AuthenticatedRequest({url:"/developers/unlink_all_teams/"+e,success:function(e){return Xn.hide(),location.reload()}})}}),!1},restore_sandbox:function(e,t,n){var i,r,o;return i=pe("#restore-sandbox")[0],Xn.show(At("Restore app folder '%(filename)s'").format({filename:l.em_snippet(We.filename(t),17)}),i),o=pe("#restore-sandbox-form")[0],r={ns_id:n},r[A.UID_PARAM_NAME]=e.id,Hn.add_vars(o,r)},submit_restore_sandbox:function(e){var t;return t=$("restore-sandbox-form"),Hn.ajax_submit(t,!1,function(e){return Xn.hide(),b.success(At("Restored app folder")),e.responseText.length?pr.reload_fqpath(e.responseText):pr.reload("","",!0)},!1,e.target),!1},submit_app_info:function(e){var t;return t=pe(e).find("input[name=name]").val(),Hn.clear_errors(e),Hn.ajax_submit(e,!1,function(){return b.success("App info updated."),t&&pe("#app-info h1").text(t),location.reload()})},submit_folder_name:function(e){var t;return t=pe(e).find("input[name=folder]").val(),Hn.clear_errors(e),Hn.ajax_submit(e,!1,function(){return b.success("App folder name updated."),pe("#folder-name .text").text(t),Tr.hide_folder_input()})},submit_new_webhook:function(e){var t,n,i,r,o,a,_,l,u,d,h,f;return n=pe(e),o=pe("#webhook-list"),r=pe("<img>").attr("src","/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif").css("vertical-align","middle"),i=n.find("input[name=webhook_url]"),h=function(e,t){return t&&t.remove(),0===o.find(".hoverable-url").length&&o.addClass("hide-status"),pe("#webhook-form-error").text(e),pe("#webhook-form").addClass("error")},_=i.val(),""===_?void h("Empty URI"):(l=s.parse(_),"http"!==(u=l.scheme)&&"https"!==u?void h("URI scheme must be http or https"):l.authority?"localhost"===(d=l.authority)||"127.0.0.1"===d||0===l.authority.indexOf("[::1]")?void h("Webhooks doesn't support localhost as Dropbox can't contact your local server. Please use an internet accessible URI."):o.find("tbody").length>=c.MAX_WEBHOOKS_PER_APP?void h("You can register a maximum of %d webhook URIs per app.".format(c.MAX_WEBHOOKS_PER_APP)):(t=pe(this._webhook_info_row_tmpl({url:_,status:"Verifying"}).toHTML()),t.find(".status").append(r),t.find(".webhook-actions").removeClass("disabled").addClass("enabled"),o.append(t),o.removeClass("hide-status"),pe("#webhook-form").removeClass("error"),a=Hn.collect_form_vars(e),i.val(""),f=(new Date).getTime(),g.WebRequest({url:"/developers/apps/update/add_webhook",dataType:"json",data:a,success:function(e){var n,r;return"invalid"===e.status?(h(e.failure_text,t),i.val(_)):(r=(new Date).getTime()-f,n=Math.max(0,1e3-r),setTimeout(function(){return"ok"===e.status?t.find(".status").text("Enabled"):"error"===e.status?(t.find("textarea").text(e.failure_text),t.find(".status").text(e.status_text).addClass("error"),t.find(".timestamp").text("Just now"),t.find(".webhook-failure-info").css("display","")):void 0},n))},error:function(){return t.remove(),i.val(_)}})):void h("Improperly formatted URI (typo maybe?)"))},remove_webhook:function(e,t){var n,i;return pe("#webhook-form").removeClass("error"),i=pe(e).find(".value").text(),n=pe("<img>").attr("src","/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif").css("vertical-align","middle"),pe(e).find(".status").text("Removing").removeClass("error").append(n),g.AuthenticatedRequest({url:"/developers/apps/update/remove_webhook",data:{app_id:t,webhook_url:i},dataType:"json",success:function(t){var n,r;return n=e.parentNode,r=n.parentNode,r.removeChild(n),0===r.getElementsByClassName("hoverable-url").length&&pe(r).addClass("hide-status"),pe("#webhook_url").val()?void 0:pe("#webhook_url").val(i)},error:function(){return b.error("Unable to complete your request.")}})},update_webhook_url:function(e,t,n){var i,r,o,s,a;return a=pe(e.parentNode.parentNode).find(".value").text(),pe("#webhook-form").removeClass("error"),o=e.parentNode.parentNode.parentNode,i=pe("<img>").attr("src","/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif").css("vertical-align","middle"),r=pe(o).find(".status").text(),n="Disabled"===r,s=n?"Enabling":"Disabling",pe(o).find(".status").text(s).removeClass("error").append(i),g.AuthenticatedRequest({url:"/developers/apps/update/update_webhook_url",data:{app_id:t,webhook_url:a,enable:n},dataType:"json",success:function(e){var t;return r=pe(o).find(".status").text(),t="Disabling"===r?"Disabled":"Enabled",pe(o).find(".status").text(t).removeClass("error").removeClass("img"),"Disabling"===r?pe(o).find(".webhook-actions").removeClass("enabled").addClass("disabled"):pe(o).find(".webhook-actions").removeClass("disabled").addClass("enabled")},error:function(e){return b.error("Unable to complete your request.")}})},set_oauth2_allow_implicit_grant:function(e,t){return g.AuthenticatedRequest({url:"/developers/apps/update/oauth2_allow_implicit_grant",data:{app_id:t,allow:pe(e).val()},dataType:"json",success:function(e){return b.success("OAuth 2 allow implicit grant updated.")},error:function(){return b.error("Error updating OAuth 2 allow implicit grant.")}})},submit_new_oauth_uri:function(e){var t;return t=pe(e).find("input[name=oauth_uri]").val(),Hn.clear_errors(e),Hn.ajax_submit(e,!1,function(){return b.success("OAuth URI added."),Tr.add_oauth_uri(t),pe(e).find("input[name=oauth_uri]").val("")})},add_oauth_uri:function(e){var t;return t=pe("#oauth-uri-list"),t.append(this._hoverable_tmpl({value:e}).toHTML()),t.show()},remove_oauth_uri:function(e,t){var n,i;return i=pe(e).find(".value").text(),n=function(t){var n;return b.success("OAuth URI removed."),n=e.parentNode,n.removeChild(e),0===n.getElementsByTagName("div").length?n.hide():void 0},g.AuthenticatedRequest({url:"/developers/apps/update/remove_oauth_uri",data:{app_id:t,oauth_uri:i},dataType:"json",success:n,error:function(){return b.error("Unable to complete your request.")}})},submit_new_domain:function(e){var t;return t=pe(e).find("input[name=domain_name]").val(),Hn.clear_errors(e),Hn.ajax_submit(e,!1,function(){return b.success("Domain added."),Tr.add_domain(t),pe(e).find("input[name=domain_name]").val("")})},add_domain:function(e){var t;return t=pe("#domain-list"),t.append(this._hoverable_tmpl({value:e}).toHTML()),t.show()},remove_domain:function(e,t){var n,i;return i=pe(e).find(".value").text(),n=function(t){var n;return b.success("Domain removed."),n=e.parentNode,n.removeChild(e),0===n.getElementsByTagName("div").length?n.hide():void 0},g.AuthenticatedRequest({url:"/developers/apps/update/remove_domain",data:{app_id:t,domain_name:i},dataType:"json",success:n,error:function(){return b.error("Unable to complete your request.")}})},show_need_users_modal:function(e){return Xn.show(At("Please test this app",{comment:"Error message"}),$("app-need-users-modal")),!1},show_need_teams_modal:function(e){return Xn.show(At("Please test this app",{comment:"Error message"}),$("app-need-teams-modal"))},show_name_branding_modal:function(e){return Xn.show(At("Please rename this app",{comment:"Error message"}),$("app-name-branding-modal")),!1},show_need_icon_modal:function(e){return Xn.show(At("Please add an icon for this app",{comment:"Error message"}),$("app-need-icon-modal")),!1},show_need_enable_users_modal:function(e){return Xn.show(At("Please enable more users for this app",{comment:"Error message"}),$("app-need-enable-users-modal")),!1},show_submit_prod_status_modal:function(e){return Xn.show(At("Confirm your application submission",{comment:"Error message"}),$("submit-prod-status-modal")),!1},check_for_nongenerated_oauth_tokens:function(e){var t;return t="/developers/prod_request/"+e,new Ajax.DBRequest("/developers/has_nongenerated_oauth_tokens/"+e,{onSuccess:function(e){return"true"===e.responseText?He.redirect(t):Xn.show(At("Please auth at least one user with the OAuth flow",{comment:"Error message"}),$("app-need-nongenerated-token"))},onFailure:function(e){return He.redirect(t)}}),!1},hide_folder_input:function(){return pe("#folder-name").show(),pe("#folder-input").hide()},show_folder_input:function(){return pe("#folder-name").hide(),pe("#folder-input").show(),pe("#folder-input input[name=folder]").focus()}};var Dr,Or;Or=INLINE_JS.twitter_auth_complete=function(e){return bt(null!=e,"user_id must be provided"),Dr.onLoginSuccessCallback?Dr.onLoginSuccessCallback(e):window.location.reload(),!1},Dr=Xe.Twitter={is_authed:function(e){return e=parseInt(e),null==Dr._authed_users&&(Dr._authed_users={}),Dr._authed_users[e]},set_is_authed:function(e,t){return e=parseInt(e),null==Dr._authed_users&&(Dr._authed_users={}),Dr._authed_users[e]=t},get_progress_container:function(){var e;return bt(Dr.progress_container,"Twitter is missing progress_container"),e=$(Dr.progress_container),bt(e,"Missing progress_container elm"),e},follow_dropbox:function(e,t){var n;return bt(null!=t,"user_id must be provided"),e.showWorking&&e.showWorking(),n=function(){return e.onFailure?e.onFailure():window.location.reload()},new Ajax.DBRequest("/twitter/follow_us",{onSuccess:function(t){return t.responseText.startsWith("ok")?e.onSuccess?e.onSuccess():void 0:n()},onFailure:function(){return n()},subject_user:t})},do_auth:function(e,t){var n,i;return bt(null!=t,"user_id must be provided"),i=s({path:"/twitter/request_token"}).updateQuery(A.UID_PARAM_NAME,t).toString(),window.open(i,"twitter_auth","width=800,height=400"),n=function(t){return Dr.set_is_authed(t,!0),"function"==typeof e?e(t):void 0},Dr.onLoginSuccessCallback=n},show_auth:function(e){return e&&(Dr.onLoginSuccessCallback=e),Mt.updateFromElm(Dr.get_progress_container(),"inline-twitter-auth")},show_posting:function(){return Dr.should_hide_modal()&&Xn.hide(),Dr.get_progress_container().update(Mt.fromElm("sharing-progress"))},show_complete:function(e){var t;return t=Dr.get_progress_container(),t.update(Mt.fromElm("sharing-posted")),Dr.show_complete_into(e,t)},show_complete_into:function(e,t){var n,i,r,o,s;return n="twitter",o=At("View tweet"),s=void 0,s=e.startsWith("ok")?"http://www.twitter.com/":e,i=t.down("#view-post"),i.href=s,i.update(o),r=G.make("web",n),i.__sert({top:r})},post:function(e,t,n,i){var r,o;return bt(null!=i,"user_id must be provided"),bt(e,"Twitter message is empty"),r={message:e,from_referrals:Dr.from_referrals,from_getspace:Dr.from_getspace},new Ajax.DBRequest("/twitter_post",{parameters:r,onSuccess:function(t){var n,r;return"login"===t.responseText?(Dr.onLoginSuccessCallback=function(){return Dr.post(e,null,null,i)},(n=Dr.custom_show_auth||Dr.show_auth)()):(Dr.should_hide_modal()&&Xn.hide(),(r=Dr.onPostSuccessCallback||Dr.show_complete)(t.responseText))},subject_user:i}),(o=Dr.custom_show_posting||Dr.show_posting)()},custom_post:function(e,t,n){return bt(null!=n,"user_id must be provided"),t&&(Dr.onPostSuccessCallback=t),e?(bt(e,"Twitter message doesn't exist"),H.get_viewer().is_signed_in?Dr.post(e,null,null,n):window.open("http://www.twitter.com/home?status="+encodeURI(e))):void 0},get_user_info:function(e,t){return bt(null!=t,"user_id must be provided"),new Ajax.DBRequest("/twitter/user_info",{noAutonotify:1,parameters:{},onSuccess:function(t){return e(JSON.parse(t.responseText))},subject_user:t})},should_hide_modal:function(){return"undefined"==typeof Dr.hide_modal?!0:Dr.hide_modal}};var $r,Nr,Ir,_n=function(e,t){function n(){this.constructor=e}for(var i in t)ln.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},ln={}.hasOwnProperty,un=function(e,t){return function(){return e.apply(t,arguments)}};$r=Xe.LightboxPreviewBase=function(){function e(e){this.link_hash=e.link_hash,this.filename=e.filename,this.fq_path=e.fq_path,this.thumbnail_url_tmpl=e.thumbnail_url_tmpl,this.dl_url=e.dl_url,this.ns_id=e.ns_id,this.ns_path=e.ns_path,this.display_time=e.display_time||null,this.more_actions_item_tmpl=Ke.tmpl("lightbox_more_actions_item_tmpl")}return e.prototype.shutdown=function(){},e.prototype.preload=function(){},e.prototype.render=function(){},e.prototype.image_size=function(){var e;return e=document.viewport.getDimensions(),ct(e.width,e.height)},
e.prototype.get_more_actions_above_divider=function(e){var t,n;return n=[],t=this.more_actions_item_tmpl({_id:"lightbox_download_link",_href:this.dl_url,_ns_id:this.ns_id,_ns_path:this.ns_path,sprite_name:"lightbox_download",item_text:At("Download"),more_classes:"more-actions-item",Sprite:G}),n.push(t),n},e.prototype.get_more_actions_below_divider=function(e){return[]},e.prototype.is_a_photo_preview=function(){return this instanceof Nr},e.prototype.is_a_video_preview=function(){return this instanceof Ir},e.prototype.get_actions=function(e){var t,n,i,r,o,a,_;return a=[],e.enable_sublinks&&("WHITE_BUTTON"===e.share_button_experiment_variant?(i=pe("#lightbox-share-action-base").clone().attr("id","lightbox-share-button"),o=this.shmodel_link?function(e){return function(t){return ze.ShmodelUILogger.log("via-shmodel-lightbox"),window.open(s.parse(e.shmodel_link).updateQuery("m","1"))}}(this):function(e){return function(t){return t.preventDefault(),ze.ShmodelUILogger.log("via-browse-lightbox"),kn.shmodel(e.fq_path,"browse_lightbox")}}(this)):(i=pe("<a />",{id:"lightbox_share_link",class:"title_bubble black"}),i.html(G.make("web","link_white")),this.is_a_photo_preview()?i.attr("title",At("Share link to photo")):this.is_a_video_preview()?i.attr("title",At("Share link to video")):bt(!1,"preview needs to be a photo or video"),this.shmodel_link?(i.attr("href",s.parse(this.shmodel_link).updateQuery("m","1")),i.attr("target","_blank"),o=function(e){return function(e){return ze.ShmodelUILogger.log("via-shmodel-lightbox")}}(this)):(i.attr("href","#"),o=function(e){return function(t){return t.preventDefault(),ze.ShmodelUILogger.log("via-browse-lightbox"),kn.shmodel(e.fq_path,"browse_lightbox")}}(this))),i.on("click",o),a.push(i[0])),e.include_delete&&(_=At("Delete"),"WHITE_BUTTON"===e.share_button_experiment_variant?(t=pe("#lightbox-delete-action-base").clone().attr("id","lightbox-delete-link"),t.find(".sprite-text-inner").text(_),t.on("click",function(e){return e.preventDefault(),Lr.delete_current()})):(t=pe("<a />",{id:"lightbox-delete-button",href:"#",class:"title_bubble black",title:_}),t.html(G.make("web","lightbox_delete_16")),t.on("click",function(e){return e.preventDefault(),Lr.toggle_delete()})),a.push(t[0])),"WHITE_BUTTON"===e.share_button_experiment_variant?(r=function(e){return function(e){return e.preventDefault(),Lr.toggle_more_actions_menu()}}(this),n=pe("#lightbox-more-actions-base").clone().attr("id","lightbox-more-actions-button").on("click",r),a.push(n[0])):(bt(null!=Lr.more_actions_button,"Lightbox should have a more_actions_button added on init"),a.push(Lr.more_actions_button)),a},e.prototype.delete_pressed=function(){var e;return e=At("Deleting..."),document.fire(Lr.PHOTO_DELETE_EVT,this),b.success(e)},e.prototype.set_more_actions_event_handlers=function(e){},e.prototype.replace_dl_action_with_open_action_if_file_available=function(){var e,t,n,i;if(null!=__CONDITIONAL_JS__.UnityFeatures)return i=pr.active_user.id,n=function(e){return function(t,n,i){var r,o;return r=pe("#lightbox_download_link"),r.data("ns-id")===t&&r.data("ns-path")===n?(o=pe(e.more_actions_item_tmpl({_id:"unity_open_action",_href:"#",_ns_id:t,_ns_path:n,sprite_name:"lightbox_open",item_text:At("Open"),more_classes:"more-actions-item",Sprite:G}).toHTML()),r.replaceWith(o),o.on("click",function(e){return __CONDITIONAL_JS__.UnityFeatures.open_file(t,n,i,__CONDITIONAL_JS__.UnityFeatures.standard_open_file_handler,function(e){return __CONDITIONAL_JS__.UnityFeatures.standard_open_file_handler(!1)})})):void 0}}(this),(null!=(t=__CONDITIONAL_JS__.UnityCheckFileCache)?t.is_cached_and_locally_available(this.ns_id,this.ns_path):void 0)?n(this.ns_id,this.ns_path,i):(e=function(e){return function(t){return t.is_locally_available?n(e.ns_id,e.ns_path,i):void 0}}(this),__CONDITIONAL_JS__.UnityFeatures.check_file(this.ns_id,this.ns_path,i,e))},e}(),Nr=INLINE_JS.PhotoPreview=Xe.PhotoPreview=function(e){function t(e){t.__super__.constructor.call(this,e),this.original_url=String(s.parse(e.original_url).updateQuery(A.UID_PARAM_NAME,pr.active_user)),this.shmodel_link=e.shmodel_link,this.fail_image_src="/static/images/preview_fail-vflc3IDxf.png",this.is_gif()&&(this.thumbnail_url_tmpl=this.original_url),this.loaded=!1,this.enable_download=e.enable_download}return _n(t,e),t.prototype.show_fail=function(e){var t;return t=pe(e).find(".lightbox_fail_text").text(At("Unable to preview this item."))},t.prototype.fallback=function(e){var t,n;return t=$(e.target),t.writeAttribute({src:this.fail_image_src,width:128,height:128}),n=t.up("div.content-item"),n?this.show_fail(n):void 0},t.prototype.is_gif=function(){return"gif"===We.file_extension(this.filename).toLowerCase()},t.prototype.preload=function(e){var t,n,i;return i=s.parse(this.thumbnail_url_tmpl).updateQuery({size:this.image_size()}).toString(),this.is_gif()&&(i=this.thumbnail_url_tmpl),n=function(t){return function(){return"function"==typeof e&&e(),t.loaded=!0}}(this),Rt.preload_image(i,this.fallback.bind(this),n),t=$(Rt.preloaded_images[i]),t.writeAttribute("data-original-href",this.original_url),t.setAttribute("enable-download",this.enable_download),t.writeAttribute("class","thumbnail"),t},t.prototype.render=function(e,t){var n,i,r,o,s;return this.loaded&&t(),i=this.preload(t),s=pe("<div />",{class:"content-item"}).append(i),n=pe("<div />",{class:"lightbox_fail_text"}),s.append(n),r=i.getAttribute("src").length,o=i.getAttribute("src").substring(r-this.fail_image_src.length,r),o===this.fail_image_src&&this.show_fail(s),e.appendChild(s[0]),s[0]},t.prototype.advance_on_click=!0,t.prototype.get_more_actions_above_divider=function(e){var n,i;return i=t.__super__.get_more_actions_above_divider.call(this,e),n=this.more_actions_item_tmpl({_id:"view_original",_href:this.original_url,_target:"_blank",sprite_name:"lightbox_view_original",item_text:At("View original"),more_classes:"more-actions-item",Sprite:G}),i.push(n),i},t}($r),Ir=Xe.VideoPreview=function(e){function t(e){this._player_error=un(this._player_error,this),this._player_ready=un(this._player_ready,this),t.__super__.constructor.call(this,e),this.preview_url=e.preview_url,this.shmodel_link=e.shmodel_link,this.thumbnail_div=null,this.metadata_link=null!=e.metadata_link?e.metadata_link:void 0,this.metadata=null,this.player=null}return _n(t,e),t.prototype.render_error=function(e){var t,n,i,r,o;return n=pe("<div/>"),i=pe("<img/>",{src:"/static/images/preview_fail-vflc3IDxf.png",class:"video-preview-fail"}),r=pe("<div/>",{class:"video-preview-fail"}),"needflash"===e?r.html(At('Install <a href="http://get.adobe.com/flashplayer/">Adobe Flash Player</a> to view this video.')):r.text(At("Unable to preview this item.",o="web",t="preview means showing the item in the same browser window without downloading a copy.")),n.append(i,r),n[0]},t.prototype._player_ready=function(){var e;return e=function(){return pe(".vjs-poster").show(),pe(".vjs-big-play-button").show(),pe(".vjs-big-play-button").focus()},e.defer()},t.prototype._onPlay=function(){return pe(".vjs-poster").hide(),pe(".vjs-big-play-button").hide()},t.prototype._onEnded=function(){return pe(".vjs-poster").show(),pe(".vjs-big-play-button").show(),pe(".vjs-loading-spinner").hide()},t.prototype._player_error=function(e){return this.shutdown(),this.div=this.render_error(e),pe("#file-preview-modal .content-item").html(this.div)},t.prototype.preload=function(){},t.prototype.render=function(e,t){return this.div=this.render_video(e),this.div},t.prototype.render_video=function(e){var t,n,i,r,o,a;return a=new Element("div",{class:"video-player content-item"}),o=.8*this.image_size().split("x")[0],r=parseInt(.55*o,10),n=!1,i=s.parse(this.thumbnail_url_tmpl).updateQuery({size:this.image_size()}).toString(),t=function(e){return function(t){return e.metadata=t}}(this),this.player=re.embed(a,{src:this.preview_url,type:A.transcoder_hls4web?"application/vnd.apple.mpegurl":"video/flv",width:o,height:r,controls:!0,preload:"auto",poster:i,onError:this._player_error,onReady:this._player_ready,metadata:this.metadata,metadata_link:this.metadata_link,metadata_cb:t}),e.appendChild(a),pe(".vjs-poster").hide(),pe(".vjs-big-play-button").hide(),this.player.on("play",this._onPlay),this.player.on("ended",this._onEnded),a},t.prototype.shutdown=function(){var e,t,n;if(pe(".vjs-big-play-button").blur(),this.player){try{this.player.trigger("shutdown"),"Hls"===this.player.techName&&null!=(n=this.player.tech.sourceBuffer)&&n.abort(),this.player.dispose()}catch(t){e=t}return this.player=null}},t}($r);var Lr;Lr=INLINE_JS.Lightbox=Xe.Lightbox=function(){var e,t,n,i,r,o,_,l,u,d,c,h,f,m,v,g,w,b,y,k,E,x,C,S,T,A,D,O,N,I,L,R,q,M,P,F,U,j,B,V,H,Y,W,J,X,Q,Z,ee,te,ne,re,oe,se,ae,_e,le,ue;return _e=[],oe=0,le=!1,ae=!0,Z=void 0,e=/^\d+\-\d+\-\d+\s+\d+\.\d+\.\d+/,ue=!1,S=void 0,u=void 0,W=-1,J=null,f=null,g=!1,M=!1,k=!1,w=null,v=function(e){return e.complete!==!1},H=function(){var e;if(!$$("#file-preview-modal .loading-image").length)return e=new Element("img",{class:"loading-image",src:"/static/images/icons/ajax-loader-black-vflweQQeE.gif"}),$$("#file-preview-modal .preview-content").first().__sert(e)},h=function(){return $$("#file-preview-modal .loading-image").invoke("remove")},I=function(){var e,t,n,i,r,o,s;return t=$$("#file-preview-modal .content-item").first().down("img.thumbnail"),t&&v(t)?(i=$$("#file-preview-modal .preview").first().getDimensions(),e=void 0,t.naturalHeight?e={width:t.naturalWidth,height:t.naturalHeight}:(e=t.getDimensions(),t.naturalHeight=e.height,t.naturalWidth=e.width),n=e.width/i.width,s=e.height/i.height,o=Math.max(n,s),t.style.visibility="",1>o?(t.style.width="",t.style.height=""):(t.style.width=Math.floor(e.width/o)+"px",t.style.height=Math.floor(e.height/o)+"px"),r=pe("#file-preview-modal .paging-block").position().left-16,pe("#file-preview-modal .filename").css("max-width",r)):void 0},l=void 0,E=function(){var e,t,n,i,r,o,s,a;for(t=$("file-preview-modal"),o=t.down(".menu"),n=t.down(".header"),s=$$(".lightbox-not-important"),a=[],i=0,r=s.length;r>i;i++)e=s[i],a.push(e.addClassName("opacity-zero"));return a},Y=function(){var e,t,n,i,r;for(l&&clearTimeout(l),i=$$(".lightbox-not-important"),r=[],t=0,n=i.length;n>t;t++)e=i[t],r.push(e.removeClassName("opacity-zero"));return r},L=function(e){var t;return Y(),t=e&&$(e.target).descendantOf("file-preview-menu"),null!=l&&clearTimeout(l),!ae||ue||t?void 0:l=setTimeout(E,3112)},Q=function(){return null!=l&&clearTimeout(l),ae=!1},X=function(){return ae=!0,L()},m=function(e){var t;return t=_e.length,(t+(oe+e)%t)%t},A=function(e){var t,n;if(!S.no_preload)return n=B.bind(null,e),"function"==typeof(t=_e[e]).preload?t.preload(n):void 0},D=function(){var e,t,n,i,r;for(i=[1,2,3,4,5,6,-1,-2],r=[],e=0,t=i.length;t>e;e++)n=i[e],Math.abs(n)<_e.length?r.push(A(m(n))):r.push(void 0);return r},q=function(e){return S.filename_in_url?(null!=e?Ut.replace_hash("lh",e):Ut.replace_hash(""),w=e):void 0},N=function(){var e,t;return e=pe("#file-preview-modal"),t=(null!=S?S.num_previews:void 0)||_e.length,g&&M&&k?e.find(".lightbox-index-text-container").text(At("Could not load folder",{comment:"Error shown when a folder fails to load"})):g?M?e.find(".lightbox-index-text-container").text(At("Loading...",{comment:"Shown while waiting for photos/videos to load"})):e.find(".lightbox-index-text-container").text(""):e.find(".lightbox-index-text-container").text(At("%(cur_file_num)s of %(num_total_files)s",{comment:"Indicating which we're viewing, like '3 of 10'"}).format({cur_file_num:oe+1,num_total_files:t})),1===_e.length?(e.find(".prev").addClass("opacity-zero"),e.find(".next").addClass("opacity-zero")):0===oe&&S.no_wrap?(e.find(".prev").addClass("opacity-zero"),e.find(".next").removeClass("opacity-zero")):oe===_e.length-1&&S.no_wrap?(e.find(".prev").removeClass("opacity-zero"),e.find(".next").addClass("opacity-zero")):(e.find(".prev").removeClass("opacity-zero"),e.find(".next").removeClass("opacity-zero"))},r=function(e,t,n,i){var r;return r={user_id:null,target:t,platform:K.FileViewPlatformType.WEB,ns_id:e.ns_id,sjid:null,ns_path:e.ns_path,shared_link_url:n,origin:K.FileViewOriginType.PHOTOS,action:K.FileViewActionType.CLICK,extra:{file_ext:i}}},P=function(t,n){var i,o,s,a,_,l,u,d,c,p,m,g,w,b,y,k,E,x,C,T;if(W=ie.time(),bt(oe<_e.length,"Invalid index "+oe),C=_e[oe],"object"!=typeof C)return J&&clearTimeout(J),void(J=setTimeout(function(){return null!=Lr.shown&&Lr.shown?P(t,n):void 0},100));for(pe("#file-preview-modal").trigger(Lr.LIGHTBOX_SHOW_EVT,{preview:C}),_=We.file_extension_for_logging(C.filename),u=K.FileViewTargetType.PRIVATE,l=null,g="lightbox",null!=C.fq_path?(u=K.FileViewTargetType.PRIVATE,g="browse_lightbox"):null!=C.shmodel_link&&(u=K.FileViewTargetType.SHARED_LINK,l=C.shmodel_link,g="shmodel_lightbox"),d=r(C,u,l,_),ze.FileViewLogger.log(d),ze.WebLightboxLogger.log(ze.WebLightboxLogger.VIEW,{context:g,file_ext:_}),b=pe("#file-preview-modal"),T=b.find(".preview-content"),x=t?j:B,T.empty(),a=C.render(T[0],x),b=b[0],f||(f=b.on("contextmenu","img.thumbnail",hr.show_for_lightbox.bind(hr))),q(C.link_hash),N(),C.display_time?C.filename.match(e)?b.down(".filename").__date(C.display_time):b.down(".filename").__date(C.display_time+" - "+C.filename):b.down(".filename").__date(C.filename),b.down(".filename").writeAttribute("title",C.filename),k=Ke.tmpl("lightbox_more_actions_item_tmpl"),y=C.get_more_actions_above_divider(S),s=C.get_more_actions_below_divider(S),s.length&&(y.push(k({divider:!0,Sprite:G})),y=y.concat(s)),$("lightbox-more-actions-list").__date(y),C.set_more_actions_event_handlers(S),null!=__CONDITIONAL_JS__.UnityFeatures&&C.replace_dl_action_with_open_action_if_file_available(),o=C.get_actions(S),c=document.createDocumentFragment(),p=0,m=o.length;m>p;p++)i=o[p],c.appendChild(i);return b.down(".actions").__date(),b.down(".actions").appendChild(c),"WHITE_BUTTON"===S.share_button_experiment_variant&&(E=pe("#lightbox-more-actions-button .sprite-div").width(),pe("#lightbox-more-actions-menu").css("right",E/2)),b.down(".album-name").hide(),b.down(".filename").removeClassName("faded"),a=a.down("img.thumbnail"),a&&(v(a)?(a.show(),I()):(a.hide(),H(),a.observe("load",function(){return h(),a.style.visibility="hidden",a.show(),I()}))),w={preview_obj:C,index:oe,direction:n},document.fire(Lr.PHOTO_CHANGE_EVT,w)},U=function(e){var t,n,i,r,o;if(-1!==W)return o=ie.time()-W,t=("undefined"!=typeof On&&null!==On?On.is_album:void 0)?"album_shmodel":"not_photos",n={current_view:t},i=pe("#file-preview-modal .content-item img.thumbnail")[0],null!=i&&null!=i.src&&(r=s.parse(i.src).getQuery(),"size"in r&&(n.size=r.size)),$e.log_ajax_transition(o,e,n),W=-1,D()},j=function(){return U("file-preview-lightbox-load-initial")},B=function(e){var t;return"number"!=typeof e?U("file-preview-lightbox-load"):(null!=(t=_e[e])&&(t.loaded=!0),e===oe?U("file-preview-lightbox-load"):void 0)},F=function(e){var t;return t=pe("#lightbox-click-catcher"),t.length||(t=pe("<div />",{id:"lightbox-click-catcher",style:"position: absolute; width: 100%; height: 100%; top: 0px; left: 0px; z-index: 2;"}),t.appendTo("#file-preview-modal .modal-preview-content"),He.msie_version_at_most(10)&&(t.css("background","black"),t.fadeTo(0,0))),t.off("click"),t.on("click",function(t){return t.preventDefault(),e()}),t.show()},d=function(){return pe("#lightbox-click-catcher").hide()},i=function(){var e;return e=pe("#lightbox-more-actions-button"),e.hasClass("toggled")?(d(),e.removeClass("toggled"),$("lightbox-more-actions-menu").hide(),pe(document).trigger("dropdownClosed",[1]),X(),!0):!1},C=function(){var e;return e=pe("#lightbox-more-actions-button"),e.hasClass("toggled")?void 0:(c(),e.addClass("toggled"),ei.hide_all(),pe("#lightbox-more-actions-menu").show(),pe(document).trigger("dropdownOpened",[1]),Q(),F(Lr.close_more_actions_menu))},te=function(){return pe("#lightbox-more-actions-button").hasClass("toggled")?i():C()},x=function(e){var t;return g&&(M=!0,N()),i(),e&&e.preventDefault(),oe===_e.length-1&&S.no_wrap?void 0:(null!=(t=_e[oe])&&t.shutdown(),oe=m(1),0===oe&&L(),P(null,Lr.NEXT))},O=function(e){var t;return g&&(M=!0,N()),i(),e&&e.preventDefault(),0===oe&&S.no_wrap?void 0:(null!=(t=_e[oe])&&t.shutdown(),oe=m(-1),P(null,Lr.PREV))},n=function(e){return e&&e.preventDefault(),_e[oe].advance_on_click?e.clientX<pe(window).width()/10?O():x():void 0},o=function(e){var t,n,i,r,o,s,a;for(t=_e.dict_by("fq_path"),r=void 0,r=e.memo.files?e.memo.files.collect(function(e){return e.fq_path}):e.memo.fq_paths,a=[],o=0,s=r.length;s>o;o++)i=r[o],t[i]?(n=_e.indexOf(t[i]),_e.splice(n,1),S.num_previews&&S.num_previews--,S.num_previews||_e.length?n===_e.length?a.push(O()):a.push(P()):a.push(u())):a.push(void 0);return a},R=function(e){return _e[oe].is_a_timeline_preview()?_e[oe].toggle_select(e):void 0},ne=function(){return Event.stopObserving(document,"mousemove",L),Event.stopObserving(document,"click",L),document.stopObserving(Lr.PHOTO_DELETE_EVT,T),document.stopObserving(a.DELETE,o),clearInterval(Z)},u=function(e){var t,n,i,r;return e&&e.preventDefault(),Lr.shown?(null!=(n=_e[oe])&&n.shutdown(),t=$("file-preview-modal"),t.hide(),t.down(".preview-content").__date(),Oe.scroll_unlock_document(),ne(),q(),Lr.shown=0,t.stopObserving("click",Lr.back),null!=(i=$$(".preview-content"))&&null!=(r=i.first())&&r.stopObserving("click"),pe("#file-preview-modal").trigger(Lr.LIGHTBOX_HIDE_EVT)):void 0},se="db:filepreview:exitselect",t=function(e){var t;return S.keep_url?u():(null!=(t=_e[oe])&&t.shutdown(),window.history.go(-1)),null!=e&&(e.originalEvent&&(e=e.originalEvent),Event.extend(e).stop()),document.fire(se,_e[oe])},T=function(e){return Vn.do_delete(pr.active_user,e.memo.fq_path)},y=function(){var e;return le||(e=pe("#file-preview-modal"),e.on("click",".close",t),z("esc",Lr.KEY_SCOPE,function(e){return pe("#lightbox-more-actions-button").hasClass("toggled")?i():ue?c():t(e)}),e.on("click",".next",x),e.on("click",".prev",O),e.on("click",".preview-container",n),z("left, k",Lr.KEY_SCOPE,function(e){return O()}),z("right, j",Lr.KEY_SCOPE,function(e){return x(),!1}),z("up, down",Lr.KEY_SCOPE,function(e){return!1}),z("x, s, space",Lr.KEY_SCOPE,function(e){return R(e),!1}),S.include_delete&&"WHITE_BUTTON"!==S.share_button_experiment_variant&&(z("delete, command+backspace, backspace",Lr.KEY_SCOPE,function(e){return Event.extend(e).preventDefault(),Lr.toggle_delete()}),pe("#lightbox-delete-photo").on("click",function(e){return ee(),_e[oe].delete_pressed()}),pe("#lightbox-delete-cancel").on("click",c)),p.add_exit_callback("/lightbox",function(){return u()}),Rt.disableSelection(e.find(".preview-container")[0]),Rt.disableSelection(e.find(".header")[0]),le=!0),Event.observe(document,"mousemove",L),Event.observe(document,"click",L),document.observe(a.DELETE,o),document.observe(Lr.PHOTO_DELETE_EVT,T),z.setScope(Lr.KEY_SCOPE),Z=setInterval(I,500)},b=function(){var e,t,n,i,r;if(w){for(r=[],e=t=0,n=_e.length;n>t;e=++t)i=_e[e],i.link_hash&&i.link_hash.toLowerCase()===w.toLowerCase()?(oe=e,Lr.shown?r.push(P()):r.push(Lr.show())):r.push(void 0);return r}},re=function(){return pe(function(){return Ut.watch("lh",function(e){return w=e,b()}),Ut.watch("f",function(e){var t,n,i,r,o;for(o=[],t=n=0,i=_e.length;i>n;t=++n)r=_e[t],r.filename.toLowerCase()===e.toLowerCase()?(oe=t,Lr.shown?o.push(P()):o.push(Lr.show())):o.push(void 0);return o})})},V=function(){return ei.hide_all(),pe("#file-preview-modal .delete-file-prompt").show(),pe(document).trigger("dropdownOpened",[1]),Y(),ue=!0,F(Lr.toggle_delete),pe("#lightbox-delete-photo").focus()},c=function(){var e,t;return ue?(e=pe("#file-preview-modal .delete-file-prompt"),e.hide(),pe(document).trigger("dropdownClosed",[1]),null!=(t=e.find(":focus")[0])&&t.blur(),L(),ue=!1,d()):void 0},ee=function(){return i(),ue?c():V()},_=function(){return _e[oe].delete_pressed()},{init_from_preview_objs:function(e,t,n){var i,r,o,s,a;for(null==n&&(n=!0),a=[],r=0,o=e.length;o>r;r++)i=e[r],s=i.is_video?new Ir({filename:i.filename,fq_path:i.path,thumbnail_url_tmpl:i.thumbnail_url,preview_url:i.preview_url,dl_url:i.dl_url,shmodel_link:i.shmodel_link,ns_id:i.ns_id,ns_path:i.path,link_hash:i.item_id+"-"+i.filename,metadata_link:i.metadata_link}):new Nr({filename:i.filename,fq_path:i.path,thumbnail_url_tmpl:i.thumbnail_url,dl_url:i.dl_url,original_url:i.orig_url,shmodel_link:i.shmodel_link,ns_id:i.ns_id,ns_path:i.ns_path,link_hash:i.item_id+"-"+i.filename,enable_download:i.enable_download}),a.push(s);return Lr.init(a,{include_delete:!1,keep_url:!0,filename_in_url:!0,enable_sublinks:n}),document.on(Lr.EXIT_SELECT_EVT,function(e){var n;return z.setScope("all"),n=pe(t)[a.indexOf(e.memo)],Rt.scroll_to_thumb(n),pe(n).addClass("wiggobble"),setTimeout(function(){return pe(n).removeClass("wiggobble")},1e3)})},init:function(e,t){return Lr.shown?void 0:(Lr.more_actions_button=new Element("a",{id:"lightbox-more-actions-button",href:"#",class:"lightbox-more-actions-button title_bubble black extra-margin",title:At("More actions")}),Lr.more_actions_button.observe("click",function(e){return e.preventDefault(),Lr.toggle_more_actions_menu()}),Lr.more_actions_button.__date(G.make("web","lightbox_more")),t=t||{},S={include_delete:t.include_delete||!1,keep_url:t.keep_url||!1,num_previews:t.num_previews||null,filename_in_url:t.filename_in_url||!1,no_wrap:t.no_wrap||!1||!0,no_preload:t.no_preload||!1,enable_sublinks:null!=t.enable_sublinks?t.enable_sublinks:!0,share_button_experiment_variant:t.share_button_experiment_variant||!1},g=t.is_loading||!1,bt(!S.filename_in_url||S.keep_url,"filename_in_url cannot be used with keep_url off"),_e=e,null!=t.start_index&&Lr.show(t.start_index),S.filename_in_url&&re(),$(document.body).on("click",".more-actions-item",function(e,t){return t.down("a").getAttribute("href").length<2&&e.preventDefault(),Lr.close_more_actions_menu()}))},update_previews:function(e){return _e=e},show:function(e){var t,n;if(!Lr.shown)return bt(_e&&_e.length,"Lightbox.show() requires file preview objects to show"),y(),null!=e&&(oe=e),pe("#file-preview-modal").trigger("lightbox-init-show",{preview:_e[oe]}),(null!=(n=_e[oe])?n.enable_download:void 0)?Lr.more_actions_button.show():Lr.more_actions_button.hide(),bt(!Lr.shown,"Trying to reshow file preview modal"),$("file-preview-modal").show(),Oe.scroll_lock_document(),P(!0),Lr.shown=1,S.keep_url||(t=p.deconstruct_url(p.get_url()),0!==t.path.indexOf("/lightbox/")&&p.push_state("/lightbox"+t.path,t.qargs)),L()},jump_to:function(e){return bt(Lr.shown,"Lightbox should be showing"),oe=e,P(),L()},set_no_wrap:function(e){return S.no_wrap=e},update_with_error:function(){return k=!0,N()},num_previews:function(){return S.num_previews||_e.length},get_previews:function(){return _e},current_index:function(){return oe},close_more_actions_menu:i,toggle_more_actions_menu:te,toggle_delete:ee,delete_current:_,back:t,PHOTO_CHANGE_EVT:"db:lightbox:photo_change",PHOTO_DELETE_EVT:"db:lightbox:photo_delete",PHOTO_REMOVE_FROM_ALBUM_EVT:"db:lightbox:photo_remove_from_album",EXIT_SELECT_EVT:se,NEXT:1,PREV:-1,vid_thumbnail_hidden:null,KEY_SCOPE:"lightbox",LIGHTBOX_HIDE_EVT:"lightbox-hide",LIGHTBOX_SHOW_EVT:"lightbox-preview"}}();var Rr;Rr=Xe.Tour=function(){var e,t,n,i,r,o,s,a,_,l,u,d;return t=6,e=0,u=function(e){var n,i,r,o,s,a,_,l,u,d,c;for($$(".page-end").each(Element.remove),_=e,c=t-e-1,n=document.createDocumentFragment(),i=o=0,l=_;l>=0?l>o:o>l;i=l>=0?++o:--o)a=new Element("img",{src:"/static/images/page-left-vflvWgvOr.png",class:"page-end-left page-end"}),a.style.left=28-5*i+"px",a.style.zIndex=t-i,n.appendChild(a);for(r=s=0,u=c;u>=0?u>s:s>u;r=u>=0?++s:--s)d=new Element("img",{src:"/static/images/page-right-vflnAeb-6.png",class:"page-end-right page-end"}),d.style.right=31-5*r+"px",d.style.zIndex=t-r,n.appendChild(d);return $("book").appendChild(n)},d=function(e){return(e>0?Element.show:Element.hide)("tour-page-back"),(t>e+1?Element.show:Element.hide)("tour-page-forward")},_=function(e){return $$(".pages").invoke("hide"),$("page-"+e).show()},n=function(t){return d(t),u(t),_(t),e=t},a=function(t){var i;return Event.extend(t).preventDefault(),i=e-1,0>i?void 0:(n(i),p.push_state("/tour/"+i))},o=function(i){var r;return Event.extend(i).preventDefault(),r=e+1,r>=t?void 0:(n(r),p.push_state("/tour/"+r))},l=function(e,t){var i;return e.preventDefault(),i=parseInt(t.href.split("/").last(),10),n(i),p.push_state("/tour/"+i)},r=function(){return $("tour-page-back").observe("click",a),$("tour-page-forward").observe("click",o),z("right",o),z("left",a),$("toc").on("click","a",l)},i=function(e,i){var r;return r=parseInt(e,10)||0,(0>r||r>=t)&&(r=0),n(r)},s=function(){var e,t,n,i,r;for(i=$$(".page-right img"),r=[],t=0,n=i.length;n>t;t++)e=i[t],r.push(Rt.preload_image(e.src));return r},{setup:function(){return pe(function(){return p.add_callback("/tour",i),r(),s()})}}}();var qr;qr=__PARENT_SCOPE__.FilePreview=INLINE_JS.FilePreview=Xe.FilePreview={PARTIAL_TEXT_LENGTH_THRESHOLD:65536,pdfLink:null,_pdfLoader:new T,_has_marked_time_to_interactive:!1,init_pdf:function(e,t,n,i,r,o){var a,_;return null==o&&(o={}),this.pdfLink=i,this.iframe_src=t,this.presentationMode=r,this._log_pdf_render_time(e),window.addEventListener("message",this._preview_listener,!1),pe(function(e){return function(){var n,i,r,a;return a=s.parse(t),n=pe("#pdf-embed-container"),o=v.defaults(o,{annotationMarkerEnabled:"True"===n.attr("data-docpreview-annotation-marker-enabled"),annotationHighlightEnabled:"True"===n.attr("data-docpreview-annotation-highlight-enabled"),annotationRegionEnabled:"True"===n.attr("data-docpreview-annotation-region-enabled")}),a=o.annotationMarkerEnabled?a.updateQuery("annotation_marker","1"):a.removeQuery("annotation_marker"),a=o.annotationHighlightEnabled?a.updateQuery("annotation_highlight","1"):a.removeQuery("annotation_highlight"),a=o.annotationRegionEnabled?a.updateQuery("annotation_region","1"):a.removeQuery("annotation_region"),r=a.getQuery(),e._pdfLoader.startListening(),e._pdfLoader.openFile(r.file,{presentationMode:e.presentationMode}),delete r.file,a.setQuery(r),i=pe("#pdf-embed-iframe"),i.attr("src",String(a)),i.attr("type","application/pdf"),i.attr("allowfullscreen",""),i.addClass("pdfjs"),pe("html, body").addClass("full_height"),e._fire_pdf_render_event(),n.trigger("previewrendered")}}(this)),this.preview_status=n,He.chrome&&(_=function(){var e;return e=pe('link[rel="shortcut icon"]').remove(),pe("head").append(e)},setTimeout(_,1e3)),a=$$("#pdf-embed-container iframe"),window.setTimeout(function(e){return function(){return a.invoke("setStyle",{visibility:"visible"})}}(this),200)},init_excel:function(e){var t;return window.addEventListener("message",this._preview_listener,!1),t=pe("#pdf-embed-iframe"),t.on("load",function(e){return function(){return e._has_marked_time_to_interactive||(e._has_marked_time_to_interactive=!0,$e.mark_time_to_view(),$e.mark_time_to_interactive()),pe("#html-container").trigger("previewrendered")}}(this)),t.attr("src",e)},excel_preview_unsupported:function(){return this.preview_failed()},init_font:function(){return pe(function(e){return function(){return!$(document.documentElement).hasClassName("fontface")||$(document.body).hasClassName("gecko")?$(document.body).removeClassName("file-preview-body"):void 0}}(this))},init_htmlified:function(){return window.htmlified_height?(this.htmlified_loaded(),void pe("#htmlified-wrapper").trigger("previewrendered")):window.postMessage?setTimeout(function(e){return function(){return window.htmlified_height?void 0:e.preview_failed()}}(this),1e4):void this.preview_failed()},htmlified_loaded:function(){var e;return null!=(e=$("htmlified-loading"))&&e.remove(),$("htmlified").style.visibility="",$e.mark_time_to_view(),$e.mark_time_to_interactive()},init_video:function(e,t,n,i,r,o,s){return pe(function(a){return function(){var _,l,u;return u=.9*s.width(),l=.55*u,_=a._video_preview_failed,"hls"===i?a.player=re.embed("#video",{src:n,type:"application/vnd.apple.mpegurl",width:u,height:l,controls:!0,poster:r,onError:_,onReady:a._player_ready,metadata_link:o}):(pe("#video").empty(),e?t?a.player=re.embed("#video",{src:n,type:"video/mp4",width:u,height:l,controls:!0,poster:r,onError:_,onReady:a._player_ready,metadata_link:o}):_():a.player=re.embed("#video",{src:n,type:"video/flv",width:u,height:l,controls:!0,poster:r,onError:_,onReady:a._player_ready,metadata_link:o})),pe(".vjs-poster").hide(),pe(".vjs-big-play-button").hide(),a.player.on("play",a._onPlay),a.player.on("ended",a._onEnded)}}(this))},photo_loaded:function(e){var t,n;return(null!=(t=window.performance)&&null!=(n=t.timing)?n.navigationStart:void 0)?(e-=window.performance.timing.navigationStart,$e.log_ajax_transition(e,"file-preview-photo")):void 0},switch_preview:function(e,t,n,i,r){var o,a,_,l,u,d,h,f;return this.iframe_src?(_=INLINE_JS.URI.parse(this.iframe_src),f=INLINE_JS.URI.parse(_.getQuery().file),h=f.updateQuery({revision_id:e}).toString(),a=s.parse(this.iframe_src).updateQuery({file:h}),d={annotationMarkerEnabled:t,annotationHighlightEnabled:t,annotationRegionEnabled:t},o=pe("#pdf-embed-iframe"),o.on("load",n),this.init_pdf("pdf-js",a.toString(),c.DOC_PREVIEW_AVAILABLE,h,this.presentationMode,d)):(u={thumbnailUrl:i,commentActivity:r},l={action:"switch-preview",parameters:u},window.postMessage(JSON.stringify(l),"*"))},_player_ready:function(){var e;return e=function(){return pe(".vjs-poster").show(),pe(".vjs-big-play-button").show(),pe(".vjs-big-play-button").focus()},e.defer()},_onPlay:function(){return pe(".vjs-poster").hide(),pe(".vjs-big-play-button").hide()},_onEnded:function(){return pe(".vjs-poster").show(),pe(".vjs-big-play-button").show(),pe(".vjs-loading-spinner").hide()},_video_preview_failed:function(e){return"needflash"===e&&pe("#video-preview-flash-message").show(),qr.preview_failed()},preview_failed:function(){var e;return e=pe(document.body),e.hasClass("shmodel-body")&&e.removeClass("file-preview-body"),b.error(At("Preview failed.")),pe(document).trigger("preview_failed")},_fire_pdf_render_event:function(){var e;return document.createEvent&&window.dispatchEvent?(e=document.createEvent("UIEvents"),e.initUIEvent("pagerender",!1,!1,window,0),window.dispatchEvent(e)):void 0},_log_pdf_render_time:function(e){var t;return t=function(e){var t,n,i;return(null!=(t=window.performance)&&null!=(n=t.timing)?n.navigationStart:void 0)?(i=ie.time()-window.performance.timing.navigationStart,$e.log_ajax_transition(i,e)):void 0},Event.observe(window,"pagerender",function(){return Event.stopObserving(window,"pagerender"),t(e)}),Event.observe(window,"parsecomplete",function(){return Event.stopObserving(window,"parsecomplete"),t(e+"-parse")})},_preview_listener:function(e){var t,n,i,r,o;if(n={"https://dl.dropbox.com":!0},n["https://"+he.DL_DOC_DOMAIN]=!0,n["https://"+he.DL_DOC_USER_CONTENT_DOMAIN]=!0,n["https://"+he.PUBSERVER]=!0,n["https://"+he.WEB_STATIC_DROPBOX_HOST]=!0,n["https://"+he.WEB_STATIC_CDN_HOST]=!0,n[e.origin]){i={};try{i=JSON.parse(e.data),t=i.action}catch(n){r=n,t=e.data}switch(t){case"pagerendered":if(!this._has_marked_time_to_interactive)return this._has_marked_time_to_interactive=!0,$e.mark_time_to_view(),$e.mark_time_to_interactive();break;case"failed":return this._has_marked_time_to_interactive||(this._has_marked_time_to_interactive=!0,$e.mark_time_to_view(),$e.mark_time_to_interactive()),qr.preview_failed()}}}};var Mr,Pr;Pr=Xe.ShmodelLogger={CLICK_SIGN_IN:"click_sign_in",CLICK_ADD_TO_MY_DROPBOX:"click_add_to_my_dropbox",REMOVE_LINK:"remove_link",CLICK_FILENAME:"click_filename",CLICK_DOWNLOAD:"click_download",LOGIN_THRU_DEFAULT_DROPDOWN:"login_thru_default_dropdown",CLICK_SIGNUP_THRU_DEFAULT_DROPDOWN:"click_signup_thru_default_dropdown",CLICK_SHARE:"click_share",log:function(e){return new Ajax.DBRequest("/shmlog",{method:"post",noAutonotify:!0,parameters:{evt:e,url:window.location.href}})},attachLogListener:function(e,t){return null!=t?t.observe("click",function(n){return Pr.log(e),t.href&&"#"!==t.href&&"_blank"!==t.target?(Event.stop(n),function(){return window.location.href=t.href}.defer()):void 0}):void 0}},Mr=Xe.RegistrationLogger={log:function(e){var t;return t=window.location.href,new Ajax.DBRequest("/share/reglog",{
method:"post",noAutonotify:!0,parameters:{evt:e,url:t}})},attachLogListener:function(e,t){return null!=t?t.observe("click",function(n){return Mr.log(e),t.href&&"#"!==t.href&&"_blank"!==t.target?(Event.stop(n),function(){return window.location.href=t.href}.defer()):void 0}):void 0}};var Fr;Fr=Xe.ModalFlow=function(){function e(e,t,n,i,r,o,s){var a,_,l,u;for(this.title=e,this.icon=t,this.states=n,this.next_state_table=i,this.previous_state_table=r,this.initial=o,this.onStart=s,this._state_map={},l=this.states,a=0,_=l.length;_>a;a++)u=l[a],this._state_map[u.name]=u;this.state=null,this._exit_listeners=[],this._cleanup_queue=[]}return e.prototype.start=function(){var e,t,n,i;for(this.vars={},n=this.states,e=0,t=n.length;t>e;e++)i=n[e],i.next=this._next.bind(this,i),i.back=this._back.bind(this,i),i.onSubmit?i.onSubmitFn=function(e,t){return e.onSubmit(this,e,t),!1}.bind(this,i):i.onSubmitFn=function(e){return function(e,t){return e.next(),!1}}(this).bind(this,i),i.contents.on("submit",i.onSubmitFn),i.contents.find(".backbutton").on("click",i.back);return Xn.onHide=this._onExit.bind(this),this.onStart&&this.onStart(),this.to_state(this.initial),!1},e.prototype.to_state=function(e){var t;return this.state=this._state_map[e],t=this.title,null!=this.state.title&&(t=this.state.title),Xn.show(t,this.state.contents[0]),this.state.enter(this)},e.prototype._next=function(e){var t;return e===this.state?(t=this.next_state_table[this.state.name](this),"__exit__"===t?this.exit():this.to_state(t)):void 0},e.prototype._back=function(e){var t;if(e===this.state){if(t=this.previous_state_table[this.state.name](this),"__cancel__"===t)return this.exit();if(t)return this.to_state(t)}},e.prototype.exit=function(){return this._onExit()},e.prototype._onExit=function(e){var t,n,i,r,o,s,a,_;for(s=this.states,t=0,i=s.length;i>t;t++)_=s[t],_.contents.off("submit",_.onSubmitFn);for(this._cleanUpExitListeners(),a=this._exit_listeners,n=0,r=a.length;r>n;n++)(o=a[n])(e);return Xn.onHide=null,Xn.hide()},e.prototype.addExitListener=function(e){return this._exit_listeners.push(e)},e.prototype.removeExitListener=function(e){return this._cleanup_queue.push(e)},e.prototype._cleanUpExitListeners=function(){var e,t,n,i,r,o;for(r=this._cleanup_queue,o=[],t=0,i=r.length;i>t;t++)e=r[t],n=this._exit_listeners.indexOf(e),o.push(this._exit_listeners.splice(n,1));return o},e}();var Ur;Ur=Xe.TwoFactorAuth={_checkpoint_token:null,_email:null,_container_selector:null,_error_selector:null,_is_offline_setup:null,_invalid_code_count:null,_current_flow:null,set_user:function(e){return this._user=H.get_viewer().get_user_by_id(e),bt(this._user,e+" is invalid"),pe("#twofactor-enter-password .email-placeholder").text(this._user.email)},login_init:function(){return this._container_selector="#twofactor-confirm",this._error_selector="#twofactor-confirm .error-message",this.login_listen()},login_listen:function(){return pe("#resend-link").on("click",this.resend_phone_code.bind(this)),pe("#code").focus()},init:function(e,t){return this._container_selector=".twofactor-account-form",this._error_selector=".twofactor-account-form .error-message",this.account_listen(),Rt.async_load_script(e),Rt.async_load_script(t)},account_listen:function(){var e,t,n,i,r,o,s,a,_,l,u,d,c,h,f,p;return n={name:"delivery_choice",enter:function(e){return function(t){var n;return e.hide_error(),n=0,pe(".delivery-choice").each(function(){var e;return e=pe(this).height(),n=Math.max(e,n)}),pe(".delivery-choice").height(n),pe(".delivery-choice.selected > input").prop("checked",!0)}}(this),contents:pe("#twofactor-delivery-choice"),onSubmit:function(e){return function(t,n,i){return t.vars.sms=!("on"!==pe("#use-sms")[0].getValue()),t.vars.sms?n.next():e.fetch_offline_key(t,n)}}(this)},i={name:"enter_phone_number",enter:function(e){return function(t){var n,i;return e.hide_error(),e._is_offline_setup=!1,e._phone_number=null,n=$("twofactor-enter-phone"),i=e.fill_phone_number_for_edit(n,pe("#twofactor-row-"+e._user.role+" #twofactor-sms-number").text()),i.focus()}}(this),contents:pe("#twofactor-enter-phone"),onSubmit:this.submit_phone_number.bind(this)},r={name:"offline_setup",enter:function(e){return function(t){return e.hide_error(),e._is_offline_setup=!0,e._phone_number=null}}(this),contents:pe("#twofactor-offline-setup")},t={name:"confirm_phone",enter:function(e){return function(t){var n;return e._invalid_code_count=0,e._is_offline_setup?$("twofactor-enable-confirm").addClassName("offline"):(n=t.vars.phone_number,bt(n,"expected a display_phone argument"),$("phone-number-placeholder").__date(n),$("twofactor-enable-confirm").removeClassName("offline")),e.hide_error(),$("phone-code").clear().focus(),e.fill_delivery_choice(n)}}(this),onSubmit:this.submit_phone_code.bind(this),contents:pe("#twofactor-enable-confirm")},e={name:"backup_phone",enter:this.enter_backup_phone_number_shown.bind(this,"back_next"),onSubmit:this.submit_backup_phone_number.bind(this,!1,"save_none"),contents:pe("#twofactor-enter-backup-phone")},d=new Fr(this.DEFAULT_ENABLE_TITLE,this.LOCK_ICON,[{name:"enable_start",enter:this.hide_error.bind(this),contents:pe("#twofactor-start")},{name:"password",enter:this.enter_password_shown.bind(this),onSubmit:this.submit_password.bind(this,this.ENABLE_CONFIRM_HREF,function(e){return function(t,n){return e.successfully_enabled=!1,t.vars.mode="ENABLE",t.vars.passed_password=!0,n.next()}}(this)),contents:pe("#twofactor-enter-password")},n,i,r,t,e,{name:"recovery_code",enter:function(e){return function(){return e.fill_backup_phone(e._backup_phone),e.hide_error.bind(e)}}(this),onSubmit:this.submit_finish.bind(this,!1),contents:pe("#twofactor-recovery")},{name:"congrats_done",enter:this.after_enabled.bind(this),title:At("Congrats! You've enabled two-step verification!"),contents:pe("#twofactor-done")}],{enable_start:function(){return"password"},password:function(){return"delivery_choice"},delivery_choice:function(e){return e.vars.sms?"enter_phone_number":"offline_setup"},enter_phone_number:function(){return"confirm_phone"},confirm_phone:function(){return"backup_phone"},backup_phone:function(){return"recovery_code"},recovery_code:function(){return"congrats_done"},congrats_done:function(){return"__exit__"},offline_setup:function(){return"confirm_phone"}},{enable_start:function(){return null},password:function(){return null},delivery_choice:function(){return null},enter_phone_number:function(){return"delivery_choice"},offline_setup:function(){return"delivery_choice"},confirm_phone:function(e){return e.vars.sms?"enter_phone_number":"offline_setup"},backup_phone:function(){return"delivery_choice"},recovery_code:function(){return"backup_phone"},congrats_done:function(){return null}},"enable_start",function(){return this.vars.passed_password=!1}),d.addExitListener(function(e){return function(t){return d.vars.passed_password&&t&&!e.successfully_enabled?b.error(At("Two-step verification isn’t enabled")):void 0}}(this)),u=new Fr(this.DEFAULT_EDIT_TITLE,this.LOCK_ICON,[{name:"password",enter:this.enter_password_shown.bind(this),onSubmit:this.submit_password.bind(this,this.EDIT_CONFIRM_HREF,function(e){return function(t,n){var i;return e.successfully_enabled=!1,pe(".delivery-choice").removeClass("selected"),i=!pe("#twofactor-row").hasClass("with-sms"),pe(i?"#app-choice":"#sms-choice").addClass("selected"),pe("#twofactor-recovery").addClass("edit-mode"),t.vars.passed_password=!0,n.next()}}(this)),contents:pe("#twofactor-enter-password")},n,i,r,t,{name:"backup_phone",enter:this.enter_backup_phone_number_shown.bind(this,"back_next"),onSubmit:this.submit_backup_phone_number.bind(this,!1,"save_everything"),contents:pe("#twofactor-enter-backup-phone")}],{password:function(){return"delivery_choice"},delivery_choice:function(e){return e.vars.sms?"enter_phone_number":"offline_setup"},enter_phone_number:function(){return"confirm_phone"},confirm_phone:function(){return"backup_phone"},backup_phone:function(){return"__exit__"},offline_setup:function(){return"confirm_phone"}},{password:function(){return null},delivery_choice:function(){return null},enter_phone_number:function(){return"delivery_choice"},offline_setup:function(){return"delivery_choice"},confirm_phone:function(e){return e.vars.sms?"enter_phone_number":"offline_setup"},backup_phone:function(){return"delivery_choice"}},"password",function(){return this.vars.passed_password=!1}),u.addExitListener(function(e){return function(t){return u.vars.passed_password&&t&&!e.successfully_enabled?b.error(At("Two-step verification has not been changed")):void 0}}(this)),_=new Fr(this.DEFAULT_DISABLE_TITLE,this.LOCK_ICON,[{name:"password",enter:this.enter_password_shown.bind(this),onSubmit:this.submit_password.bind(this,this.DISABLE_CONFIRM_HREF,function(e){return function(t,n){return e.successfully_disabled=!1,t.vars.passed_password=!0,n.next()}}(this)),contents:pe("#twofactor-enter-password")},{name:"disable",enter:this.hide_error.bind(this),contents:pe("#twofactor-disable"),onSubmit:this.disable_submit.bind(this)}],{password:function(){return"disable"},disable:function(){return"__exit__"}},{password:function(){return null},disable:function(){return"__cancel__"}},"password",function(){return this.vars.passed_password=!1}),_.addExitListener(function(e){return function(t){return _.vars.passed_password&&t&&!e.successfully_disabled?b.error(At("Two-step verification is still enabled")):void 0}}(this)),o=new Fr(this.ADD_BACKUP_TITLE,this.LOCK_ICON,[{name:"password",enter:this.enter_password_shown.bind(this),onSubmit:this.submit_password.bind(this,this.EDIT_CONFIRM_HREF,function(e,t){return t.next()}),contents:pe("#twofactor-enter-password")},{name:"backup_phone",enter:this.enter_backup_phone_number_shown.bind(this,"cancel_save"),onSubmit:this.submit_backup_phone_number.bind(this,!0,"save_backup_phone"),contents:pe("#twofactor-enter-backup-phone")}],{password:function(){return"backup_phone"},backup_phone:function(){return"__exit__"}},{password:function(){return null},backup_phone:function(){return"__cancel__"}},"password"),l=new Fr(this.EDIT_BACKUP_TITLE,this.LOCK_ICON,[{name:"password",enter:this.enter_password_shown.bind(this),onSubmit:this.submit_password.bind(this,this.EDIT_CONFIRM_HREF,function(e,t){return t.next()}),contents:pe("#twofactor-enter-password")},{name:"backup_phone",enter:this.enter_backup_phone_number_shown.bind(this,"cancel_save"),onSubmit:this.submit_backup_phone_number.bind(this,!1,"save_backup_phone"),contents:pe("#twofactor-enter-backup-phone")}],{password:function(){return"backup_phone"},backup_phone:function(){return"__exit__"}},{password:function(){return null},backup_phone:function(){return"__cancel__"}},"password"),h=new Fr(this.EDIT_RECOVERY_TITLE,this.LOCK_ICON,[{name:"password",enter:this.enter_password_shown.bind(this),onSubmit:this.submit_password.bind(this,this.EDIT_CONFIRM_HREF,function(e){return function(t,n){return new Ajax.DBRequest(e.RECOVERY_CODE_HREF,{parameters:{checkpoint_token:e._checkpoint_token,use_json:!0},onSuccess:function(t){var i,r;if(r=JSON.parse(t.responseText.trim()),"OK"===r.result)return i=r.codes,e.fill_backup_codes(i,"backup-code-list-edit-container"),n.next();switch(r.result){case"EXPIRED":return e.show_error_expired();case"ALREADY_DISABLED":return pe("#twofactor-row").removeClass("twofactor-enabled"),b.success(At("Two-step verification is already disabled. Did you maybe disable it in another window?")),Xn.hide()}},onFailure:e.show_error500.bind(e),cleanUp:e.hide_loading.bind(e),subject_user:e._user})}}(this)),contents:pe("#twofactor-enter-password")},{name:"recovery_code",enter:this.hide_error.bind(this),contents:pe("#twofactor-recovery-edit"),onSubmit:function(e){return function(t,n){return e._checkpoint_token=null,n.next()}}(this)}],{password:function(){return"recovery_code"},recovery_code:function(){return"__exit__"}},{password:function(){return null},recovery_code:function(){return null}},"password"),p=function(e){return function(t){return new Ajax.DBRequest(e.ADD_SECURITY_KEY_FINISH_HREF,{parameters:{checkpoint_token:e._checkpoint_token,device_response:JSON.stringify(t)},noAutonotify:!0,onSuccess:function(t){var n;return n=t.responseText.trim(),s.to_state("register_success"),pe(document).trigger("security-key-manager:UPDATE_KEYS",e._user.id)},onFailure:function(e){var t,n;return t=JSON.parse(e.responseText.substr(4)),n=null!=t.security_key_register?t.security_key_register.message_text:b.DEFAULT_ERROR,pe("#twofactor-security-key-register-error #error-msg").text(n),s.to_state("register_error")},cleanUp:e.hide_loading.bind(e),subject_user:e._user})}}(this),c=function(e){return function(t,n){return new Ajax.DBRequest(e.ADD_SECURITY_KEY_START_HREF,{parameters:{checkpoint_token:e._checkpoint_token},onSuccess:function(e){var t;return t=JSON.parse(e.responseText),u2f.register(t.registerRequests,t.authenticateRequests,p),n.next()},onFailure:e.show_error500.bind(e),cleanUp:e.hide_loading.bind(e),subject_user:e._user})}}(this),f=new Fr(this.ADD_SECURITY_KEY_TITLE,this.LOCK_ICON,[{name:"unsupported_browser",enter:this.hide_error.bind(this),contents:pe("#twofactor-security-key-unsupported-browser")}],{unsupported_browser:function(){return"__exit__"}},{},"unsupported_browser"),a=new Fr("Confirm password",this.LOCK_ICON,[{name:"password",enter:this.enter_password_shown.bind(this),onSubmit:this.submit_password.bind(this,this.EDIT_CONFIRM_HREF,function(e){return function(t,n){return pe(document).trigger("security-key-modal:PASSWORD_CONFIRMED",[e._user.id,e._checkpoint_token]),Xn.hide()}}(this)),contents:pe("#twofactor-enter-password")}],{password:function(){return"__exit__"}},{},"password"),s=new Fr(this.ADD_SECURITY_KEY_TITLE,this.LOCK_ICON,[{name:"password",enter:this.enter_password_shown.bind(this),onSubmit:this.submit_password.bind(this,this.EDIT_CONFIRM_HREF,function(e,t){return t.next()}),contents:pe("#twofactor-enter-password")},{name:"intro",enter:this.hide_error.bind(this),contents:pe("#twofactor-security-key-intro")},{name:"prepare_register",enter:this.hide_error.bind(this),contents:pe("#twofactor-security-key-prepare-register"),onSubmit:c},{name:"register",enter:this.hide_error.bind(this),contents:pe("#twofactor-security-key-register")},{name:"register_error",enter:this.hide_error.bind(this),contents:pe("#twofactor-security-key-register-error"),onSubmit:c},{name:"register_success",enter:function(e){return function(){return e.hide_error.bind(e),e._checkpoint_token=null}}(this),onSubmit:function(e,t){return b.success(At("Successfully added security key.")),t.next()},contents:pe("#twofactor-security-key-register-success")}],{password:function(){return"intro"},intro:function(){return"prepare_register"},prepare_register:function(){return"register"},register:function(){return"register_success"},register_error:function(){return"register"},register_success:function(){return"__exit__"}},{},"password"),this._bind_phone_input_to_save_button(),this._register_skip_link_click_to_submit_finish(),pe(".enable-twofactor").on("click",function(e){return function(t){return e.start_flow(t,d)}}(this)),pe(".disable-twofactor").on("click",function(e){return function(t){return e.start_flow(t,_)}}(this)),pe(".add-twofactor-backup-link").on("click",function(e){return function(t){return e.start_flow(t,o)}}(this)),pe(".edit-twofactor-backup").on("click",function(e){return function(t){return e.start_flow(t,l)}}(this)),pe(".edit-twofactor-recovery").on("click",function(e){return function(t){return e.start_flow(t,h)}}(this)),pe(".edit-twofactor-sms, .edit-twofactor-offline").on("click",function(e){return function(t){return e.start_flow(t,u)}}(this)),pe(document).on("twofactor:ADD_SECURITY_KEY",function(e){return function(t,n){return pe("#twofactor-security-key-unsupported-browser").length?e.start_flow(t,f,n):e.start_flow(t,s,n)}}(this)),pe(document).on("twofactor:ASK_PASSWORD_CONFIRM",function(e){return function(t,n){return e.start_flow(t,a,n)}}(this)),pe("#generate-new-recovery-code").on("click",function(e){return function(t){return e.show_loading(),new Ajax.DBRequest(e.NEW_RECOVERY_CODE_HREF,{parameters:{checkpoint_token:e._checkpoint_token,use_json:!0},onSuccess:function(t){var n,i;if(n=t.responseText.trim(),i=JSON.parse(n),"OK"===i.result)return e.fill_backup_codes(i.codes,"backup-code-list-edit-container");switch(n){case"EXPIRED":return h.to_state("password"),e.show_error_expired();case"ALREADY_DISABLED":return $("twofactor-row").removeClassName("twofactor-enabled"),b.success(At("Two-step verification is disabled. Did you maybe disable it in another window?")),Xn.hide()}},onFailure:e.show_error500.bind(e),cleanUp:e.hide_loading.bind(e),subject_user:e._user})}}(this)),pe("#twofactor-enter-backup-phone #country-code").on("change",this.reset_phone_field.bind(this)),pe("#resend-link").on("click",this.enable_resend_phone_code.bind(this)),pe("#twofactor-delivery-choice input").change(function(){return pe(".delivery-choice").removeClass("selected"),pe(this).parents(".delivery-choice").addClass("selected")}),pe("#show-qr").on("click",function(e){return pe("#twofactor-offline-setup").addClass("showing-qr"),!1}),pe("#hide-qr").on("click",function(e){return pe("#twofactor-offline-setup").removeClass("showing-qr"),!1}),"#backup2fa"===window.location.hash&&pe("#twofactor-row").hasClass("allow-autopop")?this.start_flow(o):void 0},_bind_phone_input_to_save_button:function(){return this.$save_button=pe("#twofactor-enter-backup-phone").find(".back-next").find(".savebutton"),this.$phone_input=pe("#twofactor-enter-backup-phone").find(".twofactor-backup-phone-number").find(".phone-text"),this.$phone_input.on("keyup",function(e){return function(t){return e._toggle_save_phone_button(e.$phone_input,e.$save_button)}}(this)),this.$phone_input.on("input",function(e){return function(t){return e._toggle_save_phone_button(e.$phone_input,e.$save_button)}}(this)),this._toggle_save_phone_button(this.$phone_input,this.$save_button)},_register_skip_link_click_to_submit_finish:function(){return pe("#twofactor-enter-backup-phone").find(".back-next").find("#skipstep").on("click",function(e){return function(){return e.submit_finish(!0,e._current_flow,e._current_flow.state,null)}}(this))},_toggle_save_phone_button:function(e,t){var n;return n=""===pe.trim(e.val()),t.prop("disabled",n)},start_flow:function(e,t,n){return null==n&&(n=null),e.preventDefault(),delete this._phone_number,null==n&&(n=pe(e.target).data("uid")),Ur.set_user(H.get_viewer().get_user_by_id(n)),this._current_flow=t,t.start(),!1},connect_login_init:function(){return this._container_selector="#twofactor-form",this._error_selector="#twofactor-form .error",pe("#resend-link").on("click",this.connect_resend_phone_code.bind(this))},resend_phone_code:function(e){var t;if(!this.is_resending())return this.show_resending(),t="/twofactor_resend",pe("#twofactor-confirm").hasClass("backup")&&(t=s.parse(t).updateQuery({backup:!0}).toString()),new Ajax.DBRequest(t,{onSuccess:function(e){return function(t){switch(t.responseText.trim()){case"OK":return e.hide_error(),e.notify_resent();case"UNREACHABLE":return e.show_error_unreachable(!0);case"BADCARRIER":return e.show_error_bad_carrier();case"INVALIDNUMBER":return e.show_error_invalid_number();case"NOTAMOBILE":return e.show_error_not_a_mobile();case"RATELIMIT":return b.error(At("You've asked for too many SMS messages. Please try again in a few minutes."));case"EXPIRED":return $("twofactor-confirm").submit()}}}(this),onFailure:this.show_error500.bind(this),cleanUp:this.hide_resending_with_delay.bind(this)}),!1},connect_resend_phone_code:function(e){return this.is_resending()?void 0:(this.show_resending(),new Ajax.DBRequest("/twofactor_resend",{onSuccess:function(e){return function(t){switch(t.responseText.trim()){case"OK":return e.hide_error(),e.notify_resent();case"UNREACHABLE":return b.error(e.error_unreachable(!0));case"BADCARRIER":return b.error(e.error_bad_carrier());case"INVALIDNUMBER":return e.show_error_invalid_number();case"NOTAMOBILE":return b.error(e.error_not_a_mobile());case"RATELIMIT":return b.error(At("You've asked for too many SMS messages. Please try again in a few minutes."));case"EXPIRED":return $("twofactor-form").submit()}}}(this),onFailure:function(e){return function(t){return b.error(e.error500())}}(this),cleanUp:this.hide_resending_with_delay.bind(this)}),!1)},enable_resend_phone_code:function(e){return this.is_resending()?void 0:(this.show_resending(),new Ajax.DBRequest("/twofactor_resend",{onSuccess:function(e){return function(t){switch(t.responseText.trim()){case"OK":return e.hide_error(),e.notify_resent();case"UNREACHABLE":return e.show_error_unreachable();case"BADCARRIER":return e.show_error_bad_carrier();case"INVALIDNUMBER":return e.show_error_invalid_number();case"NOTAMOBILE":return e.show_error_not_a_mobile();case"RATELIMIT":return b.error("You've asked for too many SMS messages. Please try again in a few minutes.");case"EXPIRED":return e._current_flow.to_state("password"),e.show_error_expired()}}}(this),onFailure:this.show_error500.bind(this),cleanUp:this.hide_resending_with_delay.bind(this)}),!1)},DEFAULT_ENABLE_TITLE:At("Enable two-step verification"),DEFAULT_EDIT_TITLE:At("Edit two-step verification"),DEFAULT_DISABLE_TITLE:At("Disable two-step verification"),ADD_BACKUP_TITLE:At("Add a backup phone number"),EDIT_BACKUP_TITLE:At("Edit backup phone number"),EDIT_RECOVERY_TITLE:At("View backup codes"),ADD_SECURITY_KEY_TITLE:At("Add security key"),LOCK_ICON:"lock32",ENABLE_CONFIRM_HREF:"/account/twofactor/confirm_password",DISABLE_CONFIRM_HREF:"/account/twofactor/disable_confirm_password",EDIT_CONFIRM_HREF:"/account/twofactor/edit_confirm_password",ADD_SECURITY_KEY_START_HREF:"/account/twofactor/u2f_start_registration",ADD_SECURITY_KEY_FINISH_HREF:"/account/twofactor/u2f_finish_registration",RECOVERY_CODE_HREF:"/account/twofactor/get_rescue_code",NEW_RECOVERY_CODE_HREF:"/account/twofactor/new_rescue_code",enter_password_shown:function(){var e;return this.hide_error(),pe("#twofactor-recovery").removeClass("edit-mode"),e=$("twofactor-enter-password"),pe("#password",e).val("").focus(),!1},submit_password:function(e,t,n,i,r){var o;return(o=$("password").getValue())?(this.show_loading(),new Ajax.DBRequest(e,{parameters:{password:o},onSuccess:function(e){return function(r){var o;if(o=r.responseText.trim(),o.startsWith("OK:"))return e._checkpoint_token=o.substr(3),t(n,i);switch(o){case"EXPIRED_PASSWORD":return e.show_error_expired_password();case"INVALID":return e.show_error(At("Invalid password"));case"RATELIMIT":return e.show_error(At("Too many incorrect passwords. Please try again in a few minutes."));case"ALREADY_ENABLED":return $("twofactor-row").addClassName("twofactor-enabled"),b.success(At("Two-step verification is already enabled. Did you maybe enable it in another window?")),Xn.hide();case"ALREADY_DISABLED":return $("twofactor-row").removeClassName("twofactor-enabled"),b.success(At("Two-step verification is already disabled. Did you maybe disable it in another window?")),Xn.hide()}}}(this),onFailure:this.show_error500.bind(this),cleanUp:this.hide_loading.bind(this),subject_user:this._user})):void this.show_error(At("Please enter your password"))},fetch_offline_key:function(e,t){return this.show_loading(),new Ajax.DBRequest("/account/twofactor/add_phone",{parameters:{checkpoint_token:this._checkpoint_token,offline:!0},onSuccess:function(n){return function(i){var r;if(r=i.responseText.trim(),r.startsWith("OK:"))return n.fill_key(r.substr(3)),t.next();switch(r){case"EXPIRED":return e.to_state("password"),n.show_error_expired()}}}(this),onFailure:this.show_error500.bind(this),cleanUp:this.hide_loading.bind(this),subject_user:this._user})},fill_key:function(e){var t,n,i;return e=e.replace(new RegExp("=+$"),""),t=e.toLowerCase().replace(/(.{4})/g,"$1 "),$("secret-div").__date(t),$("qr-div").__date(),i=he.IS_PROD?"Dropbox":"DropboxDev",n={text:"otpauth://totp/"+i+":"+this._user.email+"?secret="+e+"&issuer="+i,width:200,height:200},we.canvas||(n.render="table"),pe("#qr-div").qrcode(n),we.canvas?void 0:pe("#qr-div > table").css("margin","0 auto")},submit_phone_number:function(e,t,n){var i,r;return i=pe("#twofactor-enter-phone .twofactor-phone-number"),Y.get_controller(i).validate_on_submit()?(r=i.val(),this.show_loading(),new Ajax.DBRequest("/account/twofactor/add_phone",{parameters:{checkpoint_token:this._checkpoint_token,phone_number:r},onSuccess:function(n){return function(o){switch(o.responseText.trim()){case"OK":return n._phone_number=r,e.vars.phone_number=r,t.next();case"EXPIRED":return e.to_state("password"),n.show_error_expired();case"UNREACHABLE":return n.show_error_unreachable(i);case"BADCARRIER":return n.show_error_bad_carrier(i);case"INVALIDNUMBER":return n.show_error_invalid_number(i);case"NOTAMOBILE":return n.show_error_not_a_mobile(i);case"RATELIMIT":return n.show_error(At("You've added too many phone numbers. Please try again in a few minutes."))}}}(this),onFailure:this.show_error500.bind(this),cleanUp:this.hide_loading.bind(this),subject_user:this._user})):void 0},submit_phone_code:function(e,t,n){var i;return(i=$("phone-code").getValue().trim())?-1===i.search(/^\d{6}$/)?void this.show_error(At("Invalid security code")):(this.show_loading(),new Ajax.DBRequest("/account/twofactor/confirm_phone",{parameters:{checkpoint_token:this._checkpoint_token,twofactor_code:i,use_json:!0},onSuccess:function(n){return function(i){var r,o;if(o=JSON.parse(i.responseText.trim()),"OK"===o.result)return n.fill_backup_codes(o.codes,"backup-code-list-container"),t.next();switch(o.result){case"INVALID":return n._invalid_code_count+=1,r=At(n._invalid_code_count<=2?"Invalid code":n._is_offline_setup?"Invalid code. Check the clock on your phone: it must be accurate to the minute.":"Invalid code"),n.show_error(r);case"EXPIRED":return e.to_state("password"),n.show_error_expired();case"RATELIMIT":return n.show_error(At("Too many invalid codes. Try again in a few minutes."))}}}(this),onFailure:this.show_error500.bind(this),cleanUp:this.hide_loading.bind(this),subject_user:this._user})):void this.show_error(At("Please enter the security code"))},enter_backup_phone_number_shown:function(e,t){var n,i;return this.hide_error(),n=$("twofactor-enter-backup-phone"),i=this.fill_phone_number_for_edit(n,pe("#twofactor-row-"+this._user.role+" #twofactor-backup-number").text()),i.focus(),"back_next"===e?(pe("#twofactor-backup-back-next").show(),pe("#twofactor-backup-cancel-save").hide(),pe("#twofactor-backup-back-save").hide()):"cancel_save"===e?(pe("#twofactor-backup-back-next").hide(),pe("#twofactor-backup-cancel-save").show(),pe("#twofactor-backup-back-save").hide()):"back_save"===e?(pe("#twofactor-backup-back-next").hide(),pe("#twofactor-backup-cancel-save").hide(),pe("#twofactor-backup-back-save").show()):void 0},submit_backup_phone_number:function(e,t,n,i,r){var o,s;if(o=pe("#twofactor-enter-backup-phone .twofactor-backup-phone-number"),Y.get_controller(o).validate_on_blur()){if(s=o.val()){if(this.is_primary_number(s))return void Y.get_controller(o).show_error(At("You can’t use your primary phone as your backup"),o)}else if(e)return void Y.get_controller(o).show_error(At("Please enter phone number"),o);if(this._backup_phone=s,"save_backup_phone"===t)this.save_added_backup_phone(n,e,s);else if("save_everything"===t)this.submit_finish(!1,n,i,r);else if("save_none"===t)return i.next()}},is_same_phone_number:function(e,t){return e&&t?e.replace(/\D+/g,"")===t.replace(/\D+/g,""):!1},is_primary_number:function(e){var t;return t=pe("#twofactor-row-"+this._user.role),this._is_offline_setup?!1:this._phone_number?this.is_same_phone_number(e,this._phone_number):this.is_same_phone_number(e,t.data("primary_phone"))?!0:!!this.is_same_phone_number(e,pe("#twofactor-sms-number",t).text())},save_added_backup_phone:function(e,t,n){return this.show_loading(),new Ajax.DBRequest("/account/twofactor/set_backup_phone",{parameters:{checkpoint_token:this._checkpoint_token,backup_phone_number:n},onSuccess:function(i){return function(r){var o;switch(r.responseText.trim()){case"OK":return i.hide_error(),o="#twofactor-row-"+i._user.role,pe(o+" #twofactor-backup-number").text(n),pe(o).toggleClass("with-backup",!!n),n?t?b.success(At("Backup phone number added")):b.success(At("Backup phone number updated")):b.success(At("Backup phone number removed")),Xn.hide();case"EXPIRED":return e.to_state("password"),i.show_error_expired()}}}(this),onFailure:this.show_error500.bind(this),cleanUp:this.hide_loading.bind(this),subject_user:this._user})},fill_phone_number_for_edit:function(e,t){var n,i;return i=pe("input.text-input-input",e),t?(n=Y.get_controller(pe(".phone-number-input",e)),n.set(t),i.val(n.get_local_number()),i.length&&i[0].select(),pe("#twofactor-backup-back-save").find("#skipstep").hide(),pe(".text-input-wrapper").find("label").hide(),i):i.val("")},fill_delivery_choice:function(e){return pe("#twofactor-delivery-phone-label,#confirm-phone-primary").toggle(!!e),pe("#twofactor-delivery-offline-label").toggle(!e),pe("#confirm-phone-primary-number").text(e),pe("#twofactor-row-"+this._user.role).data("primary_phone",e)},fill_backup_phone:function(e){return pe("#confirm-phone-backup").toggle(!!e),pe("#confirm-phone-backup-number").text(e)},insert_spaces_into_code:function(e){return e.toLowerCase().replace(/(.{4})/g,"$1 ")},fill_backup_codes:function(e,t){var n,i,r,o,s,a,_;if(i=pe("#"+t),i.empty(),n=pe("<ol/>",{class:"twofactor-backup-list"}),0===e.length)return i.siblings().css("display","none"),pe(".codesbox__error").css("display","block");for(o=e[0].length,16===o&&n.css("column-count","1"),s=0,a=e.length;a>s;s++)r=e[s],_=pe("<li/>",{class:"twofactor-backup-list__item"}),n.append(_.append(pe("<span/>",{class:"twofactor-backup-list__code",text:this.insert_spaces_into_code(r)})));return i.append(n),i.siblings().css("display","block"),pe(".codesbox__error").css("display","none")},submit_finish:function(e,t,n,i){var r;return this.show_loading(),r={checkpoint_token:this._checkpoint_token},this._backup_phone&&!e&&(r.backup_phone_number=this._backup_phone),new Ajax.DBRequest("/account/twofactor/enable_finish",{parameters:r,onSuccess:function(e){return function(i){switch(i.responseText.trim()){case"OK":return e.successfully_enabled=!0,"ENABLE"!==t.vars.mode?e.after_enabled(t,n):n.next();case"EXPIRED":return t.to_state("password"),e.show_error_expired()}}}(this),onFailure:this.show_error500.bind(this),cleanUp:this.hide_loading.bind(this),subject_user:this._user})},after_enabled:function(e,t){var n,i;return this._checkpoint_token=null,this.hide_error(),n=pe("#twofactor-row-"+this._user.role),n.toggleClass("with-sms",!!this._phone_number),pe("#twofactor-sms-number",n).text(this._phone_number||""),n.toggleClass("with-backup",!!this._backup_phone),pe("#twofactor-backup-number",n).text(this._backup_phone||""),n.addClass("twofactor-enabled"),pe("tr[id^='session_row_']").slice(1).hide(),"ENABLE"!==e.vars.mode?(i="/account/#security",b.success(new Ke(At('Two-step verification updated. Any <a href="%(path)s">existing sessions, devices and apps</a> can still access your Dropbox.').format({path:i}))),null!=t?t.next():void 0):void 0},disable_submit:function(e,t){return this.show_loading(),new Ajax.DBRequest("/account/twofactor/disable",{parameters:{checkpoint_token:this._checkpoint_token},onSuccess:function(n){return function(i){var r;switch(i.responseText.trim()){case"OK":return n.successfully_disabled=!0,n._checkpoint_token=null,r=pe("#twofactor-row-"+n._user.role),r.removeClass("twofactor-enabled with-sms with-backup"),pe(document).trigger("security-key-manager:UPDATE_KEYS",n._user.id),pe("#twofactor-sms-number, #twofactor-backup-number",r).text(""),pe("tr[id^='session_row_']").slice(1).hide(),b.success(At("Two-step verification is now disabled.")),t.next();case"EXPIRED":return e.to_state("password"),n.show_error_expired()}}}(this),onFailure:this.show_error500.bind(this),cleanUp:this.hide_loading.bind(this),subject_user:this._user})},show_error:function(e,t){var n;return t?void Y.get_controller(t).show_error(e):(n=$$(this._error_selector),
e===this.error_expired_password()||e===this.error_unreachable(!0)?n.invoke("update",e):n.invoke("__date",e),n.invoke("show"))},show_error500:function(){return this.show_error(this.error_500())},show_error_bad_carrier:function(e){return this.show_error(this.error_bad_carrier(),e)},show_error_invalid_number:function(e){return this.show_error(this.error_invalid_number(),e)},show_error_not_a_mobile:function(e){return this.show_error(this.error_not_a_mobile(),e)},show_error_unreachable:function(e,t){return null==t&&(t=!1),this.show_error(this.error_unreachable(t),e)},show_error_expired:function(e){return this.show_error(this.error_expired(),e)},show_error_expired_password:function(e){return this.show_error(this.error_expired_password(),e)},error_500:function(){return At("Sorry, an error occurred. Please try again later.")},error_bad_carrier:function(){return At("Unfortunately, your carrier isn’t supported at this time.")},error_invalid_number:function(){return At("That isn’t a valid phone number.")},error_not_a_mobile:function(){return At("That phone number doesn’t appear to be a valid mobile number.")},error_unreachable:function(e){return null==e&&(e=!1),At(e?'We couldn\'t reach your phone number. If this has happened before <a href="https://www.dropbox.com/help/364/">click here</a>.':"We couldn't reach your phone number. Are you sure it's correct?")},error_expired:function(){return At("Since it's been a while, please enter your password again.")},error_expired_password:function(){return At('Your password has expired. Please create a new password <a target="_blank" href="/password_expired">here</a>.')},hide_error:function(){return $$(this._error_selector).invoke("__date")},show_loading:function(){return this.hide_error(),$$(this._container_selector).invoke("addClassName","loading")},hide_loading:function(){return $$(this._container_selector).invoke("removeClassName","loading")},is_resending:function(){return $$(this._container_selector)[0].hasClassName("resending")},show_resending:function(){return $$(this._container_selector).invoke("addClassName","resending")},hide_resending:function(){return $$(this._container_selector).invoke("removeClassName","resending")},hide_resending_with_delay:function(){return setTimeout(this.hide_resending.bind(this),3e3)},notify_resent:function(){return b.success(At("We sent you another code. It may take a few minutes to arrive."))},reset_phone_field:function(e){var t,n;return t=e.element(),n=pe(".sick-input",t.form),pe("input",n).val("").focus(),this.fill_example_phone_number(t,n)},fill_example_phone_number:function(e,t){var n,i;return"undefined"!=typeof phone_helpers&&null!==phone_helpers?(n=pe(e).val().substr(1),i=phone_helpers.get_example_mobile_number(n),pe("label",t).text(At("Example: ")+i)):void 0},reset_phone_field_and_backup_country:function(e){var t;return this.reset_phone_field(e),""===pe("#backup-phone-number").val()?(t=pe("#twofactor-enter-backup-phone #country-code"),t.val(e.element().getValue()),this.fill_example_phone_number(t,pe(".sick-input",t[0].form))):void 0}};var jr;jr=__PARENT_SCOPE__.FileViewer=INLINE_JS.FileViewer=Xe.FileViewer={KEY_SCOPE:"fileviewer",_MODAL_FILEINFO:0,_MODAL_PREVIEW:1,MAX_CHECK_LOCK_TRIES:8,_FADE_MSEC:300,file:null,has_preview:!1,preview_locked:!1,preview_lock_listener:null,modal_type:this._MODAL_FILEINFO,is_loaded:!1,has_key_listener:!1,preview_status_timeout_obj:null,preview_status_request:null,hiding:!1,check_lock_request:null,check_lock_timeout:null,file_locked:!1,file_view_target:K.FileViewTargetType.PRIVATE,file_view_origin:K.FileViewOriginType.UNKNOWN,file_view_action:null,_frameMessenger:null,_cached_browser_window_title:null,annotation_enabled_for_this_revision:!0,_preview_flippable_component:null,active_user:null,_pdfLoader:new T,_is_browse_drag_enabled:null,_file_view_attempts:0,_trigger_preview_state_update:function(e){return pe(document).trigger("db:filepreview:previewupdate",[e])},_trigger_openwith_state_update:function(e){return pe(document).trigger("db:filepreview:openwithupdate",[e])},_get_extension:function(e){var t;return t=e.lastIndexOf("."),-1===t?"":e.substr(t+1)},_get_preview_type_from_extension:function(e){var t,n;return t=e.substring(0,3),n="rtf"===t||"odt"===t?"doc":"pps"===t?"ppt":t},_file_view_target_is_private:function(){return this.file_view_target===K.FileViewTargetType.PRIVATE},_file_view_target_is_shared:function(){return this.file_view_target===K.FileViewTargetType.SHARED_LINK||this.file_view_target===K.FileViewTargetType.SHARED_CONTENT_LINK},_shared_link_url:function(){return this._file_view_target_is_shared()?this.file.href:null},show:function(e,t,n,i){return S.FILE_VIEWER_LEGACY_DISABLED&&yt("Unexpected use of legacy FileViewer",{tags:["file-viewer-legacy-usage"],severity:wt.NONCRITICAL}),this._file_view_attempts=0,this._cached_browser_window_title=document.title,this._setup_and_load.apply(this,arguments)},_setup_and_load:function(e,t,n,i){var r,o,s,a,_,l,u;if(null==n&&(n={}),i in K.OriginReferrerTypeToFileViewOriginAndAction?(l=K.OriginReferrerTypeToFileViewOriginAndAction[i],_=l[0],a=l[1]):(u=[null,null],_=u[0],a=u[1]),n=v.defaults(n,{files:[],force_file_unlocked:!0,should_focus_comment_input:!1,hide_comments:!1,hide_restore:!1,file_view_target:K.FileViewTargetType.PRIVATE,file_view_origin:_,file_view_action:a}),null==this._is_browse_drag_enabled&&(this._is_browse_drag_enabled=pe.proxy(function(){return!this.shown()},this)),s=pe("#file-viewer"),this.hiding)s.finish();else{if(this.shown())return this.prev_scope=z.getScope(),void z.setScope(this.KEY_SCOPE);s.hide()}return r=s.find(".file-viewer-comment-container"),n.hide_comments?r.hide():r.show(),o=s.find(".restore-button"),o.length&&(n.hide_restore?o.hide():o.show()),this.file=e,this.active_user=t,this.flippable_files=this._filterFlippableFiles(n.files),this.file_view_target=n.file_view_target,this.file_view_origin=n.file_view_origin,this.file_view_action=n.file_view_action,this.should_focus_comment_input=n.should_focus_comment_input,this.total_files=n.files.length,this._start_time=Date.now(),"download"!==this.file.preview_type?(Oe.scroll_lock_document(),s.css("pointer-events","").fadeIn(this._FADE_MSEC),this.load(this.file,n.force_file_unlocked,i)):void(window.location.href=this.file.href)},_getFilesToPreloadActivities:function(){var e,t,n,i,r,o,s;for(t=[],e=this.currentFlippableFileIndex(),s=[1,2,3,4,5,6,-1,-2],r=0,o=s.length;o>r;r++)n=s[r],i=e+n,i>=0&&i<this.flippable_files.length&&t.push(this.flippable_files[i]);return t},load:function(e,t,n){var i,r,o;return null==t&&(t=!1),this.file=e,document.title=this.file.filename,i=pe("#file-viewer"),"True"===i.data("is-openwith-allowed")&&__CONDITIONAL_JS__.OpenWith.file_supported(this.file)&&(t?this.file_locked=!1:(this.file_locked=!0,this.check_lock())),pe(document.activeElement).blur(),this._render_viewer(),o=this.modal_type===this._MODAL_FILEINFO,r=this._getFilesToPreloadActivities(),pe("#file-viewer").trigger("db:filepreview:open",[this.file,this.file_view_target,this.active_user.id,this.should_focus_comment_input,o,n,r]),pe("#file-viewer").on("db:commenting:init",function(e){return function(){return pe("#file-viewer").trigger("db:filepreview:fileinfo",[e.file,e.file_view_target,e.active_user.id,e.should_focus_comment_input,o,n,r])}}(this))},_filterFlippableFiles:function(e){var t;return function(){var n,i,r;for(r=[],n=0,i=e.length;i>n;n++)t=e[n],gt.isFlippable(t.preview_type)&&r.push(t);return r}()},currentFlippableFileIndex:function(){var e,t,n,i,r;for(r=this.flippable_files,t=n=0,i=r.length;i>n;t=++n)if(e=r[t],this.file.sjid===e.sjid)return t;return-1},cancel_check_lock:function(){return this.file_locked=!1,null!=this.check_lock_request&&(this.check_lock_request.abort(),this.check_lock_request=null),null!=this.check_lock_timeout?(clearTimeout(this.check_lock_timeout),this.check_lock_timeout=null):void 0},check_lock:function(){var e,t,n,i,r,o,s,a;if(null==this.check_lock_request)return this.check_lock_timeout=null,r=0,a=this.active_user.id,s=this.file.fq_path,o=1e3,i=function(t){return function(){return r++,r<t.MAX_CHECK_LOCK_TRIES?(2===r?INLINE_JS.Notify.warning(At("Office Online is saving your file.")):5===r&&INLINE_JS.Notify.warning(At("Office Online is taking longer than expected to save. ",NaN)),t.check_lock_timeout=setTimeout(e,o),o=2*o):(clearTimeout(t.check_lock_timeout),t.check_lock_request=null,t.file_locked=!1,t._render_preview(!0,!0))}}(this),n=function(e){return function(t){return t=JSON.parse(t),(null!=t?t.has_lock:void 0)?i():(e.check_lock_request=null,e.file_locked=!1,e._render_preview(!0,!0))}}(this),t=function(e,t,n){return i()},(e=function(e){return function(){return e.check_lock_request=g.WebRequest({url:"/ow/msft/check_lock",data:{user_id:a,fq_path:s},success:n,error:t})}}(this))()},shown:function(){return"none"!==pe("#file-viewer").css("display")},clear_preview_url_timer:function(){return null!=this.previewUrlTimer?clearTimeout(this.previewUrlTimer):void 0},set_preview_url_w_timeout:function(){return this.clear_preview_url_timer(),this.previewUrlTimer=setTimeout(function(e){return function(){return e.set_preview_url()}}(this),250)},set_preview_url:function(){var e,t,n;return e=s.parse(p.get_url()),t=e.getPath(),n=e.removeQuery("select").updateQuery({preview:this.file.filename}).getQuery(),p.push_state(s.encode_parts(t),n,{immediatelyRestoreState:!1})},unset_preview_url:function(){var e,t,n;return this.clear_preview_url_timer(),e=s.parse(p.get_url()),(this._file_view_target_is_shared()||!e.getPath().match(/^\/s[h]?\/.+/)&&this._file_view_target_is_private())&&"preview"in e.getQuery()?(t=e.getPath(),n=e.removeQuery("select").removeQuery("preview").getQuery(),p.push_state(s.encode_parts(t),n)):void 0},render_file_failed:function(){var e,t;return t=this.file,e=this.active_user,this._teardown_and_hide(),t.doc_preview_status=c.DOC_PREVIEW_UNAVAILABLE_BAD_FILE,this._setup_and_load(t,e,{files:this.flippable_files,force_file_unlocked:!this.file_locked,file_view_target:this.file_view_target,file_view_origin:this.file_view_origin,file_view_action:this.file_view_action,should_focus_comment_input:this.should_focus_comment_input}),pe("#file-viewer").show(),pe("#file-viewer").trigger("preview_failed")},_log_view:function(e,t){var n;return this._file_view_attempts++,n={user_id:this.active_user.id,target:this.file_view_target,platform:K.FileViewPlatformType.WEB,ns_id:this.file.ns_id,sjid:this.file.sjid,ns_path:this.file.ns_path,origin:this.file_view_origin,action:this.file_view_action,shared_link_url:this._shared_link_url(),extra:{file_ext:We.file_extension_for_logging(this.file.filename),file_bytes:this.file.bytes,file_mtime:this.file.ts,preview_type:this.file.preview_type,preview_status:this.file.doc_preview_status,time_taken:e,in_progress:t,is_team:1===this.active_user.is_team,paid:1===this.active_user.paid,file_view_attempts:this._file_view_attempts}},ze.FileViewLogger.log(n)},preload_office_static:function(e){var t,n,i;if(null!=__CONDITIONAL_JS__.OpenWith.PRELOAD_URLS)return n=this._get_extension(e),n in __CONDITIONAL_JS__.OpenWith.PRELOAD_URLS?(t=pe("#file-viewer .open-with-static-content-container"),i=pe("<iframe/>",{src:__CONDITIONAL_JS__.OpenWith.PRELOAD_URLS[n]}),t.html(i)):void 0},unload_office_static:function(){var e;return e=pe("#file-viewer .open-with-static-content-container"),e.empty()},_render_viewer:function(){var e,t,n,i,r,o,a,_,u,d,h,f,p,m,v;return t=pe("#file-viewer"),e=t.find(".download-button"),i=s.parse(this.file.href).updateQuery({dl:1}).toString(),this.preload_office_static(this.file.filename),m=function(n){return function(r){var o,s,a,_,u,d;return null==r&&(r=!0),_=l.em_snippet(n.file.filename,35),o=t.find(".title-bar .filename"),d={class:"icon",alt:n.file.caption},u=G.html("web",n.file.icon,d).toHTML(),s=pe("<span />",{class:"filename-text"}).text(_),o.html(u).append(s),t.addClass("has-preview"),H.get_viewer().is_team_assume_user_session&&t.addClass("room-for-team-assume-user-top-bar"),n.file.htmlified_link?t.addClass("htmlified-preview"):"excel"===n.file.preview_type?(t.addClass("html-preview"),t.find(".loading").css("z-index","-1")):t.addClass(n.file.preview_type+"-preview"),r&&t.find(".loading").show(),e.on("click",function(e){return e.preventDefault(),window.location.href=i}),void 0===n.file.tkey&&jr.active_user.is_email_verified&&null!=n.file.fq_path?(a=function(e){return this.file.tkey=e.tkey,this._update_title_bar_buttons()},g.WebRequest({url:"/sm/get_token",type:"POST",data:{path:n.file.fq_path},dataType:"json",subject_user:n.active_user.id,success:a.bind(n)})):n._update_title_bar_buttons(),n.modal_type=n._MODAL_PREVIEW,n._first_render_completed=!1,n._listen()}}(this),o=function(e){return function(){return t.removeClass(),t.find(".loading").hide(),e._unlisten()}}(this),p=function(e){return function(t,n,i,r,o){var s;return null==t&&(t=!1),null==n&&(n=!0),null==i&&(i=!1),null==r&&(r=!1),null==o&&(o=!0),e._log_view(Date.now()-e._start_time,r),s=e._get_extension(e.file.filename),"doc"!==s&&"docx"!==s&&"odt"!==s&&"ppt"!==s&&"pptx"!==s&&"xls"!==s&&"xlsx"!==s&&"pdf"!==s&&"eps"!==s&&"ai"!==s&&"psd"!==s&&"svg"!==s&&"txt"!==s&&"rtf"!==s&&"pspimage"!==s&&"tif"!==s&&"tiff"!==s&&"yuv"!==s&&"url"!==s&&"webloc"!==s&&"website"!==s&&"wopitest"!==s||e._trigger_preview_state_update({preview_state:"open",file_obj:e.file}),t||(m(n),e._update_title_bar_buttons()),e._render_preview(i,o),e._initial_resize()}}(this),f=function(n){return function(r){var o,s,a,_;return null==r&&(r=!1),o=n.file.filename.indexOf("."),s=n.file.filename.substring(o+1),_="key"===s&&null===n.file.preview_type?"/static/images/icons128/"+We.file_icon("_other")+".png":"/static/images/icons128/"+We.file_icon(n.file.filename)+".png",n._trigger_preview_state_update({preview_state:"closed",file_obj:null}),a=l.em_snippet(n.file.filename,20),t.find(".title-bar .filename").text(a),t.addClass("no-preview"),t.find(".file-thumbnail img").attr({src:_}),t.find(".file-type").text(a),t.find(".file-size").text(n.file.size),t.find(".file-modified").text(n.file.ago||""),e.on("click",function(){return He.unsafeRedirect(i)}),n.modal_type=n._MODAL_FILEINFO,n._listen(),n._log_view(Date.now()-n._start_time,r),n._update_title_bar_buttons(),n._initial_resize()}}(this),r=this._get_extension(this.file.filename),d=("doc"===(h=this.file.preview_type)||"excel"===h||"keynote"===h||"adobecs"===h||"linkfile"===h)&&(this.file.bytes<c.MAX_PDF_FILE_SIZE_B||"pdf"!==We.file_extension(this.file.filename).toLowerCase())&&!He.msie_version_at_most(9),this.has_preview=gt.isFlippable(this.file.preview_type)||"text"===this.file.preview_type&&this.file.bytes<c.MAX_TEXT_FILE_SIZE_B||"html"===this.file.preview_type&&"sandbox"in document.createElement("iframe")||"linkfile"===this.file.preview_type||d&&this.file.doc_preview_status===c.DOC_PREVIEW_AVAILABLE&&!this.file_locked,a=d&&this._preview_progressive_try(r)&&this.file.doc_preview_status!==c.DOC_PREVIEW_UNAVAILABLE_BAD_FILE&&!this.file_locked,this.has_preview||a?p(!1,!("doc"===this.file.preview_type),!1,!1,this.has_preview):(_=this.file_locked||d&&this.file.doc_preview_status===c.DOC_PREVIEW_IN_PROGRESS)?(m(),u=s({path:"/doc_preview_status"+this.file.fq_path}).toString(),v=Date.now(),(n=function(e){return function(){var t;return t=Date.now(),t-v>=5e3?void setTimeout(pe.proxy(e.render_file_failed,e),0):e.preview_status_request=g.AuthenticatedRequest({url:u,type:"GET",success:function(t){return e.file?e.file.doc_preview_status=parseInt(t,10):void 0},complete:function(t,i){return"abort"===i||e.file_locked?void 0:e.file.doc_preview_status===c.DOC_PREVIEW_AVAILABLE?(e.has_preview=!0,p(!0,!1,!0,!0)):e.file.doc_preview_status===c.DOC_PREVIEW_IN_PROGRESS?e.preview_status_timeout_obj=setTimeout(n,1e3):void e.render_file_failed()},timeout:5e3-(t-v),subject_user:e.active_user})}}(this))()):f()},switch_preview:function(e,t,n,i){var r,o,s,a;if((null!=e||null!=t)&&null!=this.file){if(this.annotation_enabled_for_this_revision=n,null!=e&&(this.file.href=e),null!=t&&(this.file.direct_blockserver_link=t),r=pe("#file-viewer .preview-content-container"),"photo"!==this.file.preview_type)return a="",r.html(a),this._render_preview(!1,!0,i);if(null!=(s=this._preview_flippable_component)?s.isMounted():void 0)return this._preview_flippable_component.props["thumbnail-url-tmpl"]===e&&(o=!0),this._preview_flippable_component.setProps({"thumbnail-url-tmpl":e,onLoad:i},function(e){return function(){return o?e._preview_flippable_component.onImageLoad():void 0}}(this))}},_remove_loading:function(e){var t;return null==e&&(e=!0),t=pe("#file-viewer .loading"),t.hide(),t.css("z-index",""),this.is_loaded=e},_render_blank:function(){var e,t;return e=pe("#file-viewer .preview-content-container"),t=_e.createElement(Ye,{icon:this.file.icon,filename:this.file.filename,created:new Date(1e3*this.file.ts),size:this.file.size}),_e.render(t,e.get(0))},_render_linkfile:function(){var e,t;return e=pe("#file-viewer .preview-content-container"),t=_e.createElement(Qe,{filename:this.file.filename,source:"browse","authenticated-data-link":!0}),_e.render(t,e.get(0))},_update_title_bar_buttons:function(){var e,t,n,i,r,o,s,a,_,l,u,d,h,f,p,m,v,g,w,b,y,k,E,x,C;return o=pe("#file-viewer"),r=o.find(".share-button"),this._file_view_target_is_shared()&&r.remove(),e=o.find(".download-button"),t=o.find(".split-button.openwith"),i=null!=t?t.find(".main-button"):void 0,n=null!=t?t.find(".more-button"):void 0,_=At("Open",{comment:"Open a file natively on the user's computer"}),a=function(){return null!=__CONDITIONAL_JS__.UnityFeatures},s=function(e){return function(t){var n,i;return"True"===o.data("is-openwith-allowed")&&(null!=(n=__CONDITIONAL_JS__.OpenWith)?n.get_open_handler_for(t,e.active_user):void 0)&&t.bytes<(null!=(i=__CONDITIONAL_JS__.OpenWith)?i.MAX_SUPPORTED_FILE_SIZE_B:void 0)&&t.doc_preview_status!==c.DOC_PREVIEW_UNAVAILABLE_PROTECTED_DOC}}(this),g=function(e){return function(t){return __CONDITIONAL_JS__.UnityFeatures.open_file(e.file.ns_id,e.file.ns_path,e.file.user_id,__CONDITIONAL_JS__.UnityFeatures.standard_open_file_handler,function(e){return __CONDITIONAL_JS__.UnityFeatures.standard_open_file_handler(!1)},t)}}(this),m=function(){return g(!1)},v=function(){return g(!0)},w=function(e){return function(){var t,n,i;return t=__CONDITIONAL_JS__.OpenWith.get_open_handler_for(e.file,e.active_user),t?(null!=(i=__CONDITIONAL_JS__.OpenWithMicrosoftLogger)&&i.log_open_button_pressed(e.active_user.id,We.file_extension(e.file.filename).toLowerCase(),e.file.ns_id,e.file.ns_path),n=t.uri+"?hpt_click_ts="+Date.now(),He.redirect(n)):void 0}}(this),C=function(e){return function(t,r,o){var s,a,l,u,d,c,h,f,p,g;return p=[],h=null!=r,h&&(r.can_open_directly||null==r.can_open_directly)&&(s=r.open_application_name||At("Open"),f=At("Desktop"),__CONDITIONAL_JS__.UnityFeatures.client_supports_open_in_file_browser()&&(f=At("Open in %(app_name)s").format({app_name:s})),p.push({id:"ow_desktop",label:f,icon:"ow_desktop",callback:m})),t&&(c=__CONDITIONAL_JS__.OpenWith.get_open_handler_for(e.file,e.active_user),p.push({id:"ow_web",label:c.name,icon:c.icon,callback:w})),h&&__CONDITIONAL_JS__.UnityFeatures.client_supports_open_in_file_browser()&&(d=r.file_browser_display_name||At("File Browser"),f=At("Show in %(file_browser)s").format({file_browser:d}),!h||r.can_open_directly||t||(_=f),p.push({id:"ow_folder",label:f,icon:"ow_folder",callback:v})),k(_,p),l=t||h?!h:!1,l||o?e._show_more_button(o,l):e._hide_more_button(),a=function(t,n,i,r){return e._open_button_update_state_timeout&&clearTimeout(e._open_button_update_state_timeout),e._open_button_update_state_timeout=setTimeout(function(){return e._trigger_openwith_state_update({user_id:t,button_display_state:n,file_extension:i,target_button:r}),e._open_button_update_state_timeout=null},200)},u=We.file_extension(e.file.filename).toLowerCase(),t?h?a(e.active_user.id,"visible",u,n):a(e.active_user.id,"visible",u,i):h&&r.can_open_directly&&(null!=(g=__CONDITIONAL_JS__.OpenWith)?g.is_adobe_app(r.open_application_identifier):void 0)?a(e.active_user.id,"visible",u,i):a(null,"hidden",null,null)}}(this),E=function(n){return null!=t&&t.toggleClass("shown",n),e.toggle(!n)},k=function(e,t){return t instanceof Array||(t=[t]),0===t.length?E(!1):1===t.length?d(e,t[0].callback):h(e,t)},d=function(e,n){return null!=t||null!=i?(E(!0),t.removeClass("split"),i.text(e),i.off("click").on("click",n)):void 0},h=function(e,r){var s,a,_,l,u;if(null!=t||null!=i||null!=n){for(E(!0),t.addClass("split"),i.text(e),s=o.find(".openwith-dropdown"),i.off("click").on("click",function(e){return r[0].callback(e)}),n.off("click").on("click",function(e){var t;return t=pe(this).parent().siblings(".openwith-dropdown"),t.is(":visible")?void 0:(t.removeAttr("style"),Gn.show(t,this,null,!0),e.stopPropagation())}),s.find("li").hide(),a=function(e){var t;return t=s.find("."+e.id),t.find("a .sprite-text-inner").text(e.label),G.src(t.find("a .sprite")[0],"web",e.icon),t.find("a").off("click").on("click",function(t){return t.preventDefault(),e.callback(t)}),t.show()},_=0,l=r.length;l>_;_++)u=r[_],a(u);return pe("#file-viewer-container").off("click",Gn.hide_all).on("click",Gn.hide_all)}},x=!!a(),l=!!s(this.file),u=!!this.file.tkey,C(l,null,u),x?(f=function(e){var t,n;return n=function(t){return e.file_browser_display_name=t,C(l,e,u)},t=function(){return C(l,null,u)},__CONDITIONAL_JS__.UnityFeatures.file_browser_display_name(n,t)},(null!=(b=__CONDITIONAL_JS__.UnityCheckFileCache)?b.is_cached_and_locally_available(this.file.ns_id,this.file.ns_path):void 0)?f(null!=(y=__CONDITIONAL_JS__.UnityCheckFileCache)?y.get(this.file.ns_id,this.file.ns_path):void 0):(p=function(e){return e.is_locally_available?f(e):void 0},__CONDITIONAL_JS__.UnityFeatures.check_file(this.file.ns_id,this.file.ns_path,this.file.user_id,p))):void 0},_show_more_button:function(e,t){var n,i,r,o,s;return s=pe("#file-viewer"),n=s.find(".more-options-button"),n.show(),r=s.find(".more-options-dropdown"),n.on("click",function(e){return r.is(":visible")?void 0:(Gn.show(r,n,null,!0),e.stopPropagation())}),pe("#file-viewer-container").on("click",Gn.hide_all),o=r.find(".remove-link"),o.off("click"),e?(o.show(),o.on("click",function(e){return function(t){return Gn.hide_all(),On.confirm_remove(e.file.filename,e.file.tkey,0,0,0,e.file.user_id)}}(this))):o.hide(),i=r.find(".download-button"),i.toggle(t)},_hide_more_button:function(){var e,t;return t=pe("#file-viewer"),e=t.find(".more-options-button"),e.off("click").hide(),pe("#file-viewer-container").off("click",Gn.hide_all),t.find(".remove-link").off("click")},_initial_resize:function(){var e;if(!this.is_loaded)return e=function(){return pe("window").trigger("resize")},setTimeout(e,0)},_get_progressive_url:function(e,t){var n,i,r,o;return o=this.active_user,e=this._get_preview_type_from_extension(e),r=s.parse(t),i=!1,"doc"===e||"key"===e||"keynote"===e||"adobecs"===e?"pdf-js"!==c.PDF_PREVIEW_MODE&&(r=r.updateQuery({post_message_on_failure:1})):"xls"===e&&(n="xls/preview"),n&&(i?r.setAuthority(he.WEBSERVER):r.setAuthority(r.getAuthority().replace("dl-web","dl-doc")),r.setPath(r.getPath().replace("/pri/get/","/get/")),r.setPath(r.getPath().replace("/get/","/"+n+"/"))),r=r.updateQuery({get_preview:1,saveas:this._is_saveas_experiment_enabled()?1:0})},_get_pdf_js_url:function(e){return"pdf-js"===c.PDF_PREVIEW_MODE&&(e=s.parse(C.static_url_pdfjs_viewer)),e},_preview_is_progressive:function(e){return e=this._get_preview_type_from_extension(e),"doc"===e||"ppt"===e||"xls"===e||"key"===e||"keynote"===e||"eps"===e||"ai"===e},_preview_progressive_try:function(e){var t,n,i;return this._preview_is_progressive(e)?(i=this.file.doc_preview_status)===c.DOC_PREVIEW_IN_PROGRESS||i===c.DOC_PREVIEW_UNAVAILABLE_OTHER?!0:(e=this._get_preview_type_from_extension(e),t=this.file.doc_preview_status===c.DOC_PREVIEW_UNAVAILABLE_FAILED,n="key"===e||"keynote"===e,t||n):!1},_set_previews_sandbox_params:function(e,t){return e=this._get_preview_type_from_extension(e),"xls"!==e?"":null},_prepare_annotation_url:function(e){return this._is_annotation_marker_enabled()&&(e=e.updateQuery("annotation_marker","1")),this._is_annotation_highlight_enabled()&&(e=e.updateQuery("annotation_highlight","1")),this._is_annotation_region_enabled()&&(e=e.updateQuery("annotation_region","1")),e},_render_preview:function(e,t,n){var i,r,o,a,_,l,u,d,h,f,p,m,v,g,w,b,y,k,E,x,C,S;if(null==e&&(e=!1),null==t&&(t=!0),null==n&&(n=null),g=function(e){return function(){return e._remove_loading(),"function"==typeof n?n():void 0}}(this),e&&this._remove_loading(!1),b=pe("#file-viewer .preview-content-container"),!(b.find("iframe").length>0)){if(this.file.htmlified_link)return d=pe("<iframe/>",{src:this.file.htmlified_link,sandbox:"allow-modals allow-scripts allow-forms"}),b.append(d),d.on("load",g);if("doc"===this.file.preview_type)return o=this._get_extension(this.file.filename),r=this._get_preview_type_from_extension(o),S=this._get_progressive_url(o,this.file.direct_blockserver_link),t||(S=S.updateQuery({generate_preview:1}),S.setAuthority(S.getAuthority().replace("dl-web","dl-doc"))),f="ppt"===r,S.updateQuery("sjid",this.file.sjid),this._pdfLoader.openFile(S,{presentationMode:f}),S=this._get_pdf_js_url(),S=S.updateQuery(A.UID_PARAM_NAME,this.active_user),S=this._prepare_annotation_url(S),d=pe("<iframe/>",{src:String(S),type:"application/pdf"}),d.attr("id","pdf-embed-iframe"),d.addClass("pdfjs"),b.append(d),d.on("load",g);if("html"===this.file.preview_type)return d=pe("<iframe/>",{src:this.file.href,sandbox:""}),b.append(d),d.on("load",g);if("excel"===this.file.preview_type)return S=this._get_progressive_url("xls",this.file.direct_blockserver_link),d=pe("<iframe/>",{src:S,sandbox:"allow-modals allow-scripts allow-forms"}),this._set_previews_sandbox_params("xls",d),b.append(d),d.on("load",g);if("keynote"===this.file.preview_type)return S=this._get_progressive_url("html",this.file.href),S=S.updateQuery({generate_preview:1}),S=S.updateQuery({post_message_on_failure:1}),d=pe("<iframe/>",{src:S,type:"text/html"}),b.append(d),d.on("load",g);if("adobecs"===this.file.preview_type)return S=this._get_progressive_url("adobecs",this.file.direct_blockserver_link),S=S.updateQuery({generate_preview:1}),this._pdfLoader.openFile(S),S=this._get_pdf_js_url(),S=S.updateQuery(A.UID_PARAM_NAME,this.active_user),S=this._prepare_annotation_url(S),d=pe("<iframe/>",{src:String(S),type:"application/pdf"}),d.attr("id","pdf-embed-iframe"),d.addClass("pdfjs"),b.append(d),d.on("load",g);if("linkfile"===this.file.preview_type)return this._remove_loading(),this._render_linkfile();if(i=this.currentFlippableFileIndex(),_=this._get_extension(this.file.filename),gt.isFlippable(this.file.preview_type)){if(pe("#file-viewer .loading").css("z-index","1"),"video"===this.file.preview_type)k=this.file.video_transcode_url,C=this.file.thumbnail_url_tmpl;else if("photo"===this.file.preview_type)for(k=this.file.thumbnail_url_tmpl,"gif"===_&&this.file.bytes<=c.MAX_GIF_FILE_SIZE_B&&(k=s.parse(this.file.href).updateQuery({raw:1}).toString()),C=this.file.thumbnail_url_tmpl,E=[1,2,3,4,5,6,-1,-2],p=0,m=E.length;m>p;p++)u=E[p],h=i+u,h>=0&&h<this.flippable_files.length&&(a=this.flippable_files[h],w=a.preview_url||a.thumbnail_url_tmpl,fe.preloadImage(w));return l={"preview-type":this.file.preview_type,"thumbnail-url-tmpl":C,"preview-url":k,"file-extension":_,"file-meta":{filename:this.file.filename,mtime:this.file.ts,formattedSize:this.file.size},index:i,count:this.flippable_files.length,totalFiles:this.total_files,onPrevious:function(e){return function(){return e.loadPreviousFlippable()}}(this),onNext:function(e){return function(){return e.loadNextFlippable()}}(this),onLoad:g,onError:function(e){return function(){e._remove_loading()}}(this)},(null!=(x=this._preview_flippable_component)?x.isMounted():void 0)?(v=this._preview_flippable_component.props,this._preview_flippable_component.setProps(l)):(y=_e.createElement(gt,l),this._preview_flippable_component=_e.render(y,b.get(0)))}return this._render_blank()}},post_preview_message:function(e){var t,n,i,r,o,s,a,_,l;for(i=pe("#file-viewer .preview-content-container iframe"),_=[],r=0,o=i.length;o>r;r++)n=i[r],l=n.src,a="://",s=l.indexOf(a),t=-1===s?l.indexOf("/"):l.indexOf("/",s+a.length),-1!==t&&(l=l.substring(0,t)),_.push(n.contentWindow.postMessage(e,l));return _},_watchFile:function(){return ee.getGandalfRule("tap_to_refresh")?this.watcher=new f(this.file,this.active_user,this._rerenderPreview.bind(this)):void 0},_rerenderPreview:function(){var e;return e=pe("#file-viewer .preview-content-container iframe"),e.attr("src",e.attr("src"))},_unwatchFile:function(){var e;return null!=(e=this.watcher)&&e.stop(),delete this.watcher},loadPreviousFlippable:function(){var e,t;return gt.isFlippable(this.file.preview_type)?(t=this.currentFlippableFileIndex()>0?this.currentFlippableFileIndex()-1:this.flippable_files.length-1,this.load(this.flippable_files[t]),this.set_preview_url(),e=this._getFilesToPreloadActivities(),pe("#file-viewer").trigger("db:filepreview:prev",[this.file,this.file_view_target,this.active_user.id,e])):void 0},loadNextFlippable:function(){var e,t;return gt.isFlippable(this.file.preview_type)?(t=this.currentFlippableFileIndex()<this.flippable_files.length-1?this.currentFlippableFileIndex()+1:0,this.load(this.flippable_files[t]),this.set_preview_url(),e=this._getFilesToPreloadActivities(),pe("#file-viewer").trigger("db:filepreview:next",[this.file,this.file_view_target,this.active_user.id,e])):void 0},_listen:function(){var e,t,n;return e=pe("#file-viewer"),this._pdfLoader.startListening(),qe.addFileDragEnabledCheck(this._is_browse_drag_enabled),e.find(".js-close-button").on("click",pe.proxy(this._on_close,this)),this._watchFile(),this.has_key_listener||(z("esc",this.KEY_SCOPE,function(e){return function(t){return et.isFullscreen()||Oe.focus_in_input()||Oe.is_input(t.target)||pe(".annotation-bubble").length>0?void 0:e._teardown_and_hide()}}(this)),z("left",this.KEY_SCOPE,function(e){return function(t){return e.loadPreviousFlippable()}}(this)),z("right",this.KEY_SCOPE,function(e){return function(t){return e.loadNextFlippable()}}(this)),this.has_key_listener=!0),this.prev_scope=z.getScope(),z.setScope(this.KEY_SCOPE),this.modal_type===this._MODAL_PREVIEW?(e.find(".share-button").on("click",pe.proxy(this._share,this)),n=function(e){return function(t){return e.file.fq_path.toLowerCase()===t.memo.fq_path.toLowerCase()?(e.file.tkey=t.memo.tkey,e._update_title_bar_buttons()):void 0}}(this),t=function(e){return function(t){return e.file.tkey===t.memo.token?(e.file.tkey=null,e._update_title_bar_buttons()):void 0}}(this),this.share_link_callback=n.bind(this),this.remove_link_callback=t.bind(this),document.observe(a.LINKS_ADD,this.share_link_callback),document.observe(a.LINKS_REMOVE,this.remove_link_callback)):this.modal_type===this._MODAL_FILEINFO&&e.find(".share-button").on("click",pe.proxy(this._share,this)),pe(window).on("resize",pe.proxy(this._resize,this)),this.handleMessageFromChild=function(e){switch(e.action){case"failed":return jr.render_file_failed();case"lock_preview":return jr.preview_locked=!0;case"unlock_preview":return jr.preview_locked=!1;case"toggle_preview_lock":return jr.preview_locked=!jr.preview_locked;case"hide_iframe":return jr._teardown_and_hide();case"loaded":return jr.post_preview_message('{"action":"listening_sfj"}');case"pagerendered":return jr._handle_page_rendered(e.parameters)}},this._frameMessenger=new Be,this._frameMessenger.configureChildMessaging(".preview-content-container > iframe",pe.proxy(this.handleMessageFromChild,this),["failed","lock_preview","unlock_preview","toggle_preview_lock","hide_iframe","loaded","pagerendered"]),this._frameMessenger.startListening(),window.onbeforeunload=function(e){return jr.preview_locked?"":void 0}},_unlisten:function(){var e;return e=pe("#file-viewer"),this._pdfLoader.stopListening(),e.off("click",pe.proxy(this._teardown_and_hide,this)),qe.removeFileDragEnabledCheck(this._is_browse_drag_enabled),e.find("#file-viewer-container").off("click",function(e){return e.stopPropagation();
}),e.find(".js-close-button").off("click",pe.proxy(this._on_close,this)),this.modal_type===this._MODAL_PREVIEW?(e.find(".share-button").off("click",pe.proxy(this._share,this)),e.find(".download-button").off("click"),pe(document).off("click",Gn.hide_all),document.stopObserving(a.LINKS_ADD,this.share_link_callback),document.stopObserving(a.LINKS_REMOVE,this.remove_link_callback)):this.modal_type===this._MODAL_FILEINFO&&e.find(".share-button").off("click",pe.proxy(this._share,this)),pe(window).off("resize",pe.proxy(this._resize,this)),z.setScope(this.prev_scope),this._unwatchFile()},_resize:function(e){},_share:function(e){return ze.ShmodelUILogger.log("via-browse-file-viewer"),e.preventDefault(),new In(this.active_user.id,this.file.fq_path,"file_viewer").show()},_on_close:function(e){return e.preventDefault(),this._teardown_and_hide()},_teardown_and_hide:function(){var e;if(!this.hiding&&(this.hiding=!0,this.clear_preview_url_timer(),this.unload_office_static(),this._trigger_preview_state_update({preview_state:"closed",file_obj:null}),!this.preview_locked||confirm("You have unsaved changes. Are you sure you want to leave this page?")))return this.preview_status_timeout_obj&&(clearTimeout(this.preview_status_timeout_obj),this.preview_status_timeout_obj=null),this.preview_status_request&&(this.preview_status_request.abort(),this.preview_status_request=null),this._file_view_target_is_private()&&_r.set_selected_files(this.file),(this._file_view_target_is_private()||this._file_view_target_is_shared())&&jr.unset_preview_url(),Oe.scroll_unlock_document(),e=pe("#file-viewer"),e.css("pointer-events","none").fadeOut({duration:this._FADE_MSEC,always:function(t){return function(){var n,i,r;et.isFullscreen()&&et.exitFullscreen(),null!=__CONDITIONAL_JS__.UnityFeatures&&(r=At("Download"),n=e.find(".download-button"),n.text(r),n.off("click")),t._hide_more_button(),e.removeClass("has-preview").removeClass("no-preview"),i=e.find(".preview-content-container"),_e.unmountComponentAtNode(i.get(0)),t._preview_flippable_component=null,i.empty(),e.find(".file-thumbnail img").attr({src:""}),e.find(".title-bar .filename").text(""),e.attr({class:""}),t._unlisten(),t._remove_loading(),document.title=t._cached_browser_window_title,t._cached_browser_window_title=null,t.last_file=t.file,t.file=null,t.preview_locked=!1,window.removeEventListener("message",t.preview_lock_listener),t.is_loaded=!1,t.hiding=!1,t.cancel_check_lock(),e.trigger("db:filepreview:close")}}(this)})},_handle_page_rendered:function(e){var t,n,i,r,o,s,a,_,l;if(!this._first_render_completed){for(t=We.file_extension_for_logging(this.file.filename),l=e.stats,s=null!=(null!=(a=this.file)?a.bytes:void 0)?this.file.bytes:0,r=pe.extend(e.attributes,{total_time:Date.now()-this._start_time,file_ext:t,source:"file-viewer",originalSize:s,docPreviewStatus:this.file.doc_preview_status}),n=0,i=l.length;i>n;n++)_=l[n],o=function(){switch(_.name){case"Page Request":return"viewer_page_request_time";case"Rendering":return"viewer_rendering_time";case"Overall":return"viewer_overall_time"}}(),r[o]=_.end-_.start;return ze.UserActivityLogger.log("web","file_view_first_page_rendered",r),ze.PreviewActivityLogger.log("file_view_first_page_rendered",{file_ext:t,extra:JSON.stringify(r)}),this._first_render_completed=!0}},resize:function(){return this._resize(null)},hide:function(){return this._teardown_and_hide()},_is_annotation_marker_enabled:function(){return"True"===pe("#file-viewer").attr("data-docpreview-annotation-marker-enabled")&&this.annotation_enabled_for_this_revision},_is_annotation_highlight_enabled:function(){return"True"===pe("#file-viewer").attr("data-docpreview-annotation-highlight-enabled")&&this.annotation_enabled_for_this_revision},_is_annotation_region_enabled:function(){return"True"===pe("#file-viewer").attr("data-docpreview-annotation-region-enabled")&&this.annotation_enabled_for_this_revision},_is_saveas_experiment_enabled:function(){return"True"===pe("#file-viewer").attr("data-docpreview-saveas-experiment")}};var Br,zr,Vr;Vr=Xe.UnsupportedBrowser={init:function(){return pe("#unsupported-browser-dismiss").on("click",function(e){return e.preventDefault(),Dt.hide(),g.AuthenticatedRequest({url:"/dismiss_browser_msg"})})}},zr=Xe.ExpiredCCNotificationBar={init:function(e){return pe(".expired-dismiss").on("click",function(t){return t.preventDefault(),Dt.hide(),g.AuthenticatedRequest({url:"/dismiss_expired_cc_notification",data:{source:e}})})}},Br=Xe.BetaLocaleNotificationBar={init:function(e){return pe(".beta-locale-dismiss").on("click",function(t){return t.preventDefault(),Dt.hide(),g.AuthenticatedRequest({url:"/dismiss_beta_locale_notification",data:{source:e}})})}};var Hr;Hr=INLINE_JS.viewer=H.get_viewer();var Yr,Wr,Kr,Gr,Jr,Xr,Qr,Zr;if(pe(Sr.check_timezone),window._document_observe_listeners)for(Qr=window._document_observe_listeners,Wr=0,Gr=Qr.length;Gr>Wr;Wr++)Xr=Qr[Wr],document.loaded?Xr.func():document.observe(Xr.event,Xr.func);if(window._jquery_ready_handlers)for(Zr=window._jquery_ready_handlers,Kr=0,Jr=Zr.length;Jr>Kr;Kr++)Yr=Zr[Kr],pe(Yr);return pe(function(){return Event.fire(document,"script:loaded")}),Xe});
//# sourceMappingURL=dropbox.min.js-vfl5lpywM.map